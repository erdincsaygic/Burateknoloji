using ClosedXML.Excel;
using ClosedXML.Graphics;
using DocumentFormat.OpenXml.Bibliography;
using DocumentFormat.OpenXml.Drawing;
using DocumentFormat.OpenXml.Drawing.Charts;
using DocumentFormat.OpenXml.Drawing.Diagrams;
using DocumentFormat.OpenXml.Drawing.Spreadsheet;
using DocumentFormat.OpenXml.ExtendedProperties;
using DocumentFormat.OpenXml.InkML;
using DocumentFormat.OpenXml.Math;
using DocumentFormat.OpenXml.Office2010.Drawing.Slicer;
using DocumentFormat.OpenXml.Office2010.Excel;
using DocumentFormat.OpenXml.Office2013.Drawing.ChartStyle;
using DocumentFormat.OpenXml.Office2016.Drawing.ChartDrawing;
using DocumentFormat.OpenXml.Office2016.Word.Symex;
using DocumentFormat.OpenXml.Office2021.DocumentTasks;
using DocumentFormat.OpenXml.Presentation;
using DocumentFormat.OpenXml.Spreadsheet;
using DocumentFormat.OpenXml.VariantTypes;
using DocumentFormat.OpenXml.Vml;
using DocumentFormat.OpenXml.Wordprocessing;
using Microsoft.Extensions.Hosting;
using Microsoft.VisualBasic;
using MigraDoc.DocumentObjectModel;
using MigraDoc.DocumentObjectModel.Tables;
using Org.BouncyCastle.Asn1.Cms;
using Org.BouncyCastle.Asn1.Crmf;
using Org.BouncyCastle.Asn1.Ocsp;
using Org.BouncyCastle.Asn1.X509;
using Org.BouncyCastle.Crypto.Agreement;
using Org.BouncyCastle.Utilities;
using Org.BouncyCastle.Utilities.Zlib;
using PdfSharp.Pdf.Content.Objects;
using PdfSharp.Pdf.Filters;
using RestSharp;
using System;
using System.Data;
using System.Diagnostics;
using System.Drawing;
using System.IO.Pipelines;
using System.Net.NetworkInformation;
using System.Numerics;
using System.Reflection;
using System.Runtime.ConstrainedExecution;
using System.Security.Cryptography.Xml;
using System.Security.Policy;
using System.Text.RegularExpressions;
using System.Threading;
using System.Timers;
using static ClosedXML.Excel.XLPredefinedFormat;
using static StilPay.Utility.Helper.Enums;
using static System.Net.Mime.MediaTypeNames;
using static System.Net.WebRequestMethods;

namespace StilPay.Utility.Worker
{
    public static class TSqlScriptOld
    {

        // Güncelleme Atıldı. 31.05.2023 12:00 Erdinç
        //-------------------------------------------------------VERSİYON SONU ----------------------------------------------------------------------------------

        // ALTER TABLE dbo.CompanyFinanceTransaction ADD
        // Piece decimal (18, 2) NULL

        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------
        //        ALTER Proc[dbo].[CompanyFinanceTransaction_Insert]

        //        @IDOut nvarchar(50) output,
        //        @CDate datetime,
        //        @CUser nvarchar(50),
        //        @IDCompany nvarchar(50),
        //      @IDBankAccount nvarchar(50),
        //      @IDBankAccount2 nvarchar(50),
        //      @Amount decimal (18,2),
        //      @Description nvarchar(100),
        //      @PaymentMethod int,
        //      @TransactionType int,
        //      @TransactionDetailType int,
        //      @TransactionDate datetime,
        //        @CompanyIntegrationType int,
        //      @Piece decimal (18,2)
        //      AS
        //      BEGIN
        //       BEGIN TRY
        //        SET @IDOut = NEWID()
        //        INSERT INTO CompanyFinanceTransaction(ID, CDate, CUser , IDCompany, IDBankAccount, IDBankAccount2 , Amount, Description , PaymentMethod , TransactionType , TransactionDetailType , TransactionDate, CompanyIntegrationType, Piece )

        //        VALUES(@IDOut, @CDate, @CUser , @IDCompany, @IDBankAccount , @IDBankAccount2, @Amount, @Description , @PaymentMethod , @TransactionType , @TransactionDetailType , @TransactionDate, @CompanyIntegrationType, @Piece )
        //        SELECT @IDOut

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //      END
        //     GO
        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------

        //        ALTER Proc[dbo].[CompanyFinanceTransaction_Update]
        //        @IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@IDBankAccount nvarchar(50),
        //@IDBankAccount2 nvarchar(50),
        //@Amount decimal (18,2),
        //@Description nvarchar(100),
        //@PaymentMethod int,
        //@TransactionType int,
        //@TransactionDetailType int,
        //@TransactionDate datetime,
        //@CompanyIntegrationType int,
        //@Piece decimal (18,2)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        UPDATE CompanyFinanceTransaction SET MUser = @MUser, MDate = @MDate, IDCompany = @IDCompany, @IDBankAccount = IDBankAccount, @IDBankAccount2 = IDBankAccount2, @Amount = Amount, Description = @Description,
        //         PaymentMethod = @PaymentMethod, TransactionType = @TransactionType, TransactionDetailType = @TransactionDetailType, TransactionDate = @TransactionDate,
        //         CompanyIntegrationType = @CompanyIntegrationType, @Piece = Piece

        //        WHERE ID = @ID


        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END
        //GO
        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------

        //        ALTER Proc[dbo].[CompanyBankAccounts_TotalCreditCardSum]
        //        @IDCompany nvarchar(50),
        //@IDBank nvarchar(50)
        //AS
        //BEGIN


        //        select TOP(1)  1 as ID, isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount, 0 as CreditCardAmount , 0 as EftAmount ,
        //			isnull(sumT.NetAmount,0) as NetAmount , isnull(CountNetAmount,0) - isnull(Piece,0) as CountNetAmount
        //        from Settings s left join
        //        (
        //            select 1 as ID , SUM(Amount) AS Amount, SUM(IncomeAmount) as IncomeAmount ,
        //            SUM(ExpenseAmount) as ExpenseAmount, SUM(Piece) as Piece from  (
        //            select sum(Amount) as Amount ,
        //				case when TransactionType = 1 then sum(isnull(Amount,0)) else 0 end as IncomeAmount,
        //				case when TransactionType = 2 then sum(isnull(Amount,0)) else 0 end as ExpenseAmount,
        //				SUM(isnull(Piece,0)) as Piece
        //             from CompanyFinanceTransaction
        //             where CompanyIntegrationType = 1 
        //			  and PaymentMethod = 2

        //            group by TransactionType ) as Total
        //		) as AmountTotal on AmountTotal.ID = 1 
        //		left join(
        //                select 1 as ID, SUM(isnull(IncomeAmount,0)) - SUM(isnull(ExpenseAmount,0)) AS Amount, 0 as CreditCardAmount , 0 as EftAmount , SUM(NetAmount) - SUM(ExpenseNetAmountTotal)- SUM(ExpenseNetAmount)  AS NetAmount, SUM(CountNetAmount) AS CountNetAmount

        //                    from(
        //                            Select sum((Total - isnull(CompanyCommission,0))) as NetAmount ,  count((NetTotal)) as CountNetAmount ,
        //							case when IDActionType IN(100,110) then sum(isnull(Total,0)) else 0 end as IncomeAmount,
        //							case when IDActionType IN(90) then sum(isnull(Total,0)) else 0 end as ExpenseAmount,
        //							case when IDActionType IN(90) then sum((isnull(cr.Amount,0) - isnull(CompanyCommission,0))) else 0 end as ExpenseNetAmount,
        //							case when IDActionType IN(90) then sum((Total - isnull(CompanyCommission,0))) else 0 end as ExpenseNetAmountTotal
        //                            From CompanyTransactions t

        //                            left join CreditCardPaymentNotifications cs on cs.Id = t.Id
        //                            left join (Select cr.ID , cr.TransactionID , cpn.PayNKolayTransactionReferenceCode, cr.Amount From CompanyRebateRequests cr

        //                                        inner join CompanyTransactions t on t.ID = cr.ID

        //                                       inner join CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID) cr on cr.ID = t.Id
        //                            where IDActionType IN(100,110,90)

        //                            and(cs.PayNKolayTransactionReferenceCode is null and cr.PayNKolayTransactionReferenceCode is null )

        //                            group by IDActionType


        //					) as AmountTotal
        //			) as sumT ON sumT.ID = 1

        //		UNION ALL


        //        select TOP(1)  2 as ID, isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount, 0 as CreditCardAmount , 0 as EftAmount,
        //		isnull(sumT.NetAmount,0) as NetAmount , isnull(CountNetAmount,0) - isnull(Piece,0)  as CountNetAmount
        //        from Settings s left join
        //        (
        //             select 2 as ID , SUM(Amount) AS Amount, SUM(IncomeAmount) as IncomeAmount ,
        //              SUM(ExpenseAmount) as ExpenseAmount, SUM(Piece) as Piece from  (

        //              select  2 as ID , sum(Amount) as Amount ,
        //				case when TransactionType = 1 then sum(isnull(Amount,0)) else 0 end as IncomeAmount,
        //				case when TransactionType = 2 then sum(isnull(Amount,0)) else 0 end as ExpenseAmount,
        //				 SUM(isnull(Piece,0)) as Piece
        //                 from CompanyFinanceTransaction
        //                 where CompanyIntegrationType = 2 
        //				  and PaymentMethod = 2

        //                group by TransactionType 

        //			) as Total
        //		) as AmountTotal on AmountTotal.ID = 2 
        //		left join(
        //                select 2 as ID, SUM(isnull(IncomeAmount,0)) - SUM(isnull(ExpenseAmount,0)) AS Amount, 0 as CreditCardAmount , 0 as EftAmount , SUM(NetAmount) - SUM(ExpenseNetAmountTotal)- SUM(ExpenseNetAmount)  AS NetAmount, SUM(CountNetAmount) AS CountNetAmount

        //                    from(
        //                            Select sum((Total - isnull(CompanyCommission,0))) as NetAmount ,  count((NetTotal)) as CountNetAmount ,
        //							case when IDActionType IN(100,110) then sum(isnull(Total,0)) else 0 end as IncomeAmount,
        //							case when IDActionType IN(90) then sum(isnull(Total,0)) else 0 end as ExpenseAmount,
        //							case when IDActionType IN(90) then sum((isnull(cr.Amount,0) - isnull(CompanyCommission,0))) else 0 end as ExpenseNetAmount,
        //							case when IDActionType IN(90) then sum((Total - isnull(CompanyCommission,0))) else 0 end as ExpenseNetAmountTotal
        //                            From CompanyTransactions t

        //                            left join CreditCardPaymentNotifications cs on cs.Id = t.Id
        //                            left join (Select cr.ID , cr.TransactionID , cpn.PayNKolayTransactionReferenceCode, cr.Amount From CompanyRebateRequests cr

        //                                        inner join CompanyTransactions t on t.ID = cr.ID

        //                                       inner join CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID) cr on cr.ID = t.Id
        //                            where IDActionType IN(100,110,90)

        //                            and(NOT cs.PayNKolayTransactionReferenceCode is null OR NOT cr.PayNKolayTransactionReferenceCode is null )

        //                            group by IDActionType


        //					) as AmountTotal
        //			) as sumT ON sumT.ID = 2

        //END
        //GO

        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------

        // 02-06-2023 12:49 ARDA 
        //ALTER Proc[dbo].[CallbackResponseLogs_GetList]
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@ServiceType nvarchar(100),
        //@TransactionID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT cl.*, c.Title as Company, IIF(pn.TransactionID  is null, cn.TransactionNr, pn.TransactionNr) as TransactionNr FROM CallbackResponseLogs cl

        //    INNER JOIN Companies c on c.ID = cl.IDCompany
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionID= cl.TransactionID

        //    LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID= cl.TransactionID

        //    WHERE (@IDCompany IS NULL OR cl.IDCompany = @IDCompany)

        //          AND(@StartDate IS NULL OR CAST(cl.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(cl.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //    AND(@ServiceType IS NULL OR cl.ServiceType = @ServiceType)

        //          AND(@TransactionID IS NULL OR cl.TransactionID = @TransactionID)


        //    ORDER BY cl.CDate
        //END

        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------

        //delete CreditCardServicesCallbackResponses_Insert

        //

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@Title nvarchar(100),
        //@Amount decimal (18,2),
        //@CostTotal decimal (18,2),
        //@IsEFT bit,
        //@Description nvarchar(250),
        //@RequestNr nvarchar(50),
        //@Status tinyint
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //		--IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany And Status = 1)>0  
        //		--BEGIN
        //		--	SET @CUSTOMERRORMESSAGE += N'Mevcutta 1 çekim talebiniz bulunmaktadır.'
        //		--	RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //		--END
        //        IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(@Amount+@CostTotal)
        //		BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //			RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany AND IBAN = @IBAN AND Amount = @Amount AND RequestNr = @RequestNr)>0
        //		BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Bu talep numarası sistemde mevcut.'
        //			RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE

        //        BEGIN
        //        SET @IDOut = NEWID()

        //            INSERT INTO CompanyWithdrawalRequests(ID, CUser, CDate, IDCompany, TransactionNr, IDBank, IBAN, Title, Amount, CostTotal, IsEFT, Description, RequestNr, Status, MDate)

        //            SELECT @IDOut, @CUser, @CDate, @IDCompany, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank, @IBAN, @Title, @Amount, @CostTotal, @IsEFT, @Description, ISNULL(@RequestNr, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5)), @Status, GETDATE()  FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //        UPDATE Companies SET UsingBalance-=(@Amount+@CostTotal) WHERE ID = @IDCompany

        //            SELECT @IDOut

        //        END
        //        IF(@Status= 2)

        //        BEGIN
        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, MDate, CompanyCommission , CompanyCommissionRate)

        //            SELECT @IDOut, GETDATE(), @IDCompany, '30', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank, @Amount, 0, @CostTotal, @Amount+@CostTotal, GETDATE() ,  0.21 , 0.21  FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //        END

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------


        // Güncelleme Atıldı. 02.06.2023 17:46 Erdinç
        //-------------------------------------------------------VERSİYON SONU ----------------------------------------------------------------------------------

        // 13-06-2023 12:49 ARDA 

        //        ALTER Proc[dbo].[CompanyWithdrawalRequests_Insert]
        //        @IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@Title nvarchar(100),
        //@Amount decimal (18,2),
        //@CostTotal decimal (18,2),
        //@IsEFT bit,
        //@Description nvarchar(250),
        //@RequestNr nvarchar(50),
        //@Status tinyint,
        //@DealerDescription nvarchar(250)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //		--IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany And Status = 1)>0  
        //		--BEGIN
        //		--	SET @CUSTOMERRORMESSAGE += N'Mevcutta 1 çekim talebiniz bulunmaktadır.'
        //		--	RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //		--END
        //        IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(@Amount+@CostTotal)
        //		BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //			RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany AND IBAN = @IBAN AND Amount = @Amount AND RequestNr = @RequestNr)>0
        //		BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Bu talep numarası sistemde mevcut.'
        //			RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE

        //        BEGIN
        //            SET @IDOut = NEWID()

        //            INSERT INTO CompanyWithdrawalRequests(ID, CUser, CDate, IDCompany, TransactionNr, IDBank, IBAN, Title, Amount, CostTotal, IsEFT, Description, RequestNr, Status, MDate, DealerDescription)

        //            SELECT @IDOut, @CUser, @CDate, @IDCompany, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank, @IBAN, @Title, @Amount, @CostTotal, @IsEFT, @Description, ISNULL(@RequestNr, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5)), @Status, GETDATE(), @DealerDescription FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //            UPDATE Companies SET UsingBalance-=(@Amount+@CostTotal) WHERE ID = @IDCompany

        //            SELECT @IDOut

        //        END
        //        IF(@Status= 2)

        //        BEGIN
        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, MDate, CompanyCommission , CompanyCommissionRate)

        //            SELECT @IDOut, GETDATE(), @IDCompany, '30', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank, @Amount, 0, @CostTotal, @Amount+@CostTotal, GETDATE() ,  0.21 , 0.21  FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //        END

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        // CompanyWithdrawalRequests tablosuna DealerDescription nvarchar (250) alanı açıldı

        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------

        // 22.06.2023 Arda

        //CREATE Proc[dbo].[CompanyRebateRequests_GetSingleByTransactionNr]
        //@TransactionNr nvarchar(50)
        //AS
        //BEGIN


        //    SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone FROM CompanyRebateRequests r

        //    INNER JOIN Companies c ON c.ID= r.IDCompany

        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    WHERE 1=1 

        //           AND r.TransactionNr= @TransactionNr

        //    ORDER BY CDate DESC

        //END

        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------

        // 22.06.2023 Arda

        //CREATE TABLE [dbo].PaymentTransferPools(
        //    ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CDate datetime NOT NULL,
        // MDate datetime NULL,
        // TransactionDate datetime NOT NULL,
        //    IDBank nvarchar(2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    SenderName nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    SenderIban nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // Amount decimal (18,2) NOT NULL,
        //    TransactionKey nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    Description nvarchar(250) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    Status tinyint NOT NULL,
        // CONSTRAINT PK_PaymentTransferPools PRIMARY KEY(ID)
        //);

        //CREATE Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //    DECLARE @totalRecords int

        //    SELECT  r.*, b.Name as Bank into #TempTable FROM PaymentTransferPools r
        // INNER JOIN Banks b ON b.ID = r.IDBank
        //    WHERE 1=1

        //          AND ((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)

        //          AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //      AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //  SELECT @totalRecords = COUNT(*) FROM #TempTable
        //  SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //  ORDER BY CDate DESC
        //          OFFSET @OffsetValue ROWS

        //         FETCH NEXT @PageLenght ROWS ONLY
        //    DROP TABLE #TempTable
        //END

        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------

        //25.06.2023
        //ALTER Proc[dbo].[CompanyRebateRequests_GetList]
        //@Status tinyint,
        //@IDCompany nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@PaymentMethod int = 0
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT r.*, c.Title AS Company, c.Phone, m.Name AS Member, m.Phone AS MemberPhone, IIF(pn.MDate  is null, cn.MDate, pn.MDate) as TransactionDate, a.Name AS Modifier, pn.Iban as Iban into #TempTable FROM CompanyRebateRequests r
        //INNER JOIN Companies c ON c.ID=r.IDCompany
        //INNER JOIN Members m ON m.ID= r.IDMember

        //LEFT JOIN PaymentNotifications pn ON pn.TransactionID= r.TransactionID

        //LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID= r.TransactionID

        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //WHERE 1=1 

        //AND (@PaymentMethod = 0 OR (@PaymentMethod = 1 AND pn.Iban is not null) OR(@PaymentMethod = 2 AND pn.Iban is null))
        //AND((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)

        //AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //ALTER Proc[dbo].[Members_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@Phone nvarchar(15),
        //@IdentityNr nvarchar(11),
        //@Name nvarchar(50),
        //@IDMemberType nvarchar(50),
        //@Email nvarchar(50),
        //@BirthYear nvarchar(4),
        //@StatusFlag bit,
        //@ServiceID nvarchar(4)
        //AS
        //BEGIN
        //BEGIN TRY


        //SET @IDOut = NEWID()

        //INSERT INTO Members(ID, CUser, CDate, Phone, UsingBalance, Name, IdentityNr, Email, IDMemberType, BirthYear, StatusFlag, ServiceID )

        //VALUES(@IDOut, @CUser, @CDate, @Phone, 0, @Name, @IdentityNr, @Email, @IDMemberType, @BirthYear, @StatusFlag, @ServiceID )


        //INSERT INTO MemberInvoiceInformations(ID, CUser, CDate, SendStatus, IDCity, IDTown, Address)

        //VALUES(@IDOut, @CUser, @CDate, 0, '00', '0000', '')

        //SELECT @IDOut

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //ALTER Proc[dbo].[Members_GetList]
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT m.*, mt.Name AS MemberTypeName, c.Title as Company into #TempTable FROM Members m
        //INNER JOIN MemberTypes mt ON mt.ID=m.IDMemberType
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID= m.ServiceID

        //INNER JOIN Companies c ON c.ID= ci.ID

        //WHERE (@SearchValue IS NULL OR  (m.Name LIKE '%' + @SearchValue + '%' OR m.Phone LIKE '%' + @SearchValue + '%' ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //USE[DEV_TEST2]
        //GO

        ///****** Object:  Table [dbo].[Members]    Script Date: 25.06.2023 13:29:48 ******/
        //SET ANSI_NULLS ON
        //GO

        //SET QUOTED_IDENTIFIER ON
        //GO

        //ALTER TABLE[dbo].[Members]
        //(

        //[ID][nvarchar](50) NOT NULL,

        //[CDate] [datetime]
        //NOT NULL,

        //[CUser] [nvarchar] (50) NOT NULL,

        //[MDate] [datetime] NULL,
        //[MUser][nvarchar] (50) NULL,
        //[Phone][nvarchar] (15) NOT NULL,

        //[UsingBalance] [decimal](18, 2) NOT NULL,

        //[IdentityNr] [nvarchar] (11) NOT NULL,

        //[Name] [nvarchar] (50) NOT NULL,

        //[IDMemberType] [nvarchar] (50) NOT NULL,

        //[MemberTypeDate] [datetime]
        //NOT NULL,

        //[Email] [nvarchar] (50) NOT NULL,

        //[BirthYear] [nvarchar] (4) NOT NULL,

        //[Address] [nvarchar] (100) NULL,
        //[LoginDate][date] NULL,
        //[IPAddress][nvarchar] (15) NULL,
        //[StatusFlag]
        //[bit]
        //NOT NULL,

        //[ServiceID] [nvarchar] (4) NULL,
        //CONSTRAINT[PK_Members] PRIMARY KEY CLUSTERED
        //(
        //[ID] ASC
        //)WITH(PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON[PRIMARY],
        //CONSTRAINT[| UQ_Members_TelefonNo |] UNIQUE NONCLUSTERED
        //(
        //[Phone] ASC
        //)WITH(PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON[PRIMARY]
        //) ON[PRIMARY]
        //GO

        //ALTER TABLE[dbo].[Members] ADD CONSTRAINT[DF_Members_CUser]  DEFAULT(N'00000000-0000-0000-0000-000000000000') FOR[CUser]
        //GO

        //ALTER TABLE[dbo].[Members] ADD CONSTRAINT[DF_Members_MemberTypeDate]  DEFAULT(getdate()) FOR[MemberTypeDate]
        //GO

        //ALTER TABLE[dbo].[Members] WITH CHECK ADD CONSTRAINT[FK_Members_MemberTypes] FOREIGN KEY([IDMemberType])
        //REFERENCES[dbo].[MemberTypes]
        //([ID])
        //GO

        //ALTER TABLE[dbo].[Members]
        //CHECK CONSTRAINT[FK_Members_MemberTypes]
        //GO

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.*, b.Name as Bank into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //WHERE 1=1

        //AND ((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%STİLPAY%' COLLATE Latin1_General_CI_AI

        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%N Kolay%' COLLATE Latin1_General_CI_AI

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------

        // 25.05.2023 Callback Kontrolü Script

        //CREATE Proc[dbo].[CallbackResponseLogs_GetSingle]
        //@TransactionID nvarchar(50),
        //@TransactionType nvarchar(100)
        //AS
        //BEGIN TRY

        //SELECT* FROM CallbackResponseLogs
        //WHERE(@TransactionID = TransactionID)

        //AND(@TransactionType = TransactionType)
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH

        //------------------------------------------------------- SCRİPT SONU -----------------------------------------------------------------------------------


        //------------------------------------------------------- 04.07.2023 Arda Değişiklik Scriptleri Başlangıç -----------------------------------------------------------------------------------

        //------------------------------------------------------- Tablolara Eklenecek Alanlar Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.CompanyWithdrawalRequests ADD
        //IsBankQueryNr nvarchar (50) NULL

        //ALTER TABLE dbo.CompanyRebateRequests ADD
        //IsBankQueryNr nvarchar (50) NULL

        //ALTER TABLE dbo.SystemSettings ADD
        //DefaultMoneyTransferWithZiraatBank bit NOT NULL DEFAULT 0,
        //DefaultMoneyTransferWithIsBank bit NOT NULL DEFAULT 0,
        //DefaultAcceptPaymentWithZiraatBank bit NOT NULL DEFAULT 0,
        //DefaultAcceptPaymentWithIsBank bit NOT NULL DEFAULT 0


        // Banks Tablosu AccountNr Field ı Length i 15 den 50 ye yükseltildi.

        // Banks Tablosu İş Bankası ve Ziraat Verileri DEV_TEST2 De Olduğu gibi güncellenmesi gerekiyor

        // ActionTypes Tablosuna  120	Üye İşyeri Bakiye Arttırma ve 130	Üye İşyeri Bakiye Azaltma eklenecek

        //------------------------------------------------------- CompanyWithdrawalRequests_SetStatus Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null
        //AS
        //BEGIN
        //BEGIN TRY

        //UPDATE CompanyWithdrawalRequests SET MUser = @MUser, MDate = IIF(@MDate is null, GETDATE(), @MDate), Description = @Description, Status = @Status, IsBankQueryNr = @IsBankQueryNr WHERE ID = @ID AND Status = 1

        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //SELECT ID, GETDATE(), IDCompany, '30', MDate, TransactionNr, IDBank, Amount, 0, CostTotal, Amount+CostTotal,  0.21 , 0.21  FROM CompanyWithdrawalRequests WHERE ID = @ID

        //END
        //ELSE IF(@Status= 3)

        //BEGIN
        //UPDATE Companies SET UsingBalance+=T.Total
        //FROM
        //(SELECT IDCompany, (Amount+CostTotal) AS Total FROM CompanyWithdrawalRequests WHERE ID = @ID)T
        //WHERE Companies.ID=T.IDCompany
        //END

        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- CompanyWithdrawalRequests_Insert Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@Title nvarchar(100),
        //@Amount decimal (18,2),
        //@CostTotal decimal (18,2),
        //@IsEFT bit,
        //@Description nvarchar(250),
        //@RequestNr nvarchar(50),
        //@Status tinyint,
        //@DealerDescription nvarchar(250),
        //@IsBankQueryNr nvarchar(50) = null
        //AS
        //BEGIN
        //BEGIN TRY

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany And Status = 1)>0  
        //--BEGIN
        //--	SET @CUSTOMERRORMESSAGE += N'Mevcutta 1 çekim talebiniz bulunmaktadır.'
        //--	RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--END
        //IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(@Amount+@CostTotal)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany AND IBAN = @IBAN AND Amount = @Amount AND RequestNr = @RequestNr)>0
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu talep numarası sistemde mevcut.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //SET @IDOut = NEWID()

        //INSERT INTO CompanyWithdrawalRequests(ID, CUser, CDate, IDCompany, TransactionNr, IDBank, IBAN, Title, Amount, CostTotal, IsEFT, Description, RequestNr, Status, MDate, DealerDescription, IsBankQueryNr)

        //SELECT @IDOut, @CUser, @CDate, @IDCompany, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank,
        //@IBAN, @Title, @Amount, @CostTotal, @IsEFT, @Description, ISNULL(@RequestNr, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5)), @Status, GETDATE(), 
        //@DealerDescription,@IsBankQueryNr FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //UPDATE Companies SET UsingBalance-=(@Amount+@CostTotal) WHERE ID = @IDCompany

        //SELECT @IDOut

        //END
        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, MDate, CompanyCommission , CompanyCommissionRate)

        //SELECT @IDOut, GETDATE(), @IDCompany, '30', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank, @Amount, 0, @CostTotal, @Amount+@CostTotal, GETDATE() ,  0.21 , 0.21  FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //------------------------------------------------------- CompanyRebateRequests_SetStatus Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyRebateRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyRebateRequests SET MUser = @MUser, MDate = @MDate, Description = @Description, Status = @Status, IsBankQueryNr = @IsBankQueryNr WHERE ID = @ID AND Status = 1

        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //SELECT cr.ID, GETDATE(), cr.IDCompany, '90', cr.MDate, cr.TransactionNr, cr.IDBank, ct.NetTotal, 0, 0, ct.NetTotal,
        //case when not PayNKolayTransactionReferenceCode is null then dbo.RoundToZero((ct.NetTotal / 100)  * ( 0.77))  else  dbo.RoundToZero((ct.NetTotal / 100)  * ( 1.25))  end,
        //case when not PayNKolayTransactionReferenceCode is null then  0.77 else  1.25 end
        //FROM CompanyRebateRequests cr

        //LEFT JOIN PaymentNotifications pt ON pt.TransactionID=cr.TransactionID
        //LEFT JOIN CreditCardPaymentNotifications ccpt ON ccpt.TransactionID= cr.TransactionID

        //INNER JOIN CompanyTransactions ct ON (ct.TransactionNr= pt.TransactionNr or ct.TransactionNr= ccpt.TransactionNr) AND ct.IDActionType IN ('10', '20', '100', '90')

        //WHERE cr.ID=@ID
        //END

        //ELSE IF(@Status= 3)

        //BEGIN
        //UPDATE Companies SET UsingBalance+=(select ct.NetTotal from CompanyRebateRequests cr

        //left join PaymentNotifications pn on pn.TransactionID=cr.TransactionID
        //left join CreditCardPaymentNotifications ccpt on ccpt.TransactionID= cr.TransactionID

        //inner join CompanyTransactions ct on ct.IDActionType IN ('10', '20', '100') and(ct.TransactionNr= pn.TransactionNr or ct.TransactionNr= ccpt.TransactionNr)

        //where cr.ID=@ID)

        //END

        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- CompanyRebateRequests_Insert Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyRebateRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@TransactionID nvarchar(50),
        //@IsBankQueryNr nvarchar(50) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //IF(Select Count(*) From CompanyRebateRequests Where TransactionID= @TransactionID AND Status IN (1,2))>0
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu işlem numaralı iade talebi sistemde mevcut.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(Select Amount From PaymentNotifications Where TransactionID=@TransactionID)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(Select Amount From CreditCardPaymentNotifications Where TransactionID=@TransactionID)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //SET @IDOut = NEWID()


        //INSERT INTO CompanyRebateRequests(ID, CUser, CDate, TransactionNr, IDCompany, TransactionID, IDMember, IDBank, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, IsBankQueryNr)

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, IDBank, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, 1, @IsBankQueryNr FROM PaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UNION ALL

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, '00' , ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, 1 , @IsBankQueryNr FROM CreditCardPaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UPDATE Companies SET UsingBalance-=(select ct.NetTotal from PaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType IN ('10', '20') and ct.TransactionNr=pn.TransactionNr
        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany

        //UNION ALL

        //select ct.NetTotal from CreditCardPaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType= '100' and ct.TransactionNr= pn.TransactionNr

        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany)

        //WHERE ID = @IDCompany


        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- SystemSettings_Update Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[SystemSettings_Update]
        //@IDOut nvarchar(50) output,
        //@DefaultCreditCardPaymentWithParam bit,
        //@DefaultCreditCardPaymentWithPayNKolay bit,
        //@DefaultTransferBeUsed bit,
        //@DefaultCreditCardBeUsed bit,
        //@DefaultMoneyTransferWithZiraatBank bit,
        //@DefaultMoneyTransferWithIsBank bit,
        //@DefaultAcceptPaymentWithZiraatBank bit,
        //@DefaultAcceptPaymentWithIsBank bit
        //AS
        //BEGIN
        //UPDATE SystemSettings SET DefaultCreditCardPaymentWithParam=@DefaultCreditCardPaymentWithParam, DefaultCreditCardPaymentWithPayNKolay=@DefaultCreditCardPaymentWithPayNKolay, 
        //DefaultTransferBeUsed=@DefaultTransferBeUsed, DefaultCreditCardBeUsed=@DefaultCreditCardBeUsed, DefaultMoneyTransferWithZiraatBank=@DefaultMoneyTransferWithZiraatBank, 
        //DefaultMoneyTransferWithIsBank=@DefaultMoneyTransferWithIsBank, DefaultAcceptPaymentWithZiraatBank = @DefaultAcceptPaymentWithZiraatBank, DefaultAcceptPaymentWithIsBank = @DefaultAcceptPaymentWithIsBank
        //WHERE ID= '1'
        //SELECT @IDOut = '1'
        //END

        //------------------------------------------------------- Banks_GetActiveList Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[Banks_GetActiveList]
        //AS
        //BEGIN


        //SELECT* FROM Banks
        //WHERE ID NOT IN('00','98','99') AND StatusFlag = 1

        //ORDER BY OrderNr

        //END

        //------------------------------------------------------- Banks_GetList Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[Banks_GetList]
        //AS
        //BEGIN


        //SELECT* FROM Banks
        //WHERE ID NOT IN('00','98','99')

        //ORDER BY OrderNr

        //END

        //------------------------------------------------------- Companies_SetBalance Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[Companies_SetBalance]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@UsingBalance decimal (18,2)
        //AS
        //BEGIN
        //BEGIN TRY

        //DECLARE @OldUsingBalance decimal (18,2)
        //DECLARE @NEWID nvarchar(50)

        //SET @NEWID = NEWID()
        //SET @OldUsingBalance = (Select UsingBalance FROM Companies WHERE ID=@ID)

        //IF(@OldUsingBalance<@UsingBalance )
        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)

        //Select @NEWID, GETDATE(), @ID, '120', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@NEWID,28,5), null,  @UsingBalance - @OldUsingBalance,  0, 0,  
        //@UsingBalance - @OldUsingBalance, null, 0,0,0
        //FROM Companies  c
        //INNER JOIN CompanyIntegrations ci ON ci.ID=@ID
        //WHERE c.ID=@ID
        //END
        //IF(@OldUsingBalance >@UsingBalance )
        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)

        //Select @NEWID, GETDATE(), @ID, '130', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@NEWID,28,5), null,   @OldUsingBalance - @UsingBalance , 0, 0,  
        //@OldUsingBalance - @UsingBalance, null, 0,0,0
        //FROM Companies  c
        //INNER JOIN CompanyIntegrations ci ON ci.ID=@ID
        //WHERE c.ID=@ID
        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- tggrInsertCompanyTransactions Trigger Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER TRIGGER[dbo].[tggrInsertCompanyTransactions]
        //ON[dbo].[CompanyTransactions]
        //AFTER INSERT
        //AS
        //BEGIN

        //declare @id nvarchar(50);
        //declare @idActionType nvarchar(3);
        //declare @idCompany nvarchar(50);
        //declare @netTotal decimal (18,2);

        //select @id = ID, @idActionType = IDActionType, @idCompany = IDCompany, @netTotal = [dbo].RoundToZero(NetTotal)  from inserted


        //If @idActionType = '10' OR @idActionType = '20'

        //Begin
        //declare @IsNotBocked bit = (select ISNULL(IsNotBocked, 0) from PaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked=1
        //End
        //Else If @idActionType = '100' OR @idActionType = '100'

        //Begin
        //declare @IsNotBocked2 bit = (select ISNULL(IsNotBocked, 0) from CreditCardPaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked2=1
        //End
        //Else If @idActionType = '70'

        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End

        //Else If @idActionType='90'
        //Begin
        //UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //End

        //Else If @idActionType='120'
        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End
        //Else If @idActionType='130'
        //Begin
        //UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //End

        //Else
        //Begin

        //IF @idActionType<>'30'
        //Begin
        //IF(Select UsingBalance From Companies Where ID= @idCompany)<@netTotal
        //Begin

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiye yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //End
        //Else

        //Begin
        //UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //End

        //End
        //End

        //END

        //------------------------------------------------------- Fn_CompanyTransactions_GetListBalance Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER FUNCTION[dbo].[Fn_CompanyTransactions_GetListBalance]
        //(
        //@IDCompany nvarchar(50), 
        //@StartDate date = null,
        //@EndDate date = null, 
        //@IDActionType int,
        //@OffsetValue int
        //)
        //RETURNS TABLE
        //AS
        //RETURN

        //WITH CTE AS(
        //SELECT* , ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum

        //FROM CompanyTransactions
        //)

        //SELECT sum(NetTotal) as Balance from(
        //select CASE WHEN t.IDActionType IN (30,40,50,90,130) then sum([dbo].RoundToZero(t.NetTotal)) * -1 else sum([dbo].RoundToZero(t.NetTotal)) end  as NetTotal
        //FROM CTE t

        //WHERE 1=1
        //AND(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@IDActionType IS NULL OR t.IDActionType= @IDActionType)
        //--AND(T.TransactionDate <= @EndDate)

        //AND(RowNum > @OffsetValue)

        //group by t.IDActionType ) as aa

        //------------------------------------------------------- CompanyWithdrawalRequests_Insert Prodecure Değişiklikleri -----------------------------------------------------------------------------------


        //ALTER Proc[dbo].[CompanyWithdrawalRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@Title nvarchar(100),
        //@Amount decimal (18,2),
        //@CostTotal decimal (18,2),
        //@IsEFT bit,
        //@Description nvarchar(250),
        //@RequestNr nvarchar(50),
        //@Status tinyint,
        //@DealerDescription nvarchar(250),
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany And Status = 1)>0  
        //--BEGIN
        //--	SET @CUSTOMERRORMESSAGE += N'Mevcutta 1 çekim talebiniz bulunmaktadır.'
        //--	RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--END
        //IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(@Amount+@CostTotal)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany AND IBAN = @IBAN AND Amount = @Amount AND RequestNr = @RequestNr)>0
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu talep numarası sistemde mevcut.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //SET @IDOut = NEWID()

        //INSERT INTO CompanyWithdrawalRequests(ID, CUser, CDate, IDCompany, TransactionNr, IDBank, IBAN, Title, Amount, CostTotal, IsEFT, Description, RequestNr, Status, MDate, DealerDescription, IsBankQueryNr, SIDBank)

        //SELECT @IDOut, @CUser, @CDate, @IDCompany, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank,
        //@IBAN, @Title, @Amount, @CostTotal, @IsEFT, @Description, ISNULL(@RequestNr, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5)), @Status, GETDATE(), 
        //@DealerDescription,@IsBankQueryNr, @SIDBank FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //UPDATE Companies SET UsingBalance-=(@Amount+@CostTotal) WHERE ID = @IDCompany

        //SELECT @IDOut

        //END
        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, MDate, CompanyCommission , CompanyCommissionRate)

        //SELECT @IDOut, GETDATE(), @IDCompany, '30', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank, @Amount, 0, @CostTotal, @Amount+@CostTotal, GETDATE() ,  0.21 , 0.21  FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- CompanyWithdrawalRequests_SetStatus Prodecure Değişiklikleri -----------------------------------------------------------------------------------


        //ALTER Proc[dbo].[CompanyWithdrawalRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyWithdrawalRequests SET MUser = @MUser, MDate = IIF(@MDate is null, GETDATE(), @MDate), Description = @Description,
        //Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank WHERE ID = @ID AND Status = 1

        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //SELECT ID, GETDATE(), IDCompany, '30', MDate, TransactionNr, IDBank, Amount, 0, CostTotal, Amount+CostTotal,  0.21 , 0.21  FROM CompanyWithdrawalRequests WHERE ID = @ID

        //END
        //ELSE IF(@Status= 3)

        //BEGIN
        //UPDATE Companies SET UsingBalance+=T.Total
        //FROM
        //(SELECT IDCompany, (Amount+CostTotal) AS Total FROM CompanyWithdrawalRequests WHERE ID = @ID)T
        //WHERE Companies.ID=T.IDCompany
        //END


        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //------------------------------------------------------- CompanyRebateRequests_Insert Prodecure Değişiklikleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyRebateRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@TransactionID nvarchar(50),
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //IF(Select Count(*) From CompanyRebateRequests Where TransactionID= @TransactionID AND Status IN (1,2))>0
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu işlem numaralı iade talebi sistemde mevcut.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(Select Amount From PaymentNotifications Where TransactionID=@TransactionID)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(Select Amount From CreditCardPaymentNotifications Where TransactionID=@TransactionID)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //SET @IDOut = NEWID()


        //INSERT INTO CompanyRebateRequests(ID, CUser, CDate, TransactionNr, IDCompany, TransactionID, IDMember, IDBank, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, IsBankQueryNr, SIDBank)

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, IDBank, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, 1, @IsBankQueryNr, @SIDBank FROM PaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UNION ALL

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, '00' , ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, 1 , @IsBankQueryNr, @SIDBank FROM CreditCardPaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UPDATE Companies SET UsingBalance-=(select ct.NetTotal from PaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType IN ('10', '20') and ct.TransactionNr=pn.TransactionNr
        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany

        //UNION ALL

        //select ct.NetTotal from CreditCardPaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType= '100' and ct.TransactionNr= pn.TransactionNr

        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany)

        //WHERE ID = @IDCompany


        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- CompanyRebateRequests_SetStatus Prodecure Değişiklikleri -----------------------------------------------------------------------------------


        //ALTER Proc[dbo].[CompanyRebateRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyRebateRequests SET MUser = @MUser, MDate = @MDate, Description = @Description, Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank WHERE ID = @ID AND Status = 1

        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //SELECT cr.ID, GETDATE(), cr.IDCompany, '90', cr.MDate, cr.TransactionNr, cr.IDBank, ct.NetTotal, 0, 0, ct.NetTotal,
        //case when not PayNKolayTransactionReferenceCode is null then dbo.RoundToZero((ct.NetTotal / 100)  * ( 0.77))  else  dbo.RoundToZero((ct.NetTotal / 100)  * ( 1.25))  end,
        //case when not PayNKolayTransactionReferenceCode is null then  0.77 else  1.25 end
        //FROM CompanyRebateRequests cr

        //LEFT JOIN PaymentNotifications pt ON pt.TransactionID=cr.TransactionID
        //LEFT JOIN CreditCardPaymentNotifications ccpt ON ccpt.TransactionID= cr.TransactionID

        //INNER JOIN CompanyTransactions ct ON (ct.TransactionNr= pt.TransactionNr or ct.TransactionNr= ccpt.TransactionNr) AND ct.IDActionType IN ('10', '20', '100', '90')

        //WHERE cr.ID=@ID
        //END

        //ELSE IF(@Status= 3)

        //BEGIN
        //UPDATE Companies SET UsingBalance+=(select ct.NetTotal from CompanyRebateRequests cr

        //left join PaymentNotifications pn on pn.TransactionID=cr.TransactionID
        //left join CreditCardPaymentNotifications ccpt on ccpt.TransactionID= cr.TransactionID

        //inner join CompanyTransactions ct on ct.IDActionType IN ('10', '20', '100') and(ct.TransactionNr= pn.TransactionNr or ct.TransactionNr= ccpt.TransactionNr)

        //where cr.ID=@ID)

        //END

        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END
        //------------------------------------------------------- 04.07.2023 Arda Değişiklik Scriptleri SON -----------------------------------------------------------------------------------


        //------------------------------------------------------- 11.07.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[PaymentTransferPools_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //SELECT r.*, b.Name as Bank FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //WHERE r.ID= @ID

        //END


        //------------------------------------------------------- 11.07.2023 Arda Değişiklik Scriptleri SON -----------------------------------------------------------------------------------

        //------------------------------------------------------- 17.07.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE FUNCTION[dbo].[Fn_PaymentTransferPools_GetListBalance]
        //(
        //@Status tinyint,
        //@StartDate date = null,
        //@EndDate date = null,
        //@OffsetValue int
        //)
        //RETURNS TABLE
        //AS
        //RETURN

        //SELECT sum([dbo].RoundToZero(MatchesBalance)) as MatchesBalance , sum([dbo].RoundToZero(NotMatchesBalance)) as NotMatchesBalance,
        //sum(MatchesCount) as MatchesCount , sum(NotMatchesCount) as NotMatchesCount from(
        //select CASE WHEN t.Status = 2 then sum([dbo].RoundToZero(t.Amount)) end as MatchesBalance,
        //CASE WHEN t.Status = 1 then sum([dbo].RoundToZero(t.Amount))  end as NotMatchesBalance,
        //CASE WHEN t.Status = 2 then count(*) else 0 end as MatchesCount,
        //CASE WHEN t.Status = 1 then count(*) else 0 end as NotMatchesCount
        //FROM PaymentTransferPools t
        //WHERE 1=1
        //AND(@Status IS NULL OR t.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //group by t.Status ) as aa

        //-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, GetBalance.MatchesBalance, GetBalance.NotMatchesBalance, GetBalance.MatchesCount, GetBalance.NotMatchesCount into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance

        //WHERE 1=1

        //AND (@Status IS NULL  OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR B.Name LIKE '%' + @SearchValue + '%'   ))
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%STİLPAY%' COLLATE Latin1_General_CI_AI

        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%N Kolay%' COLLATE Latin1_General_CI_AI

        //and(Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //------------------------------------------------------- 17.07.2023 Arda Değişiklik Scriptleri SON -----------------------------------------------------------------------------------


        //------------------------------------------------------- 17.07.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------
        //ALTER FUNCTION[dbo].[Fn_PaymentTransferPools_GetListBalance]
        //(
        //@Status tinyint,
        //@StartDate date = null,
        //@EndDate date = null,
        //@OffsetValue int
        //)
        //RETURNS TABLE
        //AS
        //RETURN

        //SELECT sum([dbo].RoundToZero(MatchesBalance)) as MatchesBalance , sum([dbo].RoundToZero(NotMatchesBalance)) as NotMatchesBalance,
        //sum(MatchesCount) as MatchesCount , sum(NotMatchesCount) as NotMatchesCount from(
        //select CASE WHEN t.Status = 2 then sum([dbo].RoundToZero(t.Amount)) end as MatchesBalance,
        //CASE WHEN t.Status = 1 then sum([dbo].RoundToZero(t.Amount))  end as NotMatchesBalance,
        //CASE WHEN t.Status = 2 then count(*) else 0 end as MatchesCount,
        //CASE WHEN t.Status = 1 then count(*) else 0 end as NotMatchesCount
        //FROM PaymentTransferPools t
        //WHERE 1=1
        //AND(@Status IS NULL OR t.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(ISNULL(t.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%STİLPAY%' COLLATE Latin1_General_CI_AI

        //AND(ISNULL(t.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%N Kolay%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(t.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%OVG ELEKTRONİK%' COLLATE Latin1_General_CI_AI
        //group by t.Status ) as aa

        //-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, GetBalance.MatchesBalance, GetBalance.NotMatchesBalance, GetBalance.MatchesCount, GetBalance.NotMatchesCount into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance

        //WHERE 1=1

        //AND (@Status IS NULL  OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR B.Name LIKE '%' + @SearchValue + '%'   ))
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%STİLPAY%' COLLATE Latin1_General_CI_AI

        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%N Kolay%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%OVG ELEKTRONİK%' COLLATE Latin1_General_CI_AI
        //and(Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END


        //------------------------------------------------------- 11.07.2023 Arda Değişiklik Scriptleri SON -----------------------------------------------------------------------------------

        // Güncelleme yapıldı. Erdinç 26.07.2023

        //------------------------------------------------------- 25.07.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //------------------------------------------------------- 1 -----------------------------------------------------------------------------------

        //CREATE TRIGGER[dbo].[tggrUpdateForeignCreditCardPaymentNotifications]
        //ON[dbo].[ForeignCreditCardPaymentNotifications]
        //AFTER UPDATE
        //AS
        //BEGIN

        //declare @id nvarchar(50);
        //declare @Status tinyint;
        //select @id = ID, @Status = Status from inserted


        //IF(@Status= 2)

        //BEGIN
        //DELETE FROM CompanyTransactions WHERE ID = @id

        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate, CompanyCommission , CompanyCommissionRate)

        //SELECT pn.ID, GetDate(), ci.ID, '140', pn.MDate, TransactionNr, pn.Amount, ROUND((pn.Amount* cc.ForeignCreditCardRate/100), 4 ) , 0, ROUND((pn.Amount - (pn.Amount* cc.ForeignCreditCardRate/100)), 4), IDMember, cc.ForeignCreditCardRate , 
        //case when not PayNKolayTransactionReferenceCode is null then ROUND(((pn.Amount / 100)  * ( 3)),4)  else  ROUND(((pn.Amount / 100)  * ( 1.25)),4)  end,
        //case when not PayNKolayTransactionReferenceCode is null then  3 else  1.25 end
        //FROM ForeignCreditCardPaymentNotifications pn

        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //INNER JOIN CompanyCommissions cc ON cc.ID= ci.ID

        //WHERE pn.ID= @id

        //END

        //END

        //------------------------------------------------------- 2 -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.CompanyCommissions ADD
        //ForeignCreditCardRate decimal (5,2),
        //ForeignCreditCardBlocked tinyint 

        //------------------------------------------------------- 3 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyCommissions_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@CreditCardRate decimal (5,2),
        //@CreditCardStatus bit,
        //@CreditCardBlocked tinyint,
        //@TransferRate decimal (5,2),
        //@TransferStatus bit,
        //@TransferBlocked tinyint,
        //@MobilePayRate decimal (5,2),
        //@MobilePayStatus bit,
        //@MobilePayBlocked tinyint,
        //@WithdrawalTransferAmount decimal (5,2),
        //@WithdrawalEftAmount decimal (5,2),
        //@ForeignCreditCardRate decimal (5,2),
        //@ForeignCreditCardBlocked tinyint
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyCommissions SET MUser = @MUser, MDate = @MDate, CreditCardRate = @CreditCardRate, TransferRate = @TransferRate, MobilePayRate = @MobilePayRate,
        //CreditCardStatus = @CreditCardStatus, TransferStatus = @TransferStatus, MobilePayStatus = @MobilePayStatus, CreditCardBlocked = @CreditCardBlocked, TransferBlocked = @TransferBlocked,
        //MobilePayBlocked = @MobilePayBlocked, WithdrawalTransferAmount = @WithdrawalTransferAmount, WithdrawalEftAmount = @WithdrawalEftAmount, ForeignCreditCardRate = @ForeignCreditCardRate,
        //ForeignCreditCardBlocked = @ForeignCreditCardBlocked

        //WHERE ID = @ID


        //DELETE FROM CompanyBanks WHERE ID=@ID
        //INSERT INTO CompanyBanks(ID, IDBank, CUser, CDate) SELECT @ID, ID, @MUser, @MDate FROM Banks WHERE StatusFlag = 1 AND 1=@TransferStatus

        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- 4 -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.CompanyIntegrations ADD
        //ForeignCreditCardBeUsed tinyint, 
        //ForeignCreditCardPaymentWithPayNKolay tinyint,
        //SIDBankForPayments nvarchar(5)

        //------------------------------------------------------- 5 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyIntegrations_SetIframeUseSettings]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@TransferBeUsed bit,
        //@CreditCardBeUsed bit,
        //@ForeignCreditCardBeUsed bit
        //AS
        //BEGIN
        //BEGIN TRY

        //IF @CreditCardBeUsed = 0

        //BEGIN
        //UPDATE CompanyIntegrations SET CreditCardPaymentWithParam=0, CreditCardPaymentWithPayNKolay=0 WHERE ID = @ID

        //END
        //IF @ForeignCreditCardBeUsed = 0
        //BEGIN
        //UPDATE CompanyIntegrations SET ForeignCreditCardPaymentWithPayNKolay=0 WHERE ID = @ID

        //END

        //UPDATE CompanyIntegrations SET TransferBeUsed=@TransferBeUsed, CreditCardBeUsed=@CreditCardBeUsed , ForeignCreditCardBeUsed = @ForeignCreditCardBeUsed WHERE ID=@ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- 6 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyIntegrations_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@SiteUrl nvarchar(100),
        //@CallbackUrl nvarchar(100),
        //@RedirectUrl nvarchar(100),
        //@IPAddress nvarchar(50),
        //@WithdrawalRequestCallback nvarchar(100),
        //@SIDBankForPayments nvarchar(5) = null
        //AS
        //BEGIN
        //BEGIN TRY

        //UPDATE CompanyIntegrations SET MUser = @MUser, MDate = @MDate, SiteUrl = @SiteUrl, CallbackUrl = @CallbackUrl, RedirectUrl = @RedirectUrl, IPAddress = @IPAddress,
        //WithdrawalRequestCallback = @WithdrawalRequestCallback, SIDBankForPayments = @SIDBankForPayments

        //WHERE ID = @ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- 7 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyIntegrations_SetCreditCardPaymentMethod]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@CreditCardPaymentWithParam bit,
        //@CreditCardPaymentWithPayNKolay bit,
        //@ForeignCreditCardPaymentWithPayNKolay bit
        //AS
        //BEGIN
        //BEGIN TRY

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(MAX)= N'MY' + @NewLine
        //IF(Select CreditCardBeUsed From CompanyIntegrations Where ID = @ID) = 0 AND(@CreditCardPaymentWithParam = 1 OR @CreditCardPaymentWithPayNKolay = 1)

        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Ödeme Servisi Ayarları Kredi Kartı Ödemesi Pasif Durumda İse Geçersizdir.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(((Select CreditCardPaymentWithParam From CompanyIntegrations Where ID = @ID) = 1 AND @CreditCardPaymentWithPayNKolay = 1  ) OR
        //((Select CreditCardPaymentWithPayNKolay From CompanyIntegrations Where ID= @ID) = 1 AND @CreditCardPaymentWithParam = 1  ) )

        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı Anda İki Ödeme Servisi Aktif Edilemez.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select ForeignCreditCardBeUsed From CompanyIntegrations Where ID = @ID) = 0 AND(@ForeignCreditCardPaymentWithPayNKolay = 1)

        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Yurt Dışı Kredi Kartı Kullanımı Pasif Durumdayken Aktif Edilemez.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //UPDATE CompanyIntegrations SET CreditCardPaymentWithParam=@CreditCardPaymentWithParam, CreditCardPaymentWithPayNKolay=@CreditCardPaymentWithPayNKolay, 
        //ForeignCreditCardPaymentWithPayNKolay = @ForeignCreditCardPaymentWithPayNKolay WHERE ID=@ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- 8 -----------------------------------------------------------------------------------

        //ALTER FUNCTION[dbo].[Fn_CompanyTransactions_GetProcessBalance]
        //(
        //@IDCompany nvarchar(50),  
        //@StartDate date,
        //@EndDate date
        //)
        //RETURNS TABLE
        //AS
        //RETURN

        //select sum([dbo].RoundToZero(NetTotal)) as NetTotal , sum([dbo].RoundToZero(Total)) as Total , 
        //sum([dbo].RoundToZero(Commission)) as Commission , sum([dbo].RoundToZero(RebateTotal)) as RebateTotal,
        //sum(RebateTotalCount) as RebateTotalCount , sum(CommissionCount) as CommissionCount
        //from(
        //select CASE WHEN t.IDActionType IN (30,40,50,90) then sum(t.NetTotal) * -1 else sum(t.NetTotal) end  as NetTotal,
        //CASE WHEN t.IDActionType IN(30,40,50,90) then sum(t.Total) * -1 else sum(t.Total) end  as Total,
        //CASE WHEN t.IDActionType IN(30,40,50,90) then sum(t.Total)  else 0 end  as RebateTotal,
        //CASE WHEN t.IDActionType IN(30,40,50,90)  then count(*)  else 0 end  as RebateTotalCount,
        //CASE WHEN t.IDActionType IN(30,40,50,90) then  0 else count(*) end  as CommissionCount,
        //sum(Commission) as  Commission
        //FROM CompanyTransactions t

        //WHERE t.IDActionType IN ('10', '20', '70', '90', '100','140')

        //AND(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //AND CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)

        //AND CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)

        //group by t.IDActionType )
        //as aa

        //------------------------------------------------------- 9 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyTransactions_GetProcess]
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT t.ID, t.CDate, t.MDate, t.IDCompany, t.IDActionType, t.TransactionDate,t.TransactionNr, t.IDBank,

        //[dbo].RoundToZero(t.Total) AS Total,

        //[dbo].RoundToZero(t.Commission) as Commission, 
        //ROUND((t.commission / t.total* 100),4) as TransactionTotal,
        //t.CostTotal,
        //[dbo].RoundToZero(t.NetTotal) as NetTotal, 

        //t.IDMember,t.IDCompanyInvoice, at.ActionType, b.Name as Bank, m.Name as Member, 
        //t.CommissionRate  ,
        //GetProcessBalance.NetTotal as Balance, GetProcessBalance.Total as BalanceTotal , 
        //GetProcessBalance.Commission as BalanceCommission ,
        //GetProcessBalance.RebateTotal , GetProcessBalance.RebateTotalCount,
        //GetProcessBalance.CommissionCount

        //--isnull(dbo.CompanyTransactions_GetProcessBalance(@IDCompany, @StartDate, @EndDate, t.TransactionDate),0) as Balance
        //into #TempTable FROM CompanyTransactions t
        //INNER JOIN ActionTypes at ON at.IDActionType=t.IDActionType
        //LEFT JOIN Banks b ON b.ID= t.IDBank

        //LEFT JOIN Members m ON m.ID= t.IDMember

        //cross join dbo.Fn_CompanyTransactions_GetProcessBalance(@IDCompany, @StartDate, @EndDate) as GetProcessBalance
        //WHERE t.IDActionType IN ('10', '20', '70', '90', '100','140')

        //AND(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //AND CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)

        //AND CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)

        //AND(@SearchValue IS NULL OR  (b.Name LIKE '%' + @SearchValue + '%' OR t.TransactionNr LIKE '%' + @SearchValue + '%'  OR t.Total LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable

        //END


        //------------------------------------------------------- 10 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyRebateRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@TransactionID nvarchar(50),
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //IF(Select Count(*) From CompanyRebateRequests Where TransactionID= @TransactionID AND Status IN (1,2))>0
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu işlem numaralı iade talebi sistemde mevcut.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(Select Amount From PaymentNotifications Where TransactionID=@TransactionID)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(Select Amount From CreditCardPaymentNotifications Where TransactionID=@TransactionID)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //SET @IDOut = NEWID()


        //INSERT INTO CompanyRebateRequests(ID, CUser, CDate, TransactionNr, IDCompany, TransactionID, IDMember, IDBank, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, IsBankQueryNr, SIDBank)

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, IDBank, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, 1, @IsBankQueryNr, @SIDBank FROM PaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UNION ALL

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, '00' , ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, 1 , @IsBankQueryNr, @SIDBank FROM CreditCardPaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UNION ALL

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, '00' , ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, 1 , @IsBankQueryNr, @SIDBank FROM ForeignCreditCardPaymentNotifications Where TransactionID=@TransactionID AND Status=2

        //UPDATE Companies SET UsingBalance-=(select ct.NetTotal from PaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType IN ('10', '20') and ct.TransactionNr=pn.TransactionNr
        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany

        //UNION ALL

        //select ct.NetTotal from CreditCardPaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType= '100' and ct.TransactionNr= pn.TransactionNr

        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany

        //UNION ALL

        //select ct.NetTotal from ForeignCreditCardPaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType= '140' and ct.TransactionNr= pn.TransactionNr

        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany)

        //WHERE ID = @IDCompany


        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //------------------------------------------------------- 11 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyRebateRequests_GetList]
        //@Status tinyint,
        //@IDCompany nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@PaymentMethod int = 0
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT r.*, c.Title AS Company, c.Phone, m.Name AS Member, m.Phone AS MemberPhone, a.Name AS Modifier, pn.Iban as Iban into #TempTable FROM CompanyRebateRequests r
        //INNER JOIN Companies c ON c.ID=r.IDCompany
        //INNER JOIN Members m ON m.ID= r.IDMember

        //LEFT JOIN PaymentNotifications pn ON pn.TransactionID= r.TransactionID

        //   LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID= r.TransactionID

        //   LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID= r.TransactionID
        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //WHERE 1=1 

        //AND (@PaymentMethod = 0 OR (@PaymentMethod = 1 AND pn.Iban is not null) OR(@PaymentMethod = 2 AND pn.Iban is null))
        //AND((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)

        //AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //------------------------------------------------------- 12 -----------------------------------------------------------------------------------

        //ALTER FUNCTION[dbo].[CalculateBlockedBalance] (@IDCompany nvarchar(50))
        //RETURNS DECIMAL(18,2) AS
        //BEGIN

        //declare @blockedBalance decimal (18,4);

        //SELECT @blockedBalance = isnull(TUTAR, 0) from(
        //SELECT SUM (TUTAR) AS TUTAR FROM  (
        //SELECT ISNULL([dbo].RoundToZero(ct.NetTotal), 0) AS TUTAR FROM PaymentNotifications r
        //INNER JOIN[dbo].CompanyTransactions ct ON ct.ID = r.ID
        //WHERE ct.IDCompany= @IDCompany AND r.Status= 2 AND r.IsNotBocked= 0

        //UNION ALL

        //SELECT ISNULL([dbo].RoundToZero(ct.NetTotal), 0)  AS TUTAR FROM CreditCardPaymentNotifications r
        //INNER JOIN[dbo].CompanyTransactions ct ON ct.ID = r.ID
        //WHERE ct.IDCompany= @IDCompany AND r.Status= 2 AND r.IsNotBocked= 0

        //UNION ALL

        //SELECT ISNULL([dbo].RoundToZero(ct.NetTotal), 0)  AS TUTAR FROM ForeignCreditCardPaymentNotifications r
        //INNER JOIN[dbo].CompanyTransactions ct ON ct.ID = r.ID
        //WHERE ct.IDCompany= @IDCompany AND r.Status= 2 AND r.IsNotBocked= 0
        //) AS AAA ) as aa

        //RETURN @blockedBalance;
        //END

        //------------------------------------------------------- 13 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[Main_GetNotifyCounts]
        //AS
        //BEGIN


        //SELECT T2.*, PaymentNotifications + CreditCardPaymentNotifications + ForeignCreditCardPaymentNotifications + CompanyPaymentRequests + MemberPaymentRequests + CompanyWithdrawalRequests + MemberWithdrawalRequests + CompanyRebateRequests +  MemberMoneyTransferRequests + CompanyApplications AS TotalPending FROM (
        //Select Sum(PaymentNotifications) as PaymentNotifications, Sum(CreditCardPaymentNotifications) as CreditCardPaymentNotifications, Sum(ForeignCreditCardPaymentNotifications) as ForeignCreditCardPaymentNotifications, Sum(CompanyPaymentRequests) as CompanyPaymentRequests, Sum(MemberPaymentRequests) as MemberPaymentRequests, Sum(CompanyWithdrawalRequests) as CompanyWithdrawalRequests, Sum(MemberWithdrawalRequests) as MemberWithdrawalRequests, Sum(CompanyRebateRequests) as CompanyRebateRequests, Sum(MemberMoneyTransferRequests) as MemberMoneyTransferRequests, Sum(CompanyApplications) as CompanyApplications, Sum(Supports) as Supports From (
        //select Count(*) as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications, 0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from PaymentNotifications where Status= 1

        //union all

        //select 0 as PaymentNotifications, Count(*) as CreditCardPaymentNotifications,  0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from CreditCardPaymentNotifications where Status= 1

        //union all

        //select 0 as PaymentNotifications,  0 as CreditCardPaymentNotifications, Count(*) as ForeignCreditCardPaymentNotifications, 0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from ForeignCreditCardPaymentNotifications where Status= 1

        //union all

        //select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications, Count(*) as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from CompanyPaymentRequests where Status= 1

        //union all

        //select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, Count(*) as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from MemberPaymentRequests where Status= 1

        //union all

        //select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, Count(*) as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from CompanyWithdrawalRequests where Status= 1

        //union all

        //select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, Count(*) as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from MemberWithdrawalRequests where Status= 1

        //union all

        //select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, Count(*) as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from CompanyRebateRequests where Status= 1

        //union all

        //select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests, Count(*) as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from MemberMoneyTransferRequests where Status= 1

        //union all

        //select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, Count(*) as CompanyApplications, 0 as Supports from CompanyApplications
        //union all
        //select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, Count(*) as Supports from Supports where Status= 1
        //)T1
        //)T2

        //END

        //------------------------------------------------------- 15 -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.Banks ADD
        //ActivatedForIFrameSetting bit DEFAULT 0 NOT NULL

        //------------------------------------------------------- 16 -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[Banks_GetBanksForIframeSetting]
        //AS
        //BEGIN


        //SELECT* FROM Banks
        //WHERE ID IN('08','03')
        //ORDER BY OrderNr

        //END

        //------------------------------------------------------- 17 -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[Banks_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@ActivatedForGeneralUse bit = null,
        //@OrderNr tinyint = null,
        //@StatusFlag bit = null
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE Banks SET ActivatedForGeneralUse = @ActivatedForGeneralUse WHERE ID = @ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //------------------------------------------------------- 18 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyBanks_GetList]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //SELECT @ID as ID, b.ID as IDBank, b.Name as Bank, b.Title, b.Branch, b.AccountNr, b.IBAN, b.Img, Cast(IIF(c.IDBank IS NULL, 0, 1) as bit) AS IsActive FROM Banks b
        //LEFT JOIN CompanyBanks c ON b.ID=c.IDBank AND c.ID=@ID
        //ORDER BY b.OrderNr

        //END

        //------------------------------------------------------- 19 -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.Settings
        //ActivatedForGeneralUse bit DEFAULT 0 NOT NULL



        //------------------------------------------------------- 20 -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[ForeignCreditCardPaymentNotifications_GetBlockeds]
        //@IDCompany nvarchar(50),
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN


        //DECLARE @totalRecords int

        //SELECT r.*, [dbo].RoundToZero(t.NetTotal) AS NetTotal, DATEDIFF(day, GetDate(), r.BlockedDate) as BlockedDays into #TempTable  
        //FROM ForeignCreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //INNER JOIN Companies c ON c.ID=ci.ID
        //INNER JOIN CompanyCommissions cc ON cc.ID=c.ID
        //INNER JOIN CompanyTransactions t ON t.ID = r.ID
        //WHERE c.ID=@IDCompany AND r.Status=2 AND Cast(BlockedDate AS DATE)>=CAST(GETDATE() AS DATE) AND r.IsNotBocked=0
        //and (@SearchValue IS NULL OR  (r.TransactionNr LIKE '%' + @SearchValue + '%' OR t.NetTotal LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))
        //ORDER BY BlockedDate ASC


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY BlockedDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable

        //END;


        //------------------------------------------------------- 21 -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[ForeignCreditCardPaymentNotifications_GetList]
        //@Status tinyint,
        //@IDCompany  nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@IsAutoNotification tinyint,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords int
        //    SELECT r.ID, r.CDate,r.MDate,r.ServiceID,r.TransactionNr,r.TransactionID,r.IDMember,r.Phone,r.ActionDate,r.ActionTime,r.Amount,r.SenderName,r.SenderIdentityNr,
        //	r.Description,r.Status,r.BlockedDate,r.IsNotBocked,r.IsAutoNotification,r.CardNumber,r.PayNKolayTransactionReferenceCode,r.CountryCode,
        //	r.MUser,r.MemberIPAddress,r.MemberPort, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, ct.CommissionRate, 
        //	[dbo].RoundToZero(ct.Commission) as Commission, [dbo].RoundToZero(ct.NetTotal) as NetTotal, m2.Name AS Modifier
        //    into #TempTable FROM ForeignCreditCardPaymentNotifications r
        //	INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID

        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //    LEFT JOIN CompanyTransactions ct ON ct.ID = r.ID

        //    WHERE 1=1

        //         AND (@IsAutoNotification IS NULL OR r.IsAutoNotification = @IsAutoNotification)

        //          AND(r.Status= @Status OR (@Status IS NULL AND r.Status IN(2,3)) OR @Status = 4)

        //          AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //          AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //          AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //		  AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //		  AND(@SearchValue IS NULL OR  (m.Name LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //	SELECT @totalRecords = COUNT(*) FROM #TempTable
        // 	SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // 	ORDER BY CDate DESC
        //          OFFSET @OffsetValue ROWS

        //         FETCH NEXT @PageLenght ROWS ONLY
        //    DROP TABLE #TempTable
        //END;

        //------------------------------------------------------- 22 -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[ForeignCreditCardPaymentNotifications_GetNotBlockeds]
        //@IDCompany nvarchar(50),
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN


        //DECLARE @totalRecords int

        //SELECT r.*, [dbo].RoundToZero(t.NetTotal) AS NetTotal, DATEDIFF(day, GetDate(), r.BlockedDate) as BlockedDays into #TempTable  
        //FROM ForeignCreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //INNER JOIN Companies c ON c.ID=ci.ID
        //INNER JOIN CompanyCommissions cc ON cc.ID=c.ID
        //INNER JOIN CompanyTransactions t ON t.ID = r.ID
        //WHERE c.ID=@IDCompany AND r.Status=2 AND Cast(BlockedDate AS DATE)<=CAST(GETDATE() AS DATE) AND r.IsNotBocked=1
        //and (@SearchValue IS NULL OR  (r.TransactionNr LIKE '%' + @SearchValue + '%' OR t.NetTotal LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))
        //ORDER BY  CDate DESC


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY BlockedDays DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable

        //END;

        //------------------------------------------------------- 23 -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[ForeignCreditCardPaymentNotifications_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, m2.Name as Modifier FROM ForeignCreditCardPaymentNotifications r

        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID

        //INNER JOIN Companies c ON c.ID= ci.ID

        //INNER JOIN Members m ON m.ID= r.IDMember

        //INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType

        //LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //WHERE r.ID= @ID

        //END;

        //------------------------------------------------------- 24 -----------------------------------------------------------------------------------

        //create Proc[dbo].[ForeignCreditCardPaymentNotifications_GetSingleByTransactionID]
        //@TransactionID nvarchar(50)
        //AS
        //BEGIN


        //SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone FROM ForeignCreditCardPaymentNotifications r

        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID

        //INNER JOIN Companies c ON c.ID= ci.ID

        //INNER JOIN Members m ON m.ID= r.IDMember

        //WHERE 1=1

        //AND (@TransactionID IS NULL OR r.TransactionID= @TransactionID)

        //ORDER BY CDate DESC

        //END;

        //------------------------------------------------------- 25 -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[ForeignCreditCardPaymentNotifications_GetSingleByTransactionNr]
        //@IDCompany nvarchar(50),
        //@TransactionNr nvarchar(50)
        //AS
        //BEGIN


        //SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, mt.Name AS MemberType FROM ForeignCreditCardPaymentNotifications r

        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID

        //INNER JOIN Companies c ON c.ID= ci.ID

        //INNER JOIN Members m ON m.ID= r.IDMember

        //INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType

        //WHERE c.ID= @IDCompany AND r.Status= 2 AND r.TransactionNr= @TransactionNr

        //END;

        //------------------------------------------------------- 26 -----------------------------------------------------------------------------------


        //CREATE Proc[dbo].[ForeignCreditCardPaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@CountryCode nvarchar(10),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@CardNumber nvarchar(30),
        //@PayNKolayTransactionReferenceCode nvarchar(30)
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--		IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where IDMember= @IDMember And Status = 1)>0  
        //--		BEGIN
        //--			SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //--			RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--		END
        //IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //declare @_isAutoNotification bit = 0;
        //declare @_isAuto bit;
        //declare @_minAmount decimal (18,2);
        //declare @_maxAmount decimal (18,2);
        //declare @_quantity smallint;
        //select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL)
        //begin
        //if(@Amount>=@_minAmount AND @Amount<=@_maxAmount)
        //begin
        //if (select Count(pn.ID) from ForeignCreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //begin

        //set @_isAutoNotification = 1;
        //end
        //end

        //end

        //SET @IDOut = NEWID()

        //INSERT INTO ForeignCreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //IsAutoNotification, Description, CardNumber, PayNKolayTransactionReferenceCode, CountryCode)

        //SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.ForeignCreditCardBlocked, GetDate()), 
        //IIF(cc.ForeignCreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @CardNumber, @PayNKolayTransactionReferenceCode , @CountryCode FROM CompanyCommissions cc

        //INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //WHERE ci.ServiceID= @ServiceID


        //SELECT @IDOut


        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END;

        //------------------------------------------------------- 27 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_SetIPAddress]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MemberIPAddress nvarchar(30),
        //@MemberPort nvarchar(15)
        //AS
        //BEGIN
        //BEGIN TRY

        //UPDATE ForeignCreditCardPaymentNotifications SET MemberIPAddress = IIF(@MemberIPAddress is null, null, @MemberIPAddress), MemberPort = IIF(@MemberPort is null, null, @MemberPort)

        //WHERE ID = @ID

        //SELECT @IDOut = @ID
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END;

        //------------------------------------------------------- 27 -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[ForeignCreditCardPaymentNotifications_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@PayNKolayTransactionReferenceCode nvarchar(30)
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //IF(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=1 AND(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=5
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu bildirim daha önce cevaplanmıştır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //UPDATE ForeignCreditCardPaymentNotifications SET MDate= IIF(@MDate is null, GETDATE(), @MDate), Description=@Description, Status=@Status, PayNKolayTransactionReferenceCode = @PayNKolayTransactionReferenceCode, MUser = @MUser WHERE ID=@ID
        //AND(Status= 1 OR Status = 5)

        //SELECT @IDOut = @ID

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END;

        //------------------------------------------------------- 28 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[Settings_GetList]
        //@ParamType nvarchar(25) = null
        //AS
        //BEGIN

        //SELECT* FROM Settings where @Paramtype IS NULL OR ParamType=@ParamType or ParamType='GENEL'

        //END

        //------------------------------------------------------- 29 -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[Settings_Update]
        //@IDOut nvarchar(50) output,
        //@ParamType nvarchar(25),
        //@ParamDef nvarchar(50),
        //@ParamVal nvarchar(500) = null,
        //@ActivatedForGeneralUse bit = null,
        //@MUser nvarchar(50) = null,
        //@MDate datetime = null
        //AS
        //BEGIN

        //BEGIN TRY

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //IF((Select ActivatedForGeneralUse From Settings Where ParamType= 'Payments' AND ParamDef = 'Withdrawal_Rebate_Is') = 1 
        //AND(@ActivatedForGeneralUse = 1 AND @ParamType = 'Payments' AND @ParamDef = 'Withdrawal_Rebate_Ziraat'))
        //BEGIN
        //UPDATE Settings SET ActivatedForGeneralUse=0 WHERE ParamType = 'Payments' AND ParamDef = 'Withdrawal_Rebate_Is'

        //END

        //IF((Select ActivatedForGeneralUse From Settings Where ParamType= 'Payments' AND ParamDef = 'Withdrawal_Rebate_Ziraat') = 1 
        //AND(@ActivatedForGeneralUse = 1 AND @ParamType = 'Payments' AND @ParamDef = 'Withdrawal_Rebate_Is'))
        //BEGIN
        //UPDATE Settings SET ActivatedForGeneralUse=0 WHERE ParamType = 'Payments' AND ParamDef = 'Withdrawal_Rebate_Ziraat'

        //END

        //UPDATE Settings SET ActivatedForGeneralUse=@ActivatedForGeneralUse, 
        //ParamVal = 
        //CASE
        //    WHEN @ParamVal IS NOT NULL THEN @ParamVal

        //    ELSE ParamVal

        //END
        //WHERE ParamType= @ParamType AND ParamDef = @ParamDef

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //END

        //------------------------------------------------------- 30 -----------------------------------------------------------------------------------

        //CREATE TABLE dbo.ForeignCreditCardPaymentNotifications2(
        //ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //CDate datetime NOT NULL,
        //MDate datetime NULL,
        //ServiceID nvarchar(4) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //TransactionNr nvarchar(24) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //TransactionID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //IDMember nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //Phone nvarchar(15) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //CountryCode nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //ActionDate date NOT NULL,
        //ActionTime nvarchar(5) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //Amount decimal (18,2) NOT NULL,
        //SenderName nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //SenderIdentityNr nvarchar(11) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //Description nvarchar(250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //Status tinyint NOT NULL,
        //BlockedDate date NOT NULL,
        //IsNotBocked bit NOT NULL,
        //IsAutoNotification bit NOT NULL,
        //CardNumber varchar(30) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //PayNKolayTransactionReferenceCode varchar(30) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //MUser varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //MemberIPAddress varchar(30) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //MemberPort varchar(15) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //CONSTRAINT PK_ForeignCreditCardPaymentNotifications2 PRIMARY KEY(ID),
        //CONSTRAINT UQ_ForeignCreditCardPaymentNotifications2 UNIQUE(ServiceID, TransactionID)
        //);


        //ALTER TABLE dbo.ForeignCreditCardPaymentNotifications2 ADD CONSTRAINT FK_ForeignCreditCardPaymentNotifications2_Members FOREIGN KEY(IDMember) REFERENCES dbo.Members(ID);

        //------------------------------------------------------- 25.07.2023 Arda Değişiklik Scriptleri SON -----------------------------------------------------------------------------------


        // Güncelleme atıldı. Erdinç 25.07.2023



        //------------------------------------------------------- 31.07.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyRebateRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyRebateRequests SET MUser = @MUser, MDate = @MDate, Description = @Description, Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank WHERE ID = @ID AND Status = 1

        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //SELECT cr.ID, GETDATE(), cr.IDCompany, '90', cr.MDate, cr.TransactionNr, cr.IDBank, ct.NetTotal, 0, 0, ct.NetTotal,
        //case when not PayNKolayTransactionReferenceCode is null then dbo.RoundToZero((ct.NetTotal / 100)  * ( 0.75))  else  dbo.RoundToZero((ct.NetTotal / 100)  * ( 1.25))  end,
        //case when not PayNKolayTransactionReferenceCode is null then  0.75 else  1.25 end
        //FROM CompanyRebateRequests cr

        //LEFT JOIN PaymentNotifications pt ON pt.TransactionID=cr.TransactionID
        //LEFT JOIN CreditCardPaymentNotifications ccpt ON ccpt.TransactionID= cr.TransactionID

        //INNER JOIN CompanyTransactions ct ON (ct.TransactionNr= pt.TransactionNr or ct.TransactionNr= ccpt.TransactionNr) AND ct.IDActionType IN ('10', '20', '100', '90','140')

        //WHERE cr.ID=@ID
        //END

        //ELSE IF(@Status= 3)

        //BEGIN
        //UPDATE Companies SET UsingBalance+=(select ct.NetTotal from CompanyRebateRequests cr

        //left join PaymentNotifications pn on pn.TransactionID=cr.TransactionID
        //left join CreditCardPaymentNotifications ccpt on ccpt.TransactionID= cr.TransactionID

        //inner join CompanyTransactions ct on ct.IDActionType IN ('10', '20', '100','140') and(ct.TransactionNr= pn.TransactionNr or ct.TransactionNr= ccpt.TransactionNr)

        //where cr.ID=@ID)

        //END

        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER TRIGGER[dbo].[tggrInsertCompanyTransactions]
        //ON[dbo].[CompanyTransactions]
        //AFTER INSERT
        //AS
        //BEGIN

        //declare @id nvarchar(50);
        //declare @idActionType nvarchar(3);
        //declare @idCompany nvarchar(50);
        //declare @netTotal decimal (18,2);

        //select @id = ID, @idActionType = IDActionType, @idCompany = IDCompany, @netTotal = [dbo].RoundToZero(NetTotal)  from inserted


        //If @idActionType = '10' OR @idActionType = '20'

        //Begin
        //declare @IsNotBocked bit = (select ISNULL(IsNotBocked, 0) from PaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked=1
        //End
        //Else If @idActionType = '100'

        //Begin
        //declare @IsNotBocked2 bit = (select ISNULL(IsNotBocked, 0) from CreditCardPaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked2=1
        //End

        //Else If @idActionType = '140'
        //Begin
        //declare @IsNotBocked3 bit = (select ISNULL(IsNotBocked, 0) from ForeignCreditCardPaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked3=1
        //End

        //Else If @idActionType = '70'

        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End

        //Else If @idActionType='90'
        //Begin
        //UPDATE Companies SET UsingBalance=UsingBalance WHERE ID=@idCompany
        //End

        //Else If @idActionType='120'
        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End
        //Else If @idActionType='130'
        //Begin
        //UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //End

        //Else
        //Begin

        //IF @idActionType<>'30'
        //Begin
        //IF(Select UsingBalance From Companies Where ID= @idCompany)<@netTotal
        //Begin

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiye yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //End
        //Else

        //Begin
        //UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //End

        //End
        //End

        //END

        //GO

        //ALTER Proc[dbo].[CompanyRebateRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyRebateRequests SET MUser = @MUser, MDate = @MDate, Description = @Description, Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank WHERE ID = @ID AND Status = 1

        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //SELECT cr.ID, GETDATE(), cr.IDCompany, '90', cr.MDate, cr.TransactionNr, cr.IDBank, ct.NetTotal, 0, 0, ct.NetTotal,


        //case when not ccpt.PayNKolayTransactionReferenceCode is null then dbo.RoundToZero((ct.NetTotal / 100)  * (1)) when not fccpt.PayNKolayTransactionReferenceCode is null then dbo.RoundToZero((ct.NetTotal / 100)  * (3))  else  dbo.RoundToZero((ct.NetTotal / 100)  * ( 1.25))  end,


        //case when not ccpt.PayNKolayTransactionReferenceCode is null then  1 when not fccpt.PayNKolayTransactionReferenceCode is null then 3 else  1.25 end



        //FROM CompanyRebateRequests cr

        //LEFT JOIN PaymentNotifications pt ON pt.TransactionID=cr.TransactionID
        //LEFT JOIN CreditCardPaymentNotifications ccpt ON ccpt.TransactionID= cr.TransactionID

        //LEFT JOIN ForeignCreditCardPaymentNotifications fccpt ON fccpt.TransactionID= cr.TransactionID

        //INNER JOIN CompanyTransactions ct ON (ct.TransactionNr= pt.TransactionNr or ct.TransactionNr= ccpt.TransactionNr or ct.TransactionNr= fccpt.TransactionNr) AND ct.IDActionType IN ('10', '20', '100', '90','140')

        //WHERE cr.ID=@ID
        //END

        //ELSE IF(@Status= 3)

        //BEGIN
        //UPDATE Companies SET UsingBalance+=(select ct.NetTotal from CompanyRebateRequests cr

        //left join PaymentNotifications pn on pn.TransactionID=cr.TransactionID
        //left join CreditCardPaymentNotifications ccpt on ccpt.TransactionID= cr.TransactionID

        //LEFT JOIN ForeignCreditCardPaymentNotifications fccpt ON fccpt.TransactionID= cr.TransactionID

        //inner join CompanyTransactions ct on ct.IDActionType IN ('10', '20', '100','140') and(ct.TransactionNr= pn.TransactionNr or ct.TransactionNr= ccpt.TransactionNr or ct.TransactionNr= fccpt.TransactionNr)

        //where cr.ID=@ID)

        //END

        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyRebateRequests_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //SELECT r.*, c.Title AS Company, c.Phone, m.Name AS Member, m.Phone AS MemberPhone, b.Name as Bank, a.Name AS Modifier , pn.Iban as Iban FROM CompanyRebateRequests r

        //INNER JOIN Companies c ON c.ID= r.IDCompany

        //INNER JOIN Members m ON m.ID= r.IDMember

        //INNER JOIN Banks b ON b.ID= r.IDBank

        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //LEFT JOIN PaymentNotifications pn ON pn.TransactionID= r.TransactionID

        //LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID= r.TransactionID

        //LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID= r.TransactionID

        //WHERE r.ID= @ID

        //END


        // ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

        // Güncelleme atıldı. Erdinç 31.07.2023

        //------------------------------------------------------- 09.08.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE DEV.dbo.CreditCardPaymentNotifications
        //CreditCardPaymentMethodID tinyint 

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@ParamCommission decimal (18,2),
        //@PayNKolayCommission decimal (18,2),
        //@CardNumber nvarchar(30),
        //@PayNKolayTransactionReferenceCode nvarchar(30),
        //@CreditCardPaymentMethodID tinyint
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--		IF(Select Count(ID) From CreditCardPaymentNotifications Where IDMember= @IDMember And Status = 1)>0  
        //--		BEGIN
        //--			SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //--			RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--		END
        //IF(Select Count(ID) From CreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //declare @_isAutoNotification bit = 0;
        //declare @_isAuto bit;
        //declare @_minAmount decimal (18,2);
        //declare @_maxAmount decimal (18,2);
        //declare @_quantity smallint;
        //select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL)
        //begin
        //if(@Amount>=@_minAmount AND @Amount<=@_maxAmount)
        //begin
        //if (select Count(pn.ID) from CreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //begin

        //    set @_isAutoNotification = 1;
        //end
        //end

        //end

        //SET @IDOut = NEWID()

        //INSERT INTO CreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //IsAutoNotification, Description, ParamCommission, PayNKolayCommission, CardNumber, PayNKolayTransactionReferenceCode, CreditCardPaymentMethodID)

        //SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.CreditCardBlocked, GetDate()), 
        //IIF(cc.CreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @ParamCommission, @PayNKolayCommission, @CardNumber, @PayNKolayTransactionReferenceCode, @CreditCardPaymentMethodID FROM CompanyCommissions cc

        //INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //WHERE ci.ServiceID= @ServiceID


        //SELECT @IDOut


        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //ALTER Proc[dbo].[CreditCardPaymentNotifications_GetList]
        //@Status tinyint,
        //@IDCompany  nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@IsAutoNotification tinyint,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT r.ID, r.CDate,r.MDate,r.ServiceID,r.TransactionNr,r.TransactionID,r.IDMember,r.Phone,r.ActionDate,r.ActionTime,r.Amount,r.SenderName,r.SenderIdentityNr,
        //r.Description,r.Status,r.BlockedDate,r.IsNotBocked,r.IsAutoNotification,r.ParamCommission,r.PayNKolayCommission,r.CardNumber,r.PayNKolayTransactionReferenceCode,
        //r.MUser,r.MemberIPAddress,r.MemberPort, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, ct.CommissionRate, 
        //[dbo].RoundToZero(ct.Commission) as Commission, [dbo].RoundToZero(ct.NetTotal) as NetTotal, m2.Name AS Modifier, r.CreditCardPaymentMethodID
        //into #TempTable FROM CreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //INNER JOIN Companies c ON c.ID= ci.ID

        //INNER JOIN Members m ON m.ID= r.IDMember

        //LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //LEFT JOIN CompanyTransactions ct ON ct.ID = r.ID

        //WHERE 1=1

        //AND (@IsAutoNotification IS NULL OR r.IsAutoNotification = @IsAutoNotification)

        //AND(r.Status= @Status OR (@Status IS NULL AND r.Status IN(2,3)) OR @Status = 4)

        //AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (m.Name LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END


        //------------------------------------------------------- 09.08.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyTransactions_GetList]
        //@IDCompany nvarchar(50) = null,
        //@StartDate date = null,
        //@EndDate date = null,
        //@IDActionType nvarchar(3) = null,
        //@IDCompanyInvoice nvarchar(50) = null,
        //@InvoiceStatus bit = null,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int
        //SELECT t.ID, t.CDate, t.MDate, t.IDCompany, t.IDActionType, t.TransactionDate,t.TransactionNr, t.IDBank,
        //t.Total, case when t.IDActionType IN (30) then[dbo].RoundToZero(t.CostTotal) else [dbo].RoundToZero(t.Commission) end as Commission, ROUND((t.commission / t.total* 100),4) as TransactionTotal, [dbo].RoundToZero(t.CostTotal) as CostTotal,[dbo].RoundToZero(t.NetTotal) as NetTotal, t.IDMember,t.IDCompanyInvoice, at.ActionType, b.Name as Bank, 
        //t.CommissionRate,
        //--isnull(dbo.CompanyTransactions_GetListBalance(@IDCompany, @StartDate, @EndDate, @IDActionType, t.TransactionDate),0) as Balance
        //--t.IDActionType AS Balance,
        //GetProcessBalance.Balance as Balance
        //into #TempTable
        //FROM CompanyTransactions t
        //INNER JOIN ActionTypes at ON at.IDActionType=t.IDActionType
        //LEFT JOIN Banks b ON b.ID=t.IDBank
        //LEFT JOIN Companies c ON c.ID = t.IDCompany
        //cross join dbo.Fn_CompanyTransactions_GetListBalance(@IDCompany , @StartDate , @EndDate , @IDActionType, @OffsetValue) as GetProcessBalance
        //WHERE 1=1

        //AND(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@IDActionType IS NULL OR t.IDActionType= @IDActionType)

        //AND(@InvoiceStatus IS NULL OR @InvoiceStatus= 0 OR ISNULL(t.IDCompanyInvoice,'')=ISNULL(@IDCompanyInvoice,''))
        //AND(@SearchValue IS NULL OR  (b.Name LIKE '%' + @SearchValue + '%' OR t.TransactionNr LIKE '%' + @SearchValue + '%'  OR t.Total LIKE '%' + @SearchValue + '%'  OR at.ActionType LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable

        //END







        //------------------------------------------------------- 21.08.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //        CREATE Proc[dbo].[ForeignCreditCardPaymentNotifications_GetPendingList]
        //        AS
        //BEGIN


        //    SELECT* FROM ForeignCreditCardPaymentNotifications
        //    WHERE Status =1 AND IsAutoNotification = 1 AND getdate() >= dateadd(minute, 15, CDate)
        //END

        // Güncellendi Erdinç 21.08.2023 



        //------------------------------------------------------- 22.08.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[AutoCallbackService]
        //AS
        //BEGIN


        //SELECT T3.TransactionID, T3.TransactionType, crl.CDate, crl.ResponseStatus , crl.Callback
        //FROM (
        //SELECT T2.TransactionID, T2.TransactionType, MAX(crl.CDate) AS MaxCDate
        //FROM (
        //SELECT T1.TransactionID, T1.TransactionType
        //FROM (
        //SELECT TransactionID, 1 AS TransactionType
        //FROM PaymentNotifications
        //WHERE Status = 2 OR Status = 3
        //UNION ALL
        //SELECT TransactionID, 2 AS TransactionType
        //FROM CreditCardPaymentNotifications
        //WHERE Status = 2 OR Status = 3
        //UNION ALL
        //SELECT TransactionID, 3 AS TransactionType
        //FROM ForeignCreditCardPaymentNotifications
        //WHERE Status = 2 OR Status = 3
        //UNION ALL
        //SELECT RequestNr AS TransactionID, 4 AS TransactionType
        //FROM CompanyWithdrawalRequests
        //WHERE Status = 2 OR Status = 3
        //-- UNION ALL
        //-- SELECT TransactionID, 5 AS TransactionType
        //-- FROM CompanyRebateRequests
        //-- WHERE Status = 2 OR Status = 3
        //) T1
        //) T2
        //INNER JOIN CallbackResponseLogs crl ON crl.TransactionID = T2.TransactionID
        //WHERE crl.ServiceType LIKE '%STILPAY%'
        //GROUP BY T2.TransactionID, T2.TransactionType
        //) T3
        //INNER JOIN CallbackResponseLogs crl ON crl.TransactionID = T3.TransactionID AND crl.CDate = T3.MaxCDate and crl.ResponseStatus = 0

        //END

        // Güncellendi Erdinç 22.08.2023 





        // Arda Değişiklikler 28.08.2023

        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'IsBankTransfer', N'debtor_account_id', N'209776749', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'IsBankTransfer', N'isbank_client_id', N'89cf105fd3ddd98dcf4173f46d69c088', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'IsBankTransfer', N'isbank_client_secret', N'48c473d04188be1c5f2c0638babf111b', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'IsBankTransfer', N'isbank_client_certificate', N'MIIIKzCCBxOgAwIBAgIQHESDGGlEvcuWNeVTG5IALjANBgkqhkiG9w0BAQsFADCBkTELMAkGA1UEBhMCR0IxGzAZBgNVBAgTEkdyZWF0ZXIgTWFuY2hlc3RlcjEQMA4GA1UEBxMHU2FsZm9yZDEYMBYGA1UEChMPU2VjdGlnbyBMaW1pdGVkMTkwNwYDVQQDEzBTZWN0aWdvIFJTQSBFeHRlbmRlZCBWYWxpZGF0aW9uIFNlY3VyZSBTZXJ2ZXIgQ0EwHhcNMjMwNTMxMDAwMDAwWhcNMjQwNjI5MjM1OTU5WjCBtDEOMAwGA1UEBRMFNTE5NDgxEzARBgsrBgEEAYI3PAIBAxMCVFIxHTAbBgNVBA8TFFByaXZhdGUgT3JnYW5pemF0aW9uMQswCQYDVQQGEwJUUjETMBEGA1UECAwKRXNracWfZWhpcjEyMDAGA1UEChMpU3RpbHBheSBFbGVrdHJvbmlrIFRpY2FyZXQgQW5vbmltIFNpcmtldGkxGDAWBgNVBAMTD3d3dy5zdGlscGF5LmNvbTCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBALUipgAc4j6pjZy4xLtwGUo3UgMr/4PNDIl/3kcdU9+hbYYfZf+ZZwBAD+U4+U9vih6q3qsOKGMaSaTYxRNOEEmn89wsWX+uj8dZqWlp2wSFBg50w6yXfWrECc3cR1fT5vstMrDiy7bAgeePDWA6f8XQna51JUCgpuMTC3BHflg2LgT+pVprIovNokd4rMnEmeOvisQfn9MNRf9oYf+bd9iJ/QaJZ50JhrrqgdW5YX2FBOANDWAfhIRWccEj2q0jYy6jDMJ7YUgNTsSKR6pDylWBa9uuCoFukKbKbKC407ZlbthAYNBiLx1vMcgJ7sQpmWgqlyXQ3fbm4Dw6dt5enEiuD+JTHH06LolGkgOHLAip6pkLwj+f4a/CgNkl7V20QTCdka8PMoVA6Kghp+VBL/PxtVbxKT2sJa6uX0uYhuqpCDE3vckx2IjqZ43agtKaELAgqH2eR0QWRA5FB/WgQ4A8iBJQyXM0tzMeCWLQzGKqHHll+gV+d/ft7Wm1p7NTJ5TLLN79ISMSN76u4R98j3xRKIRfgfWUvX9c0vmQNINZCKTUPflyDziameXF3aFJ0jW16FQiReby3qwadEc/25dkEhtsOSAggsJUeaxegf798moABsCar7cJqQcAm1NsJwN8oKmzcUhLWGy3ItKniJMp1ppF+GMrP30jn+2SIqCTAgMBAAGjggNYMIIDVDAfBgNVHSMEGDAWgBQsaf+AyYeQrjThtOdMk4WZQOmnsjAdBgNVHQ4EFgQUskj09J3b1zge+2ObxTo0harsaM4wDgYDVR0PAQH/BAQDAgWgMAwGA1UdEwEB/wQCMAAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMEkGA1UdIARCMEAwNQYMKwYBBAGyMQECAQUBMCUwIwYIKwYBBQUHAgEWF2h0dHBzOi8vc2VjdGlnby5jb20vQ1BTMAcGBWeBDAEBMFYGA1UdHwRPME0wS6BJoEeGRWh0dHA6Ly9jcmwuc2VjdGlnby5jb20vU2VjdGlnb1JTQUV4dGVuZGVkVmFsaWRhdGlvblNlY3VyZVNlcnZlckNBLmNybDCBhgYIKwYBBQUHAQEEejB4MFEGCCsGAQUFBzAChkVodHRwOi8vY3J0LnNlY3RpZ28uY29tL1NlY3RpZ29SU0FFeHRlbmRlZFZhbGlkYXRpb25TZWN1cmVTZXJ2ZXJDQS5jcnQwIwYIKwYBBQUHMAGGF2h0dHA6Ly9vY3NwLnNlY3RpZ28uY29tMCcGA1UdEQQgMB6CD3d3dy5zdGlscGF5LmNvbYILc3RpbHBheS5jb20wggF+BgorBgEEAdZ5AgQCBIIBbgSCAWoBaAB2AHb/iD8KtvuVUcJhzPWHujS0pM27KdxoQgqf5mdMWjp0AAABiHOHBKEAAAQDAEcwRQIhAM3i1L9NInVo8P4Yksn/w3557rutNxdBhYQgl7fFCKlsAiBr9uL5pNXJtignXw4W6VRR6IoxwmFdsRAi4GUvPxIiigB2ANq2v2s/tbYin5vCu1xr6HCRcWy7UYSFNL2kPTBI1/urAAABiHOHBPsAAAQDAEcwRQIgGc75ZK0JZv5QRCr9a3l7cCuAwpxVg8YKy0+OZIwBUUcCIQDAVsFNeX5E3G4rJuRw5NF7zPa9dBQ0os/VRJd7riZwuwB2AO7N0GTV2xrOxVy3nbTNE6Iyh0Z8vOzew1FIWUZxH7WbAAABiHOHBNAAAAQDAEcwRQIgCE6fvi3BrKXTtDV6nPDtReuFS5Amq/u3E3XlEQvJ3H4CIQCzzby8SWCjh6INmnqHg3bZdP3LAYME0YncZJby814eOTANBgkqhkiG9w0BAQsFAAOCAQEAHos1Ys8avOnBKySdAPAg/fDAbMaGxYheeLuatFTPkzCgL6VpE/gJaY3cZfmnJH/UMiD/n5bmqFE0cJtvxQ6nGtR5x8zBbv5wNvpXhth7LTUe+jqvNiY2PJXLDZ3vM9E2mtY/IUprvJJE6WqCYapTTE4KYskGPFBOOrAXyPZBNjm9sv5jOn9s4er5Aj/YwD4Np7brOmNn7/0Qxxiiwfrdi+3QS2+duONm1Pb2qJnvKyumd+PDmaTg5svLqAoixagivnifibJWmQizh1pyf1Hnq5dxh4DDqYlOI24Rrkwa40DxhDLGnEvQJKIfNzgLQNEXpf/KZ1qIXcPiueMF3wEkdg==', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'IsBankTransfer', N'isbank_token_auth', N'ODljZjEwNWZkM2RkZDk4ZGNmNDE3M2Y0NmQ2OWMwODg6NDhjNDczZDA0MTg4YmUxYzVmMmMwNjM4YmFiZjExMWI=', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'IsBankTransfer', N'isbank_token_username', N'd89000f5-8391-41b9-9f30-c75722b63eb8', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'IsBankTransfer', N'isbank_token_password', N'neh1hmlsoepSRhjunuZf1du0xvAnbcY332afKQj1gY8gmlxUbd', 0);




        // 01.09.2023 ARDA 

        //ALTER TABLE dbo.CompanyIntegrations ADD AutoCallbackUrl nvarchar(100) NULL;
        //ALTER TABLE dbo.CompanyIntegrations ADD AutoCallbackWithdrawalUrl nvarchar(100) NULL;

        //GO

        //ALTER Proc[dbo].[CompanyIntegrations_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@SiteUrl nvarchar(100),
        //@CallbackUrl nvarchar(100),
        //@RedirectUrl nvarchar(100),
        //@IPAddress nvarchar(50),
        //@WithdrawalRequestCallback nvarchar(100),
        //@AutoCallbackUrl nvarchar(100),
        //@AutoCallbackWithdrawalUrl nvarchar(100),
        //@SIDBankForPayments nvarchar(5) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyIntegrations SET MUser = @MUser, MDate = @MDate, SiteUrl = @SiteUrl, CallbackUrl = @CallbackUrl, RedirectUrl = @RedirectUrl, IPAddress = @IPAddress,
        //WithdrawalRequestCallback = @WithdrawalRequestCallback, SIDBankForPayments = @SIDBankForPayments, AutoCallbackUrl = @AutoCallbackUrl, AutoCallbackWithdrawalUrl = @AutoCallbackWithdrawalUrl

        //WHERE ID = @ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END



        //-------------------------------------------------------  07.09.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'auto_withdrawal_limit', N'50000', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'credit_card_be_used', N'1', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'credit_card_blocked', N'1', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'credit_card_rate', N'2.49', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'foreign_credit_card_be_used', N'0', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'foreign_credit_card_blocked', N'1', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'foreign_credit_card_rate', N'4', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'negative_balance_limit', N'0', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'transfer_be_used', N'1', 0);
        //INSERT INTOdbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'transfer_blocked', N'1', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'transfer_rate', N'1.20', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'withdrawal_eft_amount', N'4', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerDefaultValues', N'withdrawal_transfer_amount', N'2', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse);
        //VALUES(N'PayNKolayCreditCard', N'credit_card_commission_rate', N'1.70', 0);
        //INSERT INTO Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'PayNKolayForeignCC', N'credit_card_commission_rate', N'4', 0);


        //GO

        //ALTER TRIGGER[dbo].[tggrUpdateCreditCardPaymentNotifications]
        //ON[dbo].[CreditCardPaymentNotifications]
        //AFTER UPDATE
        //AS
        //BEGIN


        //declare @id nvarchar(50);
        //declare @Status tinyint;
        //select @id = ID, @Status = Status from inserted

        //DECLARE @PayNKolayCreditCardRate  nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamType = 'PayNKolayCreditCard' AND s.ParamDef = 'credit_card_commission_rate');

        //IF(@Status= 2)

        //BEGIN
        //DELETE FROM CompanyTransactions WHERE ID = @id

        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate, CompanyCommission , CompanyCommissionRate)

        //SELECT pn.ID, GetDate(), ci.ID, '100', pn.MDate, TransactionNr, pn.Amount, ROUND((pn.Amount* cc.CreditCardRate/100), 4 ) , 0, ROUND((pn.Amount - (pn.Amount* cc.CreditCardRate/100)), 4), IDMember, cc.CreditCardRate , 
        //case when CreditCardPaymentMethodID = 2 then ROUND(((pn.Amount / 100)  *  (CAST(@PayNKolayCreditCardRate AS DECIMAL(10, 2))) ),4) 
        //when CreditCardPaymentMethodID = 3  then ROUND(((pn.Amount / 100)  * 0),4)  end,
        //case when CreditCardPaymentMethodID = 2  then(CAST(@PayNKolayCreditCardRate AS DECIMAL(10, 2))) 
        //when CreditCardPaymentMethodID = 3 then 0 end

        //FROM CreditCardPaymentNotifications pn

        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //INNER JOIN CompanyCommissions cc ON cc.ID= ci.ID

        //WHERE pn.ID= @id

        //END

        //END

        //GO

        //ALTER Proc[dbo].[CompanyApplications_SetAplicationStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@Status bit
        //AS
        //BEGIN
        //BEGIN TRY

        //IF(@Status= 1)

        //BEGIN
        //DECLARE @idCompany nvarchar(50)= NEWID();
        //DECLARE @AutoWithdrawalLimit nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'auto_withdrawal_limit');
        //DECLARE @NegativeBalanceLimit nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'negative_balance_limit');

        //DECLARE @TransferBeUsed int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'transfer_be_used');
        //DECLARE @CreditCardBeUsed int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'credit_card_be_used');
        //DECLARE @ForeignCreditCardBeUsed int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'foreign_credit_card_be_used');

        //DECLARE @TransferRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'transfer_rate');
        //DECLARE @CreditCardRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'credit_card_rate');
        //DECLARE @ForeignCreditCardRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'foreign_credit_card_rate');

        //DECLARE @TransferBlocked int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'transfer_blocked');
        //DECLARE @CreditCardBlocked int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'credit_card_blocked');
        //DECLARE @ForeignCreditCardBlocked int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'foreign_credit_card_blocked');

        //DECLARE @WithdrawalTransferAmount nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'withdrawal_transfer_amount');
        //DECLARE @WithdrawalEftAmount nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'withdrawal_eft_amount');

        //INSERT INTO Companies(ID, CUser, CDate, Phone, UsingBalance, Title, Name, Email, TaxNr, TaxOffice, MonthlyGiro, Address, IdentityFrontSide,
        //IdentityBackSide, TaxPlate, SignatureCirculars, TradeRegistryGazette, Agreement, StatusFlag, NegativeBalanceLimit, AutoWithdrawalLimit)

        //SELECT @idCompany, @CUser, @CDate, Phone, 0, Title, Name, Email, TaxNr, TaxOffice, MonthlyGiro, Address, IdentityFrontSide, IdentityBackSide,
        //TaxPlate, SignatureCirculars, TradeRegistryGazette, Agreement, 1, CAST(@NegativeBalanceLimit AS DECIMAL(10, 2)), CAST(@AutoWithdrawalLimit AS DECIMAL(10, 2))  FROM CompanyApplications WHERE ID = @ID


        //INSERT INTO CompanyIntegrations(ID, CUser, CDate, ServiceID, SecretKey, TransferBeUsed, CreditCardBeUsed , CreditCardPaymentWithParam,
        //CreditCardPaymentWithPayNKolay, ForeignCreditCardBeUsed, ForeignCreditCardPaymentWithPayNKolay)

        //VALUES(@idCompany, @CUser, @CDate, dbo.GenerateServiceId(), dbo.GenerateSecretKey(), @TransferBeUsed , @CreditCardBeUsed , 0, 1, @ForeignCreditCardBeUsed,0)


        //DECLARE @idUser nvarchar(50)= NEWID()

        //INSERT INTO CompanyUsers(ID, CUser, CDate, IDCompany, Phone, Name, Email, Password, IsMainUser, StatusFlag) SELECT @idUser, @CUser, @CDate, @idCompany, Phone, Name, Email, Password, 1, 1 FROM CompanyApplications WHERE ID = @ID


        //INSERT INTO CompanyUserRoles(IDCompanyUser, RoleKey, Authorized) SELECT @idUser, RoleKey, 1 FROM Roles WHERE RoleType = 2 Order By OrderNr

        //INSERT INTO CompanyBanks(ID, CUser, CDate, IDBank) SELECT @idCompany, @CUser, @CDate, ID FROM Banks WHERE StatusFlag = 1 Order By OrderNr

        //INSERT INTO CompanyCommissions(ID, CUser, CDate, CreditCardRate, CreditCardStatus, CreditCardBlocked, TransferRate, TransferStatus, TransferBlocked,
        //MobilePayRate, MobilePayStatus, MobilePayBlocked, WithdrawalTransferAmount, WithdrawalEftAmount, ForeignCreditCardRate, ForeignCreditCardBlocked )

        //VALUES(@idCompany, @CUser, @CDate, CAST(@CreditCardRate AS DECIMAL(10, 2)), 1, @CreditCardBlocked, CAST(@TransferRate AS DECIMAL(10, 2)), 1, @TransferBlocked, 60, 1, 1,
        //CAST(@WithdrawalTransferAmount AS DECIMAL(10, 2)),CAST(@WithdrawalEftAmount AS DECIMAL(10, 2)),CAST(@ForeignCreditCardRate AS DECIMAL(10, 2)),@ForeignCreditCardBlocked)

        //DELETE CompanyApplications WHERE ID = @ID

        //END

        //DELETE CompanyApplications WHERE ID=@ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //-------------------------------------------------------  08.09.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE TABLE dbo.PaymentCreditCardPools(
        //ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //CDate datetime NULL,
        //MDate datetime NULL,
        //TransactionDate datetime NOT NULL,
        //BankName nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //SenderName nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //TransactionType nvarchar(20) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //TransactionKey nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //Commission nvarchar(20) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //Amount decimal (18,2) NULL,
        //Status tinyint NULL,
        //InstallmentCount int NULL,
        //PaymentMethodID int NULL,
        //PaymentMethodName nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //CONSTRAINT PK_PaymentCreditCardPools PRIMARY KEY(ID)
        //);

        //GO

        //CREATE Proc[dbo].[PaymentCreditCardPools_GetList]
        //@Status tinyint = null,
        //@PaymentMethodID int = null,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT r.ID, r.CDate, r.MDate, r.TransactionDate, r.BankName, ISNULL(cc.SenderName, r.SenderName) as SenderName , r.TransactionType, r.TransactionKey, ISNULL(cc.CardNumber, null) as CardNumber,
        //r.Commission, r.Amount, r.Status, r.InstallmentCount, r.PaymentMethodID, r.PaymentMethodName
        //into #TempTable FROM PaymentCreditCardPools r
        //LEFT JOIN CreditCardPaymentNotifications cc on cc.PayNKolayTransactionReferenceCode = TransactionKey
        //--cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance

        //WHERE 1=1

        //AND (@Status IS NULL  OR r.Status= @Status)
        //AND(@PaymentMethodID IS NULL OR r.PaymentMethodID = @PaymentMethodID)
        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.TransactionType LIKE '%' + @SearchValue + '%'  OR
        //r.Amount LIKE '%' + @SearchValue + '%' OR r.PaymentMethodName LIKE '%' + @SearchValue + '%'   OR r.BankName LIKE '%' + @SearchValue + '%'  OR cc.CardNumber LIKE '%' + @SearchValue + '%'))
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%STİLPAY%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%N Kolay%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%OVG ELEKTRONİK%' COLLATE Latin1_General_CI_AI
        //and(r.Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO


        //CREATE Proc[dbo].[PaymentCreditCardPools_Insert]
        //@IDOut nvarchar(50) output,
        //@TransactionDate datetime,
        //@BankName nvarchar(50),
        //@TransactionType nvarchar(20),
        //@PaymentMethodName nvarchar(50),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@PaymentMethodID int,
        //@InstallmentCount int,
        //@Status tinyint,
        //@Commission nvarchar(20),
        //@TransactionKey nvarchar(50)
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //SET @IDOut = NEWID();

        //INSERT INTO.PaymentCreditCardPools
        //(ID, CDate, TransactionDate, BankName, SenderName, TransactionType, TransactionKey, Commission, Amount, Status, InstallmentCount, PaymentMethodID, PaymentMethodName)

        //VALUES(@IDOut, GETDATE(), @TransactionDate, @BankName, @SenderName, @TransactionType, @TransactionKey, @Commission, @Amount, @Status, @InstallmentCount, @PaymentMethodID, @PaymentMethodName);

        //SELECT @IDOut


        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //GO

        //CREATE Proc[dbo].[PaymentCreditCardPools_CheckTransactionKey]
        //@TransactionKey nvarchar(50),
        //@Result bit output
        //AS
        //BEGIN

        //IF(Select Count(*) From PaymentCreditCardPools Where TransactionKey= @TransactionKey) > 0
        //SET @Result = 1
        //ELSE
        //SET @Result = 0

        //SELECT @Result
        //END


        //-------------------------------------------------------  11.09.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[PaymentCreditCardPools_GetList]
        //@Status tinyint = null,
        //@PaymentMethodID int = null,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //--cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //SELECT r.ID, r.CDate, r.MDate, r.TransactionDate, r.BankName, ISNULL(cc.SenderName, r.SenderName) as SenderName , r.TransactionType, r.TransactionKey, ISNULL(cc.CardNumber, null) as CardNumber,
        //r.Commission, r.Amount, r.Status, r.InstallmentCount, r.PaymentMethodID, r.PaymentMethodName, 
        //cc.Status as SPStatus, JSON_VALUE(cl.Callback, '$.status_code') as SPDiscardedCallbackStatus, cl2.ResponseStatus as CBResponseStatus into #TempTable  FROM PaymentCreditCardPools r
        //LEFT JOIN CreditCardPaymentNotifications cc on cc.PayNKolayTransactionReferenceCode = r.TransactionKey
        //LEFT JOIN CallbackResponseLogs cl on cl.TransactionID = r.TransactionID and cl.ServiceType = 'STILPAY'
        //LEFT JOIN CallbackResponseLogs cl2 on cl2.TransactionID = r.TransactionID and cl2.ServiceType = 'STILPAY AUTOCALLBACK'
        //and cl2.CDate = (SELECT MAX(cl3.CDate) FROM CallbackResponseLogs cl3 WHERE cl3.TransactionID = r.TransactionID AND cl3.ServiceType = 'STILPAY AUTOCALLBACK')

        //WHERE 1=1
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@PaymentMethodID IS NULL OR r.PaymentMethodID = @PaymentMethodID)
        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.TransactionType LIKE '%' + @SearchValue + '%'  OR
        //r.Amount LIKE '%' + @SearchValue + '%' OR r.PaymentMethodName LIKE '%' + @SearchValue + '%'   OR r.BankName LIKE '%' + @SearchValue + '%'  OR cc.CardNumber LIKE '%' + @SearchValue + '%'))
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%STİLPAY%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%N Kolay%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%OVG ELEKTRONİK%' COLLATE Latin1_General_CI_AI
        //and(r.Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER Proc[dbo].[PaymentCreditCardPools_Insert]
        //@IDOut nvarchar(50) output,
        //@TransactionDate datetime,
        //@BankName nvarchar(50),
        //@TransactionType nvarchar(20),
        //@PaymentMethodName nvarchar(50),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@PaymentMethodID int,
        //@InstallmentCount int,
        //@Status tinyint,
        //@Commission nvarchar(20),
        //@TransactionKey nvarchar(50),
        //@TransactionID nvarchar(50)
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //SET @IDOut = NEWID();

        //INSERT INTO.PaymentCreditCardPools
        //(ID, CDate, TransactionDate, BankName, SenderName, TransactionType, TransactionKey, Commission, Amount, Status, InstallmentCount, PaymentMethodID, PaymentMethodName, TransactionID )

        //VALUES(@IDOut, GETDATE(), @TransactionDate, @BankName, @SenderName, @TransactionType, @TransactionKey, @Commission, @Amount, @Status, @InstallmentCount, @PaymentMethodID, @PaymentMethodName, @TransactionID );

        //SELECT @IDOut


        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //-------------------------------------------------------  27.09.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //INSERT INTO dbo.Banks
        //(ID, Name, Title, Branch, AccountNr, IBAN, Img, OrderNr, StatusFlag, ActivatedForGeneralUse)
        //VALUES(N'07', N'KUVEYT TÜRK', N'OVG ELEKTRONİK TİCARET A.Ş.', N'0205', N'98681302-1', N'TR78 0020 5000 0986 8130 2000 01', N'kuveyt.png', 9, 1, 0);




        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'KuveytTurkClient', N'kuveytturk_client_id', N'c0b9e377-2d6b-47ed-ab92-05a0fabf6f6f', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'KuveytTurkClient', N'kuveytturk_client_secret', N'9e72452f-44b9-4026-aa04-fe02da8d4889-1be13037-3120-4248-9171-b7176d563f1b', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'KuveytTurkTransfer', N'web_username', N'övgü', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'KuveytTurkTransfer', N'account_suffix', N'2', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'KuveytTurkTransfer', N'transfer_type', N'4', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'Payments', N'Withdrawal_Rebate_KuveytTurk', N'Küveyt Türk', 1);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'KuveytTurkClient', N'kuveytturk_rsa_private_key', N'@"-----BEGIN RSA PRIVATE KEY-----
        //MIIEogIBAAKCAQBqmwZrSKTUTooNq+VHWDT9V+p+qxCuh+YWUb+8qX8Jeq6d0+TW
        //zx6moOhJyc4lbIO8gilWle1fN3embSNAT8bMoRi6Xr2ZEWAZPF04VI8/WpyZNQwh
        //WPwZHLFfd5jAucprbelTevE5X8WMLiL3bveMvgjcvpTsexLA5lmgdou4plQUVqJc
        //nHJJJO0kaR4wPbKbEeTUZ511Uaw9OZ4rXq5DOHy1CqVhsCiKfwXMy6t8x8wh2ijj
        //+11Zvh3wH+4pDDiR5CKdMXvglnXfwxObmbKTbBi/cfziFa8zSm7gaTP2gCQ7a2zs
        //TtgQl0DNQNKdBHYCf6LOj106cepRp01dnHsVAgMBAAECggEAJb/lowHjVEbHfhXb
        //p8rlYLzMDbS3wIXhBRBHrB/9Gzc1NDA/fY10Vh7ugoqSlA/8CjmxN7b5ilkS5n0J
        //GZHmXLnDDuPTkatkcys7+2F+JDoK7/mn5PsksiPF739jOQPRWP9fuy7y0pVGV+BS
        //g3no8Q6uBrT5+U+PkX1ASaEQ0v6jD3+wkUXrplEoymWtz0SK1U5vUzYNxB+9S1lE
        //8bLRPuPPy5NXv/hux5FBsWDm9UPVvAcJ7W3qdpGAdkywluN12iCrROebOfv99rF1
        //DTjN9j8awLcIYxvyXFaLH0RbAYQTNtvclT3xkU9H2mmOhX9MH+6G+Jo8w/if/CV0
        //WW4YAQKBgQDPKBNcBsOTkODVzkYgS4mGECIhnfuHVL8r1RhietOmYoBaJtatKU+x
        //JQGTWOv2ipHcr8BvrMmh5ryJ+LFuDo3T3RsE9zUBcFGeOIsNEEGNJ/u1K46x4Pit
        //67ckJ5yqNcsiwqcldxEATwc2x2MYCJF/ZtJvgiGuKV5Ot+DZyZIRFQKBgQCDvbbN
        //pNX7DmNoTIuhiogBD0CXhaeiAudnXXTba8ywVnnpZhea3C/8uuG9TZQB4CTZG/BK
        //faFCJTQtdMm6sdGMkPkFDbl+43ymStE30CAKKUBZKpCUjChGDkIvjeHsq6ihu6t5
        //6dAhCIRHNIBW/XIS7v+rnSnFoldwWZz4B9dCAQKBgDhct/+222l/5pxldhD9XFp8
        //czzgRfpJJYZggTTyJDnF3RQqMwiED+mrnuUfMXwvsYXwz5PS2D1TkQKdBnFiRlZZ
        //dyt/sw1EKQC6c6LHRH6KXWKqijV9d0uisX6FxItO/YjkmyOHZLnHxrexwhVc53FZ
        //YXHzXwSKvtz+DJBU1ogNAoGAQUfR/McQjY5MrhM4Ib0+tZ+0NyEwtvRPbIX/8PbT
        //ABJp6MEBM2imksqcL6zwiZljSP4yLQdh0CAVYez8RXn1x3zTGLD7WSgqzVBHqiuE
        //pORaEZUo/aMSFdzc6SmaaSeKsVIIn6m/y46n1Yzrh6+hRkaOBKElYNyYDYEqajGg
        //dgECgYEAo5clCbOsF9skOVC6e61k3aUz0d7eGuJuwPO1Ceo1tZ9CsLpVMXBtOqqP
        //kjdw2yIQfSRAD237XKAgoREJR4S4eUofp0KLGDl8neEsOoqRx8iQKgJp/7kgC/Y8
        //1oSsNa4CI5OkEkd4m6HqNktWw7kEvCFb/vxUU4fisDREEqCxJPQ=
        //-----END RSA PRIVATE KEY-----"', 0);

        //GO

        //ALTER Proc[dbo].[Settings_Update]
        //@IDOut nvarchar(50) output,
        //@ParamType nvarchar(25),
        //@ParamDef nvarchar(50),
        //@ParamVal nvarchar(500) = null,
        //@ActivatedForGeneralUse bit = null,
        //@MUser nvarchar(50) = null,
        //@MDate datetime = null
        //AS
        //BEGIN

        //BEGIN TRY

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //IF @ActivatedForGeneralUse = 1 AND @ParamType = 'Payments' AND @ParamDef = 'Withdrawal_Rebate_Is'

        //BEGIN
        //UPDATE Settings SET ActivatedForGeneralUse=0 WHERE ParamType = 'Payments' AND(ParamDef = 'Withdrawal_Rebate_Ziraat' OR ParamDef = 'Withdrawal_Rebate_KuveytTurk')

        //END

        //IF @ActivatedForGeneralUse = 1 AND @ParamType = 'Payments' AND @ParamDef = 'Withdrawal_Rebate_Ziraat'

        //BEGIN
        //UPDATE Settings SET ActivatedForGeneralUse=0 WHERE ParamType = 'Payments' AND(ParamDef = 'Withdrawal_Rebate_Is' OR ParamDef = 'Withdrawal_Rebate_KuveytTurk')

        //END

        //IF @ActivatedForGeneralUse = 1 AND @ParamType = 'Payments' AND @ParamDef = 'Withdrawal_Rebate_KuveytTurk'

        //BEGIN
        //UPDATE Settings SET ActivatedForGeneralUse=0 WHERE ParamType = 'Payments' AND(ParamDef = 'Withdrawal_Rebate_Ziraat' OR ParamDef = 'Withdrawal_Rebate_Is')

        //END

        //UPDATE Settings SET ActivatedForGeneralUse=@ActivatedForGeneralUse, 
        //ParamVal = 
        //CASE
        //WHEN @ParamVal IS NOT NULL THEN @ParamVal

        //ELSE ParamVal

        //END
        //WHERE ParamType= @ParamType AND ParamDef = @ParamDef

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        // GO

        //CREATE Proc[dbo].[Banks_GetBanksForIframeSetting]
        //AS
        //BEGIN


        //SELECT* FROM Banks
        //WHERE ID IN('08','03','07')
        //ORDER BY OrderNr

        //END

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, GetBalance.MatchesBalance, GetBalance.NotMatchesBalance, GetBalance.MatchesCount, GetBalance.NotMatchesCount into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance

        //WHERE 1=1

        //AND (@Status IS NULL  OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR B.Name LIKE '%' + @SearchValue + '%'   ))
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%STİLPAY%' COLLATE Latin1_General_CI_AI

        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%N Kolay%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%OVG ELEKTRONİK%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(r.Description,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%OVG ELEKTRONİK%' COLLATE Latin1_General_CI_AI
        //and(Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        // Güncelleme atıldı. Erdinç 15.09.2023


        //-------------------------------------------------------  04.10.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE TABLE dbo.BankBalancesLogs(
        //ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //CDate datetime NOT NULL,
        //IDBank nvarchar(2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //Balance decimal (18,2) NOT NULL,
        //Iban nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //IsExitAccount bit NOT NULL,
        //BankTitle nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //BankName nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //CONSTRAINT PK_BankBalancesLog PRIMARY KEY(ID)
        //);

        //ALTER TABLE dbo.BankBalancesLogs ADD CONSTRAINT BankBalancesLog_FK FOREIGN KEY(IDBank) REFERENCES dbo.Banks(ID);

        //GO

        //CREATE Proc[dbo].[BankBalancesLogs_GetList]
        //@StartDate date,
        //@EndDate date,
        //@IsExitAccount bit = null,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //DECLARE @totalRecords int

        //SELECT r.*, a.Name AS Creator, b.Name as Bank into #TempTable FROM BankBalancesLogs r
        //INNER JOIN Administrators a ON a.ID=r.CUser
        //INNER JOIN Banks b ON b.ID= r.IDBank

        //WHERE

        //    (@IsExitAccount IS NULL OR r.IsExitAccount = @IsExitAccount)

        //    AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //	AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        // 	AND(@SearchValue IS NULL OR  (a.Name LIKE '%' + @SearchValue + '%' OR r.Iban LIKE '%' + @SearchValue + '%' ))


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS

        //    FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //CREATE Proc[dbo].[BankBalancesLogs_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDBank nvarchar(2),
        //@Balance decimal (18,2),
        //@Iban nvarchar(50),
        //@IsExitAccount bit,
        //@BankTitle nvarchar(100),
        //@BankName nvarchar(100)
        //AS
        //BEGIN
        //BEGIN TRY

        //SET @IDOut = NEWID();
        //INSERT INTO BankBalancesLogs
        //(ID, CUser, CDate, IDBank, Balance, Iban, IsExitAccount)

        //VALUES(@IDOut, @CUser, @CDate , @IDBank, @Balance, @Iban, @IsExitAccount);

        //SELECT @IDOut

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO


        //ALTER TABLE dbo.CompanyBankAccounts
        //ADD IsExitAccount bit NOT NULL DEFAULT 0 

        //GO 

        //ALTER Proc[dbo].[CompanyBankAccounts_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@Name nvarchar(50),
        //@Title nvarchar(100),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@StatusFlag bit,
        //@Amount decimal (5,2),
        //@CreditCardAmount decimal (5,2),
        //@EftAmount decimal (5,2),
        //@IsExitAccount bit = 0
        //AS
        //BEGIN
        //BEGIN TRY


        //SET @IDOut = NEWID()
        //INSERT INTO CompanyBankAccounts(ID, CDate, CUser, IDCompany, Name, Title, IDBank, IBAN, StatusFlag, Amount , CreditCardAmount , EftAmount, IsExitAccount)

        //VALUES(@IDOut, @CDate, @CUser, @IDCompany, @Name, @Title, @IDBank, @IBAN, @StatusFlag, @Amount, @CreditCardAmount, @EftAmount, @IsExitAccount)
        //SELECT @IDOut

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyBankAccounts_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@Name nvarchar(50),
        //@Title nvarchar(100),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@StatusFlag bit,
        //@Amount decimal (5,2),
        //@CreditCardAmount decimal (5,2),
        //@EftAmount decimal (5,2),
        //@IsExitAccount bit = 0
        //AS
        //BEGIN
        //BEGIN TRY

        //UPDATE CompanyBankAccounts SET MDate = @MDate, MUser = @MUser, Name = @Name, Title = @Title, IDBank = @IDBank, IBAN = @IBAN, StatusFlag = @StatusFlag,
        //Amount = @Amount, CreditCardAmount = @CreditCardAmount, EftAmount = @EftAmount, IsExitAccount = @IsExitAccount  WHERE ID = @ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //GO

        //ALTER TRIGGER[dbo].[tggrUpdateCreditCardPaymentNotifications]
        //ON[dbo].[CreditCardPaymentNotifications]
        //AFTER UPDATE
        //AS
        //BEGIN


        //declare @id nvarchar(50);
        //declare @Status tinyint;
        //select @id = ID, @Status = Status from inserted

        //DECLARE @PayNKolayCreditCardRate  nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamType = 'PayNKolayCreditCard' AND s.ParamDef = 'credit_card_commission_rate');
        //DECLARE @PaybullCreditCardRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamType = 'Paybull' AND s.ParamDef = 'credit_card_commission_rate');

        //IF(@Status= 2)

        //BEGIN
        //DELETE FROM CompanyTransactions WHERE ID = @id

        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate, CompanyCommission , CompanyCommissionRate)

        //SELECT pn.ID, GetDate(), ci.ID, '100', pn.MDate, TransactionNr, pn.Amount, ROUND((pn.Amount* cc.CreditCardRate/100), 4 ) , 0, ROUND((pn.Amount - (pn.Amount* cc.CreditCardRate/100)), 4), IDMember, cc.CreditCardRate , 
        //case when CreditCardPaymentMethodID = 2 then ROUND(((pn.Amount / 100)  *  (CAST(@PayNKolayCreditCardRate AS DECIMAL(10, 2))) ),4)
        //when CreditCardPaymentMethodID = 5 then ROUND(((pn.Amount / 100)  *  (CAST(@PaybullCreditCardRate AS DECIMAL(10, 2))) ),4) 
        //when CreditCardPaymentMethodID = 3  then ROUND(((pn.Amount / 100)  * 0),4)  end,

        //case when CreditCardPaymentMethodID = 2  then(CAST(@PayNKolayCreditCardRate AS DECIMAL(10, 2))) 
        //when CreditCardPaymentMethodID = 5  then(CAST(@PaybullCreditCardRate AS DECIMAL(10, 2))) 
        //when CreditCardPaymentMethodID = 3 then 0 end


        //FROM CreditCardPaymentNotifications pn

        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //INNER JOIN CompanyCommissions cc ON cc.ID= ci.ID

        //WHERE pn.ID= @id

        //END

        //END


        //GO

        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'PaybullCreditCard', N'secret_key', N'$2y$10$sjn5jatn6a2x55Qh3Ugtue1FYf2aJcysdd5Bi2NkmRj1EoHkzLB5e', 0);
        //INSERT INTO.dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'PaybullCreditCard', N'app_id', N'95c85c3c9510074eb5329873ef62c27f', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'PaybullCreditCard', N'app_password', N'ce8c3a333faed94a9c2779c8ba6ba0e4', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'Paybull', N'credit_card_commission_rate', N'1.75', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'AuthBankBalances', N'auth_bank_balances', N'05382998128,05654895523', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'CreditCard', N'Paybull', N'Paybull', 0);


        //-------------------------------------------------------  06.10.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //ALTER TABLE dbo.PaymentCreditCardPools
        //ADD Description nvarchar(200)

        //GO

        //ALTER Proc[dbo].[PaymentCreditCardPools_Insert]
        //@IDOut nvarchar(50) output,
        //@TransactionDate datetime,
        //@BankName nvarchar(50),
        //@TransactionType nvarchar(20),
        //@PaymentMethodName nvarchar(50),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@PaymentMethodID int,
        //@InstallmentCount int,
        //@Status tinyint,
        //@Commission decimal (18,2),
        //@TransactionKey nvarchar(50),
        //@TransactionID nvarchar(50),
        //@Description nvarchar(200) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //SET @IDOut = NEWID();

        //INSERT INTO.PaymentCreditCardPools
        //(ID, CDate, TransactionDate, BankName, SenderName, TransactionType, TransactionKey, Commission, Amount, Status, InstallmentCount, PaymentMethodID, PaymentMethodName, TransactionID, Description )

        //VALUES(@IDOut, GETDATE(), @TransactionDate, @BankName, @SenderName, @TransactionType, @TransactionKey, @Commission, @Amount, @Status, @InstallmentCount, @PaymentMethodID, @PaymentMethodName, @TransactionID , @Description );

        //SELECT @IDOut


        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO


        //ALTER Proc[dbo].[PaymentCreditCardPools_GetList]
        //@Status tinyint = null,
        //@PaymentMethodID int = null,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //--cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //SELECT r.ID, r.CDate, r.MDate, r.TransactionDate, r.BankName, ISNULL(cc.SenderName, r.SenderName) as SenderName , r.TransactionType, r.TransactionKey, ISNULL(cc.CardNumber, null) as CardNumber,
        //r.Commission, r.Amount, r.Status, r.InstallmentCount, r.PaymentMethodID, r.PaymentMethodName, r.Description,
        //cc.Status as SPStatus, JSON_VALUE(cl.Callback, '$.status_code') as SPDiscardedCallbackStatus, cl2.ResponseStatus as CBResponseStatus into #TempTable  FROM PaymentCreditCardPools r
        //LEFT JOIN CreditCardPaymentNotifications cc on cc.PayNKolayTransactionReferenceCode = r.TransactionKey
        //LEFT JOIN CallbackResponseLogs cl on cl.TransactionID = r.TransactionID and cl.ServiceType = 'STILPAY'
        //LEFT JOIN CallbackResponseLogs cl2 on cl2.TransactionID = r.TransactionID and cl2.ServiceType = 'STILPAY AUTOCALLBACK'
        //and cl2.CDate = (SELECT MAX(cl3.CDate) FROM CallbackResponseLogs cl3 WHERE cl3.TransactionID = r.TransactionID AND cl3.ServiceType = 'STILPAY AUTOCALLBACK')

        //WHERE 1=1
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@PaymentMethodID IS NULL OR r.PaymentMethodID = @PaymentMethodID)
        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.TransactionType LIKE '%' + @SearchValue + '%'  OR
        //r.Amount LIKE '%' + @SearchValue + '%' OR r.PaymentMethodName LIKE '%' + @SearchValue + '%'   OR r.BankName LIKE '%' + @SearchValue + '%'  OR cc.CardNumber LIKE '%' + @SearchValue + '%'))
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%STİLPAY%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%N Kolay%' COLLATE Latin1_General_CI_AI
        //AND(ISNULL(r.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%OVG ELEKTRONİK%' COLLATE Latin1_General_CI_AI
        //and(r.Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        // Güncelleme atıldı. Erdinç 10.10.2023


        //-------------------------------------------------------  10.10.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[PaymentCreditCardPools_CheckStatusAndUpdate]
        //@IDOut nvarchar(50) output,
        //@TransactionKey nvarchar(50),
        //@Status tinyint
        //AS
        //BEGIN
        //BEGIN TRY

        //UPDATE PaymentCreditCardPools SET Status = @Status, MDate = GETDATE() WHERE TransactionKey = @TransactionKey

        //SELECT @IDOut = @TransactionKey

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        // GO

        //CREATE Proc[dbo].[PaymentCreditCardPools_GetSingle]
        //@TransactionKey nvarchar(50)
        //AS
        //BEGIN


        //SELECT* FROM PaymentCreditCardPools r

        //WHERE r.TransactionKey=@TransactionKey

        //END


        //-------------------------------------------------------  13.10.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //-- CompanyTransactions_GetAccountReport NULL, NULL, NULL

        //ALTER Proc[dbo].[CompanyTransactions_GetAccountReport]
        //@IDCompany nvarchar(50),
        //@StartDate datetime,
        //@EndDate datetime
        //AS
        //BEGIN

        //SELECT top 100 isnull(sumT.Total,0) as sumTotal ,
        //isnull(sumC.Commission,0) as sumCommission,  
        //isnull(sumNet.NetTotal,0) as sumNetTotal,
        //isnull(sumProcessT.Amount,0) as sumProcessTotal , 
        //isnull(sumEft.Amount,0) as sumEft , 
        //isnull(sumFast.Amount,0) as sumFast , 
        //isnull(sumProcess.CostTotal,0) as sumProcess ,
        //isnull(sumEx.Amount,0) as sumExpense,
        //isnull(sumCr.CompanyCommission,0) as sumCreditCardCommission,
        //isnull(sumTr.CompanyCommission,0) as sumTransferCommission, 
        //sumFast.cwAmount as countFast,
        //sumEft.cwAmount as countEft,
        //sumProcess.cwCostTotal as countProcess

        //FROM CompanyTransactions t

        //cross join(Select sum([dbo].RoundToZero(Total)) as Total From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //cross join(Select sum([dbo].RoundToZero(Commission)) as Commission From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumC

        //cross join(Select sum([dbo].RoundToZero(CompanyCommission)) as CompanyCommission From CompanyTransactions t where IDActionType IN(100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumCr

        //cross join(Select sum([dbo].RoundToZero(CompanyCommission)) as CompanyCommission From CompanyTransactions t where IDActionType IN(10,20)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumTr

        //cross join(Select sum([dbo].RoundToZero(NetTotal)) as NetTotal From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumNet

        //cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcessT

        //cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount, Count(cw.Amount) as cwAmount From CompanyTransactions t

        //inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(t.TransactionDate >= @StartDate)

        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount , Count(cw.Amount) as cwAmount From CompanyTransactions t

        //inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast

        //cross join(Select sum([dbo].RoundToZero(cw.CostTotal)) as CostTotal , Count(cw.Amount) as cwCostTotal From CompanyTransactions t

        //inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcess

        //cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //where TransactionType = 2

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //AND T.TransactionDetailType = 1 ) as sumEx 

        //--WHERE(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)))
        //--	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)))


        //END



        // Güncelleme atıldı. Erdinç 13.10.2023




        //-------------------------------------------------------  17.10.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------
        //-- CompanyTransactions_GetAccountReport NULL, NULL, NULL

        //CREATE Proc[dbo].[CompanyTransactions_GetAccountReport]
        //@IDCompany nvarchar(50),
        //@StartDate datetime,
        //@EndDate datetime
        //AS
        //BEGIN

        //SELECT top 100 isnull(sumT.Total,0) as sumTotal ,
        //isnull(sumC.Commission,0) as sumCommission,  
        //isnull(sumNet.NetTotal,0) as sumNetTotal,
        //isnull(sumProcessT.Amount,0) as sumProcessTotal , 
        //isnull(sumEft.Amount,0) as sumEft , 
        //isnull(sumFast.Amount,0) as sumFast , 
        //isnull(sumProcess.CostTotal,0) as sumProcess ,
        //isnull(sumEx.Amount,0) as sumExpense,
        //isnull(sumCr.CompanyCommission,0) as sumCreditCardCommission,
        //isnull(sumTr.CompanyCommission,0) as sumTransferCommission, 
        //sumFast.cwAmount as countFast,
        //sumEft.cwAmount as countEft,
        //sumProcess.cwCostTotal as countProcess,
        //isnull(sumTrPool.Amount,0) as sumTrPoolNotMatchTotal

        //FROM CompanyTransactions t

        //cross join(Select sum([dbo].RoundToZero(Total)) as Total From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //cross join(Select sum([dbo].RoundToZero(Commission)) as Commission From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumC

        //cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as CompanyCommission From CompanyTransactions t where IDActionType IN(100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumCr

        //cross join(Select sum([dbo].RoundToZero(Commission)) as CompanyCommission From CompanyTransactions t where IDActionType IN(10,20)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumTr

        //cross join(Select sum([dbo].RoundToZero(NetTotal)) as NetTotal From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumNet

        //cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcessT

        //cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount, Count(cw.Amount) as cwAmount From CompanyTransactions t

        //inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount , Count(cw.Amount) as cwAmount From CompanyTransactions t

        //inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast

        //cross join(Select sum([dbo].RoundToZero(cw.CostTotal)) as CostTotal , Count(cw.Amount) as cwCostTotal From CompanyTransactions t

        //inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)

        //and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcess

        //cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //where TransactionType = 2

        //and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //AND T.TransactionDetailType = 1 ) as sumEx

        //cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From PaymentTransferPools t

        //where t.Status = 1 
        //AND(ISNULL(t.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%STİLPAY%' COLLATE Latin1_General_CI_AI

        //AND(ISNULL(t.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%N Kolay%' COLLATE Latin1_General_CI_AI

        //AND(ISNULL(t.SenderName,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%OVG ELEKTRONİK%' COLLATE Latin1_General_CI_AI

        //AND(ISNULL(t.Description,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%PAYBULL%' COLLATE Latin1_General_CI_AI

        //AND(ISNULL(t.Description,'')) COLLATE Latin1_General_CI_AI NOT LIKE '%Gönderen Hesap No:98681302,Ek No:2,Alıcı Hesap No:98681302,Ek No:1 Para Transferi%' COLLATE Latin1_General_CI_AI
        //) as sumTrPool

        //--WHERE(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)))
        //--	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)))


        //END


        // Güncelleme atıldı. Erdinç 17.10.2023


        //-------------------------------------------------------  17.10.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //ALTER TRIGGER[dbo].[tggrUpdatePaymentNotifications]
        //ON[dbo].[PaymentNotifications]
        //AFTER UPDATE
        //AS
        //BEGIN


        //declare @id nvarchar(50);
        //declare @Status tinyint;
        //select @id = ID, @Status = Status from inserted


        //IF(@Status= 2 AND NOT UPDATE(Iban) )

        //BEGIN
        //DELETE FROM CompanyTransactions WHERE ID = @id

        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)

        //SELECT pn.ID, pn.CDate, ci.ID, IIF(pn.IsAutoNotification= 1, '20', '10'), pn.MDate, TransactionNr, pn.IDBank, pn.Amount, ROUND((pn.Amount* cc.TransferRate/100), 4 ) , 0, ROUND((pn.Amount - (pn.Amount* cc.TransferRate/100)), 4) ,  IDMember, cc.TransferRate ,  0 , 0  FROM PaymentNotifications pn
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //INNER JOIN CompanyCommissions cc ON cc.ID=ci.ID
        //WHERE pn.ID=@id
        //END


        //END

        //GO

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null,
        //@IsProcess bit = false
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyWithdrawalRequests SET MUser = @MUser, MDate = IIF(@MDate is null, GETDATE(), @MDate), Description = @Description,
        //Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank, IsProcess = @IsProcess WHERE ID = @ID AND Status = 1

        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //SELECT ID, GETDATE(), IDCompany, '30', MDate, TransactionNr, IDBank, Amount, 0, CostTotal, Amount+CostTotal, 0 , 0  FROM CompanyWithdrawalRequests WHERE ID = @ID

        //END
        //ELSE IF(@Status= 3)

        //BEGIN
        //UPDATE Companies SET UsingBalance+=T.Total
        //FROM
        //(SELECT IDCompany, (Amount+CostTotal) AS Total FROM CompanyWithdrawalRequests WHERE ID = @ID)T
        //WHERE Companies.ID=T.IDCompany
        //END


        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@Title nvarchar(100),
        //@Amount decimal (18,2),
        //@CostTotal decimal (18,2),
        //@IsEFT bit,
        //@Description nvarchar(250),
        //@RequestNr nvarchar(50),
        //@Status tinyint,
        //@DealerDescription nvarchar(250),
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null,
        //@IsProcess bit = false
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany And Status = 1)>0  
        //--BEGIN
        //--	SET @CUSTOMERRORMESSAGE += N'Mevcutta 1 çekim talebiniz bulunmaktadır.'
        //--	RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--END
        //IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(@Amount+@CostTotal)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany AND IBAN = @IBAN AND Amount = @Amount AND RequestNr = @RequestNr)>0
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu talep numarası sistemde mevcut.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //SET @IDOut = NEWID()

        //INSERT INTO CompanyWithdrawalRequests(ID, CUser, CDate, IDCompany, TransactionNr, IDBank, IBAN, Title, Amount, CostTotal, IsEFT, Description, RequestNr, Status, MDate, DealerDescription, IsBankQueryNr, SIDBank, IsProcess)

        //SELECT @IDOut, @CUser, @CDate, @IDCompany, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank,
        //@IBAN, @Title, @Amount, @CostTotal, @IsEFT, @Description, ISNULL(@RequestNr, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5)), @Status, GETDATE(), 
        //@DealerDescription,@IsBankQueryNr, @SIDBank, @IsProcess FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //UPDATE Companies SET UsingBalance-=(@Amount+@CostTotal) WHERE ID = @IDCompany

        //SELECT @IDOut

        //END
        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, MDate, CompanyCommission , CompanyCommissionRate)

        //SELECT @IDOut, GETDATE(), @IDCompany, '30', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank, @Amount, 0, @CostTotal, @Amount+@CostTotal, GETDATE() , 0 , 0  FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO


        //ALTER Proc[dbo].[CompanyWithdrawalRequests_GetList]
        //@Status tinyint,
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IsProcess bit = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT r.*, c.Title AS Company, c.Phone, b.Name as Bank, a.Name AS Modifier into #TempTable FROM CompanyWithdrawalRequests r
        //INNER JOIN Companies c ON c.ID=r.IDCompany
        //INNER JOIN Banks b ON b.ID= r.IDBank

        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //WHERE 1=1

        //AND (@IsProcess IS NULL OR r.IsProcess = 0)

        //AND((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)

        //AND(@IDCompany IS NULL OR r.IDCompany= @IDCompany)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.Title LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //-------------------------------------------------------  02.11.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyRebateRequests_GetList]
        //@Status tinyint,
        //@IDCompany nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@PaymentMethod int = 0
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT r.*, c.Title AS Company, c.Phone, m.Name AS Member, m.Phone AS MemberPhone, a.Name AS Modifier, pn.Iban as Iban,  
        //COALESCE(pn.ID, cn.ID, fn.ID) as PaymentRecordID into #TempTable FROM CompanyRebateRequests r
        //INNER JOIN Companies c ON c.ID=r.IDCompany
        //INNER JOIN Members m ON m.ID= r.IDMember

        //LEFT JOIN PaymentNotifications pn ON pn.TransactionID= r.TransactionID
        //LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID= r.TransactionID
        //LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID= r.TransactionID
        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //WHERE 1=1 

        //AND (@PaymentMethod = 0 OR (@PaymentMethod = 1 AND pn.Iban is not null) OR(@PaymentMethod = 2 AND pn.Iban is null))
        //AND((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)

        //AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END



        //------------------------------------------------------- 09.11.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE TABLE PaymentInstitutions(
        //ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //Name nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //Show bit DEFAULT 0 NOT NULL,
        //Rate decimal (18,2) NOT NULL
        //);

        //GO

        //INSERT INTO PaymentInstitutions
        //(ID, Name, Show, Rate)
        //VALUES(N'1', N'Param', 1, 0.00);
        //INSERT INTO PaymentInstitutions
        //(ID, Name, Show, Rate)
        //VALUES(N'2', N'PayNKolay', 1, 0.00);
        //INSERT INTOPaymentInstitutions
        //(ID, Name, Show, Rate)
        //VALUES(N'3', N'İş Bankası', 1, 0.00);
        //INSERT INTO PaymentInstitutions
        //(ID, Name, Show, Rate)
        //VALUES(N'5', N'Paybull', 1, 2.25);
        //INSERT INTO PaymentInstitutions
        //(ID, Name, Show, Rate)
        //VALUES(N'6', N'PayNKolay Yurt Dışı', 1, 0.00);

        //GO

        //CREATE Proc[dbo].[PaymentInstitutions_GetList]
        //AS
        //BEGIN
        //SELECT* FROM PaymentInstitutions
        //END

        //GO

        //CREATE TABLE AccountSummaries(
        //ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //CDate datetime NOT NULL,
        //CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //MDate datetime NULL,
        //MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //Profit decimal (18,4) NOT NULL,
        //ExpenseAmount decimal (18,4) NOT NULL,
        //Difference decimal (18,4) NOT NULL,
        //PaymentNotificationProfit decimal (18,2) NOT NULL,
        //CreditCardPaymentNotificationProfit decimal (18,2) NULL,
        //WithdrawalRequestProfit decimal (18,2) NULL,
        //DealerTotalBalance decimal (18,2) NULL,
        //UnmatchedPaymentNotificationBalance decimal (18,2) NULL,
        //NetAmount decimal (18,2) NULL,
        //ReportNo bigint IDENTITY(1,1) NOT NULL,
        //CONSTRAINT[PK_dbo.AccountSummary] PRIMARY KEY(ID)
        //);

        //GO

        //CREATE Proc[dbo].[AccountSummaries_GetList]
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN


        //DECLARE @totalRecords int

        //SELECT acs.*, ad.Name as Creator into #TempTable FROM AccountSummaries acs
        //INNER JOIN Administrators ad on acs.CUser =  ad.ID
        //WHERE (@SearchValue IS NULL OR  (ad.Name LIKE '%' + @SearchValue + '%' OR acs.ReportNo LIKE '%' + @SearchValue + '%'  OR acs.NetAmount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY ReportNo DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable

        //END

        //GO

        //CREATE Proc[dbo].[AccountSummaries_GetSingle]
        //@ID nvarchar(50),
        //@ReportNo int = null
        //AS
        //BEGIN

        //SELECT s.*, (select NetAmount from AccountSummaries where ReportNo = s.ReportNo - 1) as PreviousReportNetAmount FROM AccountSummaries s WHERE(s.ID = @ID or s.ReportNo = @ReportNo)
        //END

        //GO

        //CREATE Proc[dbo].[AccountSummaries_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@Profit decimal (18,2),
        //@ExpenseAmount decimal (18,2),
        //@Difference decimal (18,2),
        //@PaymentNotificationProfit decimal (18,2),
        //@CreditCardPaymentNotificationProfit decimal (18,2),
        //@WithdrawalRequestProfit decimal (18,2),
        //@DealerTotalBalance decimal (18,2),
        //@UnmatchedPaymentNotificationBalance decimal (18,2),
        //@NetAmount decimal (18,2)
        //AS
        //BEGIN

        //BEGIN TRY


        //SET @IDOut = NEWID()

        //INSERT INTO AccountSummaries(ID, CUser, CDate, Profit, ExpenseAmount, Difference,
        //PaymentNotificationProfit, CreditCardPaymentNotificationProfit,
        //WithdrawalRequestProfit, DealerTotalBalance, UnmatchedPaymentNotificationBalance, NetAmount)

        //VALUES(@IDOut, @CUser, @CDate, @Profit, @ExpenseAmount, @Difference,
        //@PaymentNotificationProfit, @CreditCardPaymentNotificationProfit,
        //@WithdrawalRequestProfit, @DealerTotalBalance, @UnmatchedPaymentNotificationBalance, @NetAmount)

        //SELECT @IDOut
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //CREATE TABLE CreditCardAccountSummaryReportDetails(
        //ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //AccountSummaryReportNo bigint NOT NULL,
        //PaymentInstitutionID nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //PaymentInstitutionName nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //Balance decimal (18,2) NOT NULL,
        //CONSTRAINT PK_CreditCardAccountSummaryReportDetails PRIMARY KEY(ID),
        //CONSTRAINT PK_BankTransferAccountSummaryReportDetails PRIMARY KEY(ID)
        //);

        //GO

        //CREATE Proc[dbo].[CreditCardAccountSummaryReportDetails_GetList]
        //@ReportNo bigint
        //AS
        //BEGIN

        //SELECT* FROM CreditCardAccountSummaryReportDetails
        //WHERE AccountSummaryReportNo = @ReportNo

        //END

        //GO

        //CREATE Proc[dbo].[CreditCardAccountSummaryReportDetails_Insert]
        //@IDOut nvarchar(50) output,
        //@AccountSummaryReportNo bigint,
        //@PaymentInstitutionID nvarchar(50),
        //@PaymentInstitutionName nvarchar(100),
        //@Balance decimal (18,2)
        //AS
        //BEGIN

        //BEGIN TRY


        //SET @IDOut = NEWID()

        //INSERT INTO CreditCardAccountSummaryReportDetails
        //(ID, AccountSummaryReportNo, PaymentInstitutionID, PaymentInstitutionName, Balance)

        //VALUES(@IDOut, @AccountSummaryReportNo, @PaymentInstitutionID, @PaymentInstitutionName, @Balance);
        //SELECT @IDOut


        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //CREATE TABLE BankTransferAccountSummaryReportDetails(
        //ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //AccountSummaryReportNo bigint NOT NULL,
        //IDBank nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //BankName nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //IsExitAccount bit NOT NULL,
        //Balance decimal (18,1) NOT NULL
        //);

        //GO

        //CREATE Proc[dbo].[BankTransferAccountSummaryReportDetails_GetList]
        //@ReportNo bigint
        //AS
        //BEGIN


        //SELECT* FROM BankTransferAccountSummaryReportDetails
        //WHERE AccountSummaryReportNo = @ReportNo

        //END

        //GO

        //CREATE Proc[dbo].[BankTransferAccountSummaryReportDetails_Insert]
        //@IDOut nvarchar(50) output,
        //@AccountSummaryReportNo bigint,
        //@IDBank nvarchar(50),
        //@BankName nvarchar(100),
        //@IsExitAccount bit,
        //@Balance decimal (18,2)
        //AS
        //BEGIN

        //BEGIN TRY


        //SET @IDOut = NEWID()

        //INSERT INTO BankTransferAccountSummaryReportDetails
        //(ID, AccountSummaryReportNo, IDBank, BankName, IsExitAccount, Balance)

        //VALUES(@IDOut, @AccountSummaryReportNo, @IDBank, @BankName, @IsExitAccount, @Balance);
        //SELECT @IDOut


        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GÜNCELLEME ATILDI


        //------------------------------------------------------- 10.11.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        // ALTER TABLE AccountSummaries ADD
        // IncomeAmount decimal (18, 4) NULL

        //GO

        //ALTER Proc[dbo].[AccountSummaries_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@Profit decimal (18,2),
        //@ExpenseAmount decimal (18,2),
        //@Difference decimal (18,2),
        //@PaymentNotificationProfit decimal (18,2),
        //@CreditCardPaymentNotificationProfit decimal (18,2),
        //@WithdrawalRequestProfit decimal (18,2),
        //@DealerTotalBalance decimal (18,2),
        //@UnmatchedPaymentNotificationBalance decimal (18,2),
        //@NetAmount decimal (18,2),
        //@IncomeAmount decimal (18,2)
        //AS
        //BEGIN

        //BEGIN TRY


        //SET @IDOut = NEWID()

        //INSERT INTO AccountSummaries(ID, CUser, CDate, Profit, ExpenseAmount, Difference,
        //PaymentNotificationProfit, CreditCardPaymentNotificationProfit,
        //WithdrawalRequestProfit, DealerTotalBalance, UnmatchedPaymentNotificationBalance, NetAmount, IncomeAmount)

        //VALUES(@IDOut, @CUser, @CDate, @Profit, @ExpenseAmount, @Difference,
        //@PaymentNotificationProfit, @CreditCardPaymentNotificationProfit,
        //@WithdrawalRequestProfit, @DealerTotalBalance, @UnmatchedPaymentNotificationBalance, @NetAmount, @IncomeAmount)

        //SELECT @IDOut
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //GO


        //CREATE Proc[dbo].[CompanyTransactions_GetAccountReportBankTransactionsDetailIncome]
        //@IDBank nvarchar(50) = null,
        //@StartDate datetime = null,
        //@EndDate datetime = null
        //AS
        //BEGIN

        //SELECT t.ID, t.TransactionDate, T.Amount, T.PaymentMethod, cba.Name AS IDBankName  , cbb.Name AS IDBankName2 ,
        //'' as  PaymentMethodName, M.Name as CUserName , case when t.TransactionDetailType = 1 then 'Muhtelif Gelirler' 

        //when t.TransactionDetailType = 2 then 'Banka Giriş' end as IncomeType
        //FROM CompanyFinanceTransaction t

        //left join CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //left join CompanyBankAccounts cbb on cbb.ID = t.IDBankAccount2

        //left join Administrators m on m.ID = T.CUser

        //WHERE 1=1 and (t.PaymentMethod = 1)

        //AND(t.TransactionType = 1)

        //AND(t.TransactionDetailType = 1)

        //AND(@IDBank IS NULL OR t.IDBankAccount= @IDBank)
        //AND(
        //(@StartDate IS NULL) OR
        //(
        //(
        //(CAST(@StartDate AS time) = '00:00:00' AND CAST(t.TransactionDate AS date) >= CAST(@StartDate AS date)) OR
        //(CAST(@StartDate AS time) <> '00:00:00' AND CAST(t.TransactionDate AS datetime) >= CAST(@StartDate AS datetime))
        //)
        //)
        //)
        //AND(
        //(@EndDate IS NULL) OR
        //(
        //(
        //(CAST(@EndDate AS time) = '00:00:00' AND CAST(t.TransactionDate AS date) <= CAST(@EndDate AS date)) OR
        //(CAST(@EndDate AS time) <> '00:00:00' AND CAST(t.TransactionDate AS datetime) <= CAST(@EndDate AS datetime))
        //)
        //)
        //)
        //ORDER BY t.TransactionDate Desc

        //END

        //GO

        //CREATE Proc[dbo].[CompanyTransactions_GetAccountReportBankTransactionsDetailExpense]
        //@IDBank nvarchar(50) = null,
        //@StartDate datetime = null,
        //@EndDate datetime = null
        //AS
        //BEGIN

        //SELECT t.ID, t.TransactionDate, T.Amount, T.PaymentMethod, cba.Name AS IDBankName  , cbb.Name AS IDBankName2 ,
        //'' as  PaymentMethodName, M.Name as CUserName , case when t.TransactionDetailType = 1 then 'Muhtelif Giderler' 

        //when t.TransactionDetailType = 2 then 'Banka Çıkış' end as ExpenseType
        //FROM CompanyFinanceTransaction t

        //left join CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //left join CompanyBankAccounts cbb on cbb.ID = t.IDBankAccount2

        //left join Administrators m on m.ID = T.CUser

        //WHERE 1=1 and (t.PaymentMethod = 1)

        //AND(t.TransactionType = 2)

        //AND(t.TransactionDetailType = 1)

        //AND(@IDBank IS NULL OR t.IDBankAccount= @IDBank)

        //AND(
        //(@StartDate IS NULL) OR
        //(
        //(
        //(CAST(@StartDate AS time) = '00:00:00' AND CAST(t.TransactionDate AS date) >= CAST(@StartDate AS date)) OR
        //(CAST(@StartDate AS time) <> '00:00:00' AND CAST(t.TransactionDate AS datetime) >= CAST(@StartDate AS datetime))
        //)
        //)
        //)
        //AND(
        //(@EndDate IS NULL) OR
        //(
        //(
        //(CAST(@EndDate AS time) = '00:00:00' AND CAST(t.TransactionDate AS date) <= CAST(@EndDate AS date)) OR
        //(CAST(@EndDate AS time) <> '00:00:00' AND CAST(t.TransactionDate AS datetime) <= CAST(@EndDate AS datetime))
        //)
        //)
        //)

        //END

        //GÜNCELLENDİ


        //------------------------------------------------------- 10.11.2023 Arda Değişiklik Scriptleri 2 -----------------------------------------------------------------------------------

        //Create Proc[dbo].[AccountSummaries_Delete]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50)
        //AS
        //BEGIN
        //BEGIN TRY


        //declare @reportNo bigint;
        //set @reportNo = (SELECT ReportNo FROM AccountSummaries WHERE ID = @ID)

        //DELETE FROM AccountSummaries WHERE ID=@ID

        //DELETE FROM BankTransferAccountSummaryReportDetails

        //WHERE AccountSummaryReportNo IN(@reportNo)


        //DELETE FROM CreditCardAccountSummaryReportDetails
        //WHERE AccountSummaryReportNo IN(@reportNo)


        //SELECT @IDOut = @ID
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //GÜNCELLENDİ

        //------------------------------------------------------- 16.11.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyTransactions_GetAccountReportCreditCardDetail]
        //@IDCompany nvarchar(50) = null,
        //@StartDate date = null,
        //@EndDate date = null
        //AS
        //BEGIN

        //SELECT t.ID, t.TransactionDate, T.Amount, T.PaymentMethod, cba.Name AS IDBankName  , cbb.Name AS IDBankName2 ,
        //pins.Name as PaymentMethodName,
        //M.Name as CUserName
        //FROM CompanyFinanceTransaction t

        //left join CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //left join CompanyBankAccounts cbb on cbb.ID = t.IDBankAccount2

        //left join Administrators m on m.ID = T.CUser

        //left join PaymentInstitutions pins on pins.ID = T.CompanyIntegrationType

        //WHERE 1=1 and (t.PaymentMethod = 2)

        //AND(@IDCompany IS NULL OR t.CompanyIntegrationType= @IDCompany)

        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //ORDER BY t.TransactionDate Desc

        //END


        //ALTER Proc[dbo].[CompanyTransactions_GetAccountReportBankTransactionsDetailTransfer]
        //@IDBank nvarchar(50) = null,
        //@StartDate date = null,
        //@EndDate date = null
        //AS
        //BEGIN

        //GO

        //SELECT t.ID, t.TransactionDate, T.Amount, T.PaymentMethod, T.TransactionType, cba.Name AS IDBankName  , cbb.Name AS IDBankName2 ,
        //ISNULL(pins.Name, '' ) as  PaymentMethodName, M.Name as CUserName , case when t.TransactionDetailType = 1 then 'Muhtelif Giderler' 

        //when t.TransactionType = 1 then 'Banka Giriş' when t.TransactionType = 2 then 'Banka Çıkış' end as IncomeType
        //FROM CompanyFinanceTransaction t

        //left join CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //left join CompanyBankAccounts cbb on cbb.ID = t.IDBankAccount2

        //left join Administrators m on m.ID = T.CUser

        //left join PaymentInstitutions pins on pins.ID = T.CompanyIntegrationType

        //WHERE 1=1 and (t.PaymentMethod = 1)
        //--AND(t.TransactionType = 2)

        //AND(t.TransactionDetailType = 2)

        //AND(@IDBank IS NULL OR t.IDBankAccount= @IDBank)

        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //ORDER BY t.TransactionDate Desc

        //END

        //GÜNCELLENDİ

        //------------------------------------------------------- 20.11.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE PROCEDURE CompanyTransactions_GetRecordsByQueryParameter
        //@QueryParameter NVARCHAR(500)
        //AS
        //BEGIN
        //SELECT ID, Status, 1 as TableWithTheTransaction FROM PaymentNotifications
        //WHERE TransactionID = @QueryParameter OR ID = @QueryParameter OR TransactionNr = @QueryParameter
        //UNION
        //SELECT ID, Status, 2 as TableWithTheTransaction FROM CreditCardPaymentNotifications
        //WHERE TransactionID = @QueryParameter OR ID = @QueryParameter OR TransactionNr = @QueryParameter
        //UNION
        //SELECT ID, Status, 3 as TableWithTheTransaction FROM ForeignCreditCardPaymentNotifications
        //WHERE TransactionID = @QueryParameter OR ID = @QueryParameter OR TransactionNr = @QueryParameter
        //UNION
        //SELECT ID, Status, 4 as TableWithTheTransaction FROM CompanyWithdrawalRequests
        //WHERE RequestNr = @QueryParameter OR ID = @QueryParameter OR TransactionNr = @QueryParameter
        //UNION
        //SELECT ID, Status, 5 as TableWithTheTransaction FROM CompanyRebateRequests
        //WHERE TransactionID = @QueryParameter OR ID = @QueryParameter OR TransactionNr = @QueryParameter
        //END


        //GÜNCELLENDİ

        //------------------------------------------------------- 28.11.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        // ALTER TABLE AccountSummaries ADD
        // IsMonthly bit NULL DEFAULT 0

        //GO

        //ALTER Proc[dbo].[AccountSummaries_GetList]
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IsMonthly bit = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT acs.*, ad.Name as Creator into #TempTable FROM AccountSummaries acs
        //INNER JOIN Administrators ad on acs.CUser =  ad.ID
        //WHERE (@IsMonthly IS NULL OR IsMonthly = @IsMonthly)
        //AND(@SearchValue IS NULL OR  (ad.Name LIKE '%' + @SearchValue + '%' OR acs.ReportNo LIKE '%' + @SearchValue + '%'  OR acs.NetAmount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY ReportNo DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable

        //END

        //GO

        //ALTER Proc[dbo].[AccountSummaries_GetSingle]
        //@ID nvarchar(50),
        //@ReportNo int = null,
        //@IsMonthly bit = null
        //      AS
        //      BEGIN

        //SELECT s.*, (select NetAmount from AccountSummaries where ReportNo = (SELECT MAX(ReportNo)
        //FROM AccountSummaries
        //WHERE ReportNo<s.ReportNo AND (@IsMonthly IS NULL OR IsMonthly = @IsMonthly))) as PreviousReportNetAmount, ad.Name as Creator
        //FROM AccountSummaries s
        //INNER JOIN Administrators ad on s.CUser =  ad.ID
        //WHERE(s.ID = @ID)
        //END

        //GO

        //ALTER Proc[dbo].[AccountSummaries_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@Profit decimal (18,2),
        //@ExpenseAmount decimal (18,2),
        //@Difference decimal (18,2),
        //@PaymentNotificationProfit decimal (18,2),
        //@CreditCardPaymentNotificationProfit decimal (18,2),
        //@WithdrawalRequestProfit decimal (18,2),
        //@DealerTotalBalance decimal (18,2),
        //@UnmatchedPaymentNotificationBalance decimal (18,2),
        //@NetAmount decimal (18,2),
        //@IncomeAmount decimal (18,2),
        //@IsMonthly bit = null
        //AS
        //BEGIN

        //BEGIN TRY

        //SET @IDOut = NEWID()

        //INSERT INTO AccountSummaries(ID, CUser, CDate, Profit, ExpenseAmount, Difference,
        //PaymentNotificationProfit, CreditCardPaymentNotificationProfit,
        //WithdrawalRequestProfit, DealerTotalBalance, UnmatchedPaymentNotificationBalance, NetAmount, IncomeAmount, IsMonthly)

        //VALUES(@IDOut, @CUser, @CDate, @Profit, @ExpenseAmount, @Difference,
        //@PaymentNotificationProfit, @CreditCardPaymentNotificationProfit,
        //@WithdrawalRequestProfit, @DealerTotalBalance, @UnmatchedPaymentNotificationBalance, @NetAmount, @IncomeAmount, @IsMonthly)

        //SELECT @IDOut
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //------------------------------------------------------- 01.12.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[PaymentInstitutions_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@IsActive bit = null,
        //@Rate decimal = null,
        //@Show bit = null
        //AS
        //BEGIN

        //Update PaymentInstitutions SET IsActive = @IsActive WHERE ID = @ID
        //END

        //GO

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, GetBalance.MatchesBalance, GetBalance.NotMatchesBalance, GetBalance.MatchesCount, GetBalance.NotMatchesCount into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //WHERE 1=1

        //AND (@Status IS NULL  OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR B.Name LIKE '%' + @SearchValue + '%'   ))
        //AND NOT EXISTS(select* from WhereConditions wc

        //WHERE (wc.ColumnName = 'SenderName' and r.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //(wc.ColumnName = 'Description' and r.Description LIKE '%' + wc.ConditionName + '%'))
        //and(Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER FUNCTION[dbo].[Fn_PaymentTransferPools_GetListBalance]
        //(
        //@Status tinyint,
        //@StartDate date = null,
        //@EndDate date = null,
        //@OffsetValue int
        //)
        //RETURNS TABLE
        //AS
        //RETURN

        //SELECT sum([dbo].RoundToZero(MatchesBalance)) as MatchesBalance , sum([dbo].RoundToZero(NotMatchesBalance)) as NotMatchesBalance,
        //sum(MatchesCount) as MatchesCount , sum(NotMatchesCount) as NotMatchesCount from(
        //select CASE WHEN t.Status = 2 then sum([dbo].RoundToZero(t.Amount)) end as MatchesBalance,
        //CASE WHEN t.Status = 1 then sum([dbo].RoundToZero(t.Amount))  end as NotMatchesBalance,
        //CASE WHEN t.Status = 2 then count(*) else 0 end as MatchesCount,
        //CASE WHEN t.Status = 1 then count(*) else 0 end as NotMatchesCount
        //FROM PaymentTransferPools t
        //WHERE 1=1
        //AND(@Status IS NULL OR t.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND NOT EXISTS(select* from WhereConditions wc
        //WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //(wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //AND(Amount > 0 )

        //group by t.Status ) as aa

        //Go

        //      ALTER Proc[dbo].[CompanyTransactions_GetAccountReport]
        //      @IDCompany nvarchar(50),
        //      @StartDate datetime,
        //      @EndDate datetime
        //      AS
        //      BEGIN

        //      SELECT top 100 isnull(sumT.Total,0) as sumTotal ,
        //      isnull(sumCr.CompanyCommission,0) + isnull(sumTr.CompanyCommission,0) as sumCommission,  
        //      isnull(sumNet.NetTotal,0) as sumNetTotal,
        //      isnull(sumProcessT.Amount,0) as sumProcessTotal , 
        //      isnull(sumEft.Amount,0) as sumEft , 
        //      isnull(sumFast.Amount,0) as sumFast , 
        //      isnull(sumProcess.CostTotal,0) as sumProcess ,
        //      isnull(sumEx.Amount,0) as sumExpense,
        //      isnull(sumCr.CompanyCommission,0) as sumCreditCardCommission,
        //      isnull(sumTr.CompanyCommission,0) as sumTransferCommission, 
        //      sumFast.cwAmount as countFast,
        //      sumEft.cwAmount as countEft,
        //      sumProcess.cwCostTotal as countProcess,
        //      isnull(sumTrPool.Amount,0) as sumTrPoolNotMatchTotal

        //      FROM CompanyTransactions t

        //      cross join(Select sum([dbo].RoundToZero(Total)) as Total From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //      cross join(Select sum([dbo].RoundToZero(Commission)) as Commission From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumC

        //      cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as CompanyCommission From CompanyTransactions t where IDActionType IN(100,110)

        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumCr

        //      cross join(Select sum([dbo].RoundToZero(Commission)) as CompanyCommission From CompanyTransactions t where IDActionType IN(10,20)

        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumTr

        //      cross join(Select sum([dbo].RoundToZero(NetTotal)) as NetTotal From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumNet

        //      cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //      inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //      where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)

        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcessT

        //      cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount, Count(cw.Amount) as cwAmount From CompanyTransactions t

        //      inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //      where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //      and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //      cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount , Count(cw.Amount) as cwAmount From CompanyTransactions t

        //      inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //      where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //      and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast

        //      cross join(Select sum([dbo].RoundToZero(cw.CostTotal)) as CostTotal , Count(cw.Amount) as cwCostTotal From CompanyTransactions t

        //      inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //      where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)

        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcess

        //      cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //      where TransactionType = 2

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //      AND T.TransactionDetailType = 1 ) as sumEx

        //      cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From PaymentTransferPools t

        //      where t.Status = 1 
        //      AND NOT EXISTS (select* from WhereConditions wc
        //      WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //      (wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //      AND t.Amount > 0 


        //) as sumTrPool

        //      --WHERE(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //      --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)))
        //      --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)))


        //      END


        // GUNCELLENDİ

        //------------------------------------------------------- 04.12.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'AKODECreditCard', N'api_user', N'apiUser3013819', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'AKODECreditCard', N'api_pass', N'PHP18TSVD3', 0);
        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'AKODECreditCard', N'client_id', N'1000001435', 0);

        // ALTER TABLE PaymentInstitutions ADD
        // DebitCardRate decimal (18, 2) NULL 

        //GO

        //ALTER Proc[dbo].[PaymentInstitutions_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@IsActive bit = null,
        //@Rate decimal = null,
        //@Show bit = null,
        //@DebitCardRate decimal = null
        //AS
        //BEGIN

        //Update PaymentInstitutions SET IsActive = @IsActive WHERE ID = @ID
        //END

        //GO

        // ALTER TABLE CreditCardPaymentNotifications ADD
        // CardTypeId int NULL 

        //GO

        // ALTER TABLE CreditCardPaymentNotifications ADD
        // PaymentInstitutionCommissionRate decimal (18,2) NULL 

        //GO

        // ALTER TABLE CreditCardPaymentNotifications ADD
        // PaymentInstitutionNetAmount decimal (18,2) NULL 

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_GetList]
        //@Status tinyint,
        //@IDCompany  nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@IsAutoNotification tinyint,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT r.ID, r.CDate,r.MDate,r.ServiceID,r.TransactionNr,r.TransactionID,r.IDMember,r.Phone,r.ActionDate,r.ActionTime,r.Amount,r.SenderName,r.SenderIdentityNr,
        //r.Description,r.Status,r.BlockedDate,r.IsNotBocked,r.IsAutoNotification,r.ParamCommission,r.PayNKolayCommission,r.CardNumber,r.TransactionReferenceCode,
        //r.MUser,r.MemberIPAddress,r.MemberPort,r.PaymentInstitutionCommissionRate,r.PaymentInstitutionNetAmount, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, ct.CommissionRate, 
        //[dbo].RoundToZero(ct.Commission) as Commission, [dbo].RoundToZero(ct.NetTotal) as NetTotal, m2.Name AS Modifier, r.CreditCardPaymentMethodID
        //into #TempTable FROM CreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //INNER JOIN Companies c ON c.ID= ci.ID

        //INNER JOIN Members m ON m.ID= r.IDMember

        //LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //LEFT JOIN CompanyTransactions ct ON ct.ID = r.ID

        //WHERE 1=1

        //AND (@IsAutoNotification IS NULL OR r.IsAutoNotification = @IsAutoNotification)

        //AND(r.Status= @Status OR (@Status IS NULL AND r.Status IN(2,3)) OR @Status = 4)

        //AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (m.Name LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@ParamCommission decimal (18,2),
        //@PayNKolayCommission decimal (18,2),
        //@CardNumber nvarchar(30),
        //@TransactionReferenceCode nvarchar(30),
        //@CreditCardPaymentMethodID tinyint,
        //@CardTypeId int,
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--		IF(Select Count(ID) From CreditCardPaymentNotifications Where IDMember= @IDMember And Status = 1)>0  
        //--		BEGIN
        //--			SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //--			RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--		END
        //IF(Select Count(ID) From CreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //declare @_isAutoNotification bit = 0;
        //declare @_isAuto bit;
        //declare @_minAmount decimal (18,2);
        //declare @_maxAmount decimal (18,2);
        //declare @_quantity smallint;
        //select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL)
        //begin
        //if(@Amount>=@_minAmount AND @Amount<=@_maxAmount)
        //begin
        //if (select Count(pn.ID) from CreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //begin

        //set @_isAutoNotification = 1;
        //end
        //end

        //end

        //SET @IDOut = NEWID()

        //INSERT INTO CreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //IsAutoNotification, Description, ParamCommission, PayNKolayCommission, CardNumber, TransactionReferenceCode, CreditCardPaymentMethodID, CardTypeId)

        //SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.CreditCardBlocked, GetDate()), 
        //IIF(cc.CreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @ParamCommission, @PayNKolayCommission, @CardNumber, @TransactionReferenceCode, @CreditCardPaymentMethodID, @CardTypeId FROM CompanyCommissions cc

        //INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //WHERE ci.ServiceID= @ServiceID


        //SELECT @IDOut


        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@TransactionReferenceCode nvarchar(30),
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //IF(select Status from CreditCardPaymentNotifications where ID = @ID)!=1 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=5
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu bildirim daha önce cevaplanmıştır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //UPDATE CreditCardPaymentNotifications SET MDate= IIF(@MDate is null, GETDATE(), @MDate), Description=@Description, Status=@Status, 
        //TransactionReferenceCode = @TransactionReferenceCode, MUser = @MUser, PaymentInstitutionCommissionRate = @PaymentInstitutionCommissionRate,
        //PaymentInstitutionNetAmount = @PaymentInstitutionNetAmount WHERE ID=@ID
        //AND(Status= 1 OR Status = 5)

        //SELECT @IDOut = @ID

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER TRIGGER[dbo].[tggrUpdateCreditCardPaymentNotifications]
        //ON[dbo].[CreditCardPaymentNotifications]
        //AFTER UPDATE
        //AS
        //BEGIN


        //declare @id nvarchar(50);
        //declare @Status tinyint;
        //select @id = ID, @Status = Status from inserted
        //--DECLARE @PayNKolayCreditCardRate  nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamType = 'PayNKolayCreditCard' AND s.ParamDef = 'credit_card_commission_rate');
        //--DECLARE @PaybullCreditCardRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamType = 'Paybull' AND s.ParamDef = 'credit_card_commission_rate');

        //IF(@Status= 2)

        //BEGIN
        //DELETE FROM CompanyTransactions WHERE ID = @id

        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate, CompanyCommission , CompanyCommissionRate)

        //SELECT pn.ID, pn.CDate, ci.ID, '100', pn.MDate, TransactionNr, pn.Amount, ROUND((pn.Amount* cc.CreditCardRate/100), 4 ) , 0, ROUND((pn.Amount - (pn.Amount* cc.CreditCardRate/100)), 4), IDMember, cc.CreditCardRate , 
        //--		case when CreditCardPaymentMethodID = 2 then ROUND(((pn.Amount / 100)  *  (CAST(@PayNKolayCreditCardRate AS DECIMAL(10, 2))) ),4)
        //--		when CreditCardPaymentMethodID = 5 then ROUND(((pn.Amount / 100)  *  (CAST(@PaybullCreditCardRate AS DECIMAL(10, 2))) ),4) 
        //--		when CreditCardPaymentMethodID = 3  then ROUND(((pn.Amount / 100)  * 0),4)  end,
        //--		
        //--		case when CreditCardPaymentMethodID = 2  then(CAST(@PayNKolayCreditCardRate AS DECIMAL(10, 2))) 
        //--		when CreditCardPaymentMethodID = 5  then(CAST(@PaybullCreditCardRate AS DECIMAL(10, 2))) 
        //--		when CreditCardPaymentMethodID = 3 then 0 end
        //--	
        //case when pn.CardTypeId = 1 and pins.DebitCardRate is not null then ROUND(((pn.Amount / 100)  *  (CAST(pins.DebitCardRate AS DECIMAL(10, 2))) ),4)
        //when pn.CardTypeId = 2 then ROUND(((pn.Amount / 100)  *  (CAST(pins.Rate AS DECIMAL(10, 2))) ),4) end,

        //case when pn.CardTypeId = 1 and pins.DebitCardRate is not null then (CAST(pins.DebitCardRate AS DECIMAL(10, 2))) 
        //when pn.CardTypeId = 2 then (CAST(pins.Rate AS DECIMAL(10, 2)))  end


        //FROM CreditCardPaymentNotifications pn

        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //INNER JOIN CompanyCommissions cc ON cc.ID= ci.ID

        //INNER JOIN PaymentInstitutions pins on pins.ID = pn.CreditCardPaymentMethodID

        //WHERE pn.ID= @id

        //END

        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 11.12.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //        ALTER Proc[dbo].[CompanyTransactions_GetProcess]
        //        @IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IsMonthlyAccountSummary bit = 0
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT t.ID, t.CDate, t.MDate, t.IDCompany, t.IDActionType, t.TransactionDate,t.TransactionNr, t.IDBank,
        //cwr.SIDBank as WithdrawalRequestSIDBank,
        //ccpn.CreditCardPaymentMethodID as CreditCardPaymentMethodID,
        //[dbo].RoundToZero(t.Total) AS Total,

        //[dbo].RoundToZero(t.Commission) as Commission, 
        //ROUND((t.commission / t.total* 100),4) as TransactionTotal,
        //t.CostTotal,
        //[dbo].RoundToZero(t.NetTotal) as NetTotal, 

        //t.IDMember,t.IDCompanyInvoice, at.ActionType, b.Name as Bank, m.Name as Member, 
        //t.CommissionRate  ,
        //GetProcessBalance.NetTotal as Balance, GetProcessBalance.Total as BalanceTotal , 
        //GetProcessBalance.Commission as BalanceCommission ,
        //GetProcessBalance.RebateTotal , GetProcessBalance.RebateTotalCount,
        //GetProcessBalance.CommissionCount

        //--isnull(dbo.CompanyTransactions_GetProcessBalance(@IDCompany, @StartDate, @EndDate, t.TransactionDate),0) as Balance
        //into #TempTable FROM CompanyTransactions t
        //INNER JOIN ActionTypes at ON at.IDActionType=t.IDActionType
        //LEFT JOIN Banks b ON b.ID= t.IDBank
        //left join CompanyWithdrawalRequests cwr on cwr.ID = t.ID
        //left join CreditCardPaymentNotifications ccpn on ccpn.ID = t.ID
        //LEFT JOIN Members m ON m.ID= t.IDMember

        //cross join dbo.Fn_CompanyTransactions_GetProcessBalance(@IDCompany, @StartDate, @EndDate) as GetProcessBalance
        //WHERE
        //    (
        //        (@IsMonthlyAccountSummary = 0 AND t.IDActionType IN ('10', '20', '70', '90', '100', '140'))
        //        OR
        //        (@IsMonthlyAccountSummary = 1 AND t.IDActionType IN ('10', '20', '30', '70', '100', '140'))
        //    )

        //AND(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //AND CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)

        //AND CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)

        //AND(@SearchValue IS NULL OR  (b.Name LIKE '%' + @SearchValue + '%' OR t.TransactionNr LIKE '%' + @SearchValue + '%'  OR t.Total LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable

        //END

        // GO

        //CREATE Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, GetBalance.MatchesBalance, GetBalance.NotMatchesBalance, GetBalance.MatchesCount, GetBalance.NotMatchesCount into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //WHERE 1=1

        //AND (@Status IS NULL  OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR B.Name LIKE '%' + @SearchValue + '%'   ))
        //AND NOT EXISTS(select* from WhereConditions wc

        //WHERE (wc.ColumnName = 'SenderName' and r.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //(wc.ColumnName = 'Description' and r.Description LIKE '%' + wc.ConditionName + '%'))
        //and(Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END


        //GUNCELLENDİ

        //------------------------------------------------------- 14.12.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //   CREATE TABLE CompanyPaymentInstitutions(
        //   ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   CDate datetime NULL,
        //   CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //MDate datetime NULL,
        //MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //PaymentInstitutionID nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //IsActive bit NULL
        //   );

        //GO

        //        CREATE Proc[dbo].[CompanyPaymentInstitutions_GetList]
        //        @ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT cpi.*, pins.Name as PaymentInstitutionName FROM CompanyPaymentInstitutions cpi

        //    INNER JOIN PaymentInstitutions pins ON pins.ID = cpi.PaymentInstitutionID

        //    WHERE cpi.ID = @ID

        //    ORDER BY pins.ID

        //END

        //GO

        //CREATE Proc[dbo].[CompanyPaymentInstitutions_Insert]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@PaymentInstitutionID nvarchar(10),
        //@IsActive bit = null
        //AS
        //BEGIN

        //BEGIN TRY


        //SET @IDOut = @ID


        //INSERT INTO CompanyPaymentInstitutions
        //(ID, CDate, CUser, MDate, MUser, PaymentInstitutionID, IsActive)

        //VALUES(@ID, @CDate, @CUser, null, null, @PaymentInstitutionID, 0);

        //SELECT @IDOut

        //END TRY

        //BEGIN CATCH

        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //RAISERROR(@ERRORMESSAGE,16,1)

        //END CATCH
        //END

        //GO

        //CREATE Proc[dbo].[CompanyPaymentInstitutions_Delete]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@PaymentInstitutionID nvarchar(10)
        //AS
        //BEGIN

        //BEGIN TRY


        //    SET @IDOut = @ID


        //        DELETE FROM CompanyPaymentInstitutions WHERE ID=@ID and PaymentInstitutionID = @PaymentInstitutionID

        //        SELECT @IDOut
        //    END TRY
        //        BEGIN CATCH
        //            DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //            SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //            RAISERROR(@ERRORMESSAGE,16,1)

        //        END CATCH
        //END

        //GO

        //CREATE Proc[dbo].[CompanyPaymentInstitutions_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@PaymentInstitutionID nvarchar(10),
        //@IsActive bit
        //AS
        //BEGIN

        //BEGIN TRY

        //Update CompanyPaymentInstitutions SET IsActive = @IsActive WHERE ID = @ID and PaymentInstitutionID = @PaymentInstitutionID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 22.12.2023 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        // ALTER TABLE dbo.Banks ADD
        // IFrameWarnText nvarchar(250) NULL

        //ALTER Proc[dbo].[CompanyBanks_GetList]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //SELECT @ID as ID, b.ID as IDBank, b.Name as Bank, b.Title, b.Branch, b.AccountNr, b.IBAN, b.Img, Cast(IIF(c.IDBank IS NULL, 0, 1) as bit) AS IsActive,
        //b.IFrameWarnText as IFrameWarnText FROM Banks b
        //LEFT JOIN CompanyBanks c ON b.ID=c.IDBank AND c.ID= @ID
        //ORDER BY b.OrderNr

        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 08.01.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.PaymentInstitutions
        //ADD ForSpecialCreditCard233 bit NULL,
        //RedirectToActionGetThreeDView233 nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //RedirectToActionPaymentMethod233 nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //RedirectToActionRebateMethod233 nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL;

        //GO
        //UPDATE dbo.PaymentInstitutions
        //SET ForSpecialCreditCard = 0, RedirectToActionGetThreeDView= NULL, RedirectToActionPaymentMethod= N'ParamPaymentMethod', RedirectToActionRebateMethod= N'ParamRefundMethod'
        //WHERE ID = N'1';
        //        UPDATE dbo.PaymentInstitutions
        //        SET ForSpecialCreditCard = 0, RedirectToActionGetThreeDView= NULL, RedirectToActionPaymentMethod= N'PayNKolayPaymentMethod', RedirectToActionRebateMethod= N'PayNKolayRefundMethod'
        //WHERE ID = N'2';
        //        UPDATE dbo.PaymentInstitutions
        //        SET ForSpecialCreditCard = 0, RedirectToActionGetThreeDView= NULL, RedirectToActionPaymentMethod= NULL, RedirectToActionRebateMethod= NULL
        //        WHERE ID = N'3';
        //        UPDATE dbo.PaymentInstitutions
        //        SET ForSpecialCreditCard = 0, RedirectToActionGetThreeDView= NULL, RedirectToActionPaymentMethod= N'IsBankPaymentMethod', RedirectToActionRebateMethod= N'IsBankRefundMethod'
        //WHERE ID = N'4';
        //        UPDATE dbo.PaymentInstitutions
        //        SET ForSpecialCreditCard = 0, RedirectToActionGetThreeDView= N'PaybullThreeDSecure', RedirectToActionPaymentMethod= N'PaybullPaymentMethod', RedirectToActionRebateMethod= N'PaybullRefundMethod'
        //WHERE ID = N'5';
        //        UPDATE dbo.PaymentInstitutions
        //        SET ForSpecialCreditCard = 0, RedirectToActionGetThreeDView= N'AKODEThreeDSecure', RedirectToActionPaymentMethod= N'AKODEPaymentMethod', RedirectToActionRebateMethod= N'AKODERefundMethod'
        //WHERE ID = N'6';


        //GO

        //ALTER Proc[dbo].[CompanyPaymentInstitutions_GetList]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT cpi.*, pins.Name as PaymentInstitutionName, pins.RedirectToActionGetThreeDView as RedirectToActionGetThreeDView,
        //    pins.RedirectToActionPaymentMethod as RedirectToActionPaymentMethod FROM CompanyPaymentInstitutions cpi

        //    INNER JOIN PaymentInstitutions pins ON pins.ID = cpi.PaymentInstitutionID

        //    WHERE cpi.ID = @ID

        //    ORDER BY pins.ID

        //END

        //GO

        //ALTER Proc[dbo].[CompanyPaymentInstitutions_GetSingle]
        //@ID nvarchar(50),
        //@PaymentInstitutionID nvarchar(10)
        //AS
        //BEGIN

        //    SELECT cpi.*, pins.Name as PaymentInstitutionName, pins.RedirectToActionGetThreeDView as RedirectToActionGetThreeDView,
        //    pins.RedirectToActionPaymentMethod as RedirectToActionPaymentMethod FROM CompanyPaymentInstitutions cpi

        //    INNER JOIN PaymentInstitutions pins ON pins.ID = cpi.PaymentInstitutionID

        //    WHERE cpi.ID = @ID and cpi.PaymentInstitutionID = @PaymentInstitutionID

        //    ORDER BY pins.ID
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 10.01.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IDBank nvarchar(10) = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, GetBalance.MatchesBalance, GetBalance.NotMatchesBalance, GetBalance.MatchesCount, GetBalance.NotMatchesCount into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //WHERE 1=1
        //AND (@IDBank IS NULL  OR r.IDBank= @IDBank)
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR B.Name LIKE '%' + @SearchValue + '%'   ))
        //AND NOT EXISTS(select* from WhereConditions wc

        //    WHERE (wc.ColumnName = 'SenderName' and r.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //    (wc.ColumnName = 'Description' and r.Description LIKE '%' + wc.ConditionName + '%'))
        //and(Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLength ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO


        //ALTER Proc[dbo].[CompanyWithdrawalRequests_GetList]
        //@Status tinyint,
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IsProcess bit = null,
        //@SIDBank nvarchar(10) = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT r.*, c.Title AS Company, c.Phone, b.Name as Bank, a.Name AS Modifier into #TempTable FROM CompanyWithdrawalRequests r
        //INNER JOIN Companies c ON c.ID=r.IDCompany
        //INNER JOIN Banks b ON b.ID= r.IDBank

        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //WHERE 1=1

        //AND (@SIDBank IS NULL OR r.SIDBank = @SIDBank)
        //AND(@IsProcess IS NULL OR r.IsProcess = 0)

        //AND((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)

        //AND(@IDCompany IS NULL OR r.IDCompany= @IDCompany)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.Title LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //CREATE PROCEDURE[dbo].[CompanyTransactions_GetBankTransactions]
        //@IDBank NVARCHAR(10) = NULL,
        //@IDBankAccount NVARCHAR(50),
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@IsExitAccount BIT = NULL,
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //DECLARE @totalRecords INT

        //IF(@IsExitAccount = 0)
        //BEGIN
        //SELECT t.TransactionDate, t.IDBank, t.SenderName, t.Amount, 
        //b.Name as BankName, t.Description
        //INTO #TempTable
        //FROM PaymentTransferPools t
        //INNER JOIN Banks b ON b.ID = t.IDBank
        //WHERE t.IDBank= @IDBank
        //AND NOT EXISTS(select* from WhereConditions wc

        //WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //(wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR (t.Description LIKE '%' + @SearchValue + '%' OR t.SenderName LIKE '%' + @SearchValue + '%' OR t.Amount LIKE '%' + @SearchValue + '%'))
        //AND t.Amount > 0 

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords AS TotalRecords FROM #TempTable
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS
        //FETCH NEXT @PageLength ROWS ONLY


        //DROP TABLE #TempTable
        //END
        //ELSE
        //BEGIN
        //SELECT cwr.CDate as TransactionDate, cwr.SIDBank as IDBank, cwr.Title as SenderName, cwr.Amount, b.Name as BankName,
        //cwr.Description
        //INTO #TempTable2
        //FROM CompanyWithdrawalRequests cwr
        //INNER JOIN Banks b ON b.ID = cwr.SIDBank
        //WHERE
        //(cwr.SIDBank = @IDBank)
        //AND(cwr.Status = 2)
        //AND(@StartDate IS NULL OR CAST(cwr.CDate AS DATE) >= CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(cwr.CDate AS DATE) <= CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR (cwr.Title LIKE '%' + @SearchValue + '%' OR cwr.Amount LIKE '%' + @SearchValue + '%'))
        //INSERT INTO #TempTable2 (TransactionDate, IDBank, SenderName, Amount, BankName, Description)
        //SELECT crr.CDate as TransactionDate, crr.SIDBank as IDBank, crr.SenderName as SenderName, crr.Amount, b.Name as BankName,
        //crr.Description
        //FROM CompanyRebateRequests crr

        //INNER JOIN Banks b ON b.ID = crr.SIDBank

        //WHERE

        //(crr.SIDBank = @IDBank)

        //AND(crr.Status = 2)

        //AND(@StartDate IS NULL OR CAST(crr.CDate AS DATE) >= CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(crr.CDate AS DATE) <= CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR (crr.SenderName LIKE '%' + @SearchValue + '%' OR crr.Amount LIKE '%' + @SearchValue + '%'))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable2
        //SELECT *, @totalRecords AS TotalRecords FROM #TempTable2
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS
        //FETCH NEXT @PageLength ROWS ONLY
        //DROP TABLE #TempTable2
        //END

        //END

        //GO

        //INSERT INTO dbo.Settings (ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'OVGIsBankWsdl', N'uid', N'U504705720', 0);

        //INSERT INTO dbo.Settings (ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'OVGIsBankWsdl', N'pwd', N'Dq0iYK6yQ1', 0);

        //INSERT INTO dbo.Settings (ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'HalkbankWsdl', N'username', N'43279407EPDUSR', 0);

        //INSERT INTO dbo.Settings (ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'HalkbankWsdl', N'password', N'D5!t/JM6Jz', 0);

        //GO

        //INSERT INTO dbo.Banks (ID, Name, Title, Branch, AccountNr, IBAN, Img, OrderNr, StatusFlag, ActivatedForGeneralUse, IFrameWarnText)
        //VALUES(N'33', N'OVG İŞ BANKASI', N'OVG ELEKTRONİK TİCARET A.Ş.', N'0064', N'4412-0298609', N'TR88 0006 4000 0014 4120 2986 09', N'is.png', 33, 1, 0, NULL);

        //GO

        //INSERT INTO dbo.CompanyBanks (ID, IDBank, CDate, CUser, MDate, MUser)
        //VALUES(N'1312E00F-E83E-45B4-85C6-892396D4377D', N'33', '2023-10-04 10:58:04.480', N'14B899E2-444C-4DE4-87F5-CC09A4D28259', NULL, NULL);

        //GO

        //ALTER Proc[dbo].[Banks_GetBanksForIframeSetting]
        //AS
        //BEGIN

        //SELECT* FROM Banks
        //WHERE ID IN('08','03','07', '04','33')
        //ORDER BY OrderNr

        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 11.01.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[PaymentTransferPools_GetBankLastActivity]
        //@IDBank nvarchar(10)
        //AS
        //BEGIN

        //SELECT MAX(TransactionDate) as TransactionDate FROM PaymentTransferPools WHERE IDBank = @IDBank
        //END

        //GO

        //CREATE Proc[dbo].[CompanyWithdrawalRequests_GetBankLastActivity]
        //@IDBank nvarchar(10)
        //AS
        //BEGIN

        //SELECT MAX(MDate) as TransactionDate FROM CompanyWithdrawalRequests
        //WHERE SIDBank = @IDBank and Status = 2
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 16.01.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_GetList]
        //@Status tinyint,
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IsProcess bit = null,
        //@SIDBank nvarchar(10) = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT r.*, c.Title AS Company, c.Phone, b.Name as Bank, a.Name AS Modifier,
        //cba.Name as SBankName
        //into #TempTable FROM CompanyWithdrawalRequests r
        //INNER JOIN Companies c ON c.ID=r.IDCompany
        //INNER JOIN Banks b ON b.ID= r.IDBank
        //LEFT JOIN CompanyBankAccounts cba on cba.IDBank = r.SIDBank

        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //WHERE 1=1
        //AND (@SIDBank IS NULL OR r.SIDBank = @SIDBank)
        //AND(@IsProcess IS NULL OR r.IsProcess = 0)

        //AND((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)

        //AND(@IDCompany IS NULL OR r.IDCompany= @IDCompany)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.Title LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT r.*, c.Title AS Company, c.Phone, b.Name as Bank, a.Name AS Modifier ,
        //    cba.Name as SBankName
        //    FROM CompanyWithdrawalRequests r

        //    INNER JOIN Companies c ON c.ID= r.IDCompany

        //    INNER JOIN Banks b ON b.ID= r.IDBank

        //    LEFT JOIN Administrators a ON a.ID= r.MUser

        //    LEFT JOIN CompanyBankAccounts cba on cba.IDBank = r.SIDBank

        //    WHERE r.ID= @ID

        //END

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT r.*, c.Title as Company,
        //    c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, m2.Name as Modifier,
        //    pins.Name as PaymentInstitutionName
        //    FROM CreditCardPaymentNotifications r

        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID

        //    INNER JOIN Companies c ON c.ID= ci.ID

        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType

        //    LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //    LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID

        //    WHERE r.ID= @ID

        //END

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_GetList]
        //@Status tinyint,
        //@IDCompany  nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@IsAutoNotification tinyint,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT r.ID, r.CDate,r.MDate,r.ServiceID,r.TransactionNr,r.TransactionID,r.IDMember,r.Phone,r.ActionDate,r.ActionTime,r.Amount,r.SenderName,r.SenderIdentityNr,
        //r.Description,r.Status,r.BlockedDate,r.IsNotBocked,r.IsAutoNotification,r.ParamCommission,r.PayNKolayCommission,r.CardNumber,r.TransactionReferenceCode,
        //r.MUser,r.MemberIPAddress,r.MemberPort,r.CardTypeId,r.PaymentInstitutionCommissionRate,r.PaymentInstitutionNetAmount, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, ct.CommissionRate, 
        //[dbo].RoundToZero(ct.Commission) as Commission, [dbo].RoundToZero(ct.NetTotal) as NetTotal, m2.Name AS Modifier, r.CreditCardPaymentMethodID, pins.Name as PaymentInstitutionName
        //into #TempTable FROM CreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //INNER JOIN Companies c ON c.ID= ci.ID
        //LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID

        //INNER JOIN Members m ON m.ID= r.IDMember

        //LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //LEFT JOIN CompanyTransactions ct ON ct.ID = r.ID

        //WHERE 1=1

        //AND (@IsAutoNotification IS NULL OR r.IsAutoNotification = @IsAutoNotification)

        //AND(r.Status= @Status OR (@Status IS NULL AND r.Status IN(2,3)) OR @Status = 4)

        //AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (m.Name LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END


        //GUNCELLENDİ





        //------------------------------------------------------- 19.01.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //        CREATE Proc[dbo].[CompanyTransactions_GetAccountReportv2]
        //        @IDCompany nvarchar(50),
        //        @StartDate datetime,
        //        @EndDate datetime
        //        AS
        //        BEGIN

        //        SELECT top 100 
        //        isnull(sumT.TransferTotalAmount,0) as TransferTotalAmount ,
        //        isnull(sumTr.CompanyCommission,0) as TransferCommissionProfitAmount,
        //        isnull(sumTr.TransferDealerPaidAmount,0) as TransferDealerPaidAmount,
        //        isnull(sumTrPool.Amount,0) as TransferNotMatchedAmount,

        //        isnull(sumT.CreditCardTotalAmount,0) as CreditCardTotalAmount,
        //        isnull(sumCr.CompanyCommission,0) as CreditCardCommissionProfitAmount,
        //        isnull(sumCr.CreditCardDealerPaidAmount,0) as CreditCardDealerPaidAmount,
        //        isnull(sumCr.CreditCardPaymentInstitutionPaidAmount,0) as CreditCardPaymentInstitutionPaidAmount,              

        //        isnull(sumWt.WithdrawalTotalAmount,0) as WithdrawalTotalAmount, 
        //        isnull(sumWt.WithdrawalTotalPaidAmount,0) as WithdrawalTotalPaidAmount, 
        //        isnull(sumWt.WithdrawalTotalTransactionFeeAmount,0) as WithdrawalTotalTransactionFeeAmount, 
        //        isnull(sumEft.Amount,0) as WithdrawalEftAmount, 
        //        isnull(sumFast.Amount,0) as WithdrawalFastAmount, 

        //        isnull(sumEx.Amount,0) as TotalExpenseAmount,
        //        isnull(sumIncome.Amount,0) as TotalIncomeAmount

        //        FROM CompanyTransactions t

        //        cross join(Select SUM(CASE WHEN t.IDActionType IN (10, 20) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS TransferTotalAmount,
        //        SUM(CASE WHEN t.IDActionType IN(100, 110) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS CreditCardTotalAmount From CompanyTransactions

        //        t where IDActionType IN(10,20,100,110)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //        cross join(Select sum([dbo].RoundToZero(Commission)) as Commission From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumC

        //        cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as CompanyCommission, 
        //        sum([dbo].RoundToZero(NetTotal)) as CreditCardDealerPaidAmount, 
        //        sum([dbo].RoundToZero(CompanyCommission)) as CreditCardPaymentInstitutionPaidAmount
        //        From CompanyTransactions t where IDActionType IN(100,110)
        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumCr

        //        cross join(Select sum([dbo].RoundToZero(Commission)) as CompanyCommission, sum([dbo].RoundToZero(NetTotal)) AS TransferDealerPaidAmount

        //        From CompanyTransactions t where IDActionType IN(10,20)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumTr

        //--        cross join(Select sum([dbo].RoundToZero(NetTotal)) as NetTotal From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumNet

        //        cross join(Select sum([dbo].RoundToZero(t.Total + t.CostTotal)) as WithdrawalTotalAmount,
        //        sum([dbo].RoundToZero(t.Total)) as WithdrawalTotalPaidAmount,
        //        sum([dbo].RoundToZero(t.CostTotal)) as WithdrawalTotalTransactionFeeAmount

        //        From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumWt

        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast

        //--        cross join(Select sum([dbo].RoundToZero(cw.CostTotal)) as CostTotal , Count(cw.Amount) as cwCostTotal From CompanyTransactions t
        //--
        //--        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //--        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcess

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 2

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1 ) as sumEx

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 1

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1  ) as sumIncome

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From PaymentTransferPools t

        //        where t.Status = 1 
        //        AND NOT EXISTS (select* from WhereConditions wc
        //        WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //        (wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //        AND t.Amount > 0 


        //		) as sumTrPool

        //        --WHERE(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //        --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)))
        //        --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)))


        //        END

        //GUNCELLENDİ


        //------------------------------------------------------- 23.01.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //INSERT INTO dbo.ActionTypes
        //(IDActionType, ActionType, ActionName, IDParasut)
        //VALUES(N'150', N'Ödeme Havuzu Manuel Eşleştirme', N'Sanal Pos Hizmeti', N'1005650946');

        //GO

        //ALTER Proc[dbo].[Companies_SetBalance]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@UsingBalance decimal (18,2),
        //@IDActionType nvarchar(10)
        //AS
        //BEGIN
        //BEGIN TRY


        //    DECLARE @OldUsingBalance decimal (18,2)
        // DECLARE @NEWID nvarchar(50)


        //    SET @NEWID = NEWID()

        //    SET @OldUsingBalance = (Select UsingBalance FROM Companies WHERE ID=@ID)

        // IF(@OldUsingBalance<@UsingBalance )

        //    BEGIN
        //        INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)


        //        Select @NEWID, GETDATE(), @ID, CASE WHEN @IDActionType IS NULL THEN '120' ELSE '150' END, GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@NEWID,28,5), null,  @UsingBalance - @OldUsingBalance,  0, 0,  
        //  @UsingBalance - @OldUsingBalance, null, 0,0,0
        //  FROM Companies  c
        //        INNER JOIN CompanyIntegrations ci ON ci.ID=@ID
        //        WHERE c.ID=@ID
        //    END

        //    IF(@OldUsingBalance>@UsingBalance )

        //    BEGIN
        //        INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)


        //        Select @NEWID, GETDATE(), @ID, '130', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@NEWID,28,5), null,   @OldUsingBalance - @UsingBalance , 0, 0,  
        //  @OldUsingBalance - @UsingBalance, null, 0,0,0
        //  FROM Companies  c
        //        INNER JOIN CompanyIntegrations ci ON ci.ID=@ID
        //        WHERE c.ID=@ID
        //    END


        //    END TRY

        //        BEGIN CATCH

        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //        RAISERROR(@ERRORMESSAGE,16,1)

        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IDBank nvarchar(10) = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, GetBalance.MatchesBalance, GetBalance.NotMatchesBalance, GetBalance.MatchesCount, GetBalance.NotMatchesCount, 
        //c.Title as Company into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //LEFT JOIN PaymentNotifications py on py.TransactionNr = r.ResponseTransactionNr
        //LEFT JOIN CompanyIntegrations ci ON (ci.ServiceID= py.ServiceID or ci.ServiceID= r.ResponseTransactionNr)
        //LEFT JOIN Companies c ON c.ID=ci.ID
        //cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //WHERE 1=1
        //AND (@IDBank IS NULL  OR r.IDBank= @IDBank)
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR B.Name LIKE '%' + @SearchValue + '%'   ))
        //AND NOT EXISTS(select* from WhereConditions wc

        //    WHERE (wc.ColumnName = 'SenderName' and r.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //    (wc.ColumnName = 'Description' and r.Description LIKE '%' + wc.ConditionName + '%'))
        //and(r.Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLength ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER TRIGGER[dbo].[tggrInsertCompanyTransactions]
        //ON[dbo].[CompanyTransactions]
        //AFTER INSERT
        //AS
        //BEGIN

        //declare @id nvarchar(50);
        //declare @idActionType nvarchar(3);
        //declare @idCompany nvarchar(50);
        //declare @netTotal decimal (18,2);

        //select @id = ID, @idActionType = IDActionType, @idCompany = IDCompany, @netTotal = [dbo].RoundToZero(NetTotal)  from inserted


        //If @idActionType = '10' OR @idActionType = '20'

        //Begin
        //declare @IsNotBocked bit = (select ISNULL(IsNotBocked, 0) from PaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked=1
        //End
        //Else If @idActionType = '100'

        //Begin
        //declare @IsNotBocked2 bit = (select ISNULL(IsNotBocked, 0) from CreditCardPaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked2=1
        //End

        //Else If @idActionType = '140'
        //Begin
        //declare @IsNotBocked3 bit = (select ISNULL(IsNotBocked, 0) from ForeignCreditCardPaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked3=1
        //End

        //Else If @idActionType = '70'

        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End

        //Else If @idActionType='90'
        //Begin
        //UPDATE Companies SET UsingBalance=UsingBalance WHERE ID=@idCompany
        //End

        //Else If(@idActionType= '120' or @idActionType = '150')
        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End
        //Else If @idActionType='130'
        //Begin
        //UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //End


        //Else
        //Begin

        //IF @idActionType<>'30'
        //Begin
        //IF(Select UsingBalance From Companies Where ID= @idCompany)<@netTotal
        //Begin

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiye yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //End
        //Else

        //Begin
        //UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //End

        //End
        //End

        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 02.01.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //------------------------------------------------------- CompanyBankAccounts

        //ALTER TABLE dbo.CompanyBankAccounts
        //ADD IsActiveByDefaultExpenseAccount bit DEFAULT 0 NOT NULL,
        //ShowInSystemSettings bit DEFAULT 0 NOT NULL,
        //IsActiveForIFrame bit DEFAULT 0 NOT NULL,
        //AccountNr nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //OrderNr tinyint NULL,
        //IFrameWarnText nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,

        //GO

        //ALTER Proc[dbo].[CompanyBankAccounts_GetActiveList]
        //@IDCompany nvarchar(50)
        //AS
        //BEGIN
        //    SELECT* FROM CompanyBankAccounts
        //    WHERE IDCompany=@IDCompany AND StatusFlag=1
        // ORDER BY Name
        //END

        //GO

        //ALTER Proc[dbo].[CompanyBankAccounts_GetList]
        //@IDCompany nvarchar(50)
        //AS
        //BEGIN

        //    SELECT cba.*, b.Name AS Bank FROM CompanyBankAccounts cba

        //    INNER JOIN Banks b ON b.ID= cba.IDBank

        //    WHERE cba.IDCompany= @IDCompany

        //    ORDER BY cba.IDBank

        //END

        //GO

        //ALTER Proc[dbo].[CompanyBankAccounts_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT cba.* , b.Name AS Bank FROM CompanyBankAccounts cba

        //    INNER JOIN Banks b ON b.ID= cba.IDBank

        //    WHERE cba.ID= @ID

        //END

        //GO

        //ALTER Proc[dbo].[CompanyBankAccounts_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@Name nvarchar(50),
        //@Title nvarchar(100),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@StatusFlag bit,
        //@Amount decimal (5,2),
        //@CreditCardAmount decimal (5,2),
        //@EftAmount decimal (5,2),
        //@IsExitAccount bit = 0,
        //@AccountNr nvarchar(100),
        //@IFrameWarnText nvarchar(100),
        //@OrderNr tinyint,
        //@IsActiveByDefaultExpenseAccount bit = 0,
        //@ShowInSystemSettings bit,
        //@IsActiveForIFrame bit = 0
        //AS
        //BEGIN

        //    BEGIN TRY

        //    SET @IDOut = NEWID()

        //    INSERT INTO CompanyBankAccounts(ID, CDate, CUser, IDCompany, Name, Title,
        //    IDBank, IBAN, StatusFlag, Amount , CreditCardAmount , EftAmount,
        //    IsExitAccount, AccountNr, IFrameWarnText, OrderNr, ShowInSystemSettings)


        //    VALUES(@IDOut, @CDate, @CUser, @IDCompany, @Name, @Title, @IDBank, @IBAN, @StatusFlag,
        //    @Amount, @CreditCardAmount, @EftAmount, @IsExitAccount, @AccountNr, @IFrameWarnText, @OrderNr , @ShowInSystemSettings)

        //    SELECT @IDOut

        //    END TRY

        //    BEGIN CATCH

        //    DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //    SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //    RAISERROR(@ERRORMESSAGE,16,1)

        //    END CATCH

        //END

        //GO

        //CREATE Proc[dbo].[CompanyBankAccounts_SetIsActiveByDefault]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@IsActiveByDefaultExpenseAccount bit
        //AS
        //BEGIN

        //GO

        //UPDATE CompanyBankAccounts SET IsActiveByDefaultExpenseAccount = @IsActiveByDefaultExpenseAccount WHERE ID = @ID
        //END

        //ALTER Proc[dbo].[CompanyBankAccounts_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@Name nvarchar(50),
        //@Title nvarchar(100),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@StatusFlag bit,
        //@Amount decimal (5,2),
        //@CreditCardAmount decimal (5,2),
        //@EftAmount decimal (5,2),
        //@IsExitAccount bit = 0,
        //@IsActiveByDefaultExpenseAccount bit = 0,
        //@ShowInSystemSettings bit,
        //@IsActiveForIFrame bit,
        //@AccountNr nvarchar(100),
        //@IFrameWarnText nvarchar(100) = null,
        //@OrderNr tinyint
        //AS
        //BEGIN

        //    BEGIN TRY

        //    UPDATE CompanyBankAccounts SET MDate = @MDate, MUser = @MUser, Name = @Name, Title = @Title, IDBank = @IDBank, IBAN = @IBAN, StatusFlag = @StatusFlag,
        //    Amount = @Amount, CreditCardAmount = @CreditCardAmount, EftAmount = @EftAmount, IsExitAccount = @IsExitAccount,
        //    IsActiveForIFrame = @IsActiveForIFrame, ShowInSystemSettings = @ShowInSystemSettings, IsActiveByDefaultExpenseAccount = @IsActiveByDefaultExpenseAccount,
        //    AccountNr = @AccountNr, IFrameWarnText = @IFrameWarnText, OrderNr = @OrderNr

        //    WHERE ID = @ID

        //    SELECT @IDOut = @ID

        //    END TRY

        //    BEGIN CATCH
        //    DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //    SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //    RAISERROR(@ERRORMESSAGE,16,1)

        //    END CATCH

        //END

        //------------------------------------------------------- CompanyBanks

        //ALTER TABLE dbo.CompanyBankAccounts
        //ADD CompanyBankAccountID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL

        //ALTER TABLE dbo.CompanyBanks ADD CONSTRAINT FK_CompanyBanks_Banks FOREIGN KEY(IDBank) REFERENCES dbo.Banks(ID);
        //ALTER TABLE dbo.CompanyBanks ADD CONSTRAINT FK_CompanyBanks_Companies FOREIGN KEY(ID) REFERENCES dbo.Companies(ID);

        //ALTER Proc[dbo].[CompanyBanks_Delete]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@IDBank tinyint,
        //@CompanyBankAccountID nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY

        //        DELETE FROM CompanyBanks WHERE ID=@ID AND IDBank=@IDBank AND CompanyBankAccountID = @CompanyBankAccountID
        //        SELECT @IDOut=@ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyBanks_GetActiveList]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT @ID as ID, cba.IDBank, b.Name as Bank, cba.Title, b.Branch, cba.AccountNr, cba.IBAN, b.Img,
        // cba.IFrameWarnText as IFrameWarnText, cb.CompanyBankAccountID FROM CompanyBanks cb

        //    INNER JOIN CompanyBankAccounts cba ON cba.ID = cb.CompanyBankAccountID
        //    INNER JOIN Banks b ON b.ID = cb.IDBank

        //    ORDER BY b.OrderNr

        //END

        //GO

        //ALTER Proc[dbo].[CompanyBanks_GetList]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT @ID as ID, cba.IDBank, b.Name as Bank, cba.Title, b.Branch, cba.AccountNr, cba.IBAN, b.Img,
        // cba.IFrameWarnText as IFrameWarnText, cba.ID as CompanyBankAccountID FROM CompanyBankAccounts cba

        //    INNER JOIN Banks b ON b.ID = cba.IDBank
        //    where cba.IsActiveForIFrame = 1

        //    ORDER BY b.OrderNr
        //END

        //GO

        //ALTER Proc[dbo].[CompanyBanks_Insert]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDBank nvarchar(2),
        //@CompanyBankAccountID nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY

        //        DELETE FROM CompanyBanks WHERE ID=@ID AND IDBank=@IDBank AND CompanyBankAccountID = @CompanyBankAccountID
        //        INSERT INTO CompanyBanks(ID, IDBank, CDate, CUser, CompanyBankAccountID) VALUES(@ID, @IDBank, @CDate, @CUser, @CompanyBankAccountID)

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END


        //------------------------------------------------------- PaymentNotification

        //ALTER TABLE dbo.PaymentNotifications
        //ADD CompanyBankAccountID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL

        //GO

        //        ALTER Proc[dbo].[PaymentNotifications_Insert]
        //        @IDOut nvarchar(50) output,
        //        @ServiceID nvarchar(4),
        //        @TransactionID nvarchar(50),
        //        @IDMember nvarchar(50),
        //        @Phone nvarchar(15),
        //        @IDBank nvarchar(50),
        //        @ActionDate date,
        //        @ActionTime nvarchar(5),
        //        @Amount decimal (18,2),
        //        @SenderName nvarchar(50),
        //        @SenderIdentityNr nvarchar(11),
        //        @Description nvarchar(500),
        //        @Status tinyint,
        //        @Iban nvarchar(50),
        //        @TransactionKey nvarchar(50),
        //        @CompanyBankAccountID nvarchar(50)
        //        AS
        //        BEGIN
        //            BEGIN TRY


        //                DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //                DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //                IF(Select Count(ID) From PaymentNotifications Where IDMember= @IDMember And Status = 1)>0  AND
        //                (SELECT TOP 1 CDate From PaymentNotifications Where IDMember= @IDMember And Status = 1 ORDER BY CDate DESC) >= DATEADD(MINUTE, -1, GETDATE())

        //                BEGIN
        //                    SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //			        RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //                END
        //                ELSE IF(Select Count(ID) From PaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //		        BEGIN
        //                    SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //			        RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //                END
        //                ELSE

        //                BEGIN
        //                    declare @_isAutoNotification bit = 0;
        //                IF(@IDMember<> '00000000-0000-0000-0000-000000000000')

        //                    BEGIN
        //                        declare @_isAuto bit;
        //                declare @_minAmount decimal (18,2);
        //				        declare @_maxAmount decimal (18,2);
        //				        declare @_quantity smallint;
        //				        select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //				        if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL)
        //				        begin
        //					        if(@Amount>=@_minAmount AND @Amount<=@_maxAmount)
        //					        begin
        //						        if (select Count(pn.ID) from PaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //                                begin

        //                                    set @_isAutoNotification = 1;
        //                end
        //            end

        //                        end
        //                END

        //                    ELSE
        //                BEGIN

        //                        set @_isAutoNotification = 1;
        //                END


        //                SET @IDOut = NEWID()

        //                    INSERT INTO PaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, IDBank,
        //                    ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //                    IsAutoNotification, Iban, TransactionKey, Description, CompanyBankAccountID )


        //                    SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @IDBank, @ActionDate, 
        //			        @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.TransferBlocked, GetDate()), 
        //			        IIF(cc.TransferBlocked= 0,1,0), @_isAutoNotification, @Iban, @TransactionKey, @Description, @CompanyBankAccountID FROM CompanyCommissions cc

        //                    INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //                    WHERE ci.ServiceID= @ServiceID


        //                    SELECT @IDOut


        //                END

        //            END TRY
        //            BEGIN CATCH
        //                DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //                SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //                RAISERROR(@ERRORMESSAGE,16,1)
        //            END CATCH
        //      END



        //------------------------------------------------------- PaymentTransferPools

        //ALTER TABLE dbo.PaymentTransferPools
        //ADD CompanyBankAccountID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL

        //------------------------------------------------------- CompanyWithdrawalRequest

        //ALTER TABLE dbo.CompanyWithdrawalRequests
        //ADD CompanyBankAccountID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL

        //GO

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_GetList]
        //@Status tinyint,
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IsProcess bit = null,
        //@SIDBank nvarchar(10) = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT r.*, c.Title AS Company, c.Phone, b.Name as Bank, a.Name AS Modifier,
        //cba.Name as SBankName
        //into #TempTable FROM CompanyWithdrawalRequests r
        //INNER JOIN Companies c ON c.ID=r.IDCompany
        //INNER JOIN Banks b ON b.ID= r.IDBank
        //LEFT JOIN CompanyBankAccounts cba on cba.ID = r.CompanyBankAccountID

        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //WHERE 1=1
        //AND (@SIDBank IS NULL OR r.SIDBank = @SIDBank)
        //AND(@IsProcess IS NULL OR r.IsProcess = 0)

        //AND((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)

        //AND(@IDCompany IS NULL OR r.IDCompany= @IDCompany)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.Title LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT r.*, c.Title AS Company, c.Phone, b.Name as Bank, a.Name AS Modifier ,
        //    cba.Name as SBankName
        //    FROM CompanyWithdrawalRequests r

        //    INNER JOIN Companies c ON c.ID= r.IDCompany

        //    INNER JOIN Banks b ON b.ID= r.IDBank

        //    LEFT JOIN Administrators a ON a.ID= r.MUser

        //    LEFT JOIN CompanyBankAccounts cba on cba.ID = r.CompanyBankAccountID

        //    WHERE r.ID= @ID

        //END

        //GO

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_GetSingleByRequestNr]
        //@RequestNr nvarchar(50)
        //AS
        //BEGIN

        //    SELECT r.*, c.Title AS Company, c.Phone, b.Name as Bank, a.Name AS Modifier, cba.Name as SBankName FROM CompanyWithdrawalRequests r

        //    INNER JOIN Companies c ON c.ID= r.IDCompany

        //    INNER JOIN Banks b ON b.ID= r.IDBank

        //    LEFT JOIN Administrators a ON a.ID= r.MUser

        //    LEFT JOIN CompanyBankAccounts cba on cba.ID = r.CompanyBankAccountID

        //    WHERE r.RequestNr= @RequestNr

        //END

        //GO

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(50) = null,
        //@IsProcess bit = false,
        //        @CompanyBankAccountID nvarchar(50)
        //AS
        //BEGIN

        //    BEGIN TRY

        //        UPDATE CompanyWithdrawalRequests SET MUser = @MUser, MDate = IIF(@MDate is null, GETDATE(), @MDate), Description = @Description,
        //        Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank, IsProcess = @IsProcess, CompanyBankAccountID = @CompanyBankAccountID WHERE ID = @ID AND Status = 1


        //        IF(@Status= 2)


        //        BEGIN
        //        INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)


        //        SELECT ID, GETDATE(), IDCompany, '30', MDate, TransactionNr, IDBank, Amount, 0, CostTotal, Amount+CostTotal, 0 , 0  FROM CompanyWithdrawalRequests WHERE ID = @ID


        //        END
        //        ELSE IF(@Status= 3)


        //        BEGIN
        //        UPDATE Companies SET UsingBalance+=T.Total
        //        FROM
        //        (SELECT IDCompany, (Amount+CostTotal) AS Total FROM CompanyWithdrawalRequests WHERE ID = @ID)T
        //        WHERE Companies.ID=T.IDCompany
        //    END



        //    SELECT @IDOut = @ID


        //    END TRY

        //    BEGIN CATCH

        //    DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //    SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //    RAISERROR(@ERRORMESSAGE,16,1)

        //    END CATCH
        //END

        //------------------------------------------------------- CompanyRebateRequests

        //ALTER TABLE dbo.CompanyRebateRequests
        //ADD CompanyBankAccountID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL

        //GO

        //ALTER Proc[dbo].[CompanyRebateRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null,
        //@CompanyBankAccountID nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY

        //        UPDATE CompanyRebateRequests SET MUser = @MUser, MDate = @MDate, Description = @Description, Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank, CompanyBankAccountID = @CompanyBankAccountID WHERE ID = @ID AND Status = 1

        //        IF(@Status= 2)

        //        BEGIN
        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //            SELECT cr.ID, GETDATE(), cr.IDCompany, '90', cr.MDate, cr.TransactionNr, cr.IDBank, ct.NetTotal, 0, 0, ct.NetTotal,0,0	    

        //            FROM CompanyRebateRequests cr
        //            LEFT JOIN PaymentNotifications pt ON pt.TransactionID= cr.TransactionID

        //            LEFT JOIN CreditCardPaymentNotifications ccpt ON ccpt.TransactionID= cr.TransactionID

        //            LEFT JOIN ForeignCreditCardPaymentNotifications fccpt ON fccpt.TransactionID= cr.TransactionID

        //            INNER JOIN CompanyTransactions ct ON (ct.TransactionNr= pt.TransactionNr or ct.TransactionNr= ccpt.TransactionNr or ct.TransactionNr= fccpt.TransactionNr) AND ct.IDActionType IN ('10', '20', '100', '90','140')

        //            WHERE cr.ID=@ID
        //        END

        //        ELSE IF(@Status= 3)

        //        BEGIN
        //            UPDATE Companies SET UsingBalance+=(select ct.NetTotal from CompanyRebateRequests cr

        //            left join PaymentNotifications pn on pn.TransactionID=cr.TransactionID
        //            left join CreditCardPaymentNotifications ccpt on ccpt.TransactionID= cr.TransactionID

        //            LEFT JOIN ForeignCreditCardPaymentNotifications fccpt ON fccpt.TransactionID= cr.TransactionID

        //            inner join CompanyTransactions ct on ct.IDActionType IN ('10', '20', '100','140') and(ct.TransactionNr= pn.TransactionNr or ct.TransactionNr= ccpt.TransactionNr or ct.TransactionNr= fccpt.TransactionNr)

        //            where cr.ID=@ID)

        //        END

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //Güncellendi

        //------------------------------------------------------- 07.02.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //ALTER Proc[dbo].[CompanyBankAccounts_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@Name nvarchar(50),
        //@Title nvarchar(100),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@StatusFlag bit,
        //@Amount decimal (5,2),
        //@CreditCardAmount decimal (5,2),
        //@EftAmount decimal (5,2),
        //@IsExitAccount bit = 0,
        //@AccountNr nvarchar(100),
        //@IFrameWarnText nvarchar(100) = null,
        //@OrderNr tinyint,
        //@IsActiveByDefaultExpenseAccount bit = 0,
        //@ShowInSystemSettings bit,
        //@IsActiveForIFrame bit = 0
        //AS
        //BEGIN

        //    BEGIN TRY


        //    SET @IDOut = NEWID()

        //    INSERT INTO CompanyBankAccounts(ID, CDate, CUser, IDCompany, Name, Title,
        //    IDBank, IBAN, StatusFlag, Amount , CreditCardAmount , EftAmount,
        //    IsExitAccount, AccountNr, IFrameWarnText, OrderNr, ShowInSystemSettings)


        //    VALUES(@IDOut, @CDate, @CUser, @IDCompany, @Name, @Title, @IDBank, @IBAN, @StatusFlag,
        //    @Amount, @CreditCardAmount, @EftAmount, @IsExitAccount, @AccountNr, @IFrameWarnText, @OrderNr , @ShowInSystemSettings)

        //    SELECT @IDOut


        //    END TRY

        //    BEGIN CATCH

        //    DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //    SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //    RAISERROR(@ERRORMESSAGE,16,1)

        //    END CATCH
        //END

        //GO

        //        ALTER Proc[dbo].[CompanyTransactions_GetAccountReportv2]
        //        @IDCompany nvarchar(50),
        //        @StartDate datetime,
        //        @EndDate datetime
        //        AS
        //        BEGIN

        //        SELECT top 100 
        //        isnull(sumT.TransferTotalAmount,0) as TransferTotalAmount ,
        //        isnull(sumTr.CompanyCommission,0) as TransferCommissionProfitAmount,
        //        isnull(sumTr.TransferDealerPaidAmount,0) as TransferDealerPaidAmount,
        //        isnull(sumTrPool.Amount,0) as TransferNotMatchedAmount,

        //        isnull(sumT.CreditCardTotalAmount,0) as CreditCardTotalAmount,
        //        isnull(sumCr.CompanyCommission,0) as CreditCardCommissionProfitAmount,
        //        isnull(sumCr.CreditCardDealerPaidAmount,0) as CreditCardDealerPaidAmount,
        //        isnull(sumCr.CreditCardPaymentInstitutionPaidAmount,0) as CreditCardPaymentInstitutionPaidAmount,              

        //        isnull(sumWt.WithdrawalTotalAmount,0) as WithdrawalTotalAmount, 
        //        isnull(sumWt.WithdrawalTotalPaidAmount,0) as WithdrawalTotalPaidAmount, 
        //        isnull(sumWt.WithdrawalTotalTransactionFeeAmount,0) as WithdrawalTotalTransactionFeeAmount, 
        //        isnull(sumEft.Amount,0) as WithdrawalEftAmount, 
        //        isnull(sumFast.Amount,0) as WithdrawalFastAmount, 

        //       	isnull(sumRebate.Amount,0) as RebateExpenseProfitAmount, 
        //        isnull(sumEx.Amount,0) as TotalExpenseAmount,
        //        isnull(sumIncome.Amount,0) as TotalIncomeAmount

        //        FROM CompanyTransactions t

        //        cross join(Select SUM(CASE WHEN t.IDActionType IN (10, 20) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS TransferTotalAmount,
        //        SUM(CASE WHEN t.IDActionType IN(100, 110) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS CreditCardTotalAmount From CompanyTransactions

        //        t where IDActionType IN(10,20,100,110)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //        cross join(Select sum([dbo].RoundToZero(Commission)) as Commission From CompanyTransactions t where IDActionType IN(10,20,100,110)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumC

        //        cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as CompanyCommission, 
        //        sum([dbo].RoundToZero(NetTotal)) as CreditCardDealerPaidAmount, 
        //        sum([dbo].RoundToZero(CompanyCommission)) as CreditCardPaymentInstitutionPaidAmount
        //        From CompanyTransactions t where IDActionType IN(100,110)
        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumCr

        //        cross join(Select sum([dbo].RoundToZero(Commission)) as CompanyCommission, sum([dbo].RoundToZero(NetTotal)) AS TransferDealerPaidAmount

        //        From CompanyTransactions t where IDActionType IN(10,20)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumTr

        //--        cross join(Select sum([dbo].RoundToZero(NetTotal)) as NetTotal From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumNet

        //        cross join(Select sum([dbo].RoundToZero(t.Total + t.CostTotal)) as WithdrawalTotalAmount,
        //        sum([dbo].RoundToZero(t.Total)) as WithdrawalTotalPaidAmount,
        //        sum([dbo].RoundToZero(t.CostTotal)) as WithdrawalTotalTransactionFeeAmount

        //        From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumWt

        //        cross join(select sum(ROUND(((ct.Total / 100) * ct.CompanyCommissionRate ),4)) as Amount
        //        From CompanyRebateRequests r
        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID

        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID

        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)

        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID

        //           where r.Status = 2
        //        and (@IDCompany IS NULL OR ct.IDCompany= @IDCompany)
        //        and(CAST(ct2.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(ct2.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumRebate

        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast

        //--        cross join(Select sum([dbo].RoundToZero(cw.CostTotal)) as CostTotal , Count(cw.Amount) as cwCostTotal From CompanyTransactions t
        //--
        //--        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //--        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcess

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 2

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1 ) as sumEx

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 1

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1  ) as sumIncome

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From PaymentTransferPools t

        //        where t.Status = 1 
        //        AND NOT EXISTS (select* from WhereConditions wc
        //        WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //        (wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //        AND t.Amount > 0 


        //		) as sumTrPool

        //        --WHERE(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //        --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)))
        //        --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)))


        //        END


        //GO

        // ALTER TABLE dbo.AccountSummaries ADD
        // RebateExpenseProfitAmount decimal (18, 2) NULL

        //GO

        //ALTER Proc[dbo].[AccountSummaries_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@Profit decimal (18,2),
        //@ExpenseAmount decimal (18,2),
        //@Difference decimal (18,2),
        //@PaymentNotificationProfit decimal (18,2),
        //@CreditCardPaymentNotificationProfit decimal (18,2),
        //@WithdrawalRequestProfit decimal (18,2),
        //@DealerTotalBalance decimal (18,2),
        //@UnmatchedPaymentNotificationBalance decimal (18,2),
        //@NetAmount decimal (18,2),
        //@IncomeAmount decimal (18,2),
        //@IsMonthly bit = null,
        //@RebateExpenseProfitAmount decimal (18,2)
        //AS
        //BEGIN

        //BEGIN TRY


        //SET @IDOut = NEWID()

        //INSERT INTO AccountSummaries(ID, CUser, CDate, Profit, ExpenseAmount, Difference,
        //PaymentNotificationProfit, CreditCardPaymentNotificationProfit,
        //WithdrawalRequestProfit, DealerTotalBalance, UnmatchedPaymentNotificationBalance, NetAmount, IncomeAmount, IsMonthly, RebateExpenseProfitAmount)

        //VALUES(@IDOut, @CUser, @CDate, @Profit, @ExpenseAmount, @Difference,
        //@PaymentNotificationProfit, @CreditCardPaymentNotificationProfit,
        //@WithdrawalRequestProfit, @DealerTotalBalance, @UnmatchedPaymentNotificationBalance, @NetAmount, @IncomeAmount, @IsMonthly, @RebateExpenseProfitAmount)

        //SELECT @IDOut
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //Güncellendi

        //------------------------------------------------------- 12.02.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.AccountSummaries
        //ADD Month int,
        //Year int

        //GO

        //ALTER Proc[dbo].[AccountSummaries_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@Profit decimal (18,2),
        //@ExpenseAmount decimal (18,2),
        //@Difference decimal (18,2),
        //@PaymentNotificationProfit decimal (18,2),
        //@CreditCardPaymentNotificationProfit decimal (18,2),
        //@WithdrawalRequestProfit decimal (18,2),
        //@DealerTotalBalance decimal (18,2),
        //@UnmatchedPaymentNotificationBalance decimal (18,2),
        //@NetAmount decimal (18,2),
        //@IncomeAmount decimal (18,2),
        //@IsMonthly bit = null,
        //@RebateExpenseProfitAmount decimal (18,2),
        //@Month int = null,
        //@Year int = null
        //AS
        //BEGIN

        //BEGIN TRY


        //SET @IDOut = NEWID()

        //INSERT INTO AccountSummaries(ID, CUser, CDate, Profit, ExpenseAmount, Difference,
        //PaymentNotificationProfit, CreditCardPaymentNotificationProfit,
        //WithdrawalRequestProfit, DealerTotalBalance, UnmatchedPaymentNotificationBalance, NetAmount, IncomeAmount, IsMonthly, RebateExpenseProfitAmount, Month, Year)

        //VALUES(@IDOut, @CUser, @CDate, @Profit, @ExpenseAmount, @Difference,
        //@PaymentNotificationProfit, @CreditCardPaymentNotificationProfit,
        //@WithdrawalRequestProfit, @DealerTotalBalance, @UnmatchedPaymentNotificationBalance, @NetAmount, @IncomeAmount, @IsMonthly, @RebateExpenseProfitAmount, @Month, @Year)

        //SELECT @IDOut
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[AccountSummaries_GetList]
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IsMonthly bit = null,
        //@Month int = null,
        //@Year int = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT acs.*, ad.Name as Creator into #TempTable FROM AccountSummaries acs
        //LEFT JOIN Administrators ad on acs.CUser =  ad.ID
        //WHERE (@IsMonthly IS NULL OR IsMonthly = @IsMonthly)
        //AND(@Month IS NULL OR Month = @Month)
        //AND(@Year IS NULL OR Year = @Year)
        //AND(@SearchValue IS NULL OR  (ad.Name LIKE '%' + @SearchValue + '%' OR acs.ReportNo LIKE '%' + @SearchValue + '%'  OR acs.NetAmount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY ReportNo DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable

        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetMonthlyAccountSummary]
        //@DailyReportStartDateTime datetime,
        //@DailyReportEndDateTime datetime,
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime,
        //@WeeklyReportStartDateTime datetime,
        //@WeeklyReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //    SELECT
        //        ccpn.CreditCardPaymentMethodID AS CreditCardPaymentMethodID,
        //        [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //        SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //    WHERE t.IDActionType IN(100, 110)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ccpn.CreditCardPaymentMethodID
        //),

        //PaymentTransferPoolCTE AS(
        //    SELECT
        //        t.IDBank AS PaymentTranferPoolBankID,
        //        [dbo].RoundToZero(SUM(t.Amount)) AS PaymentTranferPoolSumTotal,
        //        [dbo].RoundToZero(SUM(ct.Commission)) AS PaymentNotificationProfitAmount
        //    FROM PaymentTransferPools t
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionNr = t.ResponseTransactionNr
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = pn.ID
        //    WHERE t.Status = 2
        //        AND ct.TransactionDate >= @ReportStartDateTime
        //        AND ct.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDBank
        //),

        //WithdrawalRequestCTE AS(
        //    SELECT
        //        cwr.SIDBank AS WithdrawalRequestSIDBank,
        //        [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //        SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit
        //    FROM CompanyTransactions t
        //    LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //    WHERE t.IDActionType = '30'
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY cwr.SIDBank
        //),

        //PaymentNotificationCTE AS(
        //    SELECT
        //        ptp.IDBank AS PaymentNotificationSIDBank,
        //        [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationTotalAmount
        //    FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //    LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //    WHERE t.IDActionType IN(10, 20)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ptp.IDBank
        //),

        //DateRangeQueryCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @DailyReportStartDateTime
        //        AND TransactionDate <= @DailyReportEndDateTime THEN Total ELSE 0 END)) AS DailyTotalPaymentAmount,

        //        [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @WeeklyReportStartDateTime
        //        AND TransactionDate <= @WeeklyReportEndDateTime THEN Total ELSE 0 END)) AS WeeklyTotalPaymentAmount,

        //        [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @ReportStartDateTime
        //        AND TransactionDate <= @ReportEndDateTime THEN Total ELSE 0 END)) AS MonthlyTotalPaymentAmount

        //    FROM CompanyTransactions

        //    WHERE IDActionType IN(10, 20, 100, 110)
        //),

        //CompanyTransactionCTE AS(
        //    SELECT
        //        t.IDCompany AS IDCompany,
        //        [dbo].RoundToZero(SUM(t.Total)) AS CompanyTransactionTotalAmount,
        //        [dbo].RoundToZero(SUM(t.Commission - t.CompanyCommission) + SUM(t.CostTotal)) AS CompanyTransactionProfit
        //    FROM CompanyTransactions t
        //    INNER JOIN Companies c on c.ID = t.IDCompany
        //    WHERE t.IDActionType IN(10, 20, 30, 100, 110)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDCompany
        //),

        //RebateRequestCTE AS(
        //    SELECT
        //    sum(ROUND((ct.CompanyCommission ),4)) as RebateNetAmount
        //    From CompanyRebateRequests r
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //    LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //    LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)
        //    LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //    WHERE ct2.IDActionType IN (90)
        //        AND ct2.TransactionDate >= @ReportStartDateTime
        //        AND ct2.TransactionDate <= @ReportEndDateTime
        //)

        //SELECT
        //    CreditCardCTE.CreditCardPaymentMethodID,
        //    CreditCardCTE.CreditCardSumTotal,
        //    CreditCardCTE.CreditCardProfit,
        //    PaymentTransferPoolCTE.PaymentTranferPoolBankID,
        //    PaymentTransferPoolCTE.PaymentTranferPoolSumTotal,
        //    WithdrawalRequestCTE.WithdrawalRequestSIDBank,
        //    WithdrawalRequestCTE.WithdrawalRequestTotalAmount,
        //    WithdrawalRequestCTE.WithdrawalRequestProfit,
        //    PaymentNotificationCTE.PaymentNotificationSIDBank,
        //    PaymentNotificationCTE.PaymentNotificationTotalAmount,
        //    DateRangeQueryCTE.DailyTotalPaymentAmount,
        //    DateRangeQueryCTE.WeeklyTotalPaymentAmount,
        //    DateRangeQueryCTE.MonthlyTotalPaymentAmount,
        //    CompanyTransactionCTE.IDCompany,
        //    CompanyTransactionCTE.CompanyTransactionTotalAmount,
        //    CompanyTransactionCTE.CompanyTransactionProfit,
        //    RebateRequestCTE.RebateNetAmount
        //FROM CreditCardCTE
        //FULL JOIN PaymentTransferPoolCTE ON 1 = 0
        //FULL JOIN WithdrawalRequestCTE ON 1 = 0
        //FULL JOIN PaymentNotificationCTE ON 1 = 0
        //FULL JOIN DateRangeQueryCTE ON 1 = 0
        //FULL JOIN CompanyTransactionCTE ON 1 = 0
        //FULL JOIN RebateRequestCTE ON 1 = 0;
        //END

        //Güncellendi

        //------------------------------------------------------- 15.02.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //   CREATE dbo.CompanyAutoNotificationSettings(
        //   IDCompany nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   ReferenceId nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   IsActive bit NOT NULL,
        //RequestUrl nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   CallbackUrl nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //CONSTRAINT PK_PaymentNotificationReferanceNrModuleSettings PRIMARY KEY(IDCompany)
        //   );

        //GO

        //INSERT INTO dbo.CompanyAutoNotificationSettings
        //(IDCompany, ReferenceId, IsActive, RequestUrl, CallbackUrl)
        //VALUES(N'1312E00F-E83E-45B4-85C6-892396D4377D', N'2222', 1, N'https://vatangame.com/dev/checkUserReferansNumber', N'https://www.vatangame.com/dev/stilPayCallbackAuto');

        //GO

        //ALTER TABLE dbo.PaymentTransferPools
        //ADD ResponseTransactionId nvarchar,
        //IsHaveReferenceNr bit DEFAULT 0 NULL

        //GO

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate date,
        //@EndDate date,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IDBank nvarchar(10) = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, r.IsHaveReferenceNr, crl.ResponseStatus as ResponseStatus, GetBalance.MatchesBalance, GetBalance.NotMatchesBalance, GetBalance.MatchesCount, GetBalance.NotMatchesCount, 
        //c.Title as Company into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //LEFT JOIN PaymentNotifications py on py.TransactionNr = r.ResponseTransactionNr
        //LEFT JOIN CompanyIntegrations ci ON (ci.ServiceID= py.ServiceID or ci.ServiceID= r.ResponseTransactionNr)
        //LEFT JOIN CallbackResponseLogs crl on crl.TransactionID = py.TransactionID
        //LEFT JOIN Companies c ON c.ID= ci.ID
        //cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //WHERE 1=1
        //AND (@IDBank IS NULL  OR r.IDBank= @IDBank)
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR B.Name LIKE '%' + @SearchValue + '%'   ))
        //AND NOT EXISTS(select* from WhereConditions wc

        //    WHERE (wc.ColumnName = 'SenderName' and r.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //    (wc.ColumnName = 'Description' and r.Description LIKE '%' + wc.ConditionName + '%'))
        //and(r.Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLength ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //CREATE FUNCTION[dbo].[Fn_PaymentCreditCardPools_GetListBalance]
        //(
        //@StartDate datetime = null,
        //@EndDate datetime = null,
        //@PaymentMethodID int = null
        //)
        //RETURNS TABLE
        //AS
        //RETURN

        //SELECT sum([dbo].RoundToZero(ct.Total - ct.CompanyCommission)) as SPNetAmount, 
        //case when r.PaymentMethodID = 6 then sum([dbo].RoundToZero((r.Amount) ) - [dbo].RoundToZero((r.Amount / 100) * r.Commission)) else
        //sum([dbo].RoundToZero(r.Amount - r.Commission)) end  as PaymentInstitutionNetAmount,
        //sum([dbo].RoundToZero(r.Amount)) as PaymentInstitutionTotalAmount
        //FROM PaymentCreditCardPools r
        //LEFT JOIN CreditCardPaymentNotifications cc on(cc.TransactionReferenceCode = r.TransactionKey or cc.TransactionID = r.TransactionKey)
        //LEFT JOIN CompanyTransactions ct on ct.ID = cc.ID
        //WHERE 1=1
        //AND r.Status= 2
        //AND(@PaymentMethodID IS NULL OR r.PaymentMethodID = @PaymentMethodID)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS datetime)<CAST(@EndDate AS datetime))
        //GROUP BY PaymentMethodID

        //GO

        //ALTER Proc[dbo].[PaymentCreditCardPools_GetList]
        //@Status tinyint = null,
        //@PaymentMethodID int = null,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT r.ID, r.CDate, r.MDate, r.TransactionDate,CASE WHEN ISNUMERIC(r.BankName) = 1 THEN pibi.Name ELSE r.BankName
        //END as BankName, ISNULL(cc.SenderName, r.SenderName) as SenderName , r.TransactionType, r.TransactionKey, ISNULL(cc.CardNumber, null) as CardNumber,
        //r.Commission, r.Amount, r.Status, r.InstallmentCount, r.PaymentMethodID, r.PaymentMethodName, r.Description,
        //cc.Status as SPStatus, JSON_VALUE(cl.Callback, '$.status_code') as SPDiscardedCallbackStatus, 
        //cl2.ResponseStatus as CBResponseStatus, cc.CardTypeId as CardTypeId, GetBalance.SPNetAmount, 
        //GetBalance.PaymentInstitutionNetAmount, GetBalance.PaymentInstitutionTotalAmount
        //into #TempTable  FROM PaymentCreditCardPools r
        //LEFT JOIN CreditCardPaymentNotifications cc on(cc.TransactionReferenceCode = r.TransactionKey or cc.TransactionID = r.TransactionKey)
        //LEFT JOIN CallbackResponseLogs cl on cl.TransactionID = r.TransactionID and cl.ServiceType = 'STILPAY'
        //LEFT JOIN CallbackResponseLogs cl2 on cl2.TransactionID = r.TransactionID and cl2.ServiceType = 'STILPAY AUTOCALLBACK'
        //LEFT JOIN PaymentInstitutionBankIds pibi on pibi.PaymentInstitutionID = r.PaymentMethodID and r.BankName = pibi.ID
        //--and cl2.CDate = (SELECT MAX(cl3.CDate) FROM CallbackResponseLogs cl3 WHERE cl3.TransactionID = r.TransactionID AND cl3.ServiceType = 'STILPAY AUTOCALLBACK')
        //cross join dbo.Fn_PaymentCreditCardPools_GetListBalance(@StartDate, @EndDate, @PaymentMethodID) as GetBalance

        //WHERE 1=1
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@PaymentMethodID IS NULL OR r.PaymentMethodID = @PaymentMethodID)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.TransactionType LIKE '%' + @SearchValue + '%'  OR
        //r.Amount LIKE '%' + @SearchValue + '%' OR cc.CardNumber LIKE '%' + @SearchValue + '%'))
        //and(r.Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 21.02.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate datetime,
        //@EndDate datetime,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IDBank nvarchar(10) = null,
        //@IsHaveReferenceNr bit = null,
        //@ResponseStatus int = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, r.IsHaveReferenceNr, crl.ResponseStatus as ResponseStatus, GetBalance.MatchesBalance, GetBalance.NotMatchesBalance, GetBalance.MatchesCount, GetBalance.NotMatchesCount, 
        //c.Title as Company into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //LEFT JOIN PaymentNotifications py on py.TransactionNr = r.ResponseTransactionNr
        //LEFT JOIN CompanyIntegrations ci ON (ci.ServiceID= py.ServiceID or ci.ServiceID= r.ResponseTransactionNr)
        //LEFT JOIN(
        //    SELECT TransactionID, MAX(CDate) AS MaxCDate
        //    FROM CallbackResponseLogs
        //    GROUP BY TransactionID
        //) MaxCDateSubquery ON MaxCDateSubquery.TransactionID = py.TransactionID
        //LEFT JOIN CallbackResponseLogs crl ON crl.TransactionID = MaxCDateSubquery.TransactionID AND crl.CDate = MaxCDateSubquery.MaxCDate
        //LEFT JOIN Companies c ON c.ID=ci.ID
        //cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //WHERE 1=1
        //AND(@IDBank IS NULL OR r.IDBank= @IDBank)
        //AND(@ResponseStatus IS NULL OR crl.ResponseStatus= @ResponseStatus)
        //AND(@IsHaveReferenceNr IS NULL OR r.IsHaveReferenceNr= @IsHaveReferenceNr)
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  
        //OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' 
        //OR B.Name LIKE '%' + @SearchValue + '%' OR r.Description LIKE '%' + @SearchValue + '%'   ))
        //AND NOT EXISTS(select* from WhereConditions wc

        //    WHERE (wc.ColumnName = 'SenderName' and r.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //    (wc.ColumnName = 'Description' and r.Description LIKE '%' + wc.ConditionName + '%'))
        //and(r.Amount > 0  )
        //and(r.Amount< 100000  )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLength ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 29.02.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //ALTER TABLE dbo.Companies
        //ADD  AutoTransferLimit decimal (18,2) DEFAULT 0 NOT NULL,
        //AutoCreditCardLimit decimal (18,2) DEFAULT 0 NOT NULL

        //GO

        //ALTER Proc[dbo].[CompanyApplications_SetAplicationStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@Status bit
        //AS
        //BEGIN
        //BEGIN TRY

        //IF(@Status= 1)

        //BEGIN
        //DECLARE @idCompany nvarchar(50)= NEWID();
        //DECLARE @AutoWithdrawalLimit nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'auto_withdrawal_limit');
        //DECLARE @NegativeBalanceLimit nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'negative_balance_limit');

        //DECLARE @TransferBeUsed int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'transfer_be_used');
        //DECLARE @CreditCardBeUsed int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'credit_card_be_used');
        //DECLARE @ForeignCreditCardBeUsed int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'foreign_credit_card_be_used');

        //DECLARE @TransferRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'transfer_rate');
        //DECLARE @CreditCardRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'credit_card_rate');
        //DECLARE @ForeignCreditCardRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'foreign_credit_card_rate');

        //DECLARE @TransferBlocked int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'transfer_blocked');
        //DECLARE @CreditCardBlocked int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'credit_card_blocked');
        //DECLARE @ForeignCreditCardBlocked int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'foreign_credit_card_blocked');

        //DECLARE @WithdrawalTransferAmount nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'withdrawal_transfer_amount');
        //DECLARE @WithdrawalEftAmount nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'withdrawal_eft_amount');

        //INSERT INTO Companies(ID, CUser, CDate, Phone, UsingBalance, Title, Name, Email, TaxNr, TaxOffice, MonthlyGiro, Address, IdentityFrontSide,
        //IdentityBackSide, TaxPlate, SignatureCirculars, TradeRegistryGazette, Agreement, StatusFlag, NegativeBalanceLimit, AutoWithdrawalLimit, AutoTransferLimit, AutoCreditCardLimit)

        //SELECT @idCompany, @CUser, @CDate, Phone, 0, Title, Name, Email, TaxNr, TaxOffice, MonthlyGiro, Address, IdentityFrontSide, IdentityBackSide,
        //TaxPlate, SignatureCirculars, TradeRegistryGazette, Agreement, 1, CAST(@NegativeBalanceLimit AS DECIMAL(10, 2)), CAST(@AutoWithdrawalLimit AS DECIMAL(10, 2)), 0,0  FROM CompanyApplications WHERE ID = @ID


        //INSERT INTO CompanyIntegrations(ID, CUser, CDate, ServiceID, SecretKey, TransferBeUsed, CreditCardBeUsed , CreditCardPaymentWithParam,
        //CreditCardPaymentWithPayNKolay, ForeignCreditCardBeUsed, ForeignCreditCardPaymentWithPayNKolay)

        //VALUES(@idCompany, @CUser, @CDate, dbo.GenerateServiceId(), dbo.GenerateSecretKey(), @TransferBeUsed , @CreditCardBeUsed , 0, 1, @ForeignCreditCardBeUsed,0)


        //DECLARE @idUser nvarchar(50)= NEWID()

        //INSERT INTO CompanyUsers(ID, CUser, CDate, IDCompany, Phone, Name, Email, Password, IsMainUser, StatusFlag) SELECT @idUser, @CUser, @CDate, @idCompany, Phone, Name, Email, Password, 1, 1 FROM CompanyApplications WHERE ID = @ID


        //INSERT INTO CompanyUserRoles(IDCompanyUser, RoleKey, Authorized) SELECT @idUser, RoleKey, 1 FROM Roles WHERE RoleType = 2 Order By OrderNr

        //--INSERT INTO CompanyBanks(ID, CUser, CDate, IDBank) SELECT @idCompany, @CUser, @CDate, ID FROM Banks WHERE StatusFlag = 1 Order By OrderNr

        //INSERT INTO CompanyCommissions(ID, CUser, CDate, CreditCardRate, CreditCardStatus, CreditCardBlocked, TransferRate, TransferStatus, TransferBlocked,
        //MobilePayRate, MobilePayStatus, MobilePayBlocked, WithdrawalTransferAmount, WithdrawalEftAmount, ForeignCreditCardRate, ForeignCreditCardBlocked )

        //VALUES(@idCompany, @CUser, @CDate, CAST(@CreditCardRate AS DECIMAL(10, 2)), 1, @CreditCardBlocked, CAST(@TransferRate AS DECIMAL(10, 2)), 1, @TransferBlocked, 60, 1, 1,
        //CAST(@WithdrawalTransferAmount AS DECIMAL(10, 2)),CAST(@WithdrawalEftAmount AS DECIMAL(10, 2)),CAST(@ForeignCreditCardRate AS DECIMAL(10, 2)),@ForeignCreditCardBlocked)

        //DELETE CompanyApplications WHERE ID = @ID

        //END

        //DELETE CompanyApplications WHERE ID=@ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[Companies_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Title nvarchar(100),
        //@Name nvarchar(50),
        //@Phone nvarchar(11),
        //@Email nvarchar(50),
        //@TaxNr nvarchar(11),
        //@TaxOffice nvarchar(50),
        //@Address nvarchar(100),
        //@MonthlyGiro nvarchar(25),
        //@IDParasut nvarchar(50),
        //@AutoWithdrawalLimit decimal = null,
        //@NegativeBalanceLimit decimal = null,
        //@AutoTransferLimit decimal = null,
        //@AutoCreditCardLimit decimal = null
        //AS
        //BEGIN
        //    BEGIN TRY

        //        DECLARE @IDCU nvarchar(50)

        //        SET @IDCU = (SELECT top 1 CompanyUsers.ID FROM Companies join CompanyUsers on IDCompany=Companies.ID AND Companies.Phone=CompanyUsers.Phone WHERE IDCompany=@ID AND IsMainUser=1)

        //  UPDATE Companies SET MUser = @MUser, MDate = @MDate, Name = @Name, Title = @Title, Phone = @Phone, Email = @Email, TaxNr = @TaxNr, TaxOffice = @TaxOffice, Address = @Address, MonthlyGiro = @MonthlyGiro, IDParasut = @IDParasut

        //        WHERE ID = @ID

        //        UPDATE CompanyUsers SET Phone = @Phone WHERE IDCompany = @ID AND IsMainUser = 1 AND ID = @IDCU

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@ParamCommission decimal (18,2),
        //@PayNKolayCommission decimal (18,2),
        //@CardNumber nvarchar(30),
        //@TransactionReferenceCode nvarchar(30),
        //@CreditCardPaymentMethodID tinyint,
        //@CardTypeId int,
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--		IF(Select Count(ID) From CreditCardPaymentNotifications Where IDMember= @IDMember And Status = 1)>0  
        //--		BEGIN
        //--			SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //--			RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--		END
        //IF(Select Count(ID) From CreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //declare @_isAutoNotification bit = 0;
        //        declare @_isAuto bit;
        //declare @_minAmount decimal (18,2);
        //declare @_maxAmount decimal (18,2);
        //declare @_quantity smallint;

        //declare @companyCreditCardLimit decimal (18,2);

        //SELECT @companyCreditCardLimit = c.AutoCreditCardLimit
        //FROM Companies c
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID = @ServiceID
        //WHERE c.ID = ci.ID;

        //select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL)
        //begin
        //if(@Amount>=@_minAmount AND @Amount<=@_maxAmount AND @Amount <= @companyCreditCardLimit)
        //begin
        //if (select Count(pn.ID) from CreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //begin

        //    set @_isAutoNotification = 1;
        //        end
        //        end

        //end

        //SET @IDOut = NEWID()

        //INSERT INTO CreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //IsAutoNotification, Description, ParamCommission, PayNKolayCommission, CardNumber, TransactionReferenceCode, CreditCardPaymentMethodID, CardTypeId)

        //SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.CreditCardBlocked, GetDate()), 
        //IIF(cc.CreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @ParamCommission, @PayNKolayCommission, @CardNumber, @TransactionReferenceCode, @CreditCardPaymentMethodID, @CardTypeId FROM CompanyCommissions cc

        //INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //WHERE ci.ServiceID= @ServiceID


        //SELECT @IDOut


        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //      ALTER Proc[dbo].[PaymentNotifications_Insert]
        //      @IDOut nvarchar(50) output,
        //      @ServiceID nvarchar(4),
        //      @TransactionID nvarchar(50),
        //      @IDMember nvarchar(50),
        //      @Phone nvarchar(15),
        //      @IDBank nvarchar(50),
        //      @ActionDate date,
        //      @ActionTime nvarchar(5),
        //      @Amount decimal (18,2),
        //      @SenderName nvarchar(50),
        //      @SenderIdentityNr nvarchar(11),
        //      @Description nvarchar(500),
        //      @Status tinyint,
        //      @Iban nvarchar(50),
        //      @TransactionKey nvarchar(50),
        //      @CompanyBankAccountID nvarchar(50)
        //      AS
        //      BEGIN
        //          BEGIN TRY

        //      DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //      DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //      IF(Select Count(ID) From PaymentNotifications Where IDMember= @IDMember And Status = 1)>0  AND
        //      (SELECT TOP 1 CDate From PaymentNotifications Where IDMember= @IDMember And Status = 1 ORDER BY CDate DESC) >= DATEADD(MINUTE, -1, GETDATE())

        //      BEGIN
        //          SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //	RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //      END
        //      ELSE IF(Select Count(ID) From PaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //          SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //	RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //      END
        //      ELSE

        //      BEGIN
        //          IF(@IDMember<> '00000000-0000-0000-0000-000000000000')

        //          BEGIN
        //              declare @_isAuto bit;
        //      declare @_minAmount decimal (18,2);
        //		declare @_maxAmount decimal (18,2);
        //		declare @_quantity smallint;
        //		declare @_isAutoNotification bit=0;
        //		declare @companyTranferLimit decimal (18,2);

        //		SELECT @companyTranferLimit = c.AutoTransferLimit

        //              FROM Companies c
        //              INNER JOIN CompanyIntegrations ci ON ci.ServiceID = @ServiceID
        //              WHERE c.ID = ci.ID;

        //		select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //		if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL)
        //		begin
        //			if(@Amount>=@_minAmount AND @Amount<=@_maxAmount AND @Amount <= @companyTranferLimit)
        //			begin
        //				if (select Count(pn.ID) from PaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //                      begin

        //                          set @_isAutoNotification = 1;
        //              end
        //          end

        //                      end
        //                  END

        //                  ELSE
        //                  BEGIN

        //                      set @_isAutoNotification = 1;
        //              END


        //              SET @IDOut = NEWID()

        //                  INSERT INTO PaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, IDBank,
        //                  ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //                  IsAutoNotification, Iban, TransactionKey, Description, CompanyBankAccountID )


        //                  SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @IDBank, @ActionDate, 
        //	        @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.TransferBlocked, GetDate()), 
        //	        IIF(cc.TransferBlocked= 0,1,0), @_isAutoNotification, @Iban, @TransactionKey, @Description, @CompanyBankAccountID FROM CompanyCommissions cc

        //                  INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //                  WHERE ci.ServiceID= @ServiceID


        //                  SELECT @IDOut


        //              END

        //          END TRY
        //          BEGIN CATCH
        //              DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //              SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //              RAISERROR(@ERRORMESSAGE,16,1)
        //          END CATCH
        //      END

        //GO

        //ALTER Proc[dbo].[CompanyAutoNotificationSettings_GetSingle]
        //@ReferenceId nvarchar(10)
        //AS
        //BEGIN

        //    SELECT*, ci.ServiceID as ServiceID, c.AutoTransferLimit as AutoTransferLimit FROM CompanyAutoNotificationSettings
        //    Inner Join CompanyIntegrations ci on ci.ID = IDCompany
        //    Inner Join Companies c on c.ID = IDCompany
        //    WHERE ReferenceId=@ReferenceId and IsActive = 1
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 06.03.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.CompanyCommissions
        //ADD ToslaRate decimal (18,2) DEFAULT 0 NOT NULL

        //GO

        //ALTER TRIGGER[dbo].[tggrUpdateCreditCardPaymentNotifications]
        //ON[dbo].[CreditCardPaymentNotifications]
        //AFTER UPDATE
        //AS
        //BEGIN

        //    declare @id nvarchar(50);
        //        declare @Status tinyint;
        // select @id = ID, @Status = Status from inserted
        // --DECLARE @PayNKolayCreditCardRate  nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamType = 'PayNKolayCreditCard' AND s.ParamDef = 'credit_card_commission_rate');
        //    --DECLARE @PaybullCreditCardRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamType = 'Paybull' AND s.ParamDef = 'credit_card_commission_rate');

        //        IF(@Status= 2)

        //    BEGIN
        //        DELETE FROM CompanyTransactions WHERE ID = @id

        //        INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate, CompanyCommission , CompanyCommissionRate)

        //        SELECT pn.ID, pn.CDate, ci.ID, '100', pn.MDate, TransactionNr, pn.Amount,
        //  case when pn.CreditCardPaymentMethodID = 7 then ROUND((pn.Amount* cc.ToslaRate/100), 4 ) else ROUND((pn.Amount* cc.CreditCardRate/100), 4 ) end , 0, 
        //  case when pn.CreditCardPaymentMethodID = 7 then ROUND((pn.Amount - (pn.Amount* cc.ToslaRate/100)), 4) else  ROUND((pn.Amount - (pn.Amount* cc.CreditCardRate/100)), 4) end, IDMember, 
        //  case when pn.CreditCardPaymentMethodID = 7 then cc.ToslaRate else cc.CreditCardRate end,
        //--		case when CreditCardPaymentMethodID = 2 then ROUND(((pn.Amount / 100)  *  (CAST(@PayNKolayCreditCardRate AS DECIMAL(10, 2))) ),4)
        //--		when CreditCardPaymentMethodID = 5 then ROUND(((pn.Amount / 100)  *  (CAST(@PaybullCreditCardRate AS DECIMAL(10, 2))) ),4) 
        //--		when CreditCardPaymentMethodID = 3  then ROUND(((pn.Amount / 100)  * 0),4)  end,
        //--		
        //--		case when CreditCardPaymentMethodID = 2  then(CAST(@PayNKolayCreditCardRate AS DECIMAL(10, 2))) 
        //--		when CreditCardPaymentMethodID = 5  then(CAST(@PaybullCreditCardRate AS DECIMAL(10, 2))) 
        //--		when CreditCardPaymentMethodID = 3 then 0 end
        //--	
        //  case when pn.CardTypeId = 1 and pins.DebitCardRate is not null then ROUND(((pn.Amount / 100) * (CAST(pins.DebitCardRate AS DECIMAL(10, 2))) ),4) else
        //  ROUND(((pn.Amount / 100) * (CAST(pins.Rate AS DECIMAL(10, 2))) ),4) end,

        //  case when pn.CardTypeId = 1 and pins.DebitCardRate is not null then (CAST(pins.DebitCardRate AS DECIMAL(10, 2))) else
        //  (CAST(pins.Rate AS DECIMAL(10, 2)))  end

        //        FROM CreditCardPaymentNotifications pn

        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //        INNER JOIN CompanyCommissions cc ON cc.ID= ci.ID

        //        INNER JOIN PaymentInstitutions pins on pins.ID = pn.CreditCardPaymentMethodID

        //        WHERE pn.ID= @id

        //    END

        //END

        //GO

        //ALTER Proc[dbo].[Companies_SetBalance]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@UsingBalance decimal (18,2),
        //@IDActionType nvarchar(10),
        //@PaymentTransferPoolID nvarchar(50)
        //AS
        //BEGIN
        //BEGIN TRY


        //    DECLARE @OldUsingBalance decimal (18,2)
        // DECLARE @NEWID nvarchar(50)


        //    SET @NEWID = NEWID()

        //    SET @OldUsingBalance = (Select UsingBalance FROM Companies WHERE ID=@ID)

        // IF(@OldUsingBalance<@UsingBalance )

        //    BEGIN
        //        IF(@IDActionType = '150')

        //        BEGIN
        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank,
        //            Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)


        //            Select CASE WHEN @PaymentTransferPoolID IS NULL THEN @NEWID ELSE @PaymentTransferPoolID END, GETDATE(), @ID, CASE WHEN @IDActionType IS NULL THEN '120' ELSE '150' END, GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@NEWID,28,5), null,  
        //   @UsingBalance - @OldUsingBalance,  ROUND(((@UsingBalance - @OldUsingBalance) * cc.TransferRate/100), 4 ), 0, ROUND(((@UsingBalance - @OldUsingBalance) - ((@UsingBalance - @OldUsingBalance) * cc.TransferRate/100)), 4),  
        //   null, cc.TransferRate,0,0
        //   FROM Companies  c
        //            INNER JOIN CompanyIntegrations ci ON ci.ID=@ID
        //            INNER JOIN CompanyCommissions cc ON cc.ID=ci.ID
        //            WHERE c.ID=@ID
        //        END


        //        ELSE
        //        BEGIN

        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank,
        //            Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)

        //            Select @NEWID, GETDATE(), @ID, '120', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@NEWID,28,5), null, @UsingBalance - @OldUsingBalance , 0, 0,  
        //   @UsingBalance - @OldUsingBalance, null, 0,0,0
        //   FROM Companies  c
        //            INNER JOIN CompanyIntegrations ci ON ci.ID=@ID
        //            WHERE c.ID=@ID
        //        END

        //    END
        //    IF(@OldUsingBalance>@UsingBalance )

        //    BEGIN
        //        INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)


        //        Select @NEWID, GETDATE(), @ID, '130', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@NEWID,28,5), null,   @OldUsingBalance - @UsingBalance , 0, 0,  
        //  @OldUsingBalance - @UsingBalance, null, 0,0,0
        //  FROM Companies  c
        //        INNER JOIN CompanyIntegrations ci ON ci.ID=@ID
        //        WHERE c.ID=@ID
        //    END


        //    END TRY

        //        BEGIN CATCH

        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //        RAISERROR(@ERRORMESSAGE,16,1)

        //    END CATCH
        //END

        //GO

        //        -- CompanyTransactions_GetAccountReport NULL, NULL, NULL

        //        ALTER Proc[dbo].[CompanyTransactions_GetAccountReportv2]
        //        @IDCompany nvarchar(50),
        //        @StartDate datetime,
        //        @EndDate datetime
        //        AS
        //        BEGIN

        //        SELECT top 100 
        //        isnull(sumT.TransferTotalAmount,0) as TransferTotalAmount ,
        //        isnull(sumTr.CompanyCommission,0) as TransferCommissionProfitAmount,
        //        isnull(sumTr.TransferDealerPaidAmount,0) as TransferDealerPaidAmount,
        //        isnull(sumTrPool.Amount,0) as TransferNotMatchedAmount,

        //        isnull(sumT.CreditCardTotalAmount,0) as CreditCardTotalAmount,
        //        isnull(sumCr.CompanyCommission,0) as CreditCardCommissionProfitAmount,
        //        isnull(sumCr.CreditCardDealerPaidAmount,0) as CreditCardDealerPaidAmount,
        //        isnull(sumCr.CreditCardPaymentInstitutionPaidAmount,0) as CreditCardPaymentInstitutionPaidAmount,              

        //        isnull(sumWt.WithdrawalTotalAmount,0) as WithdrawalTotalAmount, 
        //        isnull(sumWt.WithdrawalTotalPaidAmount,0) as WithdrawalTotalPaidAmount, 
        //        isnull(sumWt.WithdrawalTotalTransactionFeeAmount,0) as WithdrawalTotalTransactionFeeAmount, 
        //        isnull(sumEft.Amount,0) as WithdrawalEftAmount, 
        //        isnull(sumFast.Amount,0) as WithdrawalFastAmount, 

        //       	isnull(sumRebate.Amount,0) as RebateExpenseProfitAmount, 
        //        isnull(sumEx.Amount,0) as TotalExpenseAmount,
        //        isnull(sumIncome.Amount,0) as TotalIncomeAmount

        //        FROM CompanyTransactions t

        //        cross join(Select SUM(CASE WHEN t.IDActionType IN (10, 20,150) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS TransferTotalAmount,
        //        SUM(CASE WHEN t.IDActionType IN(100, 110) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS CreditCardTotalAmount From CompanyTransactions

        //        t where IDActionType IN(10,20,100,110,150)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //--        cross join(Select sum([dbo].RoundToZero(Commission)) as Commission From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumC

        //        cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as CompanyCommission, 
        //        sum([dbo].RoundToZero(NetTotal)) as CreditCardDealerPaidAmount, 
        //        sum([dbo].RoundToZero(CompanyCommission)) as CreditCardPaymentInstitutionPaidAmount
        //        From CompanyTransactions t where IDActionType IN(100,110)
        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumCr

        //        cross join(Select sum([dbo].RoundToZero(Commission)) as CompanyCommission, sum([dbo].RoundToZero(NetTotal)) AS TransferDealerPaidAmount

        //        From CompanyTransactions t where IDActionType IN(10,20,150)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumTr

        //--        cross join(Select sum([dbo].RoundToZero(NetTotal)) as NetTotal From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumNet

        //        cross join(Select sum([dbo].RoundToZero(t.Total + t.CostTotal)) as WithdrawalTotalAmount,
        //        sum([dbo].RoundToZero(t.Total)) as WithdrawalTotalPaidAmount,
        //        sum([dbo].RoundToZero(t.CostTotal)) as WithdrawalTotalTransactionFeeAmount

        //        From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumWt

        //        cross join(select sum(ROUND(
        //        CASE WHEN ct.Commission = ct.CompanyCommission THEN 0
        //             ELSE (ct.CompanyCommission )
        //        END, 4)) as Amount
        //        From CompanyRebateRequests r
        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID

        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID

        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)

        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID

        //           where r.Status = 2
        //        and (@IDCompany IS NULL OR ct.IDCompany= @IDCompany)
        //        and(CAST(ct2.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(ct2.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumRebate

        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast

        //--        cross join(Select sum([dbo].RoundToZero(cw.CostTotal)) as CostTotal , Count(cw.Amount) as cwCostTotal From CompanyTransactions t
        //--
        //--        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //--        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcess

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 2

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1 ) as sumEx

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 1

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1  ) as sumIncome

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From PaymentTransferPools t

        //        where t.Status = 1 
        //        AND NOT EXISTS (select* from WhereConditions wc
        //        WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //        (wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //        AND t.Amount > 0 


        //		) as sumTrPool

        //        --WHERE(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        // --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)))
        //        --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)))


        //        END

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_GetList]
        //@Status tinyint,
        //@IDCompany  nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@IsAutoNotification tinyint,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@PaymentMethodID int = null
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT r.ID, r.CDate,r.MDate,r.ServiceID,r.TransactionNr,r.TransactionID,r.IDMember,r.Phone,r.ActionDate,r.ActionTime,r.Amount,r.SenderName,r.SenderIdentityNr,
        //r.Description,r.Status,r.BlockedDate,r.IsNotBocked,r.IsAutoNotification,r.ParamCommission,r.PayNKolayCommission,r.CardNumber,r.TransactionReferenceCode,
        //r.MUser,r.MemberIPAddress,r.MemberPort,r.CardTypeId,r.PaymentInstitutionCommissionRate,r.PaymentInstitutionNetAmount, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, ct.CommissionRate, 
        //[dbo].RoundToZero(ct.Commission) as Commission, [dbo].RoundToZero(ct.NetTotal) as NetTotal, m2.Name AS Modifier, r.CreditCardPaymentMethodID, pins.Name as PaymentInstitutionName
        //into #TempTable FROM CreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //INNER JOIN Companies c ON c.ID= ci.ID
        //LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID

        //INNER JOIN Members m ON m.ID= r.IDMember

        //LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //LEFT JOIN CompanyTransactions ct ON ct.ID = r.ID

        //WHERE 1=1

        //AND (@IsAutoNotification IS NULL OR r.IsAutoNotification = @IsAutoNotification)

        //AND(@PaymentMethodID IS NULL OR r.CreditCardPaymentMethodID = @PaymentMethodID)

        //AND(r.Status= @Status OR (@Status IS NULL AND r.Status IN(2,3)) OR @Status = 4)

        //AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (m.Name LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END;

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetMonthlyAccountSummary]
        //@DailyReportStartDateTime datetime,
        //@DailyReportEndDateTime datetime,
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime,
        //@WeeklyReportStartDateTime datetime,
        //@WeeklyReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //    SELECT
        //        ccpn.CreditCardPaymentMethodID AS CreditCardPaymentMethodID,
        //        [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //    SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //    WHERE t.IDActionType IN(100, 110)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ccpn.CreditCardPaymentMethodID
        //),

        //PaymentTransferPoolCTE AS(
        //    SELECT
        //        t.IDBank AS PaymentTranferPoolBankID,
        //        [dbo].RoundToZero(SUM(t.Amount)) AS PaymentTranferPoolSumTotal,
        //    [dbo].RoundToZero(SUM(ct.Commission)) AS PaymentNotificationProfitAmount
        //    FROM PaymentTransferPools t
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionNr = t.ResponseTransactionNr
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = pn.ID
        //    WHERE t.Status = 2
        //        AND ct.TransactionDate >= @ReportStartDateTime
        //        AND ct.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDBank
        //),

        //WithdrawalRequestCTE AS(
        //    SELECT
        //        cwr.SIDBank AS WithdrawalRequestSIDBank,
        //        [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //        SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit
        //FROM CompanyTransactions t
        //LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //WHERE t.IDActionType = '30'
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY cwr.SIDBank
        //),

        //PaymentNotificationCTE AS(
        //    SELECT
        //        ptp.IDBank AS PaymentNotificationSIDBank,
        //        [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationTotalAmount
        //    FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //    LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //    WHERE t.IDActionType IN(10, 20, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ptp.IDBank
        //),

        //DateRangeQueryCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @DailyReportStartDateTime
        //    AND TransactionDate <= @DailyReportEndDateTime THEN Total ELSE 0 END)) AS DailyTotalPaymentAmount,

        //    [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @WeeklyReportStartDateTime
        //    AND TransactionDate <= @WeeklyReportEndDateTime THEN Total ELSE 0 END)) AS WeeklyTotalPaymentAmount,

        //    [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @ReportStartDateTime
        //        AND TransactionDate <= @ReportEndDateTime THEN Total ELSE 0 END)) AS MonthlyTotalPaymentAmount

        //    FROM CompanyTransactions

        //    WHERE IDActionType IN(10, 20, 100, 110,150)
        //),

        //CompanyTransactionCTE AS(
        //    SELECT
        //        t.IDCompany AS IDCompany,
        //        [dbo].RoundToZero(SUM(t.Total)) AS CompanyTransactionTotalAmount,
        //    [dbo].RoundToZero(SUM(t.Commission - t.CompanyCommission) + SUM(t.CostTotal)) AS CompanyTransactionProfit
        //    FROM CompanyTransactions t
        //    INNER JOIN Companies c on c.ID = t.IDCompany
        //    WHERE t.IDActionType IN(10, 20, 30, 100, 110, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDCompany
        //),

        //RebateRequestCTE AS(
        //    SELECT
        //    sum(ROUND((ct.CompanyCommission ),4)) as RebateNetAmount
        //    From CompanyRebateRequests r
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //    LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //    LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)
        //    LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //    WHERE ct2.IDActionType IN (90)
        //        AND ct2.TransactionDate >= @ReportStartDateTime
        //        AND ct2.TransactionDate <= @ReportEndDateTime
        //)

        //SELECT
        //    CreditCardCTE.CreditCardPaymentMethodID,
        //    CreditCardCTE.CreditCardSumTotal,
        //    CreditCardCTE.CreditCardProfit,
        //    PaymentTransferPoolCTE.PaymentTranferPoolBankID,
        //    PaymentTransferPoolCTE.PaymentTranferPoolSumTotal,
        //    WithdrawalRequestCTE.WithdrawalRequestSIDBank,
        //    WithdrawalRequestCTE.WithdrawalRequestTotalAmount,
        //    WithdrawalRequestCTE.WithdrawalRequestProfit,
        //    PaymentNotificationCTE.PaymentNotificationSIDBank,
        //    PaymentNotificationCTE.PaymentNotificationTotalAmount,
        //    DateRangeQueryCTE.DailyTotalPaymentAmount,
        //    DateRangeQueryCTE.WeeklyTotalPaymentAmount,
        //    DateRangeQueryCTE.MonthlyTotalPaymentAmount,
        //    CompanyTransactionCTE.IDCompany,
        //    CompanyTransactionCTE.CompanyTransactionTotalAmount,
        //    CompanyTransactionCTE.CompanyTransactionProfit,
        //    RebateRequestCTE.RebateNetAmount
        //FROM CreditCardCTE
        //FULL JOIN PaymentTransferPoolCTE ON 1 = 0
        //FULL JOIN WithdrawalRequestCTE ON 1 = 0
        //FULL JOIN PaymentNotificationCTE ON 1 = 0
        //FULL JOIN DateRangeQueryCTE ON 1 = 0
        //FULL JOIN CompanyTransactionCTE ON 1 = 0
        //FULL JOIN RebateRequestCTE ON 1 = 0;
        //END

        //GO

        //ALTER Proc[dbo].[CompanyTransactions_GetProcess]
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IsMonthlyAccountSummary bit = 0
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT t.ID, t.CDate, t.MDate, t.IDCompany, t.IDActionType, t.TransactionDate,t.TransactionNr, t.IDBank, t.CompanyCommission,
        //cwr.SIDBank as WithdrawalRequestSIDBank,
        //ccpn.CreditCardPaymentMethodID as CreditCardPaymentMethodID,
        //pts.IDBank as SIDBank,
        //[dbo].RoundToZero(t.Total) AS Total,

        //[dbo].RoundToZero(t.Commission) as Commission, 
        //ROUND((t.commission / t.total* 100),4) as TransactionTotal,
        //t.CostTotal,
        //[dbo].RoundToZero(t.NetTotal) as NetTotal, 

        //t.IDMember,t.IDCompanyInvoice, at.ActionType, b.Name as Bank, m.Name as Member, 
        //t.CommissionRate,
        //GetProcessBalance.NetTotal as Balance, GetProcessBalance.Total as BalanceTotal , 
        //GetProcessBalance.Commission as BalanceCommission ,
        //GetProcessBalance.RebateTotal , GetProcessBalance.RebateTotalCount,
        //GetProcessBalance.CommissionCount

        //--isnull(dbo.CompanyTransactions_GetProcessBalance(@IDCompany, @StartDate, @EndDate, t.TransactionDate),0) as Balance
        //into #TempTable FROM CompanyTransactions t
        //INNER JOIN ActionTypes at ON at.IDActionType=t.IDActionType
        //LEFT JOIN Banks b ON b.ID= t.IDBank
        //left join CompanyWithdrawalRequests cwr on cwr.ID = t.ID
        //left join CreditCardPaymentNotifications ccpn on ccpn.ID = t.ID
        //left join PaymentNotifications pn on pn.ID = t.ID
        //left join PaymentTransferPools pts on pts.ResponseTransactionNr = pn.TransactionNr
        //LEFT JOIN Members m ON m.ID= t.IDMember

        //cross join dbo.Fn_CompanyTransactions_GetProcessBalance(@IDCompany, @StartDate, @EndDate) as GetProcessBalance
        //WHERE
        //    (
        //        (@IsMonthlyAccountSummary = 0 AND t.IDActionType IN ('10', '20', '70', '90', '100', '140', '150' ))
        //        OR
        //        (@IsMonthlyAccountSummary = 1 AND t.IDActionType IN ('10', '20', '30', '70', '100', '140','150'))
        //    )

        //AND(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //AND CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)

        //AND CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)

        //AND(@SearchValue IS NULL OR  (b.Name LIKE '%' + @SearchValue + '%' OR t.TransactionNr LIKE '%' + @SearchValue + '%'  OR t.Total LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable

        //END

        //GO

        //ALTER FUNCTION[dbo].[Fn_CompanyTransactions_GetProcessBalance]
        //(
        //@IDCompany nvarchar(50),  
        //@StartDate date,
        //@EndDate date
        //)
        //RETURNS TABLE
        //AS
        //RETURN

        //select sum([dbo].RoundToZero(NetTotal)) as NetTotal , sum([dbo].RoundToZero(Total)) as Total , 
        //sum([dbo].RoundToZero(Commission)) as Commission , sum([dbo].RoundToZero(RebateTotal)) as RebateTotal,
        //sum(RebateTotalCount) as RebateTotalCount , sum(CommissionCount) as CommissionCount
        //from(
        //select CASE WHEN t.IDActionType IN (30,40,50,90) then sum(t.NetTotal) * -1 else sum(t.NetTotal) end  as NetTotal,
        //CASE WHEN t.IDActionType IN(30,40,50,90) then sum(t.Total) * -1 else sum(t.Total) end  as Total,
        //CASE WHEN t.IDActionType IN(30,40,50,90) then sum(t.Total)  else 0 end  as RebateTotal,
        //CASE WHEN t.IDActionType IN(30,40,50,90)  then count(*)  else 0 end  as RebateTotalCount,
        //CASE WHEN t.IDActionType IN(30,40,50,90) then  0 else count(*) end  as CommissionCount,
        //sum(Commission) as  Commission
        //FROM CompanyTransactions t

        //WHERE t.IDActionType IN ('10', '20', '70', '90', '100','140','150')

        //AND(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //AND CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)

        //AND CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)

        //group by t.IDActionType )
        //as aa

        //GUNCELLENDİ

        //------------------------------------------------------- 08.03.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.CompanyCommissions
        //ADD  ToslaBlocked tinyint  DEFAULT 0 NOT NULL,

        //GO

        //ALTER Proc[dbo].[CompanyCommissions_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@CreditCardRate decimal (5,2),
        //@CreditCardStatus bit,
        //@CreditCardBlocked tinyint,
        //@TransferRate decimal (5,2),
        //@TransferStatus bit,
        //@TransferBlocked tinyint,
        //@MobilePayRate decimal (5,2),
        //@MobilePayStatus bit,
        //@MobilePayBlocked tinyint,
        //@WithdrawalTransferAmount decimal (5,2),
        //@WithdrawalEftAmount decimal (5,2),
        //@ForeignCreditCardRate decimal (5,2),
        //@ForeignCreditCardBlocked tinyint,
        //@ToslaRate decimal (5,2),
        //@ToslaBlocked tinyint
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyCommissions SET MUser = @MUser, MDate = @MDate, CreditCardRate = @CreditCardRate, TransferRate = @TransferRate, MobilePayRate = @MobilePayRate,
        //CreditCardStatus = @CreditCardStatus, TransferStatus = @TransferStatus, MobilePayStatus = @MobilePayStatus, CreditCardBlocked = @CreditCardBlocked, TransferBlocked = @TransferBlocked,
        //MobilePayBlocked = @MobilePayBlocked, WithdrawalTransferAmount = @WithdrawalTransferAmount, WithdrawalEftAmount = @WithdrawalEftAmount, ForeignCreditCardRate = @ForeignCreditCardRate,
        //ForeignCreditCardBlocked = @ForeignCreditCardBlocked, ToslaRate = @ToslaRate, ToslaBlocked = @ToslaBlocked

        //WHERE ID = @ID


        //--DELETE FROM CompanyBanks WHERE ID=@ID
        //--INSERT INTO CompanyBanks(ID, IDBank, CUser, CDate) SELECT @ID, ID, @MUser, @MDate FROM Banks WHERE StatusFlag = 1 AND 1=@TransferStatus

        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerMaxWithdrawalLimit', N'dealer_max_withdrawal_limit', N'10000000', 0);

        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'MaxFastAmountLimit', N'max_fast_amount_limit', N'50000', 0);

        //GUNCELLENDİ

        //------------------------------------------------------- 15.03.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.AccountSummaries
        //ADD CreditCardPoolBalance decimal (18, 2) DEFAULT 0 NOT NULL

        //GO

        //ALTER Proc[dbo].[AccountSummaries_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@Profit decimal (18,2),
        //@ExpenseAmount decimal (18,2),
        //@Difference decimal (18,2),
        //@PaymentNotificationProfit decimal (18,2),
        //@CreditCardPaymentNotificationProfit decimal (18,2),
        //@WithdrawalRequestProfit decimal (18,2),
        //@DealerTotalBalance decimal (18,2),
        //@UnmatchedPaymentNotificationBalance decimal (18,2),
        //@NetAmount decimal (18,2),
        //@IncomeAmount decimal (18,2),
        //@IsMonthly bit = null,
        //@RebateExpenseProfitAmount decimal (18,2),
        //@Month int = null,
        //@Year int = null,
        //@CreditCardPoolBalance decimal (18,2) = null
        //AS
        //BEGIN

        //BEGIN TRY


        //SET @IDOut = NEWID()

        //INSERT INTO AccountSummaries(ID, CUser, CDate, Profit, ExpenseAmount, Difference,
        //PaymentNotificationProfit, CreditCardPaymentNotificationProfit,
        //WithdrawalRequestProfit, DealerTotalBalance, UnmatchedPaymentNotificationBalance, NetAmount, IncomeAmount, IsMonthly, RebateExpenseProfitAmount, Month, Year, CreditCardPoolBalance)

        //VALUES(@IDOut, @CUser, @CDate, @Profit, @ExpenseAmount, @Difference,
        //@PaymentNotificationProfit, @CreditCardPaymentNotificationProfit,
        //@WithdrawalRequestProfit, @DealerTotalBalance, @UnmatchedPaymentNotificationBalance, @NetAmount, @IncomeAmount, @IsMonthly, @RebateExpenseProfitAmount, @Month, @Year, @CreditCardPoolBalance)

        //SELECT @IDOut
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetBankTransactions]
        //@IDBank NVARCHAR(10) = NULL,
        //@IDBankAccount NVARCHAR(50),
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@IsExitAccount BIT = NULL,
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN

        //    DECLARE @totalRecords INT
        //       DECLARE @totalNegativeBalance decimal (18, 2)
        //    DECLARE @totalPositiveBalance decimal (18, 2)

        // IF(@IsExitAccount = 0)

        //    BEGIN
        //        CREATE TABLE #TempTable (
        //         TransactionDate DATETIME,
        //         IDBank NVARCHAR(10),
        //         SenderName NVARCHAR(MAX),
        //         Amount DECIMAL(18, 2),
        //         BankName NVARCHAR(MAX),
        //         Description NVARCHAR(MAX),
        //         TotalBalance DECIMAL(18, 2),
        //         IsPositiveBalance tinyint
        //     )


        //        INSERT INTO #TempTable (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)
        //  SELECT t.TransactionDate, t.IDBank, t.SenderName, t.Amount,
        //        cba.Name as BankName, t.Description, 0, 1

        //        FROM PaymentTransferPools t
        //        INNER JOIN CompanyBankAccounts cba on cba.ID = @IDBankAccount

        //        WHERE t.IDBank= @IDBank AND t.Amount > 0 AND t.Status in (1,2)

        //        AND NOT EXISTS(select* from WhereConditions wc

        //        WHERE wc.SP= 'CompanyBankAccounts_TotalSum' AND

        //        ((wc.ColumnName = 'SenderName' and SenderName LIKE '%' + wc.ConditionName + '%' COLLATE Latin1_General_CI_AI) OR
        //        (wc.ColumnName = 'Description' and Description LIKE '%' + wc.ConditionName + '%' COLLATE Latin1_General_CI_AI)))
        //  AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //  AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //  AND(@SearchValue IS NULL OR (t.Description LIKE '%' + @SearchValue + '%' OR t.SenderName LIKE '%' + @SearchValue + '%' OR t.Amount LIKE '%' + @SearchValue + '%'))
        //  GROUP BY t.TransactionDate, t.IDBank, t.SenderName, t.Amount, cba.Name,t.Description

        //        INSERT INTO #TempTable (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)
        //     SELECT

        //            t.TransactionDate, 
        //         @IDBank, 
        //         cba.Name, 
        //         t.Amount,
        //         cba.Name,  
        //   CASE
        //                WHEN t.TransactionType = 1 THEN
        //                    CASE

        //                        WHEN pins.Name IS NULL THEN N'Bankaya Gelir Eklendi' COLLATE Latin1_General_100_CI_AS_SC_UTF8

        //                        ELSE pins.Name + N' Ödeme Kuruluşundan Transfer Eklendi' COLLATE Latin1_General_100_CI_AS_SC_UTF8

        //                    END
        //                WHEN t.TransactionType = 2 THEN
        //                    CASE

        //                        WHEN t.IDBankAccount2<> @IDBankAccount THEN cba2.Name + N' Bankasına Transfer Yapıldı' COLLATE Latin1_General_100_CI_AS_SC_UTF8

        //                        ELSE N'Bankadan Çıkış Yapıldı' COLLATE Latin1_General_100_CI_AS_SC_UTF8

        //                    END
        //            END AS Description,
        //	        0,
        //               CASE WHEN t.TransactionType = 1 THEN 1 ELSE 0 END
        //        FROM CompanyFinanceTransaction t

        //        INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //        LEFT JOIN CompanyBankAccounts cba2 on cba2.ID = t.IDBankAccount2

        //        left join PaymentInstitutions pins ON pins.ID = t.CompanyIntegrationType

        //        WHERE t.PaymentMethod = 1 AND IDBankAccount = @IDBankAccount

        //        AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //     AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //  GROUP BY t.TransactionDate, t.CompanyIntegrationType, cba.Title, cba.Name, t.Amount, t.TransactionType, pins.Name, t.IDBankAccount2, cba2.Name

        //        SELECT @totalRecords = COUNT(*) FROM #TempTable

        //  select @totalNegativeBalance = ISNULL(SUM(Amount), 0)from #TempTable where IsPositiveBalance = 0 	
        //  select @totalPositiveBalance = ISNULL(SUM(Amount), 0) from #TempTable where IsPositiveBalance = 1 

        //     SELECT TransactionDate , IDBank,SenderName,Amount, BankName, Description, @totalPositiveBalance - @totalNegativeBalance as TotalBalance, 
        //     IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable


        //        ORDER BY TransactionDate DESC

        //        OFFSET @OffsetValue ROWS
        //        FETCH NEXT @PageLength ROWS ONLY


        //        DROP TABLE #TempTable
        // END

        //    ELSE

        //    BEGIN
        //        CREATE TABLE #TempTable2 (
        //         TransactionDate DATETIME,
        //         IDBank NVARCHAR(10),
        //         SenderName NVARCHAR(MAX),
        //         Amount DECIMAL(18, 2),
        //         BankName NVARCHAR(MAX),
        //         Description NVARCHAR(MAX),
        //         TotalBalance DECIMAL(18, 2),
        //         IsPositiveBalance tinyint
        //     )


        //        INSERT INTO #TempTable2 (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)


        //        SELECT cwr.CDate as TransactionDate, cwr.SIDBank as IDBank, cwr.Title as SenderName, cwr.Amount, cba.Name as BankName,
        //        cwr.Description, 0, 0

        //        FROM CompanyWithdrawalRequests cwr
        //        INNER JOIN CompanyBankAccounts cba on cba.ID = @IDBankAccount

        //        WHERE cwr.SIDBank = @IDBank AND cwr.Status = 2

        //        AND(@StartDate IS NULL OR CAST(cwr.CDate AS DATE) >= CAST(@StartDate AS DATE))
        //  AND(@EndDate IS NULL OR CAST(cwr.CDate AS DATE) <= CAST(@EndDate AS DATE))
        //  AND(@SearchValue IS NULL OR (cwr.Title LIKE '%' + @SearchValue + '%' OR cwr.Amount LIKE '%' + @SearchValue + '%'))

        //  INSERT INTO #TempTable2 (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)
        //  SELECT crr.CDate as TransactionDate, crr.SIDBank as IDBank, crr.SenderName as SenderName, crr.Amount, cba.Name as BankName,
        //        N'İade Yapıldı' COLLATE Latin1_General_100_CI_AS_SC_UTF8 as Description, 0, 0

        //        FROM CompanyRebateRequests crr
        //        INNER JOIN CompanyBankAccounts cba on cba.ID = @IDBankAccount

        //        WHERE crr.SIDBank = @IDBank AND crr.Status = 2

        //        AND(@StartDate IS NULL OR CAST(crr.CDate AS DATE) >= CAST(@StartDate AS DATE))
        //  AND(@EndDate IS NULL OR CAST(crr.CDate AS DATE) <= CAST(@EndDate AS DATE))
        //  AND(@SearchValue IS NULL OR (crr.SenderName LIKE '%' + @SearchValue + '%' OR crr.Amount LIKE '%' + @SearchValue + '%'))


        //  INSERT INTO #TempTable2 (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)
        //     SELECT
        //            t.TransactionDate,
        //            @IDBank,
        //            cba.Name,
        //            t.Amount,
        //            cba.Name,
        //            CASE
        //                WHEN t.TransactionType = 1 THEN
        //                    CASE

        //                        WHEN pins.Name IS NULL THEN N'Bankaya Gelir Eklendi' COLLATE Latin1_General_100_CI_AS_SC_UTF8

        //                        ELSE pins.Name + N' Ödeme Kuruluşundan Transfer Eklendi' COLLATE Latin1_General_100_CI_AS_SC_UTF8

        //                    END
        //                WHEN t.TransactionType = 2 THEN
        //                    CASE

        //                        WHEN t.IDBankAccount2<> @IDBankAccount THEN cba2.Name + N' Bankasına Transfer Yapıldı' COLLATE Latin1_General_100_CI_AS_SC_UTF8

        //                        ELSE N'Bankadan Çıkış Yapıldı' COLLATE Latin1_General_100_CI_AS_SC_UTF8

        //                    END
        //            END AS Description,
        //	        0,
        //               CASE WHEN t.TransactionType = 1 THEN 1 ELSE 0 END
        //        FROM CompanyFinanceTransaction t

        //        INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //        LEFT JOIN CompanyBankAccounts cba2 on cba2.ID = t.IDBankAccount2

        //        left join PaymentInstitutions pins ON pins.ID = t.CompanyIntegrationType

        //        WHERE t.PaymentMethod = 1 AND IDBankAccount = @IDBankAccount

        //        AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //     AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //  GROUP BY t.TransactionDate, t.CompanyIntegrationType, cba.Title, cba.Name, t.Amount, t.TransactionType, pins.Name, t.IDBankAccount2, cba2.Name

        //        SELECT @totalRecords = COUNT(*) FROM #TempTable2

        //  select @totalNegativeBalance = ISNULL(SUM(Amount), 0)from #TempTable2 where IsPositiveBalance = 0 	
        //  select @totalPositiveBalance = ISNULL(SUM(Amount), 0) from #TempTable2 where IsPositiveBalance = 1 

        //     SELECT TransactionDate , IDBank,SenderName,Amount, BankName, Description, @totalPositiveBalance - @totalNegativeBalance as TotalBalance, 
        //     IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable2


        //        ORDER BY TransactionDate DESC

        //        OFFSET @OffsetValue ROWS
        //        FETCH NEXT @PageLength ROWS ONLY

        //        DROP TABLE #TempTable2
        // END

        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetCreditCardTransactions]
        //@PaymentInstitutionID NVARCHAR(10) = NULL,
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords INT
        //    DECLARE @totalNegativeBalance decimal (18, 2)		
        // DECLARE @ccPool decimal (18, 2)

        // select @ccPool = ISNULL(SUM(cpn.PaymentInstitutionNetAmount), 0)

        //            FROM CreditCardPaymentNotifications cpn
        //            WHERE cpn.CreditCardPaymentMethodID = @PaymentInstitutionID
        //              AND cpn.Status = 5

        //    DECLARE @result decimal (18, 2)
        //   Select @result =  ISNULL(sum((Total - isnull(t.CompanyCommission,0))),0)

        //            FROM CompanyTransactions t
        //            INNER JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID
        //            WHERE 1=1

        //              AND t.IDActionType IN (100,110)

        //              AND(cs.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //              AND cs.Status = 2
        //--			  AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //--			  AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))

        //    CREATE TABLE #TempTable (
        //        TransactionDate DATETIME,
        //        PaymentInstitutionID NVARCHAR(10),
        //        SenderName NVARCHAR(MAX),
        //        Amount DECIMAL(18, 2),
        //        PaymentInstitutionName NVARCHAR(MAX),
        //        Description NVARCHAR(MAX),
        //        TotalBalance DECIMAL(18, 2),
        //        IsPositiveBalance tinyint,
        //    )

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate,
        //        t.CompanyIntegrationType,
        //        cba.Name,
        //        t.Amount,
        //        pins.Name as PaymentInstitutionName,
        //        cba.Name + N' Bankasına Çıkış Yapıldı' COLLATE Latin1_General_100_CI_AS_SC_UTF8 as Description,
        //        0,
        //        0
        //    FROM CompanyFinanceTransaction t
        //    INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //    INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2
        //    WHERE
        //    t.CompanyIntegrationType = @PaymentInstitutionID
        //    AND t.PaymentMethod = 2 AND t.TransactionType = 2
        //    AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        // GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate, 
        //        cs.CreditCardPaymentMethodID, 
        //        cs.SenderName, 
        //        [dbo].RoundToZero(t.Total - t.CompanyCommission ) as Amount, 
        //        pins.Name as PaymentInstitutionName, 
        //        cs.Description,
        //        0,
        //        1
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID
        //    INNER JOIN PaymentInstitutions pins ON cs.CreditCardPaymentMethodID = pins.ID
        //    WHERE t.IDActionType IN(100,110)
        //    AND(cs.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //    AND(@SearchValue IS NULL OR (cs.SenderName LIKE '%' + @SearchValue + '%' OR cs.Amount LIKE '%' + @SearchValue + '%'))
        // GROUP BY t.TransactionDate, cs.CreditCardPaymentMethodID, cs.SenderName,t.Total,t.CompanyCommission, pins.Name, cs.Description

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate, 
        //        cs.CreditCardPaymentMethodID, 
        //        cs.SenderName, 
        //        (isnull(t2.Total,0) - isnull(t2.CompanyCommission,0)),
        //        pins.Name as PaymentInstitutionName, 
        //        N'İade Yapıldı' COLLATE Latin1_General_100_CI_AS_SC_UTF8 as Description,
        //        0,
        //        0
        //    FROM CompanyRebateRequests cr
        //    LEFT JOIN CompanyTransactions t ON t.ID = cr.ID
        //    LEFT JOIN CreditCardPaymentNotifications cs ON cs.TransactionID = cr.TransactionID
        //    LEFT JOIN CompanyTransactions t2 ON t2.ID = cs.ID
        //    LEFT JOIN PaymentInstitutions pins ON cs.CreditCardPaymentMethodID = pins.ID
        //    WHERE 1=1
        //    AND(cs.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //    AND(@SearchValue IS NULL OR (cs.Description LIKE '%' + @SearchValue + '%' OR t2.Total - t2.CompanyCommission LIKE '%' + @SearchValue + '%'))

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //    SELECT
        //           cpn.ActionDate,
        //        cpn.CreditCardPaymentMethodID,
        //        cpn.SenderName,
        //        isnull(cpn.PaymentInstitutionNetAmount,0),
        //        pins.Name as PaymentInstitutionName, 
        //        N'Manuel Kredi Kartı Ödeme Havuzunda' COLLATE Latin1_General_100_CI_AS_SC_UTF8 as Description,
        //        0,
        //        1
        //    FROM CreditCardPaymentNotifications cpn
        //    INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //    WHERE cpn.Status = 5
        //    AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)



        //    SELECT @totalRecords = COUNT(*) FROM #TempTable
        //    select @totalNegativeBalance = ISNULL(SUM(Amount), 0) from #TempTable where IsPositiveBalance = 0
        //    --select @totalPositiveBalance = ISNULL(SUM(Amount), 0) from #TempTable where IsPositiveBalance = 1 

        //    SELECT TransactionDate , PaymentInstitutionID,SenderName,Amount, PaymentInstitutionName, Description, (@result + @ccPool) - @totalNegativeBalance as TotalBalance, IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable
        //    ORDER BY TransactionDate DESC
        //    OFFSET @OffsetValue ROWS
        //    FETCH NEXT @PageLength ROWS ONLY


        //    DROP TABLE #TempTable

        //END

        //GO

        //ALTER Proc[dbo].[CompanyBankAccounts_TotalCreditCardSum]
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(50),
        //@StartDate date = null,
        //@EndDate date = null
        //AS
        //BEGIN


        //DECLARE @Counter INT = 1;
        //DECLARE @MaxCount INT;
        //SELECT @MaxCount = COUNT(*) FROM PaymentInstitutions WHERE Show = 1

        //CREATE TABLE #TempResults
        //(
        //    ID NVARCHAR(50),
        //    Amount DECIMAL(18, 2),
        //    CreditCardAmount DECIMAL(18, 2),
        //    EftAmount DECIMAL(18, 2),
        //    NetAmount DECIMAL(18, 2),
        //    CountNetAmount INT,
        //    Name NVARCHAR(200),
        //    UseForForeignCard BIT
        //);

        //        WHILE @Counter <= @MaxCount
        //        BEGIN
        //    DECLARE @CurrentID NVARCHAR(50);
        //        DECLARE @Name NVARCHAR(200);
        //        DECLARE @UseForForeignCard BIT;

        //    SELECT @CurrentID = ID, @Name = Name, @UseForForeignCard = UseForForeignCard
        //    FROM(
        //        SELECT ID, Name, UseForForeignCard, ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS RowNum
        //        FROM PaymentInstitutions
        //        WHERE Show = 1
        //    ) AS RowNumbered
        //    WHERE RowNum = @Counter;

        //        IF @CurrentID = 6

        //    BEGIN
        //        INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount)
        //    SELECT TOP(1)
        //        @CurrentID AS ID,
        //        isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //        @Name AS Name,
        //        @UseForForeignCard AS UseForForeignCard,
        //        0 AS CreditCardAmount,
        //        isnull(CountNetAmountToday, 0) - isnull(Piece,0) AS EftAmount,
        //        isnull(sumT.NetAmountTotal, 0) AS NetAmount,
        //        isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount
        //    FROM
        //    (
        //        SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //        SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //        FROM (
        //            SELECT sum(Amount) AS Amount,
        //                   CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                   CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                   SUM(isnull(Piece,0)) AS Piece
        //            FROM CompanyFinanceTransaction
        //            WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2
        //            GROUP BY TransactionType
        //        ) AS Total
        //    ) AS AmountTotal
        //    LEFT JOIN(
        //        SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //               SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //               SUM(NetAmountTotal) AS NetAmountTotal,
        //               SUM(CountNetAmount) AS CountNetAmount,
        //               SUM(CountNetAmountToday) AS CountNetAmountToday
        //        FROM (
        //            SELECT sum(Total) + isnull(ccPool.Amount,0) AS NetAmountTotal,
        //                    sum((Total - isnull(t.CompanyCommission, 0))) + isnull(ccPool.Amount,0) AS NetAmount,
        //                       count((Total)) + isnull(RebateCount,0) AS CountNetAmount,
        //                    count(CASE WHEN CONVERT(DATE, t.TransactionDate) = CONVERT(DATE, GETDATE()) THEN 1 ELSE NULL END) + isnull(RebateCount,0) AS CountNetAmountToday,
        //                   (isnull(cr.Amount, 0) - isnull(cr.CompanyCommission, 0)) AS ExpenseNetAmount
        //            FROM CompanyTransactions t
        //            LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //            CROSS JOIN(
        //                SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                       sum(cr.Amount) AS Amount,
        //                       count(cr.Amount) AS RebateCount
        //                FROM CompanyRebateRequests cr
        //                INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //                INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //                INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //     AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //            ) cr

        //            CROSS JOIN(
        //                SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                From CreditCardPaymentNotifications cpn
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND cpn.Status = 5 AND cpn.TransactionReferenceCode is not null AND cpn.PaymentInstitutionNetAmount is not null 
        //                AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) ccPool

        //            WHERE IDActionType IN(100,110) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //            AND(@EndDate IS NULL OR CAST(TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //            GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount
        //        ) AS AmountTotal
        //    ) AS sumT ON sumT.ID = @CurrentID
        //    END

        //    ELSE
        //        BEGIN

        //            INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount)
        //    SELECT TOP(1)
        //        @CurrentID AS ID,
        //        isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //        @Name AS Name,
        //        @UseForForeignCard AS UseForForeignCard,
        //        0 AS CreditCardAmount,
        //        0 AS EftAmount,
        //        isnull(sumT.NetAmount, 0) AS NetAmount,
        //       isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount
        //    FROM
        //    (
        //        SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //        SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //        FROM (
        //            SELECT sum(Amount) AS Amount,
        //                   CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                   CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                   SUM(isnull(Piece,0)) AS Piece

        //                FROM CompanyFinanceTransaction

        //                WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2

        //                GROUP BY TransactionType
        //         ) AS Total
        //     ) AS AmountTotal
        //    LEFT JOIN(
        //            SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //                   SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //                   SUM(CountNetAmount) AS CountNetAmount
        //            FROM (
        //                SELECT sum(ISNULL((Total - isnull(t.CompanyCommission,0)),0)) + isnull(ccPool.Amount,0) AS NetAmount,
        //                       count((NetTotal)) + isnull(RebateCount,0) AS CountNetAmount,
        //                    (isnull(cr.Amount, 0) - isnull(cr.CompanyCommission, 0)) AS ExpenseNetAmount

        //                FROM CompanyTransactions t
        //                LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //                CROSS JOIN(
        //                    SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                           sum(cr.Amount) AS Amount,
        //                           count(cr.Amount) AS RebateCount
        //                    FROM CompanyRebateRequests cr

        //                    INNER JOIN CompanyTransactions t ON t.ID = cr.ID

        //                    INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID

        //                    INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID

        //                    WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //            AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) cr

        //                CROSS JOIN(
        //                SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                From CreditCardPaymentNotifications cpn
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND cpn.Status = 5 AND cpn.TransactionReferenceCode is not null AND cpn.PaymentInstitutionNetAmount is not null 
        //                AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) ccPool

        //                WHERE IDActionType IN(100,110) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID

        //                GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount

        //               ) AS AmountTotal
        //     ) AS sumT ON sumT.ID = @CurrentID
        //        END
        //    SET @Counter = @Counter + 1;
        //        END;

        //SELECT* FROM #TempResults ORDER BY ID;
        //DROP TABLE #TempResults;

        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 18.03.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        //ALTER Proc[dbo].[CompanyTransactions_GetAccountReportCreditCardDetail]
        //@IDCompany nvarchar(50) = null,
        //@StartDate date = null,
        //@EndDate date = null
        //AS
        //BEGIN

        //SELECT t.ID, t.TransactionDate, T.Amount, T.PaymentMethod, cba.Name AS IDBankName , cbb.Name AS IDBankName2 ,
        //pins.Name as PaymentMethodName,
        //M.Name as CUserName,
        //t.Description
        //FROM CompanyFinanceTransaction t

        //left join CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //left join CompanyBankAccounts cbb on cbb.ID = t.IDBankAccount2

        //left join Administrators m on m.ID = T.CUser

        //left join PaymentInstitutions pins on pins.ID = T.CompanyIntegrationType

        //WHERE 1=1 and (t.PaymentMethod = 2)

        //AND(@IDCompany IS NULL OR t.CompanyIntegrationType= @IDCompany)

        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //ORDER BY t.TransactionDate Desc

        //END

        //GO

        //ALTER Proc[dbo].[CompanyTransactions_GetAccountReportBankTransactionsDetailTransfer]
        //@IDBank nvarchar(50) = null,
        //@StartDate date = null,
        //@EndDate date = null
        //AS
        //BEGIN


        //SELECT t.ID, t.TransactionDate, T.Amount, T.PaymentMethod, T.TransactionType, cba.Name AS IDBankName  , cbb.Name AS IDBankName2 ,
        //ISNULL(pins.Name, '' ) as  PaymentMethodName, M.Name as CUserName , case when t.TransactionDetailType = 1 then 'Muhtelif Giderler' 

        //when t.TransactionType = 1 then 'Banka Giriş' when t.TransactionType = 2 then 'Banka Çıkış' end as IncomeType,
        //t.Description
        //FROM CompanyFinanceTransaction t

        //left join CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //left join CompanyBankAccounts cbb on cbb.ID = t.IDBankAccount2

        //left join Administrators m on m.ID = T.CUser

        //left join PaymentInstitutions pins on pins.ID = T.CompanyIntegrationType

        //WHERE 1=1 and (t.PaymentMethod = 1)
        //--AND(t.TransactionType = 2)

        //AND(t.TransactionDetailType = 2)

        //AND(@IDBank IS NULL OR t.IDBankAccount= @IDBank)

        //AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        //ORDER BY t.TransactionDate Desc

        //END

        //GO

        //ALTER Proc[dbo].[CompanyTransactions_GetAccountReportBankTransactionsDetailIncome]
        //@IDBank nvarchar(50) = null,
        //@StartDate datetime = null,
        //@EndDate datetime = null
        //AS
        //BEGIN

        //SELECT t.ID, t.TransactionDate, T.Amount, T.PaymentMethod, cba.Name AS IDBankName  , cbb.Name AS IDBankName2 ,
        //'' as  PaymentMethodName, M.Name as CUserName , case when t.TransactionDetailType = 1 then 'Muhtelif Gelirler' 

        //when t.TransactionDetailType = 2 then 'Banka Giriş' end as IncomeType, t.Description
        //FROM CompanyFinanceTransaction t

        //left join CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //left join CompanyBankAccounts cbb on cbb.ID = t.IDBankAccount2

        //left join Administrators m on m.ID = T.CUser

        //WHERE 1=1 and (t.PaymentMethod = 1)

        //AND(t.TransactionType = 1)

        //AND(t.TransactionDetailType = 1)

        //AND(@IDBank IS NULL OR t.IDBankAccount= @IDBank)
        //AND(
        //(@StartDate IS NULL) OR
        //(
        //(
        //(CAST(@StartDate AS time) = '00:00:00' AND CAST(t.TransactionDate AS date) >= CAST(@StartDate AS date)) OR
        //(CAST(@StartDate AS time) <> '00:00:00' AND CAST(t.TransactionDate AS datetime) >= CAST(@StartDate AS datetime))
        //)
        //)
        //)
        //AND(
        //(@EndDate IS NULL) OR
        //(
        //(
        //(CAST(@EndDate AS time) = '00:00:00' AND CAST(t.TransactionDate AS date) <= CAST(@EndDate AS date)) OR
        //(CAST(@EndDate AS time) <> '00:00:00' AND CAST(t.TransactionDate AS datetime) <= CAST(@EndDate AS datetime))
        //)
        //)
        //)
        //ORDER BY t.TransactionDate Desc

        //END

        //GO

        //ALTER Proc[dbo].[CompanyTransactions_GetAccountReportBankTransactionsDetailExpense]
        //@IDBank nvarchar(50) = null,
        //@StartDate datetime = null,
        //@EndDate datetime = null
        //AS
        //BEGIN

        //SELECT t.ID, t.TransactionDate, T.Amount, T.PaymentMethod, cba.Name AS IDBankName  , cbb.Name AS IDBankName2 ,
        //'' as  PaymentMethodName, M.Name as CUserName , case when t.TransactionDetailType = 1 then 'Muhtelif Giderler' 

        //when t.TransactionDetailType = 2 then 'Banka Çıkış' end as ExpenseType, t.Description
        //FROM CompanyFinanceTransaction t

        //left join CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //left join CompanyBankAccounts cbb on cbb.ID = t.IDBankAccount2

        //left join Administrators m on m.ID = T.CUser

        //WHERE 1=1 and (t.PaymentMethod = 1)

        //AND(t.TransactionType = 2)

        //AND(t.TransactionDetailType = 1)

        //AND(@IDBank IS NULL OR t.IDBankAccount= @IDBank)

        //AND(
        //(@StartDate IS NULL) OR
        //(
        //(
        //(CAST(@StartDate AS time) = '00:00:00' AND CAST(t.TransactionDate AS date) >= CAST(@StartDate AS date)) OR
        //(CAST(@StartDate AS time) <> '00:00:00' AND CAST(t.TransactionDate AS datetime) >= CAST(@StartDate AS datetime))
        //)
        //)
        //)
        //AND(
        //(@EndDate IS NULL) OR
        //(
        //(
        //(CAST(@EndDate AS time) = '00:00:00' AND CAST(t.TransactionDate AS date) <= CAST(@EndDate AS date)) OR
        //(CAST(@EndDate AS time) <> '00:00:00' AND CAST(t.TransactionDate AS datetime) <= CAST(@EndDate AS datetime))
        //)
        //)
        //)

        //END

        //GUNCELLENDi

        //------------------------------------------------------- 20.03.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'WithdrawalRequestCancelApprovedTransaction', N'password', N'113355', 0);

        //GO

        //ALTER PROCEDURE[dbo].[CompanyWithdrawalRequests_SetStatus]
        //@IDOut NVARCHAR(50) OUTPUT,
        //@ID NVARCHAR(50),
        //@MUser NVARCHAR(50),
        //@MDate DATETIME,
        //@Description NVARCHAR(250),
        //@Status TINYINT,
        //@IsBankQueryNr NVARCHAR(50) = NULL,
        //@SIDBank NVARCHAR(50) = NULL,
        //@IsProcess BIT = 0,
        //@CompanyBankAccountID NVARCHAR(50)
        //AS
        //BEGIN
        //    BEGIN TRY
        //        UPDATE CompanyWithdrawalRequests
        //        SET
        //            MUser = @MUser,
        //            MDate = IIF(@MDate IS NULL, GETDATE(), @MDate),
        //            Description = @Description,
        //            Status = @Status,
        //            IsBankQueryNr = @IsBankQueryNr,
        //            SIDBank = @SIDBank,
        //            IsProcess = @IsProcess,
        //            CompanyBankAccountID = @CompanyBankAccountID
        //        WHERE
        //            ID = @ID
        //            AND Status in (1,2)

        //        IF @@ROWCOUNT > 0 AND @Status IN(2, 3)
        //        BEGIN
        //            IF @Status = 2
        //            BEGIN
        //                INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission, CompanyCommissionRate)
        //                SELECT
        //                    ID,
        //                    GETDATE(),
        //                    IDCompany,
        //                    '30',
        //                    MDate,
        //                    TransactionNr,
        //                    IDBank,
        //                    Amount,
        //                    0,
        //                    CostTotal,
        //                    Amount + CostTotal,
        //                    0,
        //                    0
        //                FROM
        //                    CompanyWithdrawalRequests
        //                WHERE
        //                    ID = @ID
        //            END
        //            ELSE IF @Status = 3
        //            BEGIN
        //                UPDATE Companies
        //                SET UsingBalance += T.Total
        //                FROM
        //                    (SELECT IDCompany, (Amount + CostTotal) AS Total FROM CompanyWithdrawalRequests WHERE ID = @ID) T
        //                WHERE
        //                    Companies.ID = T.IDCompany

        //                DELETE FROM CompanyTransactions WHERE ID = @ID
        //            END
        //        END

        //        SELECT @IDOut = @ID
        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE, 16, 1)
        //    END CATCH
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 04.04.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.AccountSummaries
        //ADD CreditCardPoolBalance decimal (18, 2) DEFAULT 0 NOT NULL,
        //ADD FraudPoolBalance decimal (18, 2) DEFAULT 0 NOT NULL,
        //ADD FraudExpenseProfitAmount decimal (18, 2) DEFAULT 0 NOT NULL

        //GO

        //ALTER Proc[dbo].[AccountSummaries_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@Profit decimal (18,2),
        //@ExpenseAmount decimal (18,2),
        //@Difference decimal (18,2),
        //@PaymentNotificationProfit decimal (18,2),
        //@CreditCardPaymentNotificationProfit decimal (18,2),
        //@WithdrawalRequestProfit decimal (18,2),
        //@DealerTotalBalance decimal (18,2),
        //@UnmatchedPaymentNotificationBalance decimal (18,2),
        //@NetAmount decimal (18,2),
        //@IncomeAmount decimal (18,2),
        //@IsMonthly bit = null,
        //@RebateExpenseProfitAmount decimal (18,2),
        //@Month int = null,
        //@Year int = null,
        //@CreditCardPoolBalance decimal (18,2) = 0,
        //@FraudPoolBalance decimal (18,2) = 0,
        //@FraudExpenseProfitAmount decimal (18,2) = 0
        //AS
        //BEGIN

        //BEGIN TRY


        //SET @IDOut = NEWID()

        //INSERT INTO AccountSummaries(ID, CUser, CDate, Profit, ExpenseAmount, Difference,
        //PaymentNotificationProfit, CreditCardPaymentNotificationProfit,
        //WithdrawalRequestProfit, DealerTotalBalance, UnmatchedPaymentNotificationBalance, NetAmount,
        //IncomeAmount, IsMonthly, RebateExpenseProfitAmount, Month, Year, CreditCardPoolBalance,
        //FraudPoolBalance, FraudExpenseProfitAmount)

        //VALUES(@IDOut, @CUser, @CDate, @Profit, @ExpenseAmount, @Difference,
        //@PaymentNotificationProfit, @CreditCardPaymentNotificationProfit,
        //@WithdrawalRequestProfit, @DealerTotalBalance, @UnmatchedPaymentNotificationBalance, @NetAmount,
        //@IncomeAmount, @IsMonthly, @RebateExpenseProfitAmount, @Month, @Year, @CreditCardPoolBalance,
        //@FraudPoolBalance, @FraudExpenseProfitAmount

        //)

        //SELECT @IDOut
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //CREATE TABLE dbo.PaymentsAdminAction(
        //    ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    MDate datetime NOT NULL,
        // MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    EntityID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    EntityActionType nvarchar(20) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    AdminAction nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CONSTRAINT PK_PaymentsAdminAction PRIMARY KEY(ID)
        //);

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime = null,
        //@MUser nvarchar(50) = null,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@TransactionReferenceCode nvarchar(30),
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //        IF @Status<> 6 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=6 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=1 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=5
        //  BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Bu bildirim daha önce cevaplanmıştır.'
        //   RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE

        //        BEGIN
        //            UPDATE CreditCardPaymentNotifications SET MDate= IIF(@MDate is null, GETDATE(), @MDate), Description=@Description, Status=@Status, 
        //   TransactionReferenceCode = @TransactionReferenceCode, MUser = @MUser, PaymentInstitutionCommissionRate = @PaymentInstitutionCommissionRate,
        //   PaymentInstitutionNetAmount = @PaymentInstitutionNetAmount WHERE ID=@ID
        //            AND(Status= 1 OR Status = 5 OR @Status = 6 OR Status = 6)

        //            SELECT @IDOut = @ID

        //        END

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyBankAccounts_TotalCreditCardSum]
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(50),
        //@StartDate date = null,
        //@EndDate date = null
        //AS
        //BEGIN


        //DECLARE @Counter INT = 1;
        //DECLARE @MaxCount INT;
        //SELECT @MaxCount = COUNT(*) FROM PaymentInstitutions WHERE Show = 1

        //CREATE TABLE #TempResults
        //(
        //    ID NVARCHAR(50),
        //    Amount DECIMAL(18, 2),
        //    CreditCardAmount DECIMAL(18, 2),
        //    EftAmount DECIMAL(18, 2),
        //    NetAmount DECIMAL(18, 2),
        //    CountNetAmount INT,
        //    Name NVARCHAR(200),
        //    UseForForeignCard BIT
        //);

        //        WHILE @Counter <= @MaxCount
        //        BEGIN
        //    DECLARE @CurrentID NVARCHAR(50);
        //        DECLARE @Name NVARCHAR(200);
        //        DECLARE @UseForForeignCard BIT;

        //    SELECT @CurrentID = ID, @Name = Name, @UseForForeignCard = UseForForeignCard
        //    FROM(
        //        SELECT ID, Name, UseForForeignCard, ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS RowNum
        //        FROM PaymentInstitutions
        //        WHERE Show = 1
        //    ) AS RowNumbered
        //    WHERE RowNum = @Counter;

        //        IF @CurrentID = 6

        //    BEGIN
        //        INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount)
        //    SELECT TOP(1)
        //        @CurrentID AS ID,
        //        isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //        @Name AS Name,
        //        @UseForForeignCard AS UseForForeignCard,
        //        0 AS CreditCardAmount,
        //        isnull(CountNetAmountToday, 0) - isnull(Piece,0) AS EftAmount,
        //        isnull(sumT.NetAmountTotal, 0) AS NetAmount,
        //        isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount
        //    FROM
        //    (
        //        SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //               SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //        FROM (
        //            SELECT sum(Amount) AS Amount,
        //                   CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                   CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                   SUM(isnull(Piece,0)) AS Piece
        //            FROM CompanyFinanceTransaction
        //            WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2
        //            GROUP BY TransactionType
        //        ) AS Total
        //    ) AS AmountTotal
        //    LEFT JOIN(
        //        SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //               SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //               SUM(NetAmountTotal) AS NetAmountTotal,
        //               SUM(CountNetAmount) AS CountNetAmount,
        //               SUM(CountNetAmountToday) AS CountNetAmountToday
        //        FROM (
        //            SELECT sum(Total) + isnull(ccPool.Amount,0) AS NetAmountTotal,
        //                    sum((Total - isnull(t.CompanyCommission, 0))) + isnull(ccPool.Amount,0) AS NetAmount,
        //                       count((Total)) + isnull(RebateCount,0) AS CountNetAmount,
        //                    count(CASE WHEN CONVERT(DATE, t.TransactionDate) = CONVERT(DATE, GETDATE()) THEN 1 ELSE NULL END) + isnull(RebateCount,0) AS CountNetAmountToday,
        //                   (isnull(cr.Amount, 0) - isnull(cr.CompanyCommission, 0)) AS ExpenseNetAmount
        //            FROM CompanyTransactions t
        //            LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //            CROSS JOIN(
        //                SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                       sum(cr.Amount) AS Amount,
        //                       count(cr.Amount) AS RebateCount
        //                FROM CompanyRebateRequests cr
        //                INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //                INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //                INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //     AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //            ) cr

        //            CROSS JOIN(
        //                SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                From CreditCardPaymentNotifications cpn
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND cpn.Status in (5,6) AND cpn.TransactionReferenceCode is not null AND cpn.PaymentInstitutionNetAmount is not null 
        //                AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) ccPool

        //            WHERE IDActionType IN(100,110) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //            AND(@EndDate IS NULL OR CAST(TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //            GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount
        //        ) AS AmountTotal
        //    ) AS sumT ON sumT.ID = @CurrentID
        //    END

        //    ELSE
        //        BEGIN

        //            INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount)
        //    SELECT TOP(1)
        //        @CurrentID AS ID,
        //        isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //        @Name AS Name,
        //        @UseForForeignCard AS UseForForeignCard,
        //        0 AS CreditCardAmount,
        //        0 AS EftAmount,
        //        isnull(sumT.NetAmount, 0) AS NetAmount,
        //       isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount
        //    FROM
        //    (
        //        SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //               SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //        FROM (
        //            SELECT sum(Amount) AS Amount,
        //                   CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                   CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                   SUM(isnull(Piece,0)) AS Piece

        //                FROM CompanyFinanceTransaction

        //                WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2

        //                GROUP BY TransactionType
        //         ) AS Total
        //     ) AS AmountTotal
        //    LEFT JOIN(
        //            SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //                   SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //                   SUM(CountNetAmount) AS CountNetAmount
        //            FROM (
        //                SELECT sum(ISNULL((Total - isnull(t.CompanyCommission,0)),0)) + isnull(ccPool.Amount,0) AS NetAmount,
        //                       count((NetTotal)) + isnull(RebateCount,0) AS CountNetAmount,
        //                    (isnull(cr.Amount, 0) - isnull(cr.CompanyCommission, 0)) AS ExpenseNetAmount

        //                FROM CompanyTransactions t
        //                LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //                CROSS JOIN(
        //                    SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                           sum(cr.Amount) AS Amount,
        //                           count(cr.Amount) AS RebateCount
        //                    FROM CompanyRebateRequests cr

        //                    INNER JOIN CompanyTransactions t ON t.ID = cr.ID

        //                    INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID

        //                    INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID

        //                    WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //            AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) cr

        //                CROSS JOIN(
        //                SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                From CreditCardPaymentNotifications cpn
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID
        //                AND cpn.Status in (5,6) AND cpn.TransactionReferenceCode is not null 
        //                AND cpn.PaymentInstitutionNetAmount is not null 
        //                AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) ccPool

        //                WHERE IDActionType IN(100,110) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID

        //                GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount

        //               ) AS AmountTotal
        //     ) AS sumT ON sumT.ID = @CurrentID
        //        END
        //    SET @Counter = @Counter + 1;
        //        END;

        //SELECT* FROM #TempResults ORDER BY ID;
        //DROP TABLE #TempResults;

        //END

        //GO    

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetCreditCardTransactions]
        //@PaymentInstitutionID NVARCHAR(10) = NULL,
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords INT
        //    DECLARE @totalNegativeBalance decimal (18, 4) = 0	
        //    DECLARE @totalPositiveBalance decimal (18, 4) = 0
        //    DECLARE @skippedAmount DECIMAL(18, 4) = 0  		
        //    DECLARE @ccPool decimal (18, 4)
        //    DECLARE @result decimal (18, 4)

        // select @ccPool = ISNULL(SUM(cpn.PaymentInstitutionNetAmount), 0)

        //            FROM CreditCardPaymentNotifications cpn
        //            WHERE cpn.CreditCardPaymentMethodID = @PaymentInstitutionID
        //            AND cpn.Status in (5,6)
        //   --AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //   AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))



        // SELECT @result = ISNULL(SUM((Total - ISNULL(t.CompanyCommission, 0))) - cft.ExpenseAmount - cr.ExpenseAmountRebate, 0)
        //    FROM CompanyTransactions t
        //    INNER JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID

        //    cross join(SELECT ISNULL(sum(t.Amount),0) AS ExpenseAmount
        //    FROM CompanyFinanceTransaction t
        //    INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //    INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2
        //    WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //    AND t.PaymentMethod = 2 AND t.TransactionType = 2
        //    AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //    ) as cft

        //    cross join(SELECT ISNULL(sum((isnull(t2.Total,0) - isnull(t2.CompanyCommission,0))),0) AS ExpenseAmountRebate
        //    FROM CompanyRebateRequests cr
        //    INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //    INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //    INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //    INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //    WHERE cr.Status = 2 and cpn.Status = 2
        //    AND (cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //    ) as cr

        //    WHERE 1 = 1
        //        AND t.IDActionType IN (100, 110)
        //        AND(cs.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //        AND cs.Status = 2
        //        --AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //    GROUP BY cft.ExpenseAmount, cr.ExpenseAmountRebate

        //    CREATE TABLE #TempTable (
        //        TransactionDate DATETIME,
        //        PaymentInstitutionID NVARCHAR(10),
        //        SenderName NVARCHAR(MAX),
        //        Amount DECIMAL(18, 4),
        //        PaymentInstitutionName NVARCHAR(MAX),
        //        Description NVARCHAR(MAX),
        //        TotalBalance DECIMAL(18, 4),
        //        IsPositiveBalance tinyint,
        //    )

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate,
        //        cs.CreditCardPaymentMethodID,
        //        cs.SenderName,
        //        (isnull(t.Total,0) - isnull(t.CompanyCommission,0)) as Amount, 
        //        pins.Name as PaymentInstitutionName, 
        //        cs.Description,
        //        0,
        //        1
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID
        //    INNER JOIN PaymentInstitutions pins ON cs.CreditCardPaymentMethodID = pins.ID
        //    WHERE t.IDActionType IN(100,110) and cs.Status = 2
        //    AND (cs.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        // GROUP BY t.TransactionDate, cs.CreditCardPaymentMethodID, cs.SenderName,t.Total,t.CompanyCommission, pins.Name, cs.Description

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //    SELECT

        //           cpn.MDate, 
        //        cpn.CreditCardPaymentMethodID, 
        //        cpn.SenderName, 
        //        isnull(cpn.PaymentInstitutionNetAmount,0),
        //        pins.Name as PaymentInstitutionName, 
        //        N'Manuel Kredi Kartı Ödeme Havuzunda' as Description,
        //        0,
        //        1
        //    FROM CreditCardPaymentNotifications cpn
        //    INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //    WHERE cpn.Status = 5
        //    AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //    SELECT
        //           cpn.MDate,
        //        cpn.CreditCardPaymentMethodID,
        //        cpn.SenderName,
        //        isnull(cpn.PaymentInstitutionNetAmount,0),
        //        pins.Name as PaymentInstitutionName, 
        //        N'Fraud Havuzunda' as Description,
        //        0,
        //        1
        //    FROM CreditCardPaymentNotifications cpn
        //    INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //    WHERE cpn.Status = 6
        //    AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate,
        //        cpn.CreditCardPaymentMethodID,
        //        cpn.SenderName,
        //        (isnull(t2.Total,0) - isnull(t2.CompanyCommission,0)),
        //        pins.Name as PaymentInstitutionName, 
        //        N'İade Yapıldı' as Description,
        //        -1,
        //        0
        //    FROM CompanyRebateRequests cr
        //    INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //    INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //    INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //    INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //    WHERE cr.Status = 2 and cpn.Status = 2
        //    AND (cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate,
        //        t.CompanyIntegrationType,
        //        cba.Name,
        //        t.Amount,
        //        pins.Name as PaymentInstitutionName,
        //        cba.Name + N' Bankasına Çıkış Yapıldı' as Description,
        //        -1,
        //        0
        //    FROM CompanyFinanceTransaction t
        //    INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //    INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2
        //    WHERE
        //    t.CompanyIntegrationType = @PaymentInstitutionID
        //    AND t.PaymentMethod = 2 AND t.TransactionType = 2
        //    AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        // GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount


        //    SELECT @totalRecords = COUNT(*) FROM #TempTable
        //    select @totalNegativeBalance = ISNULL(SUM(Amount), 0) from #TempTable where IsPositiveBalance = 0 and TotalBalance >= 0
        //    select @totalPositiveBalance = @result + @ccPool

        //       IF @OffsetValue<> 0
        //    BEGIN
        //        SELECT @totalPositiveBalance = @totalPositiveBalance + ISNULL(SUM(CASE WHEN IsPositiveBalance = 1 THEN Amount * -1 ELSE Amount END), 0)
        //     FROM(
        //            SELECT Amount, IsPositiveBalance, ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum

        //            FROM #TempTable
        //     ) AS SubQuery

        //        WHERE RowNum <= @OffsetValue
        //    END


        //    SELECT TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, @totalPositiveBalance - @totalNegativeBalance  as TotalBalance, IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable
        //    ORDER BY TransactionDate DESC
        //    OFFSET @OffsetValue ROWS
        //    FETCH NEXT @PageLength ROWS ONLY


        //    DROP TABLE #TempTable

        //END

        //GO

        //CREATE PROCEDURE[dbo].[CompanyTransactions_GetDealerFraudPool]
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@IDCompany NVARCHAR(50),
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords INT

        //    CREATE TABLE #TempTable (
        //        ID NVARCHAR(50),
        //        CDate DATETIME,
        //        MDate DATETIME,
        //        PaymentMethodType TINYINT,
        //        TransactionID NVARCHAR(50),
        //        TransactionNr NVARCHAR(50),
        //        Description NVARCHAR(500),
        //        Amount DECIMAL(18, 4),
        //        PaymentInstitutionName NVARCHAR(50),
        //        SenderName NVARCHAR(500),
        //        MemberName NVARCHAR(500),
        //        IDCompany NVARCHAR(50),
        //        CompanyPhone NVARCHAR(50),
        //        MemberPhone NVARCHAR(50),
        //        Company NVARCHAR(500),
        //        CardNumber NVARCHAR(50),
        //        MUser NVARCHAR(50),
        //        MUserName NVARCHAR(50),
        //        PaymentInstitutionNetAmount DECIMAL(18, 4), 
        //        DealerCommission DECIMAL(18, 4)
        //    )

        //    INSERT INTO #TempTable (ID, CDate, MDate, PaymentMethodType, TransactionID, TransactionNr, Description, Amount, 
        //    PaymentInstitutionName, SenderName,MemberName,IDCompany, CompanyPhone, MemberPhone,Company,CardNumber, Muser , MUserName, PaymentInstitutionNetAmount, DealerCommission)

        //    SELECT ccpn.ID, ccpn.CDate, ccpn.MDate, 2, ccpn.TransactionID, ccpn.TransactionNr, ccpn.Description, ccpn.Amount,
        //       pins.Name, ccpn.SenderName, m.Name, c.ID, c.Phone, m.Phone, c.Title, ccpn.CardNumber, ccpn.MUser, a.Name, ISNULL(ccpn.PaymentInstitutionNetAmount,0),  ISNULL(ccpn.Commission,0)
        //    FROM CreditCardPaymentNotifications  ccpn
        //    INNER JOIN PaymentInstitutions pins ON pins.ID=CreditCardPaymentMethodID
        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID=ccpn.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID
        //    INNER JOIN Members m ON m.ID= IDMember
        //    LEFT JOIN Administrators a ON a.ID= ccpn.MUser
        //    WHERE Status in (6,7) 
        //    AND(@IDCompany IS NULL OR c.ID = @IDCompany)
        //    AND(@StartDate IS NULL OR CAST(ccpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(ccpn.MDate AS DATE) <= CAST(@EndDate AS DATE))


        //    INSERT INTO #TempTable (ID, CDate, MDate, PaymentMethodType, TransactionID, TransactionNr, Description, 
        //    Amount, PaymentInstitutionName, SenderName,MemberName,IDCompany, CompanyPhone, MemberPhone, Company,CardNumber, Muser , MUserName, PaymentInstitutionNetAmount, DealerCommission)
        //    SELECT pn.ID, pn.CDate, pn.MDate, 1, pn.TransactionID, pn.TransactionNr, pn.Description,
        //    pn.Amount, cba.Name, pn.SenderName, m.Name, c.ID, c.Phone, m.Phone, c.Title, null, pn.MUser, a.Name, pn.Amount, ROUND((pn.Amount - (pn.Amount* cc.TransferRate/100)), 4)

        // FROM PaymentNotifications pn
        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID
        //    INNER JOIN CompanyBankAccounts cba ON CompanyBankAccountID = cba.ID
        //    INNER JOIN Members m ON m.ID= pn.IDMember
        //       INNER JOIN CompanyCommissions cc ON cc.ID=ci.ID
        //    LEFT JOIN Administrators a ON a.ID= pn.MUser

        //    WHERE Status in (6,7) 
        //    AND(@IDCompany IS NULL OR c.ID = @IDCompany)
        //    AND(@StartDate IS NULL OR CAST(pn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(pn.MDate AS DATE) <= CAST(@EndDate AS DATE))


        // SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // ORDER BY MDate DESC
        //    OFFSET @OffsetValue ROWS


        //    DROP TABLE #TempTable

        //END

        //GO

        //CREATE Proc[dbo].[CompanyTransactions_SetStatusToFraud]
        //@IDOut nvarchar(50) output,
        //@EntityID nvarchar(50),
        //@IDCompany nvarchar(50),
        //@MDate datetime = null,
        //@MUser nvarchar(50) = null,
        //@Description nvarchar(250),
        //@EntityActionType nvarchar(20),
        //@Status tinyint,
        //@AdminAction nvarchar(500)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //        declare @netTotal decimal (18,2);
        //  declare @isNotBocked decimal (18,2);
        //  declare @blockedDate date;
        //  declare @entityStatus tinyint;

        //  If @EntityActionType = ('10,20')

        //        Begin
        //            IF(select Status from PaymentNotifications where ID = @EntityID)=2
        //   BEGIN
        //                UPDATE PaymentNotifications SET Status = @Status, MDate = @MDate , MUser = @MUser, Description = @Description where ID=@EntityID AND Status = 2

        //    INSERT INTO PaymentsAdminAction
        //                (ID, MDate, MUser, EntityID, EntityActionType, AdminAction)

        //                VALUES(NEWID(), @MDate , @MUser, @EntityID, @EntityActionType, @AdminAction);

        //        select @netTotal = [dbo].RoundToZero(NetTotal) FROM CompanyTransactions where ID = @EntityID


        //                UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@IDCompany

        //                DELETE FROM CompanyTransactions WHERE ID = @EntityID



        //                SELECT @IDOut = @EntityID

        //            END

        //            ELSE

        //            BEGIN
        //                SET @CUSTOMERRORMESSAGE += N'Onaylı Durumda Olmayan İşlem Fraud Olarak Güncellenemez'
        //    RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //            END

        //        End


        //        Else If @EntityActionType = ('100,110')	
        //  Begin

        //            select @blockedDate = BlockedDate, @isNotBocked = ISNULL(IsNotBocked, 0), @entityStatus = Status FROM CreditCardPaymentNotifications where ID=@EntityID AND Status = 2

        //   IF @entityStatus = 2

        //            BEGIN

        //                select @netTotal = [dbo].RoundToZero(NetTotal) FROM CompanyTransactions where ID = @EntityID


        //                UPDATE CreditCardPaymentNotifications SET Status = @Status, MDate = @MDate, MUser = @MUser,
        //                Description = @Description, Commission = @netTotal where ID = @EntityID AND Status = 2


        //                UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@IDCompany and @isNotBocked = 1

        //    DELETE FROM CompanyTransactions WHERE ID=@EntityID

        //                INSERT INTO PaymentsAdminAction
        //                (ID, MDate, MUser, EntityID, EntityActionType, AdminAction)

        //                VALUES(NEWID(), @MDate , @MUser, @EntityID, @EntityActionType, @AdminAction);

        //        SELECT @IDOut = @EntityID

        //            END

        //            ELSE

        //            BEGIN
        //                SET @CUSTOMERRORMESSAGE += N'Onaylı Durumda Olmayan İşlem Fraud Olarak Güncellenemez'
        //    RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //            END
        //        End



        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //        ALTER Proc[dbo].[CompanyTransactions_GetAccountReportv2]
        //        @IDCompany nvarchar(50),
        //        @StartDate datetime,
        //        @EndDate datetime
        //        AS
        //        BEGIN

        //        SELECT top 100 
        //        isnull(sumT.TransferTotalAmount,0) as TransferTotalAmount ,
        //        isnull(sumTr.CompanyCommission,0) as TransferCommissionProfitAmount,
        //        isnull(sumTr.TransferDealerPaidAmount,0) as TransferDealerPaidAmount,
        //        isnull(sumTrPool.Amount,0) as TransferNotMatchedAmount,

        //        isnull(sumT.CreditCardTotalAmount,0) as CreditCardTotalAmount,
        //        isnull(sumCr.CompanyCommission,0) as CreditCardCommissionProfitAmount,
        //        isnull(sumCr.CreditCardDealerPaidAmount,0) as CreditCardDealerPaidAmount,
        //        isnull(sumCr.CreditCardPaymentInstitutionPaidAmount,0) as CreditCardPaymentInstitutionPaidAmount,              

        //        isnull(sumWt.WithdrawalTotalAmount,0) as WithdrawalTotalAmount, 
        //        isnull(sumWt.WithdrawalTotalPaidAmount,0) as WithdrawalTotalPaidAmount, 
        //        isnull(sumWt.WithdrawalTotalTransactionFeeAmount,0) as WithdrawalTotalTransactionFeeAmount, 
        //        isnull(sumEft.Amount,0) as WithdrawalEftAmount, 
        //        isnull(sumFast.Amount,0) as WithdrawalFastAmount, 

        //       	isnull(sumRebate.Amount,0) as RebateExpenseProfitAmount, 
        //       	isnull(sumFraud.Amount,0) as FraudExpenseProfitAmount, 
        //        isnull(sumEx.Amount,0) as TotalExpenseAmount,
        //        isnull(sumIncome.Amount,0) as TotalIncomeAmount

        //        FROM CompanyTransactions t

        //        cross join(Select SUM(CASE WHEN t.IDActionType IN (10, 20,150) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS TransferTotalAmount,
        //        SUM(CASE WHEN t.IDActionType IN(100, 110) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS CreditCardTotalAmount From CompanyTransactions

        //        t where IDActionType IN(10,20,100,110,150)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //--        cross join(Select sum([dbo].RoundToZero(Commission)) as Commission From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumC

        //        cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as CompanyCommission, 
        //        sum([dbo].RoundToZero(NetTotal)) as CreditCardDealerPaidAmount, 
        //        sum([dbo].RoundToZero(CompanyCommission)) as CreditCardPaymentInstitutionPaidAmount
        //        From CompanyTransactions t where IDActionType IN(100,110)
        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumCr

        //        cross join(Select sum([dbo].RoundToZero(Commission)) as CompanyCommission, sum([dbo].RoundToZero(NetTotal)) AS TransferDealerPaidAmount

        //        From CompanyTransactions t where IDActionType IN(10,20,150)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumTr

        //--        cross join(Select sum([dbo].RoundToZero(NetTotal)) as NetTotal From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumNet

        //        cross join(Select sum([dbo].RoundToZero(t.Total + t.CostTotal)) as WithdrawalTotalAmount,
        //        sum([dbo].RoundToZero(t.Total)) as WithdrawalTotalPaidAmount,
        //        sum([dbo].RoundToZero(t.CostTotal)) as WithdrawalTotalTransactionFeeAmount

        //        From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumWt

        //        cross join(select sum(ROUND(
        //        CASE WHEN ct.Commission = ct.CompanyCommission THEN 0
        //             ELSE (ct.CompanyCommission )
        //        END, 4)) as Amount
        //        From CompanyRebateRequests r
        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID

        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID

        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)

        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID

        //           where r.Status = 2
        //        and (@IDCompany IS NULL OR ct.IDCompany= @IDCompany)
        //        and(CAST(ct2.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(ct2.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumRebate

        //        cross join(select sum([dbo].RoundToZero(r.PaymentInstitutionNetAmount - r.Commission)) as Amount
        //        From CreditCardPaymentNotifications r

        //           INNER JOIN CompanyIntegrations ci on ci.ServiceID = r.ServiceID
        //           where r.Status in (6,7) AND r.PaymentInstitutionNetAmount is not null 
        //        and (@IDCompany IS NULL OR ci.ID= @IDCompany)
        //        and(CAST(r.MDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(r.MDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFraud


        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast

        //--        cross join(Select sum([dbo].RoundToZero(cw.CostTotal)) as CostTotal , Count(cw.Amount) as cwCostTotal From CompanyTransactions t
        //--
        //--        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //--        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcess

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 2

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1 ) as sumEx

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 1

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1  ) as sumIncome

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From PaymentTransferPools t

        //        where t.Status = 1 
        //        AND NOT EXISTS (select* from WhereConditions wc
        //        WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //        (wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //        AND t.Amount > 0 


        //		) as sumTrPool

        //        --WHERE(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        // --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)))
        //        --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)))


        //        END



        //------------------------------------------------------- 24.04.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[CompanyAutoNotificationSettings_GetSingleByIDCompany]
        //@IDCompany nvarchar(50)
        //AS
        //BEGIN

        //    SELECT*, ci.ServiceID as ServiceID, c.AutoTransferLimit as AutoTransferLimit FROM CompanyAutoNotificationSettings
        //    Inner Join CompanyIntegrations ci on ci.ID = IDCompany
        //    Inner Join Companies c on c.ID = IDCompany
        //    WHERE IDCompany=@IDCompany
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 30.04.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetMonthlyAccountSummary]
        //@DailyReportStartDateTime datetime,
        //@DailyReportEndDateTime datetime,
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime,
        //@WeeklyReportStartDateTime datetime,
        //@WeeklyReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //    SELECT
        //        ccpn.CreditCardPaymentMethodID AS CreditCardPaymentMethodID,
        //        [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //    SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //    WHERE t.IDActionType IN(100, 110)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ccpn.CreditCardPaymentMethodID
        //),

        //PaymentTransferPoolCTE AS(
        //    SELECT
        //        t.IDBank AS PaymentTranferPoolBankID,
        //        [dbo].RoundToZero(SUM(t.Amount)) AS PaymentTranferPoolSumTotal,
        //    [dbo].RoundToZero(SUM(ct.Commission)) AS PaymentNotificationProfitAmount
        //    FROM PaymentTransferPools t
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionNr = t.ResponseTransactionNr
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = pn.ID
        //    WHERE t.Status = 2
        //        AND ct.TransactionDate >= @ReportStartDateTime
        //        AND ct.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDBank
        //),

        //WithdrawalRequestCTE AS(
        //    SELECT
        //        cwr.SIDBank AS WithdrawalRequestSIDBank,
        //        [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //        SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit
        //FROM CompanyTransactions t
        //LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //WHERE t.IDActionType = '30'
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY cwr.SIDBank
        //),

        //PaymentNotificationCTE AS(
        //    SELECT
        //        ptp.IDBank AS PaymentNotificationSIDBank,
        //        [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationTotalAmount
        //    FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //    LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //    WHERE t.IDActionType IN(10, 20, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ptp.IDBank
        //),

        //DateRangeQueryCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @DailyReportStartDateTime
        //    AND TransactionDate <= @DailyReportEndDateTime THEN Total ELSE 0 END)) AS DailyTotalPaymentAmount,

        //    [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @WeeklyReportStartDateTime
        //    AND TransactionDate <= @WeeklyReportEndDateTime THEN Total ELSE 0 END)) AS WeeklyTotalPaymentAmount,

        //    [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @ReportStartDateTime
        //        AND TransactionDate <= @ReportEndDateTime THEN Total ELSE 0 END)) AS MonthlyTotalPaymentAmount

        //    FROM CompanyTransactions

        //    WHERE IDActionType IN(10, 20, 100, 110,150)
        //),

        //CompanyTransactionCTE AS(
        //    SELECT
        //        t.IDCompany AS IDCompany,
        //        [dbo].RoundToZero(SUM(CASE WHEN t.IDActionType<> 30 THEN t.Total ELSE 0 END)) AS CompanyTransactionTotalAmount,

        //           [dbo].RoundToZero(SUM(t.Commission - t.CompanyCommission) + SUM(t.CostTotal)) AS CompanyTransactionProfit,
        //        [dbo].RoundToZero(SUM(CASE WHEN t.IDActionType = 30 THEN t.Total ELSE 0 END)) AS CompanyWithdrawalTransactionTotalAmount,
        //        [dbo].RoundToZero(SUM(CASE WHEN t.IDActionType = 30 THEN 1 ELSE 0 END)) AS CompanyWithdrawalTransactionCount
        //    FROM CompanyTransactions t
        //    INNER JOIN Companies c on c.ID = t.IDCompany
        //    WHERE t.IDActionType IN(10, 20, 30, 100, 110, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDCompany
        //),

        //RebateRequestCTE AS(
        //    SELECT
        //    sum([dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal) as RebateNetAmount
        //    From CompanyRebateRequests r
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //    LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //    LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)
        //    LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //    WHERE ct2.IDActionType IN (90)
        //        AND ct2.TransactionDate >= @ReportStartDateTime
        //        AND ct2.TransactionDate <= @ReportEndDateTime
        //)

        //SELECT
        //    CreditCardCTE.CreditCardPaymentMethodID,
        //    CreditCardCTE.CreditCardSumTotal,
        //    CreditCardCTE.CreditCardProfit,
        //    PaymentTransferPoolCTE.PaymentTranferPoolBankID,
        //    PaymentTransferPoolCTE.PaymentTranferPoolSumTotal,
        //    WithdrawalRequestCTE.WithdrawalRequestSIDBank,
        //    WithdrawalRequestCTE.WithdrawalRequestTotalAmount,
        //    WithdrawalRequestCTE.WithdrawalRequestProfit,
        //    PaymentNotificationCTE.PaymentNotificationSIDBank,
        //    PaymentNotificationCTE.PaymentNotificationTotalAmount,
        //    DateRangeQueryCTE.DailyTotalPaymentAmount,
        //    DateRangeQueryCTE.WeeklyTotalPaymentAmount,
        //    DateRangeQueryCTE.MonthlyTotalPaymentAmount,
        //    CompanyTransactionCTE.IDCompany,
        //    CompanyTransactionCTE.CompanyTransactionTotalAmount,
        //    CompanyTransactionCTE.CompanyTransactionProfit,
        //    CompanyTransactionCTE.CompanyWithdrawalTransactionTotalAmount,
        //    CompanyTransactionCTE.CompanyWithdrawalTransactionCount,
        //    RebateRequestCTE.RebateNetAmount
        //FROM CreditCardCTE
        //FULL JOIN PaymentTransferPoolCTE ON 1 = 0
        //FULL JOIN WithdrawalRequestCTE ON 1 = 0
        //FULL JOIN PaymentNotificationCTE ON 1 = 0
        //FULL JOIN DateRangeQueryCTE ON 1 = 0
        //FULL JOIN CompanyTransactionCTE ON 1 = 0
        //FULL JOIN RebateRequestCTE ON 1 = 0;
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 07.05.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE TABLE dbo.WithdrawalPools(
        //    ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CDate datetime NOT NULL,
        // MDate datetime NULL,
        // TransactionDate datetime NOT NULL,
        //    IDBank nvarchar(2) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    ReceiverName nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    ReceiverIban nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // Amount decimal (18,2) NOT NULL,
        //    TransactionKey nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    Description nvarchar(250) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    Status tinyint NOT NULL,
        // ResponseDescription nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // ResponseTransactionNr nvarchar(24) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // ResponseRequestNr nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // CompanyBankAccountID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // IDCompany nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // CONSTRAINT PK_WithdrawalPools PRIMARY KEY(ID, TransactionKey)
        //);

        //GO

        //CREATE Proc[dbo].[WithdrawalPools_GetList]
        //@Status tinyint = null,
        //@StartDate date,
        //@EndDate date,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IDBank nvarchar(10) = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT* from WithdrawalPools r

        //WHERE 1=1
        //AND(@IDBank IS NULL OR r.IDBank= @IDBank)
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS date)>=CAST(@StartDate AS date))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS date)<=CAST(@EndDate AS date))
        //AND(@SearchValue IS NULL OR  (r.ReceiverName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  
        //OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR r.Description LIKE '%' + @SearchValue + '%'   ))


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLength ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //CREATE Proc[dbo].[WithdrawalPools_GetSingle]
        //@ID nvarchar(50) = null,
        //@TransactionKey nvarchar(100) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //    Select* From WithdrawalPools
        //    where(@ID IS NULL OR ID= @ID) and(@TransactionKey IS NULL OR TransactionKey = @TransactionKey)


        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //CREATE Proc[dbo].[WithdrawalPools_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@TransactionDate datetime,
        //@IDBank nvarchar(2),
        //@ReceiverName nvarchar(100),
        //@Amount decimal (18,2),
        //@Description nvarchar(500),
        //@Status tinyint,
        //@ReceiverIBAN nvarchar(250),
        //@TransactionKey nvarchar(50),
        //@CompanyBankAccountID nvarchar(50),
        //@ResponseDescription nvarchar(50) = null,
        //@ResponseTransactionNr nvarchar(50) = null,
        //@ResponseRequestNr nvarchar(50) = null,
        //@IDCompany nvarchar(50) = null
        //AS
        //BEGIN
        //BEGIN TRY

        //    DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //    DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //    SET @IDOut = NEWID();

        //        INSERT INTO WithdrawalPools
        //        (ID, CDate, TransactionDate, IDBank, ReceiverName, ReceiverIban,
        //        Amount, TransactionKey, Description, Status, CompanyBankAccountID)

        //    VALUES(@IDOut, @CDate, @TransactionDate, @IDBank, @ReceiverName, @ReceiverIBAN, @Amount, @TransactionKey, @Description, @Status, @CompanyBankAccountID);

        //        END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //CREATE PROCEDURE[dbo].[WithdrawalPools_SetStatus]
        //@IDOut NVARCHAR(50) OUTPUT,
        //@ID NVARCHAR(50),
        //@MDate DATETIME,
        //@ResponseRequestNr NVARCHAR(50),
        //@ResponseTransactionNr NVARCHAR(50),
        //@Status TINYINT,
        //@IDCompany NVARCHAR(50)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        UPDATE WithdrawalPools
        //        SET
        //            MDate = IIF(@MDate IS NULL, GETDATE(), @MDate),
        //            ResponseRequestNr = @ResponseRequestNr,
        //               ResponseTransactionNr = @ResponseTransactionNr,
        //            Status = @Status,
        //            IDCompany = @IDCompany
        //        WHERE ID = @ID AND Status = 1

        //        SELECT @IDOut = @ID


        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE, 16, 1)
        //    END CATCH
        //END


        //GO

        //GÜNCELLENDİ

        //------------------------------------------------------- 08.05.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //EXEC sp_rename 'WithdrawalPools.ResponseRequestNr', 'RequestNr', 'COLUMN';

        //GO

        //ALTER TABLE dbo.WithdrawalPools
        //ADD IsRebate bit NOT NULL DEFAULT 0 

        //GO

        //ALTER Proc[dbo].[WithdrawalPools_GetList]
        //@Status tinyint = null,
        //@StartDate date,
        //@EndDate date,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IDBank nvarchar(10) = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT r.* , cba.Name as Bank into #TempTable from WithdrawalPools r
        //inner join CompanyBankAccounts cba on cba.ID = r.CompanyBankAccountID

        //WHERE 1=1
        //AND (@IDBank IS NULL  OR r.IDBank= @IDBank)
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS date)>=CAST(@StartDate AS date))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS date)<=CAST(@EndDate AS date))
        //AND(@SearchValue IS NULL OR  (r.ReceiverName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  
        //OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR r.Description LIKE '%' + @SearchValue + '%'   ))


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLength ROWS ONLY
        //DROP TABLE #TempTable
        //END


        //GO

        //ALTER PROCEDURE[dbo].[WithdrawalPools_SetStatus]
        //@IDOut NVARCHAR(50) OUTPUT,
        //@ID NVARCHAR(50),
        //@MDate DATETIME,
        //@RequestNr NVARCHAR(50),
        //@ResponseTransactionNr NVARCHAR(50),
        //@Status TINYINT,
        //@IDCompany NVARCHAR(50),
        //@IsRebate bit
        //AS
        //BEGIN
        //    BEGIN TRY
        //        UPDATE WithdrawalPools
        //        SET
        //            MDate = IIF(@MDate IS NULL, GETDATE(), @MDate),
        //            RequestNr = @RequestNr,
        //               ResponseTransactionNr = @ResponseTransactionNr,
        //            Status = @Status,
        //            IDCompany = @IDCompany,
        //            IsRebate = @IsRebate
        //        WHERE ID = @ID AND Status = 1

        //        SELECT @IDOut = @ID


        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE, 16, 1)
        //    END CATCH
        //END

        //GO

        //CREATE PROCEDURE[dbo].[GetInProcessWithdrawalAndRebateRequests]

        //AS
        //BEGIN


        //    CREATE TABLE #TempTable (
        //        ID NVARCHAR(50),
        //        MDate DATETIME,
        //        TransactionID NVARCHAR(50),
        //        TransactionNr NVARCHAR(50),
        //        RequestNr NVARCHAR(50),
        //        Title NVARCHAR(MAX),
        //        IsRebate bit,
        //        Amount DECIMAL(18, 4),
        //        Iban NVARCHAR(50),
        //        Description NVARCHAR(MAX),
        //        CompanyBankAccountID NVARCHAR(50),
        //        IDCompany NVARCHAR(50),
        //        SIDBank NVARCHAR(2),
        //    )

        // INSERT INTO #TempTable (ID, MDate, TransactionID, TransactionNr, RequestNr, Title, IsRebate, Amount, Iban, Description, CompanyBankAccountID, IDCompany, SIDBank)
        // SELECT ID, MDate, TransactionNr, TransactionNr, RequestNr, Title, 0 , Amount, IBAN, Description, CompanyBankAccountID, IDCompany, SIDBank
        //    FROM CompanyWithdrawalRequests
        //    WHERE Status = 8 and IsProcess = 1



        //    INSERT INTO #TempTable (ID, MDate, TransactionID, TransactionNr, RequestNr, Title, IsRebate, Amount, Iban, Description, CompanyBankAccountID, IDCompany, SIDBank)
        // SELECT cbr.ID, cbr.MDate, cbr.TransactionID, cbr.TransactionNr, cbr.TransactionNr, cbr.SenderName as Title, 1 , cbr.Amount, pn.Iban as Iban, cbr.Description

        //    , cbr.CompanyBankAccountID, cbr.IDCompany, cbr.SIDBank
        //    FROM CompanyRebateRequests cbr
        //    INNER JOIN PaymentNotifications pn on pn.TransactionID = cbr.TransactionID
        //    WHERE cbr.Status = 8


        //    SELECT* FROM #TempTable
        //    ORDER BY MDate DESC


        //    DROP TABLE #TempTable

        //END

        //------------------------------------------------------- 13.05.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_GetList]
        //@Status tinyint,
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IsProcess bit = null,
        //@SIDBank nvarchar(10) = null,
        //@WithProcess bit = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT r.*, c.Title AS Company, c.Phone, b.Name as Bank, a.Name AS Modifier,
        //cba.Name as SBankName
        //into #TempTable FROM CompanyWithdrawalRequests r
        //INNER JOIN Companies c ON c.ID=r.IDCompany
        //INNER JOIN Banks b ON b.ID= r.IDBank
        //LEFT JOIN CompanyBankAccounts cba on cba.ID = r.CompanyBankAccountID

        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //WHERE 1=1
        //AND (@SIDBank IS NULL OR r.SIDBank = @SIDBank)
        //AND(
        //    -- Status 1 ve WithProcess true ise Status 1 veya 8 olabilir
        //    (@Status = 1 AND @WithProcess = 1 AND (r.Status = 1 OR r.Status = 8))
        //    OR
        //    -- Diğer durumlarda normal filtreleme yapılır
        //    ((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)
        //)

        //AND((@IsProcess IS NULL OR r.IsProcess = 0) OR r.IsProcess = @IsProcess)

        //AND(@IDCompany IS NULL OR r.IDCompany= @IDCompany)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.Title LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER Proc[dbo].[CompanyRebateRequests_GetList]
        //@Status tinyint,
        //@IDCompany nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@PaymentMethod int = 0,
        //@WithProcess bit = null
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT r.*, c.Title AS Company, c.Phone, m.Name AS Member, m.Phone AS MemberPhone, a.Name AS Modifier, pn.Iban as Iban,  
        //COALESCE(pn.ID, cn.ID, fn.ID) as PaymentRecordID into #TempTable FROM CompanyRebateRequests r
        //INNER JOIN Companies c ON c.ID=r.IDCompany
        //INNER JOIN Members m ON m.ID= r.IDMember

        //LEFT JOIN PaymentNotifications pn ON pn.TransactionID= r.TransactionID
        //LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID= r.TransactionID
        //LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID= r.TransactionID
        //LEFT JOIN Administrators a ON a.ID= r.MUser

        //WHERE 1=1 

        //AND (@PaymentMethod = 0 OR (@PaymentMethod = 1 AND pn.Iban is not null) OR(@PaymentMethod = 2 AND pn.Iban is null))
        //AND(
        //    -- Status 1 ve WithProcess true ise Status 1 veya 8 olabilir
        //    (@Status = 1 AND @WithProcess = 1 AND (r.Status = 1 OR r.Status = 8))
        //    OR
        //    -- Diğer durumlarda normal filtreleme yapılır
        //    ((@Status IS NULL AND r.Status IN (2,3)) OR r.Status=@Status OR @Status= 4)
        //)

        //AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //        ALTER Proc[dbo].[Main_GetNotifyCounts]
        //        AS
        //BEGIN


        //        SELECT T2.*, PaymentNotifications + CreditCardPaymentNotifications + ForeignCreditCardPaymentNotifications + CompanyPaymentRequests + MemberPaymentRequests + CompanyWithdrawalRequests + MemberWithdrawalRequests + CompanyRebateRequests +  MemberMoneyTransferRequests + CompanyApplications AS TotalPending FROM (
        //        Select Sum(PaymentNotifications) as PaymentNotifications, Sum(CreditCardPaymentNotifications) as CreditCardPaymentNotifications, Sum(ForeignCreditCardPaymentNotifications) as ForeignCreditCardPaymentNotifications, Sum(CompanyPaymentRequests) as CompanyPaymentRequests, Sum(MemberPaymentRequests) as MemberPaymentRequests, Sum(CompanyWithdrawalRequests) as CompanyWithdrawalRequests, Sum(MemberWithdrawalRequests) as MemberWithdrawalRequests, Sum(CompanyRebateRequests) as CompanyRebateRequests, Sum(MemberMoneyTransferRequests) as MemberMoneyTransferRequests, Sum(CompanyApplications) as CompanyApplications, Sum(Supports) as Supports From (
        //        select Count(*) as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications, 0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from PaymentNotifications where Status= 1

        //        union all

        //        select 0 as PaymentNotifications, Count(*) as CreditCardPaymentNotifications,  0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from CreditCardPaymentNotifications where Status= 1

        //        union all

        //        select 0 as PaymentNotifications,  0 as CreditCardPaymentNotifications, Count(*) as ForeignCreditCardPaymentNotifications, 0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from ForeignCreditCardPaymentNotifications where Status= 1

        //        union all

        //        select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications, Count(*) as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from CompanyPaymentRequests where Status= 1

        //        union all

        //        select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, Count(*) as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from MemberPaymentRequests where Status= 1

        //        union all

        //        select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, Count(*) as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from CompanyWithdrawalRequests where Status in (1,8)

        //        union all

        //        select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, Count(*) as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from MemberWithdrawalRequests where Status= 1

        //        union all

        //        select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, Count(*) as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from CompanyRebateRequests where Status in (1,8)

        //        union all

        //        select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests, Count(*) as MemberMoneyTransferRequests, 0 as CompanyApplications, 0 as Supports from MemberMoneyTransferRequests where Status= 1

        //        union all

        //        select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, Count(*) as CompanyApplications, 0 as Supports from CompanyApplications
        //        union all
        //        select 0 as PaymentNotifications, 0 as CreditCardPaymentNotifications, 0 as ForeignCreditCardPaymentNotifications,0 as CompanyPaymentRequests, 0 as MemberPaymentRequests, 0 as CompanyWithdrawalRequests, 0 as MemberWithdrawalRequests, 0 as CompanyRebateRequests,  0 as MemberMoneyTransferRequests, 0 as CompanyApplications, Count(*) as Supports from Supports where Status= 1
        //        )T1
        //        )T2

        //        END

        //GUNCELLENDİ

        //------------------------------------------------------- 20.05.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetDealerAccountSummary]
        //@IDCompany nvarchar(50),
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //        SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit,
        //        COUNT(*)  AS CreditCardCount

        //        FROM CompanyTransactions t
        //        LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        WHERE t.IDActionType IN(100, 110)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //),

        //WithdrawalRequestCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //        SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit,
        //        COUNT(*) WithdrawalRequestCount
        //        FROM CompanyTransactions t

        //        LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //        WHERE t.IDActionType = '30'
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //),

        //PaymentNotificationCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(t.Total)) AS PaymentNotificationTotalAmount,
        //        [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationProfit,
        //        COUNT(*) AS PaymentNotificationCount

        //        FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //        LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //        WHERE t.IDActionType IN(10, 20, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //),

        //RebateRequestCTE AS(
        //    SELECT
        //        sum([dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal) as RebateNetAmount
        //        From CompanyRebateRequests r

        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID

        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID

        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)

        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID

        //        WHERE ct2.IDActionType IN (90)

        //        AND r.Status = 2
        //        AND ct2.TransactionDate >= @ReportStartDateTime
        //        AND ct2.TransactionDate <= @ReportEndDateTime
        //        AND ct2.IDCompany = @IDCompany
        //)

        //SELECT
        //        (SELECT CreditCardSumTotal FROM CreditCardCTE) AS CreditCardSumTotal,
        //        (SELECT CreditCardProfit FROM CreditCardCTE) AS CreditCardProfit,
        //        (SELECT CreditCardCount FROM CreditCardCTE) AS CreditCardCount,
        //        (SELECT WithdrawalRequestTotalAmount FROM WithdrawalRequestCTE) AS WithdrawalRequestTotalAmount,
        //        (SELECT WithdrawalRequestProfit FROM WithdrawalRequestCTE) AS WithdrawalRequestProfit,
        //        (SELECT WithdrawalRequestCount FROM WithdrawalRequestCTE) AS WithdrawalRequestCount,
        //        (SELECT PaymentNotificationTotalAmount FROM PaymentNotificationCTE) AS PaymentNotificationTotalAmount,
        //        (SELECT PaymentNotificationProfit FROM PaymentNotificationCTE) AS PaymentNotificationProfit,
        //        (SELECT PaymentNotificationCount FROM PaymentNotificationCTE) AS PaymentNotificationCount,
        //        (SELECT RebateNetAmount FROM RebateRequestCTE) AS RebateNetAmount
        //END

        //------------------------------------------------------- 27.05.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetBankTransactions]
        //@IDBank NVARCHAR(10) = NULL,
        //@IDBankAccount NVARCHAR(50),
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@IsExitAccount BIT = NULL,
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN

        //    DECLARE @totalRecords INT
        //    DECLARE @skippedAmount DECIMAL(18, 4) = 0
        //    DECLARE @result decimal (18, 4) = 0

        // IF(@IsExitAccount = 0)

        //    BEGIN

        //        SELECT @result = SUM(total)

        //        FROM(
        //            SELECT SUM(ISNULL(t.Amount,0)) as total
        //            FROM PaymentTransferPools t

        //            INNER JOIN CompanyBankAccounts cba on cba.ID = @IDBankAccount
        //            WHERE t.IDBank= @IDBank AND t.Amount > 0 AND t.Status in (1,2)

        //            AND NOT EXISTS(
        //                SELECT*
        //                FROM WhereConditions wc

        //                WHERE wc.SP = 'CompanyBankAccounts_TotalSum'

        //                AND (
        //                    (wc.ColumnName = 'SenderName' AND t.SenderName LIKE '%' + wc.ConditionName + '%' COLLATE Latin1_General_CI_AI) OR
        //                    (wc.ColumnName = 'Description' AND t.Description LIKE '%' + wc.ConditionName + '%' COLLATE Latin1_General_CI_AI)
        //          )
        //      )
        //   AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))


        //      UNION ALL


        //            SELECT ISNULL(SUM(CASE WHEN TransactionType = 1 THEN ISNULL(Amount, 0) ELSE ISNULL(Amount, 0) * -1 END), 0) AS total

        //            FROM CompanyFinanceTransaction

        //            WHERE PaymentMethod = 1

        //                AND IDBankAccount = @IDBankAccount

        //                AND(@EndDate IS NULL OR CAST(TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      GROUP BY TransactionType
        //  ) AS combined_results;


        //        CREATE TABLE #TempTable (
        //         TransactionDate DATETIME,
        //            IDBank NVARCHAR(10),
        //         SenderName NVARCHAR(MAX),
        //         Amount DECIMAL(18, 4),
        //         BankName NVARCHAR(MAX),
        //         Description NVARCHAR(MAX),
        //         TotalBalance DECIMAL(18, 4),
        //         IsPositiveBalance tinyint
        //     )


        //        INSERT INTO #TempTable (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)
        //  SELECT t.TransactionDate, t.IDBank, t.SenderName, t.Amount,
        //        cba.Name as BankName, t.Description, 0, 1

        //        FROM PaymentTransferPools t
        //        INNER JOIN CompanyBankAccounts cba on cba.ID = @IDBankAccount

        //        WHERE t.IDBank= @IDBank AND t.Amount > 0 AND t.Status in (1,2)

        //        AND NOT EXISTS(select* from WhereConditions wc

        //        WHERE wc.SP= 'CompanyBankAccounts_TotalSum' AND

        //        ((wc.ColumnName = 'SenderName' and SenderName LIKE '%' + wc.ConditionName + '%' COLLATE Latin1_General_CI_AI) OR
        //        (wc.ColumnName = 'Description' and Description LIKE '%' + wc.ConditionName + '%' COLLATE Latin1_General_CI_AI)))
        //  AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //  AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //  GROUP BY t.TransactionDate, t.IDBank, t.SenderName, t.Amount, cba.Name,t.Description

        //        INSERT INTO #TempTable (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)
        //     SELECT

        //            t.TransactionDate, 
        //         @IDBank, 
        //         cba.Name, 
        //         ISNULL(t.Amount,0),
        //         cba.Name,  
        //   CASE
        //                WHEN t.TransactionType = 1 THEN
        //                    CASE

        //                        WHEN pins.Name IS NULL THEN N'Bankaya Gelir Eklendi' 

        //                        ELSE pins.Name + N' Ödeme Kuruluşundan Transfer Eklendi'

        //                    END
        //                WHEN t.TransactionType = 2 THEN
        //                    CASE

        //                        WHEN t.IDBankAccount2<> @IDBankAccount AND pins.Name IS NULL THEN cba2.Name + N' Bankasına Transfer Yapıldı'

        //                        WHEN t.IDBankAccount2 IS NULL AND pins.Name IS NOT NULL THEN pins.Name + N' Ödeme Kuruluşuna Transfer Yapıldı'

        //                        ELSE N'Bankadan Çıkış Yapıldı'

        //                    END
        //            END AS Description,
        //	        0,
        //               CASE WHEN t.TransactionType = 1 THEN 1 ELSE 0 END
        //        FROM CompanyFinanceTransaction t

        //        INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //        LEFT JOIN CompanyBankAccounts cba2 on cba2.ID = t.IDBankAccount2

        //        left join PaymentInstitutions pins ON pins.ID = t.CompanyIntegrationType

        //        WHERE t.PaymentMethod = 1 AND IDBankAccount = @IDBankAccount

        //        AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //     AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //  GROUP BY t.TransactionDate, t.CompanyIntegrationType, cba.Title, cba.Name, t.Amount, t.TransactionType, pins.Name, t.IDBankAccount2, cba2.Name

        //        SELECT @totalRecords = COUNT(*) FROM #TempTable

        //  IF @OffsetValue<> 0
        //     BEGIN
        //            SELECT @result = @result + ISNULL(SUM(CASE WHEN IsPositiveBalance = 1 THEN Amount * -1 ELSE Amount END), 0)
        //      FROM(
        //                SELECT Amount, IsPositiveBalance, ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum

        //                FROM #TempTable
        //      ) AS SubQuery

        //            WHERE RowNum <= @OffsetValue
        //        END


        //        SELECT TransactionDate, IDBank, SenderName, Amount, BankName, Description, @result as TotalBalance, 
        //     IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable


        //        ORDER BY TransactionDate DESC

        //        OFFSET @OffsetValue ROWS
        //        FETCH NEXT @PageLength ROWS ONLY


        //        DROP TABLE #TempTable
        // END

        //    ELSE


        //    BEGIN
        //        CREATE TABLE #TempTable2 (
        //         TransactionDate DATETIME,
        //         IDBank NVARCHAR(10),
        //         SenderName NVARCHAR(MAX),
        //         Amount DECIMAL(18, 2),
        //         BankName NVARCHAR(MAX),
        //         Description NVARCHAR(MAX),
        //         TotalBalance DECIMAL(18, 2),
        //         IsPositiveBalance tinyint
        //     )


        //           SELECT @result = SUM(total)

        //        FROM(
        //            SELECT SUM(ISNULL(cwr.Amount,0)) * -1 as total
        //            FROM CompanyWithdrawalRequests cwr

        //            INNER JOIN CompanyBankAccounts cba on cba.ID = @IDBankAccount
        //            WHERE cwr.SIDBank = @IDBank AND cwr.Status = 2

        //            AND(@EndDate IS NULL OR CAST(cwr.CDate AS DATE) <= CAST(@EndDate AS DATE))

        //   UNION ALL


        //            SELECT SUM(ISNULL(crr.Amount,0)) * -1 as total
        //            FROM CompanyRebateRequests crr

        //            INNER JOIN CompanyBankAccounts cba on cba.ID = @IDBankAccount
        //            WHERE crr.SIDBank = @IDBank AND crr.Status = 2

        //            AND(@EndDate IS NULL OR CAST(crr.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //      UNION ALL


        //            SELECT ISNULL(SUM(CASE WHEN t.TransactionType = 1 THEN ISNULL(t.Amount, 0) WHEN t.TransactionType = 2 THEN ISNULL(t.Amount, 0) * -1 END), 0) AS total

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //            WHERE t.PaymentMethod = 1 AND IDBankAccount = @IDBankAccount

        //            AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))			    	    
        //  ) AS combined_results;

        //        INSERT INTO #TempTable2 (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)
        //  SELECT cwr.MDate as TransactionDate, cwr.SIDBank as IDBank, cwr.Title as SenderName, cwr.Amount, cba.Name as BankName,
        //        ISNULL(cwr.Description, 'Çekim Talebi'), 0, 0
        //  FROM CompanyWithdrawalRequests cwr
        //        INNER JOIN CompanyBankAccounts cba on cba.ID = @IDBankAccount
        //        WHERE cwr.SIDBank = @IDBank AND cwr.Status = 2
        //  AND(@StartDate IS NULL OR CAST(cwr.CDate AS DATE) >= CAST(@StartDate AS DATE))
        //  AND(@EndDate IS NULL OR CAST(cwr.CDate AS DATE) <= CAST(@EndDate AS DATE))

        //  INSERT INTO #TempTable2 (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)
        //  SELECT crr.MDate as TransactionDate, crr.SIDBank as IDBank, crr.SenderName as SenderName, crr.Amount, cba.Name as BankName,
        //        N'İade Yapıldı' as Description, 0, 0

        //        FROM CompanyRebateRequests crr
        //        INNER JOIN CompanyBankAccounts cba on cba.ID = @IDBankAccount

        //        WHERE crr.SIDBank = @IDBank AND crr.Status = 2

        //        AND(@StartDate IS NULL OR CAST(crr.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //  AND(@EndDate IS NULL OR CAST(crr.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //  INSERT INTO #TempTable2 (TransactionDate, IDBank, SenderName, Amount, BankName, Description, TotalBalance, IsPositiveBalance)
        //     SELECT
        //            t.TransactionDate,
        //            @IDBank,
        //            cba.Name,
        //            t.Amount,
        //            cba.Name,
        //            CASE
        //                WHEN t.TransactionType = 1 THEN
        //                    CASE

        //                        WHEN pins.Name IS NULL THEN N'Bankaya Gelir Eklendi'  

        //                        ELSE pins.Name + N' Ödeme Kuruluşundan Transfer Eklendi' 

        //                    END
        //                WHEN t.TransactionType = 2 THEN
        //                    CASE

        //                        WHEN t.IDBankAccount2<> @IDBankAccount AND pins.Name IS NULL THEN cba2.Name + N' Bankasına Transfer Yapıldı'

        //                        WHEN t.IDBankAccount2 IS NULL AND pins.Name IS NOT NULL THEN pins.Name + N' Ödeme Kuruluşuna Transfer Yapıldı'

        //                        ELSE N'Bankadan Çıkış Yapıldı'

        //                    END
        //            END AS Description,
        //	        0,
        //               CASE WHEN t.TransactionType = 1 THEN 1 ELSE 0 END
        //        FROM CompanyFinanceTransaction t

        //        INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount

        //        LEFT JOIN CompanyBankAccounts cba2 on cba2.ID = t.IDBankAccount2

        //        left join PaymentInstitutions pins ON pins.ID = t.CompanyIntegrationType

        //        WHERE t.PaymentMethod = 1 AND IDBankAccount = @IDBankAccount

        //        AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //     AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //  GROUP BY t.TransactionDate, t.CompanyIntegrationType, cba.Title, cba.Name, t.Amount, t.TransactionType, pins.Name, t.IDBankAccount2, cba2.Name

        //        SELECT @totalRecords = COUNT(*) FROM #TempTable2

        //  IF @OffsetValue<> 0
        //     BEGIN
        //            SELECT @result = @result + ISNULL(SUM(CASE WHEN IsPositiveBalance = 1 THEN Amount * -1 ELSE Amount END), 0)
        //      FROM(
        //                SELECT Amount, IsPositiveBalance, ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum

        //                FROM #TempTable2
        //      ) AS SubQuery

        //            WHERE RowNum <= @OffsetValue
        //        END



        //        SELECT TransactionDate, IDBank, SenderName, Amount, BankName, Description, @result as TotalBalance, 
        //     IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable2


        //        ORDER BY TransactionDate DESC

        //        OFFSET @OffsetValue ROWS
        //        FETCH NEXT @PageLength ROWS ONLY

        //        DROP TABLE #TempTable2
        // END

        //END                                             

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetCreditCardTransactions]
        //@PaymentInstitutionID NVARCHAR(10) = NULL,
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords INT
        //    DECLARE @totalNegativeBalance decimal (18, 4) = 0	
        //    DECLARE @totalPositiveBalance decimal (18, 4) = 0
        //    DECLARE @skippedAmount DECIMAL(18, 4) = 0  		
        //    DECLARE @ccPool decimal (18, 4)
        //    DECLARE @result decimal (18, 4)

        // select @ccPool = ISNULL(SUM(cpn.PaymentInstitutionNetAmount), 0)

        //            FROM CreditCardPaymentNotifications cpn
        //            WHERE cpn.CreditCardPaymentMethodID = @PaymentInstitutionID
        //            AND cpn.Status in (5,6)
        //   --AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //   AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))



        // SELECT @result = ISNULL(SUM((Total - ISNULL(t.CompanyCommission, 0))) + cftIncome.IncomeAmount - cft.ExpenseAmount - cr.ExpenseAmountRebate, 0)
        //    FROM CompanyTransactions t
        //    INNER JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID

        //    cross join(SELECT ISNULL(sum(t.Amount),0) AS ExpenseAmount
        //    FROM CompanyFinanceTransaction t
        //    INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //    INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2
        //    WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //    AND  t.PaymentMethod = 2 and t.TransactionType = 2
        //    AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //    ) as cft

        //    cross join(SELECT ISNULL(sum(t.Amount),0) AS IncomeAmount
        //    FROM CompanyFinanceTransaction t
        //    INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //    INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //    WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //    AND  t.PaymentMethod = 2 and t.TransactionType = 1
        //    AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //    ) as cftIncome

        //    cross join(SELECT ISNULL(sum((isnull(t2.Total,0) - isnull(t2.CompanyCommission,0))),0) AS ExpenseAmountRebate
        //    FROM CompanyRebateRequests cr
        //    INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //    INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //    INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //    INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //    WHERE cr.Status = 2 and cpn.Status = 2
        //    AND (cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //    ) as cr

        //    WHERE 1 = 1
        //        AND t.IDActionType IN (100, 110)
        //        AND(cs.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //        AND cs.Status = 2
        //        --AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //    GROUP BY cft.ExpenseAmount, cftIncome.IncomeAmount, cr.ExpenseAmountRebate

        //    CREATE TABLE #TempTable (
        //        TransactionDate DATETIME,
        //        PaymentInstitutionID NVARCHAR(10),
        //        SenderName NVARCHAR(MAX),
        //        Amount DECIMAL(18, 4),
        //        PaymentInstitutionName NVARCHAR(MAX),
        //        Description NVARCHAR(MAX),
        //        TotalBalance DECIMAL(18, 4),
        //        IsPositiveBalance tinyint,
        //    )

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate,
        //        cs.CreditCardPaymentMethodID,
        //        cs.SenderName,
        //        (isnull(t.Total,0) - isnull(t.CompanyCommission,0)) as Amount, 
        //        pins.Name as PaymentInstitutionName, 
        //        cs.Description,
        //        0,
        //        1
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID
        //    INNER JOIN PaymentInstitutions pins ON cs.CreditCardPaymentMethodID = pins.ID
        //    WHERE t.IDActionType IN(100,110) and cs.Status = 2
        //    AND (cs.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        // GROUP BY t.TransactionDate, cs.CreditCardPaymentMethodID, cs.SenderName,t.Total,t.CompanyCommission, pins.Name, cs.Description

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //    SELECT

        //           cpn.MDate, 
        //        cpn.CreditCardPaymentMethodID, 
        //        cpn.SenderName, 
        //        isnull(cpn.PaymentInstitutionNetAmount,0),
        //        pins.Name as PaymentInstitutionName, 
        //        N'Manuel Kredi Kartı Ödeme Havuzunda' as Description,
        //        0,
        //        1
        //    FROM CreditCardPaymentNotifications cpn
        //    INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //    WHERE cpn.Status = 5
        //    AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //    SELECT
        //           cpn.MDate,
        //        cpn.CreditCardPaymentMethodID,
        //        cpn.SenderName,
        //        isnull(cpn.PaymentInstitutionNetAmount,0),
        //        pins.Name as PaymentInstitutionName, 
        //        N'Fraud Havuzunda' as Description,
        //        0,
        //        1
        //    FROM CreditCardPaymentNotifications cpn
        //    INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //    WHERE cpn.Status = 6
        //    AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate,
        //        cpn.CreditCardPaymentMethodID,
        //        cpn.SenderName,
        //        (isnull(t2.Total,0) - isnull(t2.CompanyCommission,0)),
        //        pins.Name as PaymentInstitutionName, 
        //        N'İade Yapıldı' as Description,
        //        -1,
        //        0
        //    FROM CompanyRebateRequests cr
        //    INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //    INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //    INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //    INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //    WHERE cr.Status = 2 and cpn.Status = 2
        //    AND (cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)
        //    AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate,
        //        t.CompanyIntegrationType,
        //        cba.Name,
        //        t.Amount,
        //        pins.Name as PaymentInstitutionName,
        //        cba.Name + N' Bankasına Çıkış Yapıldı' as Description,
        //        -1,
        //        0
        //    FROM CompanyFinanceTransaction t
        //    INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //    INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2
        //    WHERE
        //    t.CompanyIntegrationType = @PaymentInstitutionID
        //    AND t.PaymentMethod = 2 AND t.TransactionType = 2
        //    AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        // GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount

        //    INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //    SELECT
        //        t.TransactionDate, 
        //        t.CompanyIntegrationType, 
        //        cba.Name, 
        //        t.Amount,
        //        pins.Name as PaymentInstitutionName,  
        //        cba.Name + N' Bankasından Transfer Yapıldı' as Description,
        //        -1,
        //        1
        //    FROM CompanyFinanceTransaction t
        //    INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //    INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //    WHERE
        //    t.CompanyIntegrationType = @PaymentInstitutionID
        //    AND t.PaymentMethod = 2 AND t.TransactionType = 1
        //    AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        // GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount


        //    SELECT @totalRecords = COUNT(*) FROM #TempTable
        //    select @totalNegativeBalance = ISNULL(SUM(Amount), 0) from #TempTable where IsPositiveBalance = 0 and TotalBalance >= 0
        //    select @totalPositiveBalance = @result + @ccPool

        //       IF @OffsetValue<> 0
        //    BEGIN
        //        SELECT @totalPositiveBalance = @totalPositiveBalance + ISNULL(SUM(CASE WHEN IsPositiveBalance = 1 THEN Amount * -1 ELSE Amount END), 0)
        //     FROM(
        //            SELECT Amount, IsPositiveBalance, ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum

        //            FROM #TempTable
        //     ) AS SubQuery

        //        WHERE RowNum <= @OffsetValue
        //    END


        //    SELECT TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, @totalPositiveBalance - @totalNegativeBalance  as TotalBalance, IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable
        //    ORDER BY TransactionDate DESC
        //    OFFSET @OffsetValue ROWS
        //    FETCH NEXT @PageLength ROWS ONLY


        //    DROP TABLE #TempTable

        //END

        //GUNCELLENDI

        //------------------------------------------------------- 30.05.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        // ALTER TABLE dbo.CompanyIntegrations ADD
        // WithdrawalApiBeUsed bit NOT NULL DEFAULT 0

        //GO

        //ALTER Proc[dbo].[CompanyIntegrations_SetIframeUseSettings]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@TransferBeUsed bit,
        //@CreditCardBeUsed bit,
        //@ForeignCreditCardBeUsed bit,
        //@WithdrawalApiBeUsed bit
        //AS
        //BEGIN
        //BEGIN TRY

        //IF @CreditCardBeUsed = 0

        //BEGIN
        //UPDATE CompanyIntegrations SET CreditCardPaymentWithParam=0, CreditCardPaymentWithPayNKolay=0 WHERE ID = @ID

        //END
        //IF @ForeignCreditCardBeUsed = 0
        //BEGIN
        //UPDATE CompanyIntegrations SET ForeignCreditCardPaymentWithPayNKolay=0 WHERE ID = @ID

        //END

        //UPDATE CompanyIntegrations SET TransferBeUsed=@TransferBeUsed, WithdrawalApiBeUsed = @WithdrawalApiBeUsed, CreditCardBeUsed=@CreditCardBeUsed , ForeignCreditCardBeUsed = @ForeignCreditCardBeUsed WHERE ID=@ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 14.06.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyTransactions_GetList]
        //@IDCompany nvarchar(50) = null,
        //@StartDate date = null,
        //@EndDate date = null,
        //@IDActionType nvarchar(3) = null,
        //@IDCompanyInvoice nvarchar(50) = null,
        //@InvoiceStatus bit = null,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN


        //    DECLARE @totalRecords int
        //    SELECT t.ID, t.CDate, t.MDate, t.IDCompany, t.IDActionType, t.TransactionDate,t.TransactionNr, t.IDBank,
        // t.Total, case when t.IDActionType IN (30) then[dbo].RoundToZero(t.CostTotal) else [dbo].RoundToZero(t.Commission) end as Commission, ROUND((t.commission / t.total* 100),4) as TransactionTotal, [dbo].RoundToZero(t.CostTotal) as CostTotal,[dbo].RoundToZero(t.NetTotal) as NetTotal, t.IDMember,t.IDCompanyInvoice, at.ActionType, b.Name as Bank, 
        // t.CommissionRate,
        // --isnull(dbo.CompanyTransactions_GetListBalance(@IDCompany, @StartDate, @EndDate, @IDActionType, t.TransactionDate),0) as Balance
        // --t.IDActionType AS Balance,
        // GetProcessBalance.Balance as Balance
        //    into #TempTable
        // FROM CompanyTransactions t
        //    INNER JOIN ActionTypes at ON at.IDActionType=t.IDActionType
        //    LEFT JOIN Banks b ON b.ID=t.IDBank
        //    LEFT JOIN Companies c ON c.ID = t.IDCompany
        //    cross join dbo.Fn_CompanyTransactions_GetListBalance(@IDCompany , null , @EndDate, @IDActionType, @OffsetValue) as GetProcessBalance
        //    WHERE 1=1


        //    AND(@IDCompany IS NULL OR t.IDCompany= @IDCompany)


        //    AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        // AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE))
        // AND(@IDActionType IS NULL OR t.IDActionType= @IDActionType)


        //    AND(@InvoiceStatus IS NULL OR @InvoiceStatus= 0 OR ISNULL(t.IDCompanyInvoice,'')=ISNULL(@IDCompanyInvoice,''))
        // AND(@SearchValue IS NULL OR  (b.Name LIKE '%' + @SearchValue + '%' OR t.TransactionNr LIKE '%' + @SearchValue + '%'  OR t.Total LIKE '%' + @SearchValue + '%'  OR at.ActionType LIKE '%' + @SearchValue + '%'   ))

        // SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // ORDER BY TransactionDate DESC
        //    OFFSET @OffsetValue ROWS


        //    FETCH NEXT @PageLenght ROWS ONLY
        //    DROP TABLE #TempTable

        //END

        //GO

        //ALTER FUNCTION[dbo].[Fn_CompanyTransactions_GetListBalance]
        //(
        //@IDCompany nvarchar(50), 
        //@StartDate date = null,
        //@EndDate date = null, 
        //@IDActionType int = null,
        //@OffsetValue int
        //)
        //RETURNS TABLE
        //AS
        //RETURN
        //(
        //    WITH CTE AS (
        //        SELECT
        //            *,
        //            ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum
        //        FROM
        //            CompanyTransactions
        //        WHERE
        //            (@IDCompany IS NULL OR IDCompany = @IDCompany)
        //            AND(@StartDate IS NULL OR CAST(TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //            AND(@EndDate IS NULL OR CAST(TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //            AND(@IDActionType IS NULL OR IDActionType = @IDActionType)
        //    ),
        //    TotalBalance AS(
        //        SELECT
        //            SUM(CASE
        //                WHEN IDActionType IN (30, 40, 50, 90, 130)
        //                THEN[dbo].[RoundToZero] (NetTotal)* -1 
        //                ELSE[dbo].[RoundToZero]
        //        (NetTotal)
        //            END) AS Balance
        //        FROM CTE
        //    ),
        //    OffsetBalance AS(
        //        SELECT
        //            SUM(CASE
        //                WHEN IDActionType IN (30, 40, 50, 90, 130)
        //                THEN[dbo].[RoundToZero] (NetTotal)* -1 
        //                ELSE[dbo].[RoundToZero]
        //        (NetTotal)
        //            END) AS Balance
        //        FROM CTE
        //        WHERE RowNum <= @OffsetValue
        //    )
        //    SELECT
        //        tb.Balance - COALESCE(ob.Balance, 0) AS Balance
        //    FROM
        //        TotalBalance tb, OffsetBalance ob
        //);

        //GUNCELLENDİ

        //------------------------------------------------------- 20.06.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        // ALTER TABLE dbo.PaymentInstitutions ADD
        // EndOfDayTime nvarchar(10)

        //GO


        //CREATE Proc[dbo].[PaymentInstitutions_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@IsActive bit = null,
        //@Rate decimal = null,
        //@Show bit = null,
        //@UseForForeignCard bit = null,
        //@DebitCardRate decimal = null,
        //@IsApi bit = null,
        //@EndOfDayTime nvarchar(10) = null,
        //@Name nvarchar(100) = null
        //AS
        //BEGIN

        //    Update PaymentInstitutions SET IsActive = @IsActive WHERE ID = @ID


        //    IF @EndOfDayTime IS NOT NULL
        //    BEGIN
        //        UPDATE PaymentInstitutions
        //        SET EndOfDayTime = @EndOfDayTime
        //        WHERE ID = @ID;
        //        END
        //    END

        //GO

        //ALTER Proc[dbo].[CompanyBankAccounts_TotalCreditCardSum]
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(50),
        //@StartDate date = null,
        //@EndDate date = null
        //AS
        //BEGIN


        //DECLARE @Counter INT = 1;
        //DECLARE @MaxCount INT;
        //SELECT @MaxCount = COUNT(*) FROM PaymentInstitutions WHERE Show = 1

        //CREATE TABLE #TempResults
        //(
        //    ID NVARCHAR(50),
        //    Amount DECIMAL(18, 2),
        //    CreditCardAmount DECIMAL(18, 2),
        //    EftAmount DECIMAL(18, 2),
        //    NetAmount DECIMAL(18, 2),
        //    CountNetAmount INT,
        //    Name NVARCHAR(200),
        //    UseForForeignCard BIT,
        //    EndOfDayTime NVARCHAR(10)
        //);

        //WHILE @Counter <= @MaxCount
        //BEGIN
        //    DECLARE @CurrentID NVARCHAR(50);
        //        DECLARE @Name NVARCHAR(200);
        //        DECLARE @UseForForeignCard BIT;
        //    DECLARE @EndOfDayTime NVARCHAR(10)

        //    SELECT @CurrentID = ID, @Name = Name, @UseForForeignCard = UseForForeignCard, @EndOfDayTime = EndOfDayTime
        //    FROM(
        //        SELECT ID, Name, UseForForeignCard, EndOfDayTime, ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS RowNum
        //        FROM PaymentInstitutions
        //        WHERE Show = 1
        //    ) AS RowNumbered
        //    WHERE RowNum = @Counter;

        //        IF @CurrentID = 6

        //    BEGIN
        //        INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount,EndOfDayTime )
        //    SELECT TOP(1)
        //        @CurrentID AS ID,
        //        isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //        @Name AS Name,
        //        @UseForForeignCard AS UseForForeignCard,
        //        0 AS CreditCardAmount,
        //        isnull(CountNetAmountToday, 0) - isnull(Piece,0) AS EftAmount,
        //        isnull(sumT.NetAmountTotal, 0) AS NetAmount,
        //        isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount,
        //        @EndOfDayTime as EndOfDayTime
        //    FROM
        //    (
        //        SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //               SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //        FROM (
        //            SELECT sum(Amount) AS Amount,
        //                   CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                   CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                   SUM(isnull(Piece,0)) AS Piece
        //            FROM CompanyFinanceTransaction
        //            WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2
        //            GROUP BY TransactionType
        //        ) AS Total
        //    ) AS AmountTotal
        //    LEFT JOIN(
        //        SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //               SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //               SUM(NetAmountTotal) AS NetAmountTotal,
        //               SUM(CountNetAmount) AS CountNetAmount,
        //               SUM(CountNetAmountToday) AS CountNetAmountToday
        //        FROM (
        //            SELECT sum(Total) + isnull(ccPool.Amount,0) AS NetAmountTotal,
        //                    sum((Total - isnull(t.CompanyCommission, 0))) + isnull(ccPool.Amount,0) AS NetAmount,
        //                       count((Total)) + isnull(RebateCount,0) AS CountNetAmount,
        //                    count(CASE WHEN CONVERT(DATE, t.TransactionDate) = CONVERT(DATE, GETDATE()) THEN 1 ELSE NULL END) + isnull(RebateCount,0) AS CountNetAmountToday,
        //                   (isnull(cr.Amount, 0) - isnull(cr.CompanyCommission, 0)) AS ExpenseNetAmount
        //            FROM CompanyTransactions t
        //            LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //            CROSS JOIN(
        //                SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                       sum(cr.Amount) AS Amount,
        //                       count(cr.Amount) AS RebateCount
        //                FROM CompanyRebateRequests cr
        //                INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //                INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //                INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //     AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //            ) cr

        //            CROSS JOIN(
        //                SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                From CreditCardPaymentNotifications cpn
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND cpn.Status in (5,6) AND cpn.TransactionReferenceCode is not null AND cpn.PaymentInstitutionNetAmount is not null 
        //                AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) ccPool

        //            WHERE IDActionType IN(100,110) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //            AND(@EndDate IS NULL OR CAST(TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //            GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount
        //        ) AS AmountTotal
        //    ) AS sumT ON sumT.ID = @CurrentID
        //    END

        //    ELSE
        //        BEGIN

        //            INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount, EndOfDayTime)
        //    SELECT TOP(1)
        //        @CurrentID AS ID,
        //        isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //        @Name AS Name,
        //        @UseForForeignCard AS UseForForeignCard,
        //        0 AS CreditCardAmount,
        //        0 AS EftAmount,
        //        isnull(sumT.NetAmount, 0) AS NetAmount,
        //       isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount,
        //       @EndOfDayTime as EndOfDayTime
        //    FROM
        //    (
        //        SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //               SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //        FROM (
        //            SELECT sum(Amount) AS Amount,
        //                   CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                   CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                   SUM(isnull(Piece,0)) AS Piece

        //                FROM CompanyFinanceTransaction

        //                WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2

        //                GROUP BY TransactionType
        //         ) AS Total
        //     ) AS AmountTotal
        //    LEFT JOIN(
        //            SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //                   SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //                   SUM(CountNetAmount) AS CountNetAmount
        //            FROM (
        //                SELECT sum(ISNULL((Total - isnull(t.CompanyCommission,0)),0)) + isnull(ccPool.Amount,0) AS NetAmount,
        //                       count((NetTotal)) + isnull(RebateCount,0) AS CountNetAmount,
        //                    (isnull(cr.Amount, 0) - isnull(cr.CompanyCommission, 0)) AS ExpenseNetAmount

        //                FROM CompanyTransactions t
        //                LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //                CROSS JOIN(
        //                    SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                           sum(cr.Amount) AS Amount,
        //                           count(cr.Amount) AS RebateCount
        //                    FROM CompanyRebateRequests cr

        //                    INNER JOIN CompanyTransactions t ON t.ID = cr.ID

        //                    INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID

        //                    INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID

        //                    WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //            AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) cr

        //                CROSS JOIN(
        //     SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                From CreditCardPaymentNotifications cpn
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID
        //                AND cpn.Status in (5,6) AND cpn.TransactionReferenceCode is not null 
        //                AND cpn.PaymentInstitutionNetAmount is not null 
        //                AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) ccPool

        //                WHERE IDActionType IN(100,110) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID

        //                GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount

        //               ) AS AmountTotal
        //     ) AS sumT ON sumT.ID = @CurrentID
        //        END
        //    SET @Counter = @Counter + 1;
        //        END;

        //SELECT* FROM #TempResults ORDER BY ID;
        //DROP TABLE #TempResults;

        //END


        //GO

        //CREATE Proc[dbo].[PaymentInstitutions_GetSingle]
        //@ID nvarchar(10)
        //AS
        //BEGIN

        //    SELECT* FROM PaymentInstitutions where ID=@ID
        //END

        //GO

        //    ALTER TRIGGER[dbo].[tggrUpdateCreditCardPaymentNotifications]
        //    ON[dbo].[CreditCardPaymentNotifications]
        //    AFTER UPDATE

        //    AS
        //    BEGIN


        //        declare @id nvarchar(50);
        //        declare @Status tinyint;
        //     declare @IsNotBocked bit;
        //	    declare @IsAutoNotification bit;

        //     DECLARE @paymentInstitutionId NVARCHAR(50);
        //        DECLARE @netPaymentInstitutionTotal DECIMAL(18, 4);
        //        DECLARE @adjustedDate DATE;
        //     DECLARE @endOfDayTime TIME(0);

        //        DECLARE @mDate DATETIME;
        //     DECLARE @mDateTime DATETIME;
        //     DECLARE @actionDate DATE;
        //     DECLARE @actionTimeString NVARCHAR(5);
        //        DECLARE @actionDateTime DATETIME;
        //     DECLARE @endOfDayDateTime DATETIME;

        //  select @id = ID, @Status = Status, @paymentInstitutionId = CreditCardPaymentMethodID, @IsNotBocked = IsNotBocked,
        //        @actionTimeString = ActionTime, @actionDate = ActionDate, @IsAutoNotification = IsAutoNotification, @mDate = MDate from inserted


        //            SET @mDateTime = DATEADD(MINUTE, DATEDIFF(MINUTE, 0, CONVERT(TIME(0), @mDate)), CONVERT(DATETIME, CONVERT(DATE, @mDate)));

        //        SET @actionDateTime = DATEADD(MINUTE, DATEDIFF(MINUTE, 0, CONVERT(TIME(0), @actionTimeString)), CONVERT(DATETIME, @actionDate));

        //     -- Fetch EndOfDayTime for the payment institution using SET
        //     SET @endOfDayTime = (SELECT CONVERT(TIME(0), EndOfDayTime)
        //                             FROM PaymentInstitutions

        //                                WHERE ID = @paymentInstitutionId);

        //     SET @endOfDayDateTime = DATEADD(MINUTE, DATEDIFF(MINUTE, 0, @endOfDayTime), CONVERT(DATETIME, @actionDate));


        //    IF(@Status= 2)

        //        BEGIN
        //            DELETE FROM CompanyTransactions WHERE ID = @id

        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate, CompanyCommission , CompanyCommissionRate)

        //            SELECT pn.ID, pn.CDate, ci.ID, '100', pn.MDate, TransactionNr, pn.Amount,
        //   case when pn.CreditCardPaymentMethodID = 7 then ROUND((pn.Amount* cc.ToslaRate/100), 4 ) else ROUND((pn.Amount* cc.CreditCardRate/100), 4 ) end , 0, 
        //   case when pn.CreditCardPaymentMethodID = 7 then ROUND((pn.Amount - (pn.Amount* cc.ToslaRate/100)), 4) else  ROUND((pn.Amount - (pn.Amount* cc.CreditCardRate/100)), 4) end, IDMember, 
        //   case when pn.CreditCardPaymentMethodID = 7 then cc.ToslaRate else cc.CreditCardRate end,
        // --	
        //   case when pn.CardTypeId = 1 and pins.DebitCardRate is not null then ROUND(((pn.Amount / 100) * (CAST(pins.DebitCardRate AS DECIMAL(10, 2))) ),4) else
        //   ROUND(((pn.Amount / 100) * (CAST(pins.Rate AS DECIMAL(10, 2))) ),4) end,

        //   case when pn.CardTypeId = 1 and pins.DebitCardRate is not null then (CAST(pins.DebitCardRate AS DECIMAL(10, 2))) else
        //   (CAST(pins.Rate AS DECIMAL(10, 2)))  end

        //            FROM CreditCardPaymentNotifications pn

        //            INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //            INNER JOIN CompanyCommissions cc ON cc.ID= ci.ID

        //            INNER JOIN PaymentInstitutions pins on pins.ID = pn.CreditCardPaymentMethodID

        //            WHERE pn.ID= @id


        //            IF (@IsNotBocked = 0)

        //            BEGIN

        //                SELECT @netPaymentInstitutionTotal = 
        //             CASE
        //                    WHEN pn.CardTypeId = 1 AND pins.DebitCardRate IS NOT NULL THEN ROUND((pn.Amount - (pn.Amount* pins.DebitCardRate / 100)), 4)
        //                 ELSE ROUND((pn.Amount - (pn.Amount* pins.Rate / 100)), 4)
        //             END
        //                FROM CreditCardPaymentNotifications pn

        //                INNER JOIN PaymentInstitutions pins ON pins.ID = pn.CreditCardPaymentMethodID
        //                WHERE pn.ID = @id;

        //    IF @IsAutoNotification = 1

        //                BEGIN
        //                    IF @mDateTime  > @endOfDayDateTime
        //                    BEGIN

        //                        SET @adjustedDate = DATEADD(DAY, 1, CONVERT(DATE, @mDateTime));
        //    END
        //    ELSE

        //                    BEGIN
        //                        SET @adjustedDate = CONVERT(DATE, @mDateTime );
        //    END
        //END

        //                ELSE
        //                BEGIN

        //                    IF @actionDateTime > @endOfDayDateTime
        //                    BEGIN

        //                        SET @adjustedDate = DATEADD(DAY, 1, @actionDate);
        //    END
        //    ELSE

        //                    BEGIN
        //                        SET @adjustedDate = @actionDate;
        //              END
        //                END


        //                IF EXISTS(SELECT 1 FROM ProgressPaymentCalendars WHERE[Date] = @adjustedDate AND PaymentInstitutionId = @paymentInstitutionId)

        //                BEGIN
        //                    UPDATE ProgressPaymentCalendars
        //                    SET ProgressPayment += @netPaymentInstitutionTotal
        //                    WHERE[Date] = @adjustedDate AND PaymentInstitutionId = @paymentInstitutionId;
        //    END
        //    ELSE

        //                BEGIN
        //                    INSERT INTO ProgressPaymentCalendars(ID, [Date], ProgressPayment, PaymentInstitutionId)

        //                    VALUES(NEWID(), @adjustedDate, @netPaymentInstitutionTotal, @paymentInstitutionId);
        //    END
        //END

        //        END
        //    END

        //------------------------------------------------------- 24.06.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //    CREATE TABLE dbo.CompanyProgressPaymentCalendars(
        //    ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    IDCompany nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,

        //    [Date] datetime NOT NULL,
        // ProgressPayment decimal (18,2) NOT NULL,
        //    RebateAmount decimal (18,4) DEFAULT 0 NULL,
        // CONSTRAINT PK_CompanyProgressPaymentCalendars PRIMARY KEY(ID)
        //    );

        //GO

        //CREATE Proc[dbo].[CompanyProgressPaymentCalendars_GetList]
        //@IDCompany NVARCHAR(50)
        //AS
        //BEGIN

        //    SELECT*, ci.Title as CompanyName From CompanyProgressPaymentCalendars
        //    inner join Companies ci on ci.ID = IDCompany
        //    where IDCompany = @IDCompany
        //    ORDER BY Date DESC

        //END

        //GO 

        //ALTER TRIGGER[dbo].[tggrInsertCompanyTransactions]
        //ON[dbo].[CompanyTransactions]
        //AFTER INSERT
        //AS
        //BEGIN

        //declare @id nvarchar(50);
        //        declare @idActionType nvarchar(3);
        //        declare @idCompany nvarchar(50);
        //        declare @netTotal decimal (18,2);
        //declare @transactionDate datetime;

        //select @id = ID, @idActionType = IDActionType, @idCompany = IDCompany, @netTotal = [dbo].RoundToZero(NetTotal), @transactionDate = TransactionDate from inserted


        //If @idActionType = '10' OR @idActionType = '20'

        //Begin
        //declare @IsNotBocked bit = (select ISNULL(IsNotBocked, 0) from PaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked=1

        // IF @IsNotBocked = 0

        //    BEGIN
        //        IF EXISTS(SELECT 1 FROM CompanyProgressPaymentCalendars WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany)

        //        BEGIN
        //            UPDATE CompanyProgressPaymentCalendars
        //            SET ProgressPayment += @netTotal
        //            WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany;
        //        END
        //        ELSE

        //        BEGIN
        //            INSERT INTO CompanyProgressPaymentCalendars(ID, IDCompany, [Date], ProgressPayment)

        //            VALUES(NEWID(), @idCompany, @transactionDate, @netTotal);
        //        END
        //    END
        //End
        //Else If @idActionType = '100'

        //Begin
        //declare @IsNotBocked2 bit = (select ISNULL(IsNotBocked, 0) from CreditCardPaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked2=1

        // IF @IsNotBocked2 = 0

        //    BEGIN
        //        IF EXISTS(SELECT 1 FROM CompanyProgressPaymentCalendars WHERE[Date] = CONVERT(DATE, @transactionDate)AND IDCompany = @idCompany)

        //        BEGIN
        //            UPDATE CompanyProgressPaymentCalendars
        //            SET ProgressPayment += @netTotal
        //            WHERE[Date] = CONVERT(DATE, @transactionDate)AND IDCompany = @idCompany;
        //        END
        //        ELSE

        //        BEGIN
        //            INSERT INTO CompanyProgressPaymentCalendars(ID, IDCompany, [Date], ProgressPayment)

        //            VALUES(NEWID(), @idCompany, @transactionDate, @netTotal);
        //        END
        //    END
        //End

        //Else If @idActionType = '140'
        //Begin
        //declare @IsNotBocked3 bit = (select ISNULL(IsNotBocked, 0) from ForeignCreditCardPaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked3=1
        //End

        //Else If @idActionType = '70'

        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End

        //Else If @idActionType='90'
        //Begin
        //UPDATE Companies SET UsingBalance=UsingBalance WHERE ID=@idCompany

        //    IF EXISTS(SELECT 1 FROM CompanyProgressPaymentCalendars WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany)
        //    BEGIN
        //        UPDATE CompanyProgressPaymentCalendars
        //        SET ProgressPayment += @netTotal* -1,
        //        RebateAmount += @netTotal* -1
        //        WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany;
        //        END
        //        ELSE
        //    BEGIN
        //        INSERT INTO CompanyProgressPaymentCalendars(ID, IDCompany, [Date], ProgressPayment, RebateAmount )
        //        VALUES(NEWID(), @idCompany, @transactionDate, @netTotal* -1, @netTotal* -1);
        //        END

        //    End

        //Else If(@idActionType= '120' or @idActionType = '150')
        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End
        //Else If @idActionType='130'
        //    Begin
        //    UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //    End


        //    Else
        //    Begin

        //    IF @idActionType<>'30'
        //Begin
        //IF(Select UsingBalance From Companies Where ID= @idCompany)<@netTotal
        //Begin

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiye yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //End
        //Else

        //Begin
        //UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //End

        //End
        //End

        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 22.07.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //   CREATE TABLE dbo.Sliders(
        //   ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   CDate datetime NOT NULL,
        //CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   MDate datetime NULL,
        //   MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //Header nvarchar(250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //Content nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //ShowButton bit DEFAULT 0 NULL,
        //ButtonRedirectUrl nvarchar(250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //IsActive bit DEFAULT 0 NOT NULL,
        //   OrderNr int NULL,
        //   ButtonName varchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //ImageUrl nvarchar(MAX) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //Name nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //CONSTRAINT PK_Slider PRIMARY KEY(ID)
        //   );

        //GO

        //CREATE Proc[dbo].[Sliders_Delete]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY

        //        DELETE FROM Sliders WHERE ID=@ID
        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //Create Proc[dbo].[Sliders_GetActiveList]
        //AS
        //BEGIN

        //SELECT* FROM Sliders Where IsActive = 1 ORDER BY OrderNr

        //END

        //GO

        //Create Proc[dbo].[Sliders_GetList]
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN


        //    DECLARE @totalRecords int

        //    SELECT s.*, ba.Name AS Creator, ba2.Name AS Modifier FROM Sliders s

        //    LEFT JOIN Administrators ba ON ba.ID = s.CUser
        //    LEFT JOIN Administrators ba2 ON ba2.ID = s.MUser

        //    ORDER BY s.OrderNr

        //    SELECT s.*, ba.Name AS Creator, ba2.Name AS Modifier FROM Sliders s

        //    LEFT JOIN Administrators ba ON ba.ID = s.CUser

        //    LEFT JOIN Administrators ba2 ON ba2.ID = s.MUser

        //    WHERE

        //    (@SearchValue IS NULL OR  (s.Name LIKE '%' + @SearchValue + '%' OR s.OrderNr LIKE '%' + @SearchValue + '%'  OR s.Header LIKE '%' + @SearchValue + '%'   ))

        // SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords AS TotalRecords FROM #TempTable
        // ORDER BY s.OrderNr DESC
        //    OFFSET @OffsetValue ROWS


        //    FETCH NEXT @PageLength ROWS ONLY
        //    DROP TABLE #TempTable
        //END

        //GO

        //Create Proc[dbo].[Sliders_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //SELECT* FROM Sliders Where ID=@ID

        //END

        //GO

        //CREATE Proc[dbo].[Sliders_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate DATETIME,
        //@CUser NVARCHAR(50),
        //@Header NVARCHAR(250),
        //@Content NVARCHAR(500),
        //@ShowButton BIT,
        //@ButtonRedirectUrl NVARCHAR(250) = null,
        //@IsActive BIT,
        //@OrderNr INT,
        //@ButtonName NVARCHAR(100) = null,
        //@ImageUrl NVARCHAR(MAX),
        //@Name NVARCHAR(500)
        //AS
        //    BEGIN TRY
        //        IF EXISTS(SELECT 1 FROM Sliders WHERE OrderNr = @OrderNr)
        //        BEGIN
        //            UPDATE Sliders
        //            SET OrderNr = OrderNr + 1
        //            WHERE OrderNr >= @OrderNr;
        //        END

        //           SET @IDOut = NEWID();

        //        INSERT INTO Sliders(ID, CDate, CUser, Header, Content, ShowButton,
        //        ButtonRedirectUrl, IsActive, OrderNr, ButtonName, ImageUrl, Name)
        //        VALUES(@IDOut, @CDate, @CUser, @Header,
        //           @Content, @ShowButton, @ButtonRedirectUrl, @IsActive, @OrderNr, @ButtonName, @ImageUrl, @Name);

        //        SELECT @IDOut


        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH

        //GO

        //CREATE Proc[dbo].[Sliders_Update]
        //@IDOut nvarchar(50) output,
        //@ID NVARCHAR(50),
        //@MDate DATETIME,
        //@MUser NVARCHAR(50),
        //@Header NVARCHAR(250),
        //@Content NVARCHAR(500),
        //@ShowButton BIT,
        //@ButtonRedirectUrl NVARCHAR(250),
        //@IsActive BIT,
        //@OrderNr INT,
        //@ButtonName NVARCHAR(100),
        //@ImageUrl NVARCHAR(MAX),
        //@Name NVARCHAR(500)
        //AS

        //BEGIN TRY
        //        DECLARE @CurrentOrderNr INT;
        //        SELECT @CurrentOrderNr = OrderNr FROM Sliders WHERE ID = @ID;

        //        IF @CurrentOrderNr IS NOT NULL AND @CurrentOrderNr != @OrderNr
        //        BEGIN
        //            IF EXISTS(SELECT 1 FROM Sliders WHERE OrderNr = @OrderNr)
        //            BEGIN
        //                IF @CurrentOrderNr<@OrderNr
        //                BEGIN
        //                    UPDATE Sliders
        //                    SET OrderNr = OrderNr - 1
        //                    WHERE OrderNr> @CurrentOrderNr AND OrderNr <= @OrderNr;
        //                END
        //                ELSE
        //                BEGIN
        //                    UPDATE Sliders
        //                    SET OrderNr = OrderNr + 1
        //                    WHERE OrderNr<@CurrentOrderNr AND OrderNr >= @OrderNr;
        //        END
        //    END
        //        END

        //        UPDATE Sliders
        //        SET MDate = @MDate,
        //            MUser = @MUser,
        //            Header = @Header,
        //            Content = @Content,
        //            ShowButton = @ShowButton,
        //            ButtonRedirectUrl = @ButtonRedirectUrl,
        //            IsActive = @IsActive,
        //            OrderNr = @OrderNr,
        //            ButtonName = @ButtonName,
        //            ImageUrl = @ImageUrl,
        //            Name = @Name
        //        WHERE ID = @ID;

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH

        //GO

        //ALTER Proc[dbo].[Blogs_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT b.*, bc.Name AS BlogCategoryName, ba.Name AS Creator, ba2.Name AS Modifier FROM Blogs b

        //    INNER JOIN BlogCategories bc ON bc.ID= b.IDBlogCategory

        //    LEFT JOIN Administrators ba ON ba.ID= b.CUser

        //    LEFT JOIN Administrators ba2 ON ba2.ID = b.MUser

        //    WHERE b.ID= @ID


        //    SELECT * FROM BlogCategories
        //END

        //GO

        //ALTER Proc[dbo].[Blogs_GetList]
        //AS
        //BEGIN

        //    SELECT b.*, bc.Name AS BlogCategoryName, ba.Name AS Creator, ba2.Name AS Modifier FROM Blogs b

        //    INNER JOIN BlogCategories bc ON bc.ID= b.IDBlogCategory

        //    LEFT JOIN Administrators ba ON ba.ID= b.CUser

        //    LEFT JOIN Administrators ba2 ON ba2.ID = b.MUser

        //    ORDER BY b.OrderNr
        //END

        //GO


        // ALTER TABLE dbo.CompanyApplications ADD
        // Website NVARCHAR (100) NULL

        //GO

        //ALTER Proc[dbo].[CompanyApplications_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@Name nvarchar(50),
        //@CUser nvarchar(50),
        //@Phone nvarchar(11),
        //@Title nvarchar(100)  = null,
        //@TaxNr nvarchar(11)  = null,
        //@TaxOffice nvarchar(50) = null,
        //@Address nvarchar(100)  = null,
        //@MonthlyGiro nvarchar(25),
        //@Email nvarchar(50),
        //@Password nvarchar(25),
        //@IdentityFrontSide varbinary(max),
        //@IdentityBackSide varbinary(max),
        //@TaxPlate varbinary(max) = null,
        //@SignatureCirculars varbinary(max),
        //@TradeRegistryGazette varbinary(max),
        //@Agreement varbinary(max),
        //@Website nvarchar(100)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        SET @IDOut = NEWID()
        //        INSERT INTO CompanyApplications(ID, CDate, Name, Phone, Title, TaxNr, TaxOffice, Address, MonthlyGiro, Email, Password, Website)

        //        VALUES(@IDOut, @CDate, @Name, @Phone, @Title, @TaxNr, @TaxOffice, @Address, @MonthlyGiro, @Email, @Password, @Website)
        //        SELECT @IDOut


        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyApplications_GetList]
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords int
        //    SELECT ID, CDate, MDate, Name, Phone, Title, TaxNr, TaxOffice, Address, MonthlyGiro, Email, Password , Website into #TempTable  FROM CompanyApplications
        // WHERE(@SearchValue IS NULL OR  (Name LIKE '%' + @SearchValue + '%' OR Phone LIKE '%' + @SearchValue + '%'  OR Title LIKE '%' + @SearchValue + '%'   ))
        // SELECT @totalRecords = COUNT(*) FROM #TempTable
        //  SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //  ORDER BY CDate DESC
        //          OFFSET @OffsetValue ROWS

        //         FETCH NEXT @PageLenght ROWS ONLY
        //    DROP TABLE #TempTable
        //END


        //GO

        //ALTER Proc[dbo].[CompanyApplications_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT ID, CDate, CUser, MDate, MUser, Phone, Name, Title, TaxNr, TaxOffice, Email, MonthlyGiro, Password, Address, IdentityFrontSide, IdentityBackSide, TaxPlate, SignatureCirculars, TradeRegistryGazette, Agreement,
        //    IdentityFrontSideStatus, IdentityBackSideStatus, TaxPlateStatus, SignatureCircularsStatus, TradeRegistryGazetteStatus, AgreementStatus, Website,
        //    Case When IdentityFrontSide IS NULL Then 'pe-none' When IdentityFrontSideStatus = 1 Then 'btn-success' When IdentityFrontSideStatus = 2 Then 'btn-danger' Else 'btn-dark' End AS IdentityFrontSideColor,
        // Case When IdentityBackSide IS NULL Then 'pe-none' When IdentityBackSideStatus = 1 Then 'btn-success' When IdentityBackSideStatus = 2 Then 'btn-danger' Else 'btn-dark' End AS IdentityBackSideColor,
        // Case When TaxPlate IS NULL Then 'pe-none' When TaxPlateStatus = 1 Then 'btn-success' When TaxPlateStatus = 2 Then 'btn-danger' Else 'btn-dark' End AS TaxPlateColor,
        // Case When SignatureCirculars IS NULL Then 'pe-none' When SignatureCircularsStatus = 1 Then 'btn-success' When SignatureCircularsStatus = 2 Then 'btn-danger' Else 'btn-dark' End AS SignatureCircularsColor,
        // Case When TradeRegistryGazette IS NULL Then 'pe-none' When TradeRegistryGazetteStatus = 1 Then 'btn-success' When TradeRegistryGazetteStatus = 2 Then 'btn-danger' Else 'btn-dark' End AS TradeRegistryGazetteColor,
        // Case When Agreement IS NULL Then 'pe-none' When AgreementStatus = 1 Then 'btn-success' When AgreementStatus = 2 Then 'btn-danger' Else 'btn-dark' End AS AgreementColor
        //    FROM CompanyApplications
        //    WHERE ID=@ID

        //END

        //GO

        //ALTER Proc[dbo].[CompanyApplications_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@Name nvarchar(50),
        //@Phone nvarchar(11),
        //@Title nvarchar(100)  = null,
        //@TaxNr nvarchar(11)  = null,
        //@TaxOffice nvarchar(50) = null,
        //@Address nvarchar(100)  = null,
        //@MonthlyGiro nvarchar(25),
        //@Email nvarchar(50),
        //@Password nvarchar(25),
        //@IdentityFrontSide varbinary(max),
        //@IdentityBackSide varbinary(max),
        //@TaxPlate varbinary(max) = null,
        //@SignatureCirculars varbinary(max),
        //@TradeRegistryGazette varbinary(max),
        //@Agreement varbinary(max),
        //@Website nvarchar(100)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        SET @IDOut = NEWID()
        //        INSERT INTO CompanyApplications(ID, CDate, Name, Phone, Title, TaxNr, TaxOffice, Address, MonthlyGiro, Email, Password, Website)

        //        VALUES(@IDOut, @CDate, @Name, @Phone, @Title, @TaxNr, @TaxOffice, @Address, @MonthlyGiro, @Email, @Password, @Website)
        //        SELECT @IDOut


        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END


        //GUNCELLENDİ

        //------------------------------------------------------- 24.07.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //   CREATE TABLE dbo.CompanyPaymentInstitutions(
        //   ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   CDate datetime NULL,
        //   CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //MDate datetime NULL,
        //MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //PaymentInstitutionID nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   IsActive bit NULL,
        //   CONSTRAINT PK_CompanyPaymentInstitutions PRIMARY KEY(ID)
        //   );

        //GO

        //ALTER Proc[dbo].[CompanyPaymentInstitutions_Insert]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@PaymentInstitutionID nvarchar(10),
        //@IsActive bit = null
        //AS
        //BEGIN

        //BEGIN TRY


        //    SET @IDOut = @ID


        //        INSERT INTO CompanyPaymentInstitutions
        //        (ID, CDate, CUser, MDate, MUser, PaymentInstitutionID, IsActive)

        //        VALUES(@ID, @CDate, @CUser, null, null, @PaymentInstitutionID, ISNULL(@IsActive,0));

        //  SELECT @IDOut

        //    END TRY

        //        BEGIN CATCH

        //            DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //            SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //            RAISERROR(@ERRORMESSAGE,16,1)

        //        END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyPaymentInstitutions_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT cpi.*, pins.Name as PaymentInstitutionName, pins.RedirectToActionGetThreeDView as RedirectToActionGetThreeDView,
        //    pins.RedirectToActionPaymentMethod as RedirectToActionPaymentMethod FROM CompanyPaymentInstitutions cpi

        //    INNER JOIN PaymentInstitutions pins ON pins.ID = cpi.PaymentInstitutionID

        //    WHERE cpi.ID = @ID

        //    ORDER BY pins.ID
        //END

        //GO

        //ALTER Proc[dbo].[PaymentCreditCardPools_GetList]
        //@Status tinyint = null,
        //@PaymentMethodID int = null,
        //@StartDate date,
        //@EndDate date,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT r.ID, r.CDate, r.MDate, r.TransactionDate,CASE WHEN ISNUMERIC(r.BankName) = 1 THEN pibi.Name ELSE r.BankName
        //END as BankName, ISNULL(cc.SenderName, r.SenderName) as SenderName , r.TransactionType, r.TransactionKey, ISNULL(cc.CardNumber, null) as CardNumber,
        //r.Commission, r.Amount, r.Status, r.InstallmentCount, r.PaymentMethodID, r.PaymentMethodName, r.Description,
        //cc.Status as SPStatus, JSON_VALUE(cl.Callback, '$.status_code') as SPDiscardedCallbackStatus, 
        //cl2.ResponseStatus as CBResponseStatus, cc.CardTypeId as CardTypeId
        //--GetBalance.SPNetAmount, 
        // --GetBalance.PaymentInstitutionNetAmount, GetBalance.PaymentInstitutionTotalAmount
        //into #TempTable  FROM PaymentCreditCardPools r
        //LEFT JOIN CreditCardPaymentNotifications cc on cc.TransactionID = r.TransactionKey
        //LEFT JOIN CallbackResponseLogs cl on cl.TransactionID = r.TransactionID and cl.ServiceType = 'STILPAY'
        //LEFT JOIN CallbackResponseLogs cl2 on cl2.TransactionID = r.TransactionID and cl2.ServiceType = 'STILPAY AUTOCALLBACK'
        //LEFT JOIN PaymentInstitutionBankIds pibi on pibi.PaymentInstitutionID = r.PaymentMethodID and r.BankName = pibi.ID
        //--and cl2.CDate = (SELECT MAX(cl3.CDate) FROM CallbackResponseLogs cl3 WHERE cl3.TransactionID = r.TransactionID AND cl3.ServiceType = 'STILPAY AUTOCALLBACK')
        //--cross join dbo.Fn_PaymentCreditCardPools_GetListBalance(@StartDate, @EndDate, @PaymentMethodID) as GetBalance

        //WHERE 1=1
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@PaymentMethodID IS NULL OR r.PaymentMethodID = @PaymentMethodID)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS date)>=CAST(@StartDate AS date))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS date)<=CAST(@EndDate AS date))
        //AND(@SearchValue IS NULL OR  (cc.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  OR r.TransactionType LIKE '%' + @SearchValue + '%'  OR
        //r.Amount LIKE '%' + @SearchValue + '%' OR cc.CardNumber LIKE '%' + @SearchValue + '%'))
        //and(r.Amount > 0 )

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY TransactionDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetDealerAccountSummary]
        //@IDCompany nvarchar(50),
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //        SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit,
        //        COUNT(*)  AS CreditCardCount,
        //         AVG(ccpn.PaymentInstitutionCommissionRate) AS CreditCardRate

        //        FROM CompanyTransactions t
        //        LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        WHERE t.IDActionType IN(100, 110)

        //        AND ccpn.CardTypeId = 2
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //),

        //WithdrawalRequestCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //        SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit,
        //        COUNT(*) WithdrawalRequestCount
        //        FROM CompanyTransactions t

        //        LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //        WHERE t.IDActionType = '30'
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //),

        //PaymentNotificationCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(t.Total)) AS PaymentNotificationTotalAmount,
        //        [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationProfit,
        //        COUNT(*) AS PaymentNotificationCount

        //        FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //        LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //        WHERE t.IDActionType IN(10, 20, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //),

        //RebateRequestCTE AS(
        //    SELECT
        //        sum([dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal) as RebateNetAmount
        //        From CompanyRebateRequests r

        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID

        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID

        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)

        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID

        //        WHERE ct2.IDActionType IN (90)

        //        AND r.Status = 2
        //        AND ct2.TransactionDate >= @ReportStartDateTime
        //        AND ct2.TransactionDate <= @ReportEndDateTime
        //        AND ct2.IDCompany = @IDCompany
        //),

        //BankCardCTE AS(
        //    SELECT
        //        COUNT(*) AS BankCardCount,
        //        [dbo].RoundToZero(SUM(t.Total)) AS BankCardSumTotal,
        //        SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS BankCardProfit,
        //        AVG(ccpn.PaymentInstitutionCommissionRate) AS BankCardRate
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //    WHERE t.IDActionType IN(100, 110)
        //        AND ccpn.CardTypeId = 1
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //)

        //SELECT
        //        (SELECT CreditCardSumTotal FROM CreditCardCTE) AS CreditCardSumTotal,
        //        (SELECT CreditCardProfit FROM CreditCardCTE) AS CreditCardProfit,
        //        (SELECT CreditCardCount FROM CreditCardCTE) AS CreditCardCount,
        //        (SELECT WithdrawalRequestTotalAmount FROM WithdrawalRequestCTE) AS WithdrawalRequestTotalAmount,
        //        (SELECT WithdrawalRequestProfit FROM WithdrawalRequestCTE) AS WithdrawalRequestProfit,
        //        (SELECT WithdrawalRequestCount FROM WithdrawalRequestCTE) AS WithdrawalRequestCount,
        //        (SELECT PaymentNotificationTotalAmount FROM PaymentNotificationCTE) AS PaymentNotificationTotalAmount,
        //        (SELECT PaymentNotificationProfit FROM PaymentNotificationCTE) AS PaymentNotificationProfit,
        //        (SELECT PaymentNotificationCount FROM PaymentNotificationCTE) AS PaymentNotificationCount,
        //        (SELECT RebateNetAmount FROM RebateRequestCTE) AS RebateNetAmount,
        //        (SELECT BankCardCount FROM BankCardCTE) AS BankCardCount,
        //        (SELECT BankCardSumTotal FROM BankCardCTE) AS BankCardSumTotal,
        //        (SELECT BankCardProfit FROM BankCardCTE) AS BankCardProfit,
        //        (CASE
        //            WHEN(SELECT CreditCardCount + BankCardCount FROM CreditCardCTE, BankCardCTE) = 0 THEN 0
        //            ELSE(SELECT(CreditCardSumTotal * CreditCardRate + BankCardSumTotal * BankCardRate) / (CreditCardSumTotal + BankCardSumTotal) FROM CreditCardCTE, BankCardCTE)
        //        END) AS AverageCommissionRate

        //END

        //GO

        //------------------------------------------------------- 25.07.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE PaymentInstitutions ADD
        //ConsecutiveTransactionLimit2 INT DEFAULT 0,
        //CurrentTransactionCount2 INT DEFAULT 0

        //GO

        //ALTER Proc[dbo].[PaymentInstitutions_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@IsActive bit = null,
        //@Rate decimal = null,
        //@Show bit = null,
        //@UseForForeignCard bit = null,
        //@DebitCardRate decimal = null,
        //@IsApi bit = null,
        //@EndOfDayTime nvarchar(10) = null,
        //@Name nvarchar(100) = null,
        //@ConsecutiveTransactionLimit int = null,
        //@CurrentTransactionCount int = null
        //AS
        //BEGIN

        //    Update PaymentInstitutions SET IsActive = @IsActive WHERE ID = @ID


        //    IF @EndOfDayTime IS NOT NULL
        //    BEGIN
        //        UPDATE PaymentInstitutions
        //        SET EndOfDayTime = @EndOfDayTime
        //        WHERE ID = @ID;
        //        END

        //           IF @ConsecutiveTransactionLimit IS NOT NULL
        //    BEGIN
        //        UPDATE PaymentInstitutions
        //        SET ConsecutiveTransactionLimit = @ConsecutiveTransactionLimit
        //        WHERE ID = @ID;
        //    END

        //    IF @CurrentTransactionCount IS NOT NULL
        //    BEGIN
        //        UPDATE PaymentInstitutions
        //        SET CurrentTransactionCount = @CurrentTransactionCount
        //        WHERE ID = @ID;
        //    END
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 31.07.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE Proc[dbo].[CreditCardPaymentNotifications_GetCreditCardTransactionsAPI]
        //@ServiceID nvarchar(50),
        //@StartDate datetime,
        //@EndDate datetime
        //AS
        //BEGIN
        //    SELECT r.SenderName, r.Phone,r.Amount, r.TransactionID, r.TransactionNr, r.CDate, DATEADD(SECOND, DATEDIFF(SECOND, '00:00:00', r.ActionTime), 
        // CAST(r.ActionDate AS datetime)) AS ActionDate, r.CardNumber, r.MemberIPAddress, R.MemberPort,
        //    CASE
        //        WHEN r.Status = 1 THEN 'BEKLİYOR' 
        //        WHEN r.Status = 2 THEN 'ONAYLANDI' 
        //        ELSE 'İPTAL EDİLDİ' 
        //    END AS Status,
        //    CASE
        //    WHEN crr.Status = 1 THEN 'IADE BEKLİYOR' 
        //    WHEN crr.Status = 2 THEN 'IADE ONAYLANDI'
        //    WHEN crr.Status = 3 THEN 'IADE ONAYLANMADI' 
        //    ELSE NULL
        //    END AS RebateStatus, r.Description
        //    FROM CreditCardPaymentNotifications r
        //    LEFT JOIN CompanyRebateRequests crr on crr.TransactionID = r.TransactionID


        //    WHERE 1=1

        //          AND (r.ServiceID= @ServiceID)

        //          AND(CAST(r.CDate AS datetime)>=CAST(@StartDate AS datetime))
        //    AND(CAST(r.CDate AS datetime)<=CAST(@EndDate AS datetime))   

        // ORDER BY r.CDate desc
        //END


        //------------------------------------------------------- 06.08.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE CompanyRebateRequests ADD
        //IsPartialRebate bit DEFAULT 0 NULL

        //GO

        //ALTER Proc[dbo].[CompanyRebateRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@TransactionID nvarchar(50),
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null,
        //@Amount decimal,
        //@IsPartialRebate bit
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //IF(Select Count(*) From CompanyRebateRequests Where TransactionID= @TransactionID AND Status IN (1,2))>0
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu işlem numaralı iade talebi sistemde mevcut.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<@Amount
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<@Amount
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //SET @IDOut = NEWID()


        //INSERT INTO CompanyRebateRequests(ID, CUser, CDate, TransactionNr, IDCompany, TransactionID, IDMember, IDBank, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, IsPartialRebate, Status, IsBankQueryNr, SIDBank)

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, IDBank, ActionDate, ActionTime, @Amount, SenderName, SenderIdentityNr, @IsPartialRebate, 1, @IsBankQueryNr, @SIDBank FROM PaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UNION ALL

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, '00' , ActionDate, ActionTime, @Amount, SenderName, SenderIdentityNr, @IsPartialRebate, 1 , @IsBankQueryNr, @SIDBank FROM CreditCardPaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UNION ALL

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, '00' , ActionDate, ActionTime, @Amount, SenderName, SenderIdentityNr, @IsPartialRebate, 1 , @IsBankQueryNr, @SIDBank FROM ForeignCreditCardPaymentNotifications Where TransactionID=@TransactionID AND Status=2

        //UPDATE Companies SET UsingBalance-=(select case when @IsPartialRebate = 1 then @Amount -  ((@Amount* ct.CommissionRate) / 100) else ct.NetTotal end from PaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType IN('10', '20') and ct.TransactionNr=pn.TransactionNr
        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany

        //UNION ALL

        //select case when @IsPartialRebate = 1 then @Amount -  ((@Amount* ct.CommissionRate) / 100) else ct.NetTotal end from CreditCardPaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType= '100' and ct.TransactionNr= pn.TransactionNr

        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany

        //UNION ALL

        //select case when @IsPartialRebate = 1 then @Amount -  ((@Amount* ct.CommissionRate) / 100) else ct.NetTotal end from ForeignCreditCardPaymentNotifications pn

        //inner join CompanyTransactions ct on ct.IDActionType= '140' and ct.TransactionNr= pn.TransactionNr

        //where pn.TransactionID= @TransactionID AND ct.IDCompany= @IDCompany)

        //WHERE ID = @IDCompany


        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyTransactions_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT t.* FROM CompanyTransactions t
        //    WHERE t.ID = @ID
        //END

        //GO

        //        	        -- CompanyTransactions_GetAccountReport NULL, NULL, NULL

        //        ALTER Proc[dbo].[CompanyTransactions_GetAccountReportv2]
        //        @IDCompany nvarchar(50),
        //        @StartDate datetime,
        //        @EndDate datetime
        //        AS
        //        BEGIN

        //        SELECT top 1 
        //        isnull(sumT.TransferTotalAmount,0) as TransferTotalAmount ,
        //        isnull(sumTr.CompanyCommission,0) as TransferCommissionProfitAmount,
        //        isnull(sumTr.TransferDealerPaidAmount,0) as TransferDealerPaidAmount,
        //        isnull(sumTrPool.Amount,0) as TransferNotMatchedAmount,

        //        isnull(sumT.CreditCardTotalAmount,0) as CreditCardTotalAmount,
        //        isnull(sumCr.CompanyCommission,0) as CreditCardCommissionProfitAmount,
        //        isnull(sumCr.CreditCardDealerPaidAmount,0) as CreditCardDealerPaidAmount,
        //        isnull(sumCr.CreditCardPaymentInstitutionPaidAmount,0) as CreditCardPaymentInstitutionPaidAmount,              

        //        isnull(sumWt.WithdrawalTotalAmount,0) as WithdrawalTotalAmount, 
        //        isnull(sumWt.WithdrawalTotalPaidAmount,0) as WithdrawalTotalPaidAmount, 
        //        isnull(sumWt.WithdrawalTotalTransactionFeeAmount,0) as WithdrawalTotalTransactionFeeAmount, 
        //        isnull(sumEft.Amount,0) as WithdrawalEftAmount, 
        //        isnull(sumFast.Amount,0) as WithdrawalFastAmount, 

        //       	isnull(sumRebate.Amount,0) as RebateExpenseProfitAmount, 
        //       	isnull(sumFraud.Amount,0) as FraudExpenseProfitAmount, 
        //        isnull(sumEx.Amount,0) as TotalExpenseAmount,
        //        isnull(sumIncome.Amount,0) as TotalIncomeAmount

        //        FROM CompanyTransactions t

        //        cross join(Select SUM(CASE WHEN t.IDActionType IN (10, 20,150) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS TransferTotalAmount,
        //        SUM(CASE WHEN t.IDActionType IN(100, 110) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS CreditCardTotalAmount From CompanyTransactions

        //        t where IDActionType IN(10,20,100,110,150)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //--        cross join(Select sum([dbo].RoundToZero(Commission)) as Commission From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumC

        //        cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as CompanyCommission, 
        //        sum([dbo].RoundToZero(NetTotal)) as CreditCardDealerPaidAmount, 
        //        sum([dbo].RoundToZero(CompanyCommission)) as CreditCardPaymentInstitutionPaidAmount
        //        From CompanyTransactions t where IDActionType IN(100,110)
        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumCr

        //        cross join(Select sum([dbo].RoundToZero(Commission)) as CompanyCommission, sum([dbo].RoundToZero(NetTotal)) AS TransferDealerPaidAmount

        //        From CompanyTransactions t where IDActionType IN(10,20,150)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumTr

        //--        cross join(Select sum([dbo].RoundToZero(NetTotal)) as NetTotal From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumNet

        //        cross join(Select sum([dbo].RoundToZero(t.Total + t.CostTotal)) as WithdrawalTotalAmount,
        //        sum([dbo].RoundToZero(t.Total)) as WithdrawalTotalPaidAmount,
        //        sum([dbo].RoundToZero(t.CostTotal)) as WithdrawalTotalTransactionFeeAmount

        //        From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        Where
        //         t.IDActionType IN (30)
        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumWt

        //        CROSS JOIN(
        //            SELECT
        //                SUM(
        //                    ROUND(
        //                        CASE
        //                            WHEN ct.Commission = ct.CompanyCommission THEN 0

        //                            ELSE
        //                                CASE

        //                                    WHEN r.IsPartialRebate = 1 THEN ct2.CompanyCommission - ct2.Total
        //                                    ELSE [dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal
        //                                END

        //                        END, 4
        //		            )
        //		        ) AS Amount
        //        From CompanyRebateRequests r
        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)

        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //           where r.Status = 2
        //        and (@IDCompany IS NULL OR ct.IDCompany= @IDCompany)
        //        and(CAST(ct2.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(ct2.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumRebate

        //        cross join(select sum([dbo].RoundToZero(r.PaymentInstitutionNetAmount - r.Commission)) as Amount
        //        From CreditCardPaymentNotifications r

        //           INNER JOIN CompanyIntegrations ci on ci.ServiceID = r.ServiceID
        //           where r.Status in (6,7) AND r.PaymentInstitutionNetAmount is not null 
        //        and (@IDCompany IS NULL OR ci.ID= @IDCompany)
        //        and(CAST(r.MDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(r.MDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFraud


        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast

        //--        cross join(Select sum([dbo].RoundToZero(cw.CostTotal)) as CostTotal , Count(cw.Amount) as cwCostTotal From CompanyTransactions t
        //--
        //--        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //--        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcess

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 2

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1 ) as sumEx

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 1

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //    and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1  ) as sumIncome

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From PaymentTransferPools t

        //        where t.Status = 1 
        //        AND NOT EXISTS (select* from WhereConditions wc
        //        WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //        (wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //        AND t.Amount > 0 


        //		) as sumTrPool

        //        --WHERE(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        // --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)))
        //        --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)))


        //        END

        //GO

        //ALTER Proc[dbo].[CompanyBankAccounts_TotalCreditCardSum]
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(50),
        //@StartDate date = null,
        //@EndDate date = null
        //AS
        //BEGIN


        //DECLARE @Counter INT = 1;
        //DECLARE @MaxCount INT;
        //SELECT @MaxCount = COUNT(*) FROM PaymentInstitutions WHERE Show = 1

        //CREATE TABLE #TempResults
        //(
        //    ID NVARCHAR(50),
        //    Amount DECIMAL(18, 2),
        //    CreditCardAmount DECIMAL(18, 2),
        //    EftAmount DECIMAL(18, 2),
        //    NetAmount DECIMAL(18, 2),
        //    CountNetAmount INT,
        //    Name NVARCHAR(200),
        //    UseForForeignCard BIT,
        //    EndOfDayTime NVARCHAR(10)
        //);

        //WHILE @Counter <= @MaxCount
        //BEGIN
        //    DECLARE @CurrentID NVARCHAR(50);
        //        DECLARE @Name NVARCHAR(200);
        //        DECLARE @UseForForeignCard BIT;
        //    DECLARE @EndOfDayTime NVARCHAR(10)

        //    SELECT @CurrentID = ID, @Name = Name, @UseForForeignCard = UseForForeignCard, @EndOfDayTime = EndOfDayTime
        //    FROM(
        //        SELECT ID, Name, UseForForeignCard, EndOfDayTime, ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS RowNum
        //        FROM PaymentInstitutions
        //        WHERE Show = 1
        //    ) AS RowNumbered
        //    WHERE RowNum = @Counter;

        //        IF @CurrentID = 6

        //    BEGIN
        //        INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount,EndOfDayTime )
        //    SELECT TOP(1)
        //        @CurrentID AS ID,
        //        isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //        @Name AS Name,
        //        @UseForForeignCard AS UseForForeignCard,
        //        0 AS CreditCardAmount,
        //        isnull(CountNetAmountToday, 0) - isnull(Piece,0) AS EftAmount,
        //        isnull(sumT.NetAmountTotal, 0) AS NetAmount,
        //        isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount,
        //        @EndOfDayTime as EndOfDayTime
        //    FROM
        //    (
        //        SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //               SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //        FROM (
        //            SELECT sum(Amount) AS Amount,
        //                   CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                   CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                   SUM(isnull(Piece,0)) AS Piece
        //            FROM CompanyFinanceTransaction
        //            WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2
        //            GROUP BY TransactionType
        //        ) AS Total
        //    ) AS AmountTotal
        //    LEFT JOIN(
        //        SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //               SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //               SUM(NetAmountTotal) AS NetAmountTotal,
        //               SUM(CountNetAmount) AS CountNetAmount,
        //               SUM(CountNetAmountToday) AS CountNetAmountToday
        //        FROM (
        //            SELECT sum(Total) + isnull(ccPool.Amount,0) AS NetAmountTotal,
        //                    sum((Total - isnull(t.CompanyCommission, 0))) + isnull(ccPool.Amount,0) AS NetAmount,
        //                       count((Total)) + isnull(RebateCount,0) AS CountNetAmount,
        //                    count(CASE WHEN CONVERT(DATE, t.TransactionDate) = CONVERT(DATE, GETDATE()) THEN 1 ELSE NULL END) + isnull(RebateCount,0) AS CountNetAmountToday,
        //                    case when IsPartialRebate = 1 then isnull(cr.PartialCompanyCommission,0) else (isnull(cr.Amount,0) - isnull(cr.CompanyCommission,0)) end AS ExpenseNetAmount
        //            FROM CompanyTransactions t
        //            LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //            CROSS JOIN (
        //                SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                       sum(t.CompanyCommission) as PartialCompanyCommission,
        //                        SUM(CASE WHEN IsPartialRebate = 1 THEN 1 ELSE 0 END) AS IsPartialRebate,
        //                       sum(cr.Amount) AS Amount,
        //                       count(cr.Amount) AS RebateCount
        //                FROM CompanyRebateRequests cr
        //                INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //                INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //                INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND(@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //     AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //            ) cr

        //            CROSS JOIN(
        //                SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                From CreditCardPaymentNotifications cpn
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND cpn.Status in (5,6) AND cpn.TransactionReferenceCode is not null AND cpn.PaymentInstitutionNetAmount is not null 
        //                AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) ccPool

        //            WHERE IDActionType IN(100,110) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID AND (@StartDate IS NULL OR CAST(TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //            AND(@EndDate IS NULL OR CAST(TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //            GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount, cr.PartialCompanyCommission, cr.IsPartialRebate
        //        ) AS AmountTotal
        //    ) AS sumT ON sumT.ID = @CurrentID
        //    END

        //    ELSE
        //        BEGIN

        //            INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount, EndOfDayTime)
        //    SELECT TOP(1)
        //        @CurrentID AS ID,
        //        isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //        @Name AS Name,
        //        @UseForForeignCard AS UseForForeignCard,
        //        0 AS CreditCardAmount,
        //        0 AS EftAmount,
        //        isnull(sumT.NetAmount, 0) AS NetAmount,
        //       isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount,
        //       @EndOfDayTime as EndOfDayTime
        //    FROM
        //    (
        //        SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //               SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //        FROM (
        //            SELECT sum(Amount) AS Amount,
        //                   CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                   CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                   SUM(isnull(Piece,0)) AS Piece

        //                FROM CompanyFinanceTransaction

        //                WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2

        //                GROUP BY TransactionType
        //         ) AS Total
        //     ) AS AmountTotal
        //    LEFT JOIN(
        //            SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //                   SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //                   SUM(CountNetAmount) AS CountNetAmount
        //            FROM (
        //                SELECT sum(ISNULL((Total - isnull(t.CompanyCommission,0)),0)) + isnull(ccPool.Amount,0) AS NetAmount,
        //                       count((NetTotal)) + isnull(RebateCount,0) AS CountNetAmount,
        //                    case when IsPartialRebate = 1 then isnull(cr.PartialCompanyCommission,0) else (isnull(cr.Amount,0) - isnull(cr.CompanyCommission,0)) end AS ExpenseNetAmount
        //                FROM CompanyTransactions t

        //                LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //                CROSS JOIN (
        //                    SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                            sum(t.CompanyCommission) as PartialCompanyCommission,
        //                            SUM(CASE WHEN IsPartialRebate = 1 THEN 1 ELSE 0 END) AS IsPartialRebate,
        //                           sum(cr.Amount) AS Amount,
        //                           count(cr.Amount) AS RebateCount

        //                    FROM CompanyRebateRequests cr
        //         INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //                    INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //                    INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //                    WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND(@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //            AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) cr

        //                CROSS JOIN(
        //     SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                From CreditCardPaymentNotifications cpn
        //                WHERE cpn.CreditCardPaymentMethodID = @CurrentID
        //                AND cpn.Status in (5,6) AND cpn.TransactionReferenceCode is not null 
        //                AND cpn.PaymentInstitutionNetAmount is not null 
        //                AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //             ) ccPool

        //                WHERE IDActionType IN(100,110) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID

        //                GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount, cr.PartialCompanyCommission, cr.IsPartialRebate

        //               ) AS AmountTotal
        //     ) AS sumT ON sumT.ID = @CurrentID
        //        END
        //    SET @Counter = @Counter + 1;
        //        END;

        //SELECT* FROM #TempResults ORDER BY CAST(ID AS INT);
        //DROP TABLE #TempResults;

        //END

        //GO

        //alter PROCEDURE[dbo].[CompanyTransactions_GetDealerAccountSummary]
        //@IDCompany nvarchar(50),
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //        SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit,
        //        COUNT(*)  AS CreditCardCount,
        //         AVG(ccpn.PaymentInstitutionCommissionRate) AS CreditCardRate

        //        FROM CompanyTransactions t
        //        LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        WHERE t.IDActionType IN(100, 110)

        //        AND ccpn.CardTypeId = 2
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //),

        //WithdrawalRequestCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //        SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit,
        //        COUNT(*) WithdrawalRequestCount
        //        FROM CompanyTransactions t

        //        LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //        WHERE t.IDActionType = '30'
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //),

        //PaymentNotificationCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(t.Total)) AS PaymentNotificationTotalAmount,
        //        [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationProfit,
        //        COUNT(*) AS PaymentNotificationCount

        //        FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //        LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //        WHERE t.IDActionType IN(10, 20, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //),

        //RebateRequestCTE AS(
        //        SELECT case when r.IsPartialRebate = 1 then ct2.CompanyCommission - ct2.NetTotal else

        //        sum([dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal) end as RebateNetAmount
        //        From CompanyRebateRequests r

        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID

        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID

        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)

        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID

        //        WHERE ct2.IDActionType IN (90)

        //        AND r.Status = 2
        //        AND ct2.TransactionDate >= @ReportStartDateTime
        //        AND ct2.TransactionDate <= @ReportEndDateTime
        //        AND ct2.IDCompany = @IDCompany
        //        group by r.IsPartialRebate , ct2.CompanyCommission, ct2.NetTotal
        //),

        //BankCardCTE AS(
        //    SELECT
        //        COUNT(*) AS BankCardCount,
        //        [dbo].RoundToZero(SUM(t.Total)) AS BankCardSumTotal,
        //        SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS BankCardProfit,
        //        AVG(ccpn.PaymentInstitutionCommissionRate) AS BankCardRate
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //    WHERE t.IDActionType IN(100, 110)
        //        AND ccpn.CardTypeId = 1
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany
        //)


        //SELECT
        //        (SELECT CreditCardSumTotal FROM CreditCardCTE) AS CreditCardSumTotal,
        //        (SELECT CreditCardProfit FROM CreditCardCTE) AS CreditCardProfit,
        //        (SELECT CreditCardCount FROM CreditCardCTE) AS CreditCardCount,
        //        (SELECT WithdrawalRequestTotalAmount FROM WithdrawalRequestCTE) AS WithdrawalRequestTotalAmount,
        //        (SELECT WithdrawalRequestProfit FROM WithdrawalRequestCTE) AS WithdrawalRequestProfit,
        //        (SELECT WithdrawalRequestCount FROM WithdrawalRequestCTE) AS WithdrawalRequestCount,
        //        (SELECT PaymentNotificationTotalAmount FROM PaymentNotificationCTE) AS PaymentNotificationTotalAmount,
        //        (SELECT PaymentNotificationProfit FROM PaymentNotificationCTE) AS PaymentNotificationProfit,
        //        (SELECT PaymentNotificationCount FROM PaymentNotificationCTE) AS PaymentNotificationCount,
        //        (SELECT RebateNetAmount FROM RebateRequestCTE) AS RebateNetAmount,
        //        (SELECT BankCardCount FROM BankCardCTE) AS BankCardCount,
        //        (SELECT BankCardSumTotal FROM BankCardCTE) AS BankCardSumTotal,
        //        (SELECT BankCardProfit FROM BankCardCTE) AS BankCardProfit,

        //        (CASE
        //            WHEN(SELECT CreditCardSumTotal + BankCardSumTotal FROM CreditCardCTE, BankCardCTE) = 0 THEN 0
        //            ELSE(SELECT CreditCardSumTotal * 100 / (CreditCardSumTotal + BankCardSumTotal) FROM CreditCardCTE, BankCardCTE)
        //        END) AS CreditCardRevenuePercentage,
        //        (CASE
        //            WHEN(SELECT CreditCardSumTotal + BankCardSumTotal FROM CreditCardCTE, BankCardCTE) = 0 THEN 0
        //            ELSE(SELECT BankCardSumTotal * 100 / (CreditCardSumTotal + BankCardSumTotal) FROM CreditCardCTE, BankCardCTE)
        //        END) AS BankCardRevenuePercentage,

        //        (CASE
        //            WHEN(SELECT CreditCardProfit + BankCardProfit FROM CreditCardCTE, BankCardCTE) = 0 THEN 0
        //            ELSE(SELECT CreditCardProfit * 100 / (CreditCardProfit + BankCardProfit) FROM CreditCardCTE, BankCardCTE)
        //        END) AS CreditCardProfitPercentage,
        //        (CASE
        //            WHEN(SELECT CreditCardProfit + BankCardProfit FROM CreditCardCTE, BankCardCTE) = 0 THEN 0
        //            ELSE(SELECT BankCardProfit * 100 / (CreditCardProfit + BankCardProfit) FROM CreditCardCTE, BankCardCTE)
        //        END) AS BankCardProfitPercentage,

        //        (CASE
        //            WHEN(SELECT CreditCardCount + BankCardCount FROM CreditCardCTE, BankCardCTE) = 0 THEN 0
        //            ELSE(SELECT(CreditCardSumTotal * CreditCardRate + BankCardSumTotal * BankCardRate) / (CreditCardSumTotal + BankCardSumTotal) FROM CreditCardCTE, BankCardCTE)
        //        END) AS AverageCommissionRate


        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetMonthlyAccountSummary]
        //@DailyReportStartDateTime datetime,
        //@DailyReportEndDateTime datetime,
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime,
        //@WeeklyReportStartDateTime datetime,
        //@WeeklyReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //    SELECT
        //        ccpn.CreditCardPaymentMethodID AS CreditCardPaymentMethodID,
        //        [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //    SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //    WHERE t.IDActionType IN(100, 110)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ccpn.CreditCardPaymentMethodID
        //),

        //PaymentTransferPoolCTE AS(
        //    SELECT
        //        t.IDBank AS PaymentTranferPoolBankID,
        //        [dbo].RoundToZero(SUM(t.Amount)) AS PaymentTranferPoolSumTotal,
        //    [dbo].RoundToZero(SUM(ct.Commission)) AS PaymentNotificationProfitAmount
        //    FROM PaymentTransferPools t
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionNr = t.ResponseTransactionNr
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = pn.ID
        //    WHERE t.Status = 2
        //        AND ct.TransactionDate >= @ReportStartDateTime
        //        AND ct.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDBank
        //),

        //WithdrawalRequestCTE AS(
        //    SELECT
        //        cwr.SIDBank AS WithdrawalRequestSIDBank,
        //        [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //        SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit
        //FROM CompanyTransactions t
        //LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //WHERE t.IDActionType = '30'
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY cwr.SIDBank
        //),

        //PaymentNotificationCTE AS(
        //    SELECT
        //        ptp.IDBank AS PaymentNotificationSIDBank,
        //        [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationTotalAmount
        //    FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //    LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //    WHERE t.IDActionType IN(10, 20, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ptp.IDBank
        //),

        //DateRangeQueryCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @DailyReportStartDateTime
        //    AND TransactionDate <= @DailyReportEndDateTime THEN Total ELSE 0 END)) AS DailyTotalPaymentAmount,

        //    [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @WeeklyReportStartDateTime
        //    AND TransactionDate <= @WeeklyReportEndDateTime THEN Total ELSE 0 END)) AS WeeklyTotalPaymentAmount,

        //    [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @ReportStartDateTime
        //        AND TransactionDate <= @ReportEndDateTime THEN Total ELSE 0 END)) AS MonthlyTotalPaymentAmount

        //    FROM CompanyTransactions

        //    WHERE IDActionType IN(10, 20, 100, 110,150)
        //),

        //CompanyTransactionCTE AS(
        //    SELECT
        //        t.IDCompany AS IDCompany,
        //        [dbo].RoundToZero(SUM(CASE WHEN t.IDActionType<> 30 THEN t.Total ELSE 0 END)) AS CompanyTransactionTotalAmount,

        //           [dbo].RoundToZero(SUM(t.Commission - t.CompanyCommission) + SUM(t.CostTotal)) AS CompanyTransactionProfit,
        //        [dbo].RoundToZero(SUM(CASE WHEN t.IDActionType = 30 THEN t.Total ELSE 0 END)) AS CompanyWithdrawalTransactionTotalAmount,
        //        [dbo].RoundToZero(SUM(CASE WHEN t.IDActionType = 30 THEN 1 ELSE 0 END)) AS CompanyWithdrawalTransactionCount
        //    FROM CompanyTransactions t
        //    INNER JOIN Companies c on c.ID = t.IDCompany
        //    WHERE t.IDActionType IN(10, 20, 30, 100, 110, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDCompany
        //),

        //RebateRequestCTE AS(
        //    SELECT case when r.IsPartialRebate = 1 then ct2.CompanyCommission - ct2.NetTotal else
        //    sum([dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal) end as RebateNetAmount
        //    From CompanyRebateRequests r
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //    LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //    LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)
        //    LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //    WHERE ct2.IDActionType IN (90)
        //        AND ct2.TransactionDate >= @ReportStartDateTime
        //        AND ct2.TransactionDate <= @ReportEndDateTime
        //        group by r.IsPartialRebate , ct2.CompanyCommission, ct2.NetTotal
        //)

        //SELECT
        //    CreditCardCTE.CreditCardPaymentMethodID,
        //    CreditCardCTE.CreditCardSumTotal,
        //    CreditCardCTE.CreditCardProfit,
        //    PaymentTransferPoolCTE.PaymentTranferPoolBankID,
        //    PaymentTransferPoolCTE.PaymentTranferPoolSumTotal,
        //    WithdrawalRequestCTE.WithdrawalRequestSIDBank,
        //    WithdrawalRequestCTE.WithdrawalRequestTotalAmount,
        //    WithdrawalRequestCTE.WithdrawalRequestProfit,
        //    PaymentNotificationCTE.PaymentNotificationSIDBank,
        //    PaymentNotificationCTE.PaymentNotificationTotalAmount,
        //    DateRangeQueryCTE.DailyTotalPaymentAmount,
        //    DateRangeQueryCTE.WeeklyTotalPaymentAmount,
        //    DateRangeQueryCTE.MonthlyTotalPaymentAmount,
        //    CompanyTransactionCTE.IDCompany,
        //    CompanyTransactionCTE.CompanyTransactionTotalAmount,
        //    CompanyTransactionCTE.CompanyTransactionProfit,
        //    CompanyTransactionCTE.CompanyWithdrawalTransactionTotalAmount,
        //    CompanyTransactionCTE.CompanyWithdrawalTransactionCount,
        //    RebateRequestCTE.RebateNetAmount
        //FROM CreditCardCTE
        //FULL JOIN PaymentTransferPoolCTE ON 1 = 0
        //FULL JOIN WithdrawalRequestCTE ON 1 = 0
        //FULL JOIN PaymentNotificationCTE ON 1 = 0
        //FULL JOIN DateRangeQueryCTE ON 1 = 0
        //FULL JOIN CompanyTransactionCTE ON 1 = 0
        //FULL JOIN RebateRequestCTE ON 1 = 0;
        //        END

        //GO

        //ALTER Proc[dbo].[CompanyRebateRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null,
        //@CompanyBankAccountID nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        UPDATE CompanyRebateRequests SET MUser = @MUser, MDate = @MDate, Description = @Description, Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank, CompanyBankAccountID = @CompanyBankAccountID

        //        WHERE ID = @ID AND Status in (1,8)

        //        IF(@Status= 2)

        //        BEGIN
        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //            SELECT cr.ID, GETDATE(), cr.IDCompany, '90', cr.MDate, cr.TransactionNr, cr.IDBank,
        //   case when cr.IsPartialRebate = 1 then cr.Amount - ((cr.Amount* ct.CommissionRate) / 100) else ct.NetTotal end, 0, 0,
        //   case when cr.IsPartialRebate = 1 then cr.Amount - ((cr.Amount* ct.CommissionRate) / 100) else ct.NetTotal end,
        //   case when cr.IsPartialRebate = 1 then cr.Amount - ((cr.Amount* ct.CompanyCommissionRate) / 100) else ct.NetTotal end,
        //            ct.CompanyCommissionRate
        //            FROM CompanyRebateRequests cr

        //            LEFT JOIN PaymentNotifications pt ON pt.TransactionID=cr.TransactionID
        //            LEFT JOIN CreditCardPaymentNotifications ccpt ON ccpt.TransactionID= cr.TransactionID

        //            LEFT JOIN ForeignCreditCardPaymentNotifications fccpt ON fccpt.TransactionID= cr.TransactionID

        //            INNER JOIN CompanyTransactions ct ON (ct.TransactionNr= pt.TransactionNr or ct.TransactionNr= ccpt.TransactionNr or ct.TransactionNr= fccpt.TransactionNr) AND ct.IDActionType IN ('10', '20', '100', '90','140')

        //            WHERE cr.ID=@ID
        //        END

        //        ELSE IF(@Status= 3)

        //        BEGIN
        //            UPDATE Companies SET UsingBalance+=(select case when cr.IsPartialRebate = 1 then cr.Amount -  ((cr.Amount* ct.CommissionRate) / 100) else ct.NetTotal end from CompanyRebateRequests cr
        //            left join PaymentNotifications pn on pn.TransactionID=cr.TransactionID
        //            left join CreditCardPaymentNotifications ccpt on ccpt.TransactionID=cr.TransactionID
        //            LEFT JOIN ForeignCreditCardPaymentNotifications fccpt ON fccpt.TransactionID=cr.TransactionID
        //            inner join CompanyTransactions ct on ct.IDActionType IN('10', '20', '100','140') and(ct.TransactionNr= pn.TransactionNr or ct.TransactionNr= ccpt.TransactionNr or ct.TransactionNr= fccpt.TransactionNr)

        //            where cr.ID=@ID)

        //        END

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyRebateRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null,
        //@CompanyBankAccountID nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        UPDATE CompanyRebateRequests SET MUser = @MUser, MDate = @MDate, Description = @Description, Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank, CompanyBankAccountID = @CompanyBankAccountID

        //        WHERE ID = @ID AND Status in (1,8)

        //        IF(@Status= 2)

        //        BEGIN
        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //            SELECT cr.ID, GETDATE(), cr.IDCompany, '90', cr.MDate, cr.TransactionNr, cr.IDBank,
        //   case when cr.IsPartialRebate = 1 then cr.Amount - ((cr.Amount* ct.CommissionRate) / 100) else ct.NetTotal end, 0, 0,
        //   case when cr.IsPartialRebate = 1 then cr.Amount - ((cr.Amount* ct.CommissionRate) / 100) else ct.NetTotal end,
        //   case when cr.IsPartialRebate = 1 then cr.Amount - ((cr.Amount* ct.CompanyCommissionRate) / 100) else ct.NetTotal end,
        //            ct.CompanyCommissionRate
        //            FROM CompanyRebateRequests cr

        //            LEFT JOIN PaymentNotifications pt ON pt.TransactionID=cr.TransactionID
        //            LEFT JOIN CreditCardPaymentNotifications ccpt ON ccpt.TransactionID= cr.TransactionID

        //            LEFT JOIN ForeignCreditCardPaymentNotifications fccpt ON fccpt.TransactionID= cr.TransactionID

        //            INNER JOIN CompanyTransactions ct ON (ct.TransactionNr= pt.TransactionNr or ct.TransactionNr= ccpt.TransactionNr or ct.TransactionNr= fccpt.TransactionNr) AND ct.IDActionType IN ('10', '20', '100', '90','140')

        //            WHERE cr.ID=@ID
        //        END

        //        ELSE IF(@Status= 3)

        //        BEGIN
        //            UPDATE Companies SET UsingBalance+=(select case when cr.IsPartialRebate = 1 then cr.Amount -  ((cr.Amount* ct.CommissionRate) / 100) else ct.NetTotal end from CompanyRebateRequests cr
        //            left join PaymentNotifications pn on pn.TransactionID=cr.TransactionID
        //            left join CreditCardPaymentNotifications ccpt on ccpt.TransactionID=cr.TransactionID
        //            LEFT JOIN ForeignCreditCardPaymentNotifications fccpt ON fccpt.TransactionID=cr.TransactionID
        //            inner join CompanyTransactions ct on ct.IDActionType IN('10', '20', '100','140') and(ct.TransactionNr= pn.TransactionNr or ct.TransactionNr= ccpt.TransactionNr or ct.TransactionNr= fccpt.TransactionNr)

        //            where cr.ID=@ID and cr.IDCompany = ct.IDCompany)

        //            WHERE ID = (select cr.IDCompany from CompanyRebateRequests cr where cr.ID=@ID)

        //        END

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END


        //------------------------------------------------------- 15.08.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        // ALTER TABLE dbo.Companies ADD
        // AutoForeignCreditCardLimit decimal (18, 2) NULL DEFAULT 0

        //GO

        //CREATE Proc[dbo].[Companies_SetAutoForeignCreditCardLimit]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@AutoForeignCreditCardLimit decimal (18,2)
        //AS
        //BEGIN
        //    BEGIN TRY

        //       UPDATE Companies SET AutoForeignCreditCardLimit = @AutoForeignCreditCardLimit  WHERE ID = @ID
        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyApplications_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@Name nvarchar(50),
        //@Phone nvarchar(11),
        //@Title nvarchar(100)  = null,
        //@TaxNr nvarchar(11)  = null,
        //@TaxOffice nvarchar(50) = null,
        //@Address nvarchar(100)  = null,
        //@MonthlyGiro nvarchar(25),
        //@Email nvarchar(50),
        //@Password nvarchar(25),
        //@IdentityFrontSide varbinary(max),
        //@IdentityBackSide varbinary(max),
        //@TaxPlate varbinary(max) = null,
        //@SignatureCirculars varbinary(max),
        //@TradeRegistryGazette varbinary(max),
        //@Agreement varbinary(max),
        //@Website nvarchar(100)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        SET @IDOut = NEWID()
        //        INSERT INTO CompanyApplications(ID, CDate, Name, Phone, Title, TaxNr, TaxOffice, Address, MonthlyGiro, Email, Password, Website)

        //        VALUES(@IDOut, @CDate, @Name, @Phone, ISNULL(@Title, @Name), @TaxNr, @TaxOffice, @Address, @MonthlyGiro, @Email, @Password, @Website)
        //        SELECT @IDOut


        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //ALTER Proc[dbo].[CompanyBanks_GetActiveList]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT cb.ID, cba.IDBank, b.Name as Bank, cba.Title, b.Branch, cba.AccountNr, cba.IBAN, b.Img,
        //    cba.IFrameWarnText as IFrameWarnText, cb.CompanyBankAccountID FROM CompanyBanks cb

        //    INNER JOIN CompanyBankAccounts cba ON cba.ID = cb.CompanyBankAccountID

        //    INNER JOIN Banks b ON b.ID = cb.IDBank

        //    where cb.ID = @ID

        //    ORDER BY b.OrderNr

        //END

        //GO

        //CREATE PROCEDURE[dbo].[Companies_NewDealerInsert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser NVARCHAR(50),
        //@Name NVARCHAR(500),
        //@Phone NVARCHAR(50),
        //@Password NVARCHAR(500),
        //@Title NVARCHAR(500),
        //@Email NVARCHAR(500),
        //@TaxNr NVARCHAR(500),
        //@TaxOffice NVARCHAR(500),
        //@MonthlyGiro NVARCHAR(MAX),
        //@Address NVARCHAR(500),
        //@AutoWithdrawalLimit DECIMAL(18, 2),
        //@AutoTransferLimit DECIMAL(18, 2),
        //@AutoCreditCardLimit DECIMAL(18, 2),
        //@AutoForeignCreditCardLimit DECIMAL(18, 2),
        //@CreditCardRate DECIMAL(18, 2),
        //@TransferRate DECIMAL(18, 2),
        //@MobilePayRate DECIMAL(18, 2),
        //@WithdrawalTransferAmount DECIMAL(18, 2),
        //@WithdrawalEftAmount DECIMAL(18, 2),
        //@ForeignCreditCardRate DECIMAL(18, 2),
        //@SiteUrl NVARCHAR(500),
        //@CallbackUrl NVARCHAR(500),
        //@RedirectUrl NVARCHAR(500),
        //@IPAddress NVARCHAR(500),
        //@WithdrawalRequestCallBack NVARCHAR(500),
        //@WithdrawalApiBeUsed BIT,
        //@ForeignCreditCardBeUsed BIT,
        //@TransferBeUsed BIT,
        //@CreditCardBeUsed BIT
        //AS
        //BEGIN
        //    BEGIN TRY

        //    DECLARE @idCompany nvarchar(50)= NEWID();

        //        INSERT INTO Companies(ID, CUser, CDate, Phone, UsingBalance, Title, Name, Email, TaxNr, TaxOffice, MonthlyGiro, Address,
        //        StatusFlag, NegativeBalanceLimit, AutoWithdrawalLimit, AutoTransferLimit, AutoCreditCardLimit, AutoForeignCreditCardLimit)
        //    VALUES(@idCompany, @CUser, @CDate, @Phone, 0, @Title, @Name, @Email, @TaxNr, @TaxOffice, @MonthlyGiro, @Address, 1, 0,
        //    @AutoWithdrawalLimit, @AutoTransferLimit, @AutoCreditCardLimit, @AutoForeignCreditCardLimit)


        //    INSERT INTO CompanyIntegrations
        //    (ID, CUser, CDate, ServiceID, SecretKey, SiteUrl, CallbackUrl, TransferBeUsed, CreditCardBeUsed,
        //    CreditCardPaymentWithParam, CreditCardPaymentWithPayNKolay, RedirectUrl, IPAddress, WithdrawalRequestCallBack,
        //    ForeignCreditCardBeUsed, ForeignCreditCardPaymentWithPayNKolay, WithdrawalApiBeUsed)


        //    VALUES(@idCompany, @CUser, @CDate, dbo.GenerateServiceId(), dbo.GenerateSecretKey(), @SiteUrl, @CallbackUrl, @TransferBeUsed, @CreditCardBeUsed,
        // 0, 0, @RedirectUrl, @IPAddress, @WithdrawalRequestCallBack, @ForeignCreditCardBeUsed, 0, @WithdrawalApiBeUsed);


        //        DECLARE @idUser nvarchar(50)= NEWID();

        //        INSERT INTO CompanyUsers(ID, CUser, CDate, IDCompany, Phone, Name, Email, Password, IsMainUser, StatusFlag)
        //    SELECT @idUser, @CUser, @CDate, @idCompany, @Phone, @Name, @Email, @Password, 1, 1


        //    INSERT INTO CompanyUserRoles(IDCompanyUser, RoleKey, Authorized) SELECT @idUser, RoleKey, 1 FROM Roles WHERE RoleType = 2 Order By OrderNr

        //    INSERT INTO CompanyCommissions(ID, CUser, CDate, CreditCardRate, CreditCardStatus, CreditCardBlocked, TransferRate, TransferStatus, TransferBlocked,
        //        MobilePayRate, MobilePayStatus, MobilePayBlocked, WithdrawalTransferAmount, WithdrawalEftAmount, ForeignCreditCardRate, ForeignCreditCardBlocked )

        //    VALUES(@idCompany, @CUser, @CDate, @CreditCardRate, 1, 1, @TransferRate, 1, 1, @MobilePayRate, 1, 1, @WithdrawalTransferAmount, @WithdrawalEftAmount,
        //    @ForeignCreditCardRate, 1)



        //       SELECT @IDOut = @idCompany

        //    END TRY
        //    BEGIN CATCH
        //    DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //    SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //    RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //GUNCELLENDİ

        //------------------------------------------------------- 27.08.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[CompanyIntegrations_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@SiteUrl nvarchar(100),
        //@CallbackUrl nvarchar(100),
        //@RedirectUrl nvarchar(100),
        //@IPAddress nvarchar(500),
        //@WithdrawalRequestCallback nvarchar(100),
        //@AutoCallbackUrl nvarchar(100),
        //@AutoCallbackWithdrawalUrl nvarchar(100),
        //@SIDBankForPayments nvarchar(5) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyIntegrations SET MUser = @MUser, MDate = @MDate, SiteUrl = @SiteUrl, CallbackUrl = @CallbackUrl, RedirectUrl = @RedirectUrl, IPAddress = @IPAddress,
        //WithdrawalRequestCallback = @WithdrawalRequestCallback, SIDBankForPayments = @SIDBankForPayments, AutoCallbackUrl = @AutoCallbackUrl, AutoCallbackWithdrawalUrl = @AutoCallbackWithdrawalUrl

        //WHERE ID = @ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[PaymentInstitutions_GetList]
        //AS
        //BEGIN

        //    SELECT* FROM PaymentInstitutions
        //    ORDER BY CAST(ID AS INT)
        //END

        //GO

        //ALTER Proc[dbo].[PaymentCreditCardPools_CheckStatusAndUpdate]
        //@IDOut nvarchar(50) output,
        //@TransactionKey nvarchar(50),
        //@Status tinyint,
        //@Description nvarchar(500)
        //AS
        //BEGIN
        //BEGIN TRY


        //    UPDATE PaymentCreditCardPools SET PreviousStatus = Status, Status = @Status, MDate = GETDATE(), Description = @Description WHERE TransactionKey = @TransactionKey


        //    SELECT @IDOut = @TransactionKey

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END



        //GO

        //DROP TABLE dbo.ForeignCreditCardPaymentNotifications;

        //         CREATE TABLE dbo.ForeignCreditCardPaymentNotifications(
        //         ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //         CDate datetime NOT NULL,
        //      MDate datetime NULL,
        //      ServiceID nvarchar(4) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //         TransactionNr nvarchar(24) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //         TransactionID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //         IDMember nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //         Phone nvarchar(15) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //         CountryCode nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //      ActionDate date NOT NULL,
        //         ActionTime nvarchar(5) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //         Amount decimal (18,2) NOT NULL,
        //         SenderName nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //         SenderIdentityNr nvarchar(11) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //         Description nvarchar(250) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //      Status tinyint NOT NULL,
        //         BlockedDate date NOT NULL,
        //      IsNotBocked bit NOT NULL,
        //         IsAutoNotification bit NOT NULL,
        //      CardNumber varchar(30) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //      TransactionReferenceCode varchar(30) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //      MUser varchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //      MemberIPAddress varchar(30) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //      MemberPort varchar(15) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //      PaymentInstitutionCommissionRate decimal (18,4) NULL,
        //      PaymentInstitutionNetAmount decimal (18,4) NULL,
        //      CardTypeId int NULL,
        //         CreditCardPaymentMethodID tinyint NULL,
        //         CurrencyCode nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //      CONSTRAINT PK_ForeignCreditCardPaymentNotifications2 PRIMARY KEY(ID),
        //      CONSTRAINT UQ_ForeignCreditCardPaymentNotifications2 UNIQUE(ServiceID, TransactionID)
        //     );



        //     ALTER TABLE dbo.ForeignCreditCardPaymentNotifications ADD CONSTRAINT FK_ForeignCreditCardPaymentNotifications_Members FOREIGN KEY (IDMember) REFERENCES dbo.Members(ID);

        //GO


        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_GetList]
        //@Status tinyint,
        //@IDCompany  nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@IsAutoNotification tinyint,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords int
        //    SELECT r.ID, r.CDate,r.MDate,r.ServiceID,r.TransactionNr,r.TransactionID,r.IDMember,r.Phone,r.ActionDate,r.ActionTime,r.Amount,r.SenderName,r.SenderIdentityNr,
        // r.Description,r.Status,r.BlockedDate,r.IsNotBocked,r.IsAutoNotification,r.CardNumber,r.TransactionReferenceCode,r.CountryCode,
        // r.MUser,r.MemberIPAddress,r.MemberPort, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, ct.CommissionRate, 
        // [dbo].RoundToZero(ct.Commission) as Commission, [dbo].RoundToZero(ct.NetTotal) as NetTotal, m2.Name AS Modifier, r.PaymentInstitutionCommissionRate,
        // r.PaymentInstitutionNetAmount, r.CreditCardPaymentMethodID, pins.Name as PaymentInstitutionName, r.CurrencyCode, r.CardTypeId
        //    into #TempTable FROM ForeignCreditCardPaymentNotifications r
        // INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID

        //    LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID
        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //    LEFT JOIN CompanyTransactions ct ON ct.ID = r.ID

        //    WHERE

        //         CASE

        //            WHEN @Status IN (5, 6, 7) THEN
        //                CASE

        //                    WHEN(@StartDate IS NULL OR CAST(r.MDate AS DATE) >= CAST(@StartDate AS DATE)) AND
        //                         (@EndDate IS NULL OR CAST(r.MDate AS DATE) <= CAST(@EndDate AS DATE)) THEN 1
        //                 ELSE 0
        //             END
        //            ELSE

        //                CASE
        //                    WHEN(@StartDate IS NULL OR CAST(r.CDate AS DATE) >= CAST(@StartDate AS DATE)) AND
        //                         (@EndDate IS NULL OR CAST(r.CDate AS DATE) <= CAST(@EndDate AS DATE)) THEN 1
        //                 ELSE 0
        //             END
        //        END = 1

        //    AND 1=1

        //         AND(@IsAutoNotification IS NULL OR r.IsAutoNotification = @IsAutoNotification)

        //          AND(r.Status= @Status OR (@Status IS NULL AND r.Status IN(2,3)) OR @Status = 4)

        //          AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //          AND(@IDMember IS NULL OR r.IDMember= @IDMember)

        //          AND(@StartDate IS NULL OR CAST(r.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(r.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //    AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR m.Name LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))

        // SELECT @totalRecords = COUNT(*) FROM #TempTable
        //  SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //  ORDER BY CDate DESC
        //          OFFSET @OffsetValue ROWS

        //         FETCH NEXT @PageLenght ROWS ONLY
        //    DROP TABLE #TempTable
        //END;

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, m2.Name as Modifier,
        //pins.Name as PaymentInstitutionName FROM ForeignCreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID
        //INNER JOIN Companies c ON c.ID= ci.ID
        //INNER JOIN Members m ON m.ID= r.IDMember
        //INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType
        //LEFT JOIN Administrators m2 ON m2.ID = r.MUser
        //LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID
        //WHERE r.ID= @ID

        //END;

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@CountryCode nvarchar(10),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@CardNumber nvarchar(30),
        //@TransactionReferenceCode nvarchar(30),
        //@CreditCardPaymentMethodID tinyint,
        //@CardTypeId int,
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null,
        //@CurrencyCode nvarchar(30)
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--		IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where IDMember= @IDMember And Status = 1)>0  
        //--		BEGIN
        //--			SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //--			RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--		END
        //IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //declare @_isAutoNotification bit = 0;
        //        declare @_isAuto bit;
        //declare @_minAmount decimal (18,2);
        //declare @_maxAmount decimal (18,2);
        //declare @_quantity smallint;

        //declare @companyForeignCreditCardLimit decimal (18,2);

        //SELECT @companyForeignCreditCardLimit = c.AutoForeignCreditCardLimit
        //FROM Companies c
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID = @ServiceID
        //WHERE c.ID = ci.ID;

        //select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL)
        //begin
        //if(@Amount>=@_minAmount AND @Amount<=@_maxAmount AND @Amount <= @companyForeignCreditCardLimit)
        //begin
        //if (select Count(pn.ID) from ForeignCreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //begin

        //set @_isAutoNotification = 1;
        //        end
        //        end

        //end

        //SET @IDOut = NEWID()

        //INSERT INTO ForeignCreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //IsAutoNotification, Description, CardNumber, TransactionReferenceCode, CountryCode, CreditCardPaymentMethodID, CardTypeId, CurrencyCode)

        //SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.ForeignCreditCardBlocked, GetDate()), 
        //IIF(cc.ForeignCreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @CardNumber, @TransactionReferenceCode, 
        //@CountryCode, @CreditCardPaymentMethodID, @CardTypeId, @CurrencyCode FROM CompanyCommissions cc

        //INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //WHERE ci.ServiceID= @ServiceID

        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END;

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@TransactionReferenceCode nvarchar(30),
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null
        //AS
        //BEGIN

        //    BEGIN TRY



        //    DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)


        //    DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //    IF(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=1 AND(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=5
        // BEGIN
        //    SET @CUSTOMERRORMESSAGE += N'Bu bildirim daha önce cevaplanmıştır.'
        // RAISERROR(@CUSTOMERRORMESSAGE,16,1)


        //    END
        //    ELSE


        //    BEGIN
        //    UPDATE ForeignCreditCardPaymentNotifications SET MDate= IIF(@MDate is null, GETDATE(), @MDate), Description=@Description, Status=@Status, 
        // TransactionReferenceCode = @TransactionReferenceCode, MUser = @MUser, PaymentInstitutionCommissionRate = @PaymentInstitutionCommissionRate,
        // PaymentInstitutionNetAmount = @PaymentInstitutionNetAmount
        //    WHERE ID=@ID AND(Status= 1 OR Status = 5 OR @Status = 6 OR Status = 6)


        //    SELECT @IDOut = @ID


        //    END

        //    END TRY
        //    BEGIN CATCH
        //    DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //    SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //    RAISERROR(@ERRORMESSAGE,16,1)

        //    END CATCH
        //END;

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_GetSingleByTransactionNr]
        //@IDCompany nvarchar(50),
        //@TransactionNr nvarchar(50)
        //AS
        //BEGIN


        //SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, mt.Name AS MemberType, CAST([dbo].RoundToZero(ct.NetTotal) AS DECIMAL(18,2)) as NetTotal FROM ForeignCreditCardPaymentNotifications r

        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID

        //INNER JOIN Companies c ON c.ID= ci.ID

        //INNER JOIN Members m ON m.ID= r.IDMember

        //INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType

        //INNER JOIN CompanyTransactions ct on ct.ID = r.ID

        //WHERE c.ID= @IDCompany AND r.Status= 2 AND r.TransactionNr= @TransactionNr

        //END;

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_GetSingleByTransactionID]
        //@TransactionID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, CAST([dbo].RoundToZero(ct.NetTotal) AS DECIMAL(18,2)) as NetTotal FROM ForeignCreditCardPaymentNotifications r

        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID

        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    INNER JOIN CompanyTransactions ct on ct.ID = r.ID

        //    WHERE 1=1

        //          AND (@TransactionID IS NULL OR r.TransactionID= @TransactionID)

        //    ORDER BY CDate DESC

        //END

        //GO

        //ALTER Proc[dbo].[PaymentNotifications_GetSingleByTransactionNr]
        //@IDCompany nvarchar(50),
        //@TransactionNr nvarchar(50)
        //AS
        //BEGIN


        //    SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, b.Name AS Bank, mt.Name AS MemberType, CAST([dbo].RoundToZero(ct.NetTotal) AS DECIMAL(18,2)) as NetTotal FROM PaymentNotifications r

        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID

        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType

        //    INNER JOIN Banks b ON b.ID= r.IDBank

        //    INNER JOIN CompanyTransactions ct on ct.ID = r.ID

        //    WHERE c.ID= @IDCompany AND r.Status= 2 AND r.TransactionNr= @TransactionNr

        //END

        //GO

        //    ALTER TRIGGER[dbo].[tggrUpdateForeignCreditCardPaymentNotifications]
        //    ON[dbo].[ForeignCreditCardPaymentNotifications]
        //    AFTER UPDATE

        //    AS
        //    BEGIN


        //        declare @id nvarchar(50);
        //        declare @Status tinyint;
        //     declare @IsNotBocked bit;
        //	    declare @IsAutoNotification bit;

        //     DECLARE @paymentInstitutionId NVARCHAR(50);
        //        DECLARE @netPaymentInstitutionTotal DECIMAL(18, 4);
        //        DECLARE @adjustedDate DATE;
        //     DECLARE @endOfDayTime TIME(0);

        //        DECLARE @mDate DATETIME;
        //     DECLARE @mDateTime DATETIME;
        //     DECLARE @actionDate DATE;
        //     DECLARE @actionTimeString NVARCHAR(5);
        //        DECLARE @actionDateTime DATETIME;
        //     DECLARE @endOfDayDateTime DATETIME;

        //  select @id = ID, @Status = Status, @paymentInstitutionId = CreditCardPaymentMethodID, @IsNotBocked = IsNotBocked,
        //        @actionTimeString = ActionTime, @actionDate = ActionDate, @IsAutoNotification = IsAutoNotification, @mDate = MDate from inserted


        //            SET @mDateTime = DATEADD(MINUTE, DATEDIFF(MINUTE, 0, CONVERT(TIME(0), @mDate)), CONVERT(DATETIME, CONVERT(DATE, @mDate)));

        //        SET @actionDateTime = DATEADD(MINUTE, DATEDIFF(MINUTE, 0, CONVERT(TIME(0), @actionTimeString)), CONVERT(DATETIME, @actionDate));

        //     -- Fetch EndOfDayTime for the payment institution using SET
        //     SET @endOfDayTime = (SELECT CONVERT(TIME(0), EndOfDayTime)
        //                          FROM PaymentInstitutions

        //                             WHERE ID = @paymentInstitutionId);

        //     SET @endOfDayDateTime = DATEADD(MINUTE, DATEDIFF(MINUTE, 0, @endOfDayTime), CONVERT(DATETIME, @actionDate));


        //    IF(@Status= 2)

        //        BEGIN
        //            DELETE FROM CompanyTransactions WHERE ID = @id

        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate, CompanyCommission , CompanyCommissionRate)

        //            SELECT pn.ID, pn.CDate, ci.ID, '140', pn.MDate, TransactionNr, pn.Amount, ROUND((pn.Amount* cc.ForeignCreditCardRate/100), 4 ), 0, ROUND((pn.Amount - (pn.Amount* cc.ForeignCreditCardRate/100)), 4), IDMember, 
        //   cc.ForeignCreditCardRate, ROUND(((pn.Amount / 100) * (CAST(pins.Rate AS DECIMAL(10, 2))) ),4),(CAST(pins.Rate AS DECIMAL(10, 2)))

        //   FROM ForeignCreditCardPaymentNotifications pn
        //            INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //            INNER JOIN CompanyCommissions cc ON cc.ID=ci.ID
        //            INNER JOIN PaymentInstitutions pins on pins.ID = pn.CreditCardPaymentMethodID
        //            WHERE pn.ID=@id

        //            IF(@IsNotBocked = 0)

        //            BEGIN

        //                SELECT @netPaymentInstitutionTotal = ROUND((pn.Amount - (pn.Amount* pins.Rate / 100)), 4)
        //          FROM ForeignCreditCardPaymentNotifications pn
        //                INNER JOIN PaymentInstitutions pins ON pins.ID = pn.CreditCardPaymentMethodID
        //                WHERE pn.ID = @id;

        //          IF @IsAutoNotification = 1

        //                BEGIN
        //                    IF @mDateTime  > @endOfDayDateTime
        //                    BEGIN

        //                        SET @adjustedDate = DATEADD(DAY, 1, CONVERT(DATE, @mDateTime));
        //    END
        //    ELSE

        //                    BEGIN
        //                        SET @adjustedDate = CONVERT(DATE, @mDateTime );
        //    END
        //END

        //                ELSE
        //                BEGIN

        //                    IF @actionDateTime > @endOfDayDateTime
        //                    BEGIN

        //                        SET @adjustedDate = DATEADD(DAY, 1, @actionDate);
        //    END
        //    ELSE

        //                    BEGIN
        //                        SET @adjustedDate = @actionDate;
        //              END
        //                END


        //                IF EXISTS(SELECT 1 FROM ProgressPaymentCalendars WHERE[Date] = @adjustedDate AND PaymentInstitutionId = @paymentInstitutionId)

        //                BEGIN
        //                    UPDATE ProgressPaymentCalendars
        //                    SET ProgressPayment += @netPaymentInstitutionTotal
        //                    WHERE[Date] = @adjustedDate AND PaymentInstitutionId = @paymentInstitutionId;
        //    END
        //    ELSE

        //                BEGIN
        //                    INSERT INTO ProgressPaymentCalendars(ID, [Date], ProgressPayment, PaymentInstitutionId)

        //                    VALUES(NEWID(), @adjustedDate, @netPaymentInstitutionTotal, @paymentInstitutionId);
        //    END
        //END

        //        END
        //    END

        //GO

        //ALTER Proc[dbo].[CompanyPaymentInstitutions_GetList]
        //@ID nvarchar(50),
        //@UseForForeignCard bit
        //AS
        //BEGIN

        //    SELECT cpi.*, pins.Name as PaymentInstitutionName, pins.RedirectToActionGetThreeDView as RedirectToActionGetThreeDView,
        //    pins.RedirectToActionPaymentMethod as RedirectToActionPaymentMethod FROM CompanyPaymentInstitutions cpi

        //    INNER JOIN PaymentInstitutions pins ON pins.ID = cpi.PaymentInstitutionID

        //    WHERE cpi.ID = @ID AND pins.UseForForeignCard = @UseForForeignCard

        //    ORDER BY pins.ID
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyWithdrawalRequests_SetStatus]
        //@IDOut NVARCHAR(50) OUTPUT,
        //@ID NVARCHAR(50),
        //@MUser NVARCHAR(50),
        //@MDate DATETIME,
        //@Description NVARCHAR(250),
        //@Status TINYINT,
        //@IsBankQueryNr NVARCHAR(50) = NULL,
        //@SIDBank NVARCHAR(50) = NULL,
        //@IsProcess BIT = 0,
        //@CompanyBankAccountID NVARCHAR(50)
        //AS
        //BEGIN

        //--	IF @MUser = '00000000-0000-0000-0000-000000000000'
        //--  BEGIN
        //--	    SET @Status = 2; -- Dışarıdan gelen değer 3 ise 2 olarak ayarla
        //--	END
        //--	
        //--	DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)
        //--	DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--	
        //--	IF(Select Status From CompanyWithdrawalRequests Where ID = @ID)=8
        //--	BEGIN
        //--		SET @CUSTOMERRORMESSAGE += N'İşlemde olan kayda müdahale edilemez.'
        //--		RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--	END

        //    BEGIN TRY
        //        UPDATE CompanyWithdrawalRequests
        //        SET
        //            MUser = @MUser,
        //            MDate = IIF(@MDate IS NULL, GETDATE(), @MDate),
        //            Description = @Description,
        //            Status = @Status,
        //            IsBankQueryNr = @IsBankQueryNr,
        //            SIDBank = @SIDBank,
        //            IsProcess = @IsProcess,
        //            CompanyBankAccountID = @CompanyBankAccountID
        //        WHERE
        //            ID = @ID
        //            AND Status in (1,2,8)

        //        IF @@ROWCOUNT > 0 AND @Status IN(2, 3)
        //        BEGIN
        //            IF @Status = 2
        //            BEGIN
        //                INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission, CompanyCommissionRate)
        //                SELECT
        //                    ID,
        //                    GETDATE(),
        //                    IDCompany,
        //                    '30',
        //                    MDate,
        //                    TransactionNr,
        //                    IDBank,
        //                    Amount,
        //                    0,
        //                    CostTotal,
        //                    Amount + CostTotal,
        //                    0,
        //                    0
        //                FROM
        //                    CompanyWithdrawalRequests
        //                WHERE
        //                    ID = @ID
        //            END
        //            ELSE IF @Status = 3
        //            BEGIN
        //                UPDATE Companies
        //                SET UsingBalance += T.Total
        //                FROM
        //                    (SELECT IDCompany, (Amount + CostTotal) AS Total FROM CompanyWithdrawalRequests WHERE ID = @ID) T
        //                WHERE
        //                    Companies.ID = T.IDCompany

        //                DELETE FROM CompanyTransactions WHERE ID = @ID
        //            END
        //        END

        //        SELECT @IDOut = @ID
        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE, 16, 1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[Companies_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Title nvarchar(100),
        //@Name nvarchar(50),
        //@Phone nvarchar(11),
        //@Email nvarchar(50),
        //@TaxNr nvarchar(11),
        //@TaxOffice nvarchar(50),
        //@Address nvarchar(100),
        //@MonthlyGiro nvarchar(25),
        //@IDParasut nvarchar(50),
        //@AutoWithdrawalLimit decimal = null,
        //@NegativeBalanceLimit decimal = null,
        //@AutoTransferLimit decimal = null,
        //@AutoCreditCardLimit decimal = null,
        //@AutoForeignCreditCardLimit decimal = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @IDCU nvarchar(50)

        //        SET @IDCU = (SELECT top 1 CompanyUsers.ID FROM Companies join CompanyUsers on IDCompany=Companies.ID AND Companies.Phone=CompanyUsers.Phone WHERE IDCompany=@ID AND IsMainUser=1)

        //  UPDATE Companies SET MUser = @MUser, MDate = @MDate, Name = @Name, Title = @Title, Phone = @Phone, Email = @Email, TaxNr = @TaxNr,
        //        TaxOffice = @TaxOffice, Address = @Address, MonthlyGiro = @MonthlyGiro, IDParasut = @IDParasut

        //        WHERE ID = @ID


        //        UPDATE CompanyUsers SET Phone = @Phone WHERE IDCompany = @ID AND IsMainUser = 1 AND ID = @IDCU

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END


        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetCreditCardTransactions]
        //@PaymentInstitutionID NVARCHAR(10) = NULL,
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords INT
        //    DECLARE @totalNegativeBalance decimal (18, 4) = 0	
        //    DECLARE @totalPositiveBalance decimal (18, 4) = 0
        //    DECLARE @skippedAmount DECIMAL(18, 4) = 0  		
        //    DECLARE @ccPool decimal (18, 4)
        //    DECLARE @result decimal (18, 4)
        //    DECLARE @isForeignCreditCard bit;

        //    select @isForeignCreditCard = (select UseForForeignCard from PaymentInstitutions pins where @PaymentInstitutionID = pins.ID )


        //       IF @isForeignCreditCard = 0

        //           BEGIN
        //               select @ccPool = ISNULL(SUM(cpn.PaymentInstitutionNetAmount), 0)

        //            FROM CreditCardPaymentNotifications cpn
        //            WHERE cpn.CreditCardPaymentMethodID = @PaymentInstitutionID
        //            AND cpn.Status in (5,6)
        //   --AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //   AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))



        //   SELECT @result = ISNULL(SUM((Total - ISNULL(t.CompanyCommission, 0))) - crPartial.ExpenseAmountPartialRebate + cftIncome.IncomeAmount - cft.ExpenseAmount - cr.ExpenseAmountRebate, 0)

        //            FROM CompanyTransactions t
        //            INNER JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID

        //            cross join(SELECT ISNULL(sum(t.Amount),0) AS ExpenseAmount

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2
        //            WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND  t.PaymentMethod = 2 and t.TransactionType = 2
        //      AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      ) as cft

        //            cross join(SELECT ISNULL(sum(t.Amount),0) AS IncomeAmount

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //            WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND  t.PaymentMethod = 2 and t.TransactionType = 1
        //      AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      ) as cftIncome

        //            cross join(SELECT ISNULL(sum((isnull(t2.Total,0) - isnull(t2.CompanyCommission,0))),0) AS ExpenseAmountRebate

        //            FROM CompanyRebateRequests cr
        //            INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //            INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr.Status = 2 and cpn.Status = 2 AND (cr.IsPartialRebate = 0 or cr.IsPartialRebate IS NULL)

        //            AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      ) as cr

        //            cross join(SELECT ISNULL(sum((cr2.PartialRebatePaymentInstitutionTotalAmount - cr2.PartialRebatePaymentInstitutionCommission)),0) AS ExpenseAmountPartialRebate

        //            FROM CompanyRebateRequests cr2
        //            INNER JOIN CompanyTransactions t ON t.ID = cr2.ID
        //            INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr2.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr2.Status = 2 and cpn.Status = 2 AND (cr2.IsPartialRebate = 1)

        //            AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      ) as crPartial

        //            WHERE 1 = 1

        //                AND t.IDActionType IN (100, 110)

        //                AND(cs.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //                AND cs.Status = 2
        // 	        --AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //          AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      GROUP BY cft.ExpenseAmount, cftIncome.IncomeAmount, cr.ExpenseAmountRebate, crPartial.ExpenseAmountPartialRebate

        //            CREATE TABLE #TempTable (
        //          TransactionDate DATETIME,
        //          PaymentInstitutionID NVARCHAR(10),
        //          SenderName NVARCHAR(MAX),
        //          Amount DECIMAL(18, 4),
        //          PaymentInstitutionName NVARCHAR(MAX),
        //          Description NVARCHAR(MAX),
        //          TotalBalance DECIMAL(18, 4),
        //          IsPositiveBalance tinyint,
        //      )


        //            INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                cs.CreditCardPaymentMethodID,
        //                cs.SenderName,
        //                (isnull(t.Total,0) - isnull(t.CompanyCommission,0)) as Amount, 
        //          pins.Name as PaymentInstitutionName, 
        //          cs.Description,
        // 	        0,
        // 	        1
        //      FROM CompanyTransactions t
        //            LEFT JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID
        //            INNER JOIN PaymentInstitutions pins ON cs.CreditCardPaymentMethodID = pins.ID
        //            WHERE t.IDActionType IN(100,110) and cs.Status = 2
        //      AND (cs.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                   cpn.MDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //                isnull(cpn.PaymentInstitutionNetAmount,0),
        //          pins.Name as PaymentInstitutionName, 
        //          N'Manuel Kredi Kartı Ödeme Havuzunda' as Description,
        //          0,
        //          1
        //      FROM CreditCardPaymentNotifications cpn
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cpn.Status = 5
        //      AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                   cpn.MDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //                isnull(cpn.PaymentInstitutionNetAmount,0),
        //          pins.Name as PaymentInstitutionName, 
        //          N'Fraud Havuzunda' as Description,
        //          0,
        //          1
        //      FROM CreditCardPaymentNotifications cpn
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cpn.Status = 6
        //      AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //          case when cr.IsPartialRebate = 1 then cr.PartialRebatePaymentInstitutionTotalAmount - cr.PartialRebatePaymentInstitutionCommission else (isnull(t2.Total,0) - isnull(t2.CompanyCommission,0)) end,
        //          pins.Name as PaymentInstitutionName, 
        //          N'İade Yapıldı' as Description,
        //          -1,
        //          0
        //      FROM CompanyRebateRequests cr
        //            INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //            INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr.Status = 2 and cpn.Status = 2
        //      AND (cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                t.CompanyIntegrationType,
        //                cba.Name,
        //                t.Amount,
        //                pins.Name as PaymentInstitutionName,
        //                cba.Name + N' Bankasına Çıkış Yapıldı' as Description,
        // 	        -1,
        // 	        0

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID

        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2

        //            WHERE
        //            t.CompanyIntegrationType = @PaymentInstitutionID

        //            AND t.PaymentMethod = 2 AND t.TransactionType = 2

        //            AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //   GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount

        //            INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT

        //                t.TransactionDate, 
        //          t.CompanyIntegrationType, 
        //          cba.Name, 
        //          t.Amount,
        //          pins.Name as PaymentInstitutionName,  
        //          cba.Name + N' Bankasından Transfer Yapıldı' as Description,
        // 	        -1,
        // 	        1
        //      FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //            WHERE

        //            t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND t.PaymentMethod = 2 AND t.TransactionType = 1
        //      AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //   GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount


        //            SELECT @totalRecords = COUNT(*) FROM #TempTable
        //      select @totalNegativeBalance = ISNULL(SUM(Amount), 0) from #TempTable where IsPositiveBalance = 0 and TotalBalance >= 0
        //      select @totalPositiveBalance = ISNULL(@result,0) + ISNULL(@ccPool,0)


        //               IF @OffsetValue<> 0
        //      BEGIN
        //                SELECT @totalPositiveBalance = @totalPositiveBalance + ISNULL(SUM(CASE WHEN IsPositiveBalance = 1 THEN Amount * -1 ELSE Amount END), 0)

        //                FROM (
        //                    SELECT Amount, IsPositiveBalance, ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum

        //                    FROM #TempTable
        //       ) AS SubQuery

        //                WHERE RowNum <= @OffsetValue
        //            END


        //            SELECT TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, @totalPositiveBalance - @totalNegativeBalance  as TotalBalance, IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable
        //      ORDER BY TransactionDate DESC

        //            OFFSET @OffsetValue ROWS
        //            FETCH NEXT @PageLength ROWS ONLY


        //            DROP TABLE #TempTable
        //  END
        //    ELSE

        //        BEGIN
        //            select @ccPool = ISNULL(SUM(cpn.PaymentInstitutionNetAmount), 0)

        //            FROM ForeignCreditCardPaymentNotifications cpn
        //            WHERE cpn.CreditCardPaymentMethodID = @PaymentInstitutionID
        //            AND cpn.Status in (5,6)
        //   --AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //   AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))



        //   SELECT @result = ISNULL(SUM((Total - ISNULL(t.CompanyCommission, 0))) - crPartial.ExpenseAmountPartialRebate + cftIncome.IncomeAmount - cft.ExpenseAmount - cr.ExpenseAmountRebate, 0)

        //            FROM CompanyTransactions t
        //            INNER JOIN ForeignCreditCardPaymentNotifications cs ON cs.ID = t.ID

        //            cross join(SELECT ISNULL(sum(t.Amount),0) AS ExpenseAmount

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2
        //            WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND  t.PaymentMethod = 2 and t.TransactionType = 2
        //      AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      ) as cft

        //            cross join(SELECT ISNULL(sum(t.Amount),0) AS IncomeAmount

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //            WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND  t.PaymentMethod = 2 and t.TransactionType = 1
        //      AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      ) as cftIncome

        //            cross join(SELECT ISNULL(sum((isnull(t2.Total,0) - isnull(t2.CompanyCommission,0))),0) AS ExpenseAmountRebate

        //            FROM CompanyRebateRequests cr
        //            INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //            INNER JOIN ForeignCreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr.Status = 2 and cpn.Status = 2 AND (cr.IsPartialRebate = 0 or cr.IsPartialRebate IS NULL)

        //            AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      ) as cr

        //            cross join(SELECT ISNULL(sum((cr2.PartialRebatePaymentInstitutionTotalAmount - cr2.PartialRebatePaymentInstitutionCommission)),0) AS ExpenseAmountPartialRebate

        //            FROM CompanyRebateRequests cr2
        //            INNER JOIN CompanyTransactions t ON t.ID = cr2.ID
        //            INNER JOIN ForeignCreditCardPaymentNotifications cpn ON cpn.TransactionID = cr2.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr2.Status = 2 and cpn.Status = 2 AND (cr2.IsPartialRebate = 1)

        //            AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      ) as crPartial

        //            WHERE 1 = 1

        //                AND t.IDActionType IN (140)

        //                AND(cs.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //                AND cs.Status = 2
        // 	        --AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //          AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      GROUP BY cft.ExpenseAmount, cftIncome.IncomeAmount, cr.ExpenseAmountRebate, crPartial.ExpenseAmountPartialRebate

        //            CREATE TABLE #TempTable2 (
        //          TransactionDate DATETIME,
        //          PaymentInstitutionID NVARCHAR(10),
        //          SenderName NVARCHAR(MAX),
        //          Amount DECIMAL(18, 4),
        //          PaymentInstitutionName NVARCHAR(MAX),
        //          Description NVARCHAR(MAX),
        //          TotalBalance DECIMAL(18, 4),
        //          IsPositiveBalance tinyint,
        //      )


        //            INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                cs.CreditCardPaymentMethodID,
        //                cs.SenderName,
        //                (isnull(t.Total,0) - isnull(t.CompanyCommission,0)) as Amount, 
        //          pins.Name as PaymentInstitutionName, 
        //          cs.Description,
        // 	        0,
        // 	        1
        //      FROM CompanyTransactions t
        //            LEFT JOIN ForeignCreditCardPaymentNotifications cs ON cs.ID = t.ID
        //            INNER JOIN PaymentInstitutions pins ON cs.CreditCardPaymentMethodID = pins.ID
        //            WHERE t.IDActionType IN(140) and cs.Status = 2
        //      AND (cs.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                   cpn.MDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //                isnull(cpn.PaymentInstitutionNetAmount,0),
        //          pins.Name as PaymentInstitutionName, 
        //          N'Manuel Kredi Kartı Ödeme Havuzunda' as Description,
        //          0,
        //          1
        //      FROM ForeignCreditCardPaymentNotifications cpn
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cpn.Status = 5
        //      AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                   cpn.MDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //                isnull(cpn.PaymentInstitutionNetAmount,0),
        //          pins.Name as PaymentInstitutionName, 
        //          N'Fraud Havuzunda' as Description,
        //          0,
        //          1
        //      FROM ForeignCreditCardPaymentNotifications cpn
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cpn.Status = 6
        //      AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //          case when cr.IsPartialRebate = 1 then cr.PartialRebatePaymentInstitutionTotalAmount - cr.PartialRebatePaymentInstitutionCommission else (isnull(t2.Total,0) - isnull(t2.CompanyCommission,0)) end,
        //          pins.Name as PaymentInstitutionName, 
        //          N'İade Yapıldı' as Description,
        //          -1,
        //          0
        //      FROM CompanyRebateRequests cr
        //            INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //            INNER JOIN ForeignCreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr.Status = 2 and cpn.Status = 2
        //      AND (cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                t.CompanyIntegrationType,
        //                cba.Name,
        //                t.Amount,
        //                pins.Name as PaymentInstitutionName,
        //                cba.Name + N' Bankasına Çıkış Yapıldı' as Description,
        // 	        -1,
        // 	        0

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID

        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2

        //            WHERE
        //            t.CompanyIntegrationType = @PaymentInstitutionID

        //            AND t.PaymentMethod = 2 AND t.TransactionType = 2

        //            AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //   GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount

        //            INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT

        //                t.TransactionDate, 
        //          t.CompanyIntegrationType, 
        //          cba.Name, 
        //          t.Amount,
        //          pins.Name as PaymentInstitutionName,  
        //          cba.Name + N' Bankasından Transfer Yapıldı' as Description,
        // 	        -1,
        // 	        1
        //      FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //            WHERE

        //            t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND t.PaymentMethod = 2 AND t.TransactionType = 1
        //      AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //   GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount


        //            SELECT @totalRecords = COUNT(*) FROM #TempTable2
        //      select @totalNegativeBalance = ISNULL(SUM(Amount), 0) from #TempTable2 where IsPositiveBalance = 0 and TotalBalance >= 0
        //      select @totalPositiveBalance = ISNULL(@result,0) + ISNULL(@ccPool,0)


        //               IF @OffsetValue<> 0
        //      BEGIN
        //                SELECT @totalPositiveBalance = @totalPositiveBalance + ISNULL(SUM(CASE WHEN IsPositiveBalance = 1 THEN Amount * -1 ELSE Amount END), 0)

        //                FROM (
        //                    SELECT Amount, IsPositiveBalance, ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum

        //                    FROM #TempTable2
        //       ) AS SubQuery

        //                WHERE RowNum <= @OffsetValue
        //            END


        //            SELECT TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, @totalPositiveBalance - @totalNegativeBalance  as TotalBalance, IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable2
        //      ORDER BY TransactionDate DESC

        //            OFFSET @OffsetValue ROWS
        //            FETCH NEXT @PageLength ROWS ONLY


        //            DROP TABLE #TempTable2
        //  END
        //END

        //GO

        //ALTER PROC[dbo].[CompanyBankAccounts_TotalCreditCardSum]
        //(
        //    @IDCompany NVARCHAR(50),
        //    @IDBank NVARCHAR(50),
        //    @StartDate DATE = NULL,
        //    @EndDate DATE = NULL
        //)
        //AS
        //BEGIN
        //    DECLARE @Counter INT = 1;
        //    DECLARE @MaxCount INT;

        //    SELECT @MaxCount = COUNT(*)
        //    FROM PaymentInstitutions
        //    WHERE Show = 1;

        //        CREATE TABLE #TempResults
        //    (
        //            ID NVARCHAR(50),
        //        Amount DECIMAL(18, 2),
        //        CreditCardAmount DECIMAL(18, 2),
        //        EftAmount DECIMAL(18, 2),
        //        NetAmount DECIMAL(18, 2),
        //        CountNetAmount INT,
        //        Name NVARCHAR(200),
        //        UseForForeignCard BIT,
        //        EndOfDayTime NVARCHAR(10)
        //    );

        //    WHILE @Counter <= @MaxCount
        //    BEGIN
        //        DECLARE @CurrentID NVARCHAR(50);
        //        DECLARE @Name NVARCHAR(200);
        //        DECLARE @UseForForeignCard BIT;
        //        DECLARE @EndOfDayTime NVARCHAR(10);

        //        SELECT
        //            @CurrentID = ID,
        //            @Name = Name,
        //            @UseForForeignCard = UseForForeignCard,
        //            @EndOfDayTime = EndOfDayTime
        //        FROM
        //        (
        //            SELECT
        //                ID,
        //                Name,
        //                UseForForeignCard,
        //                EndOfDayTime,
        //                ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS RowNum
        //            FROM PaymentInstitutions
        //            WHERE Show = 1
        //        ) AS RowNumbered
        //        WHERE RowNum = @Counter;

        //        IF @CurrentID = '6'
        //        BEGIN
        //            INSERT INTO #TempResults 
        //            (
        //                ID, Amount, Name, UseForForeignCard,
        //                CreditCardAmount, EftAmount, NetAmount,
        //                CountNetAmount, EndOfDayTime
        //            )
        //            SELECT TOP(1)
        //                @CurrentID AS ID,
        //                ISNULL(sumT.NetAmount, 0) + ISNULL(IncomeAmount, 0) - ISNULL(ExpenseAmount, 0) AS Amount,
        //                @Name AS Name,
        //                @UseForForeignCard AS UseForForeignCard,
        //                0 AS CreditCardAmount,
        //                ISNULL(CountNetAmountToday, 0) - ISNULL(Piece, 0) AS EftAmount,
        //                ISNULL(sumT.NetAmountTotal, 0) AS NetAmount,
        //                ISNULL(CountNetAmount, 0) - ISNULL(Piece, 0) AS CountNetAmount,
        //                @EndOfDayTime AS EndOfDayTime
        //            FROM
        //            (
        //                SELECT
        //                    @CurrentID AS ID,
        //                    SUM(Amount) AS Amount,
        //                    SUM(IncomeAmount) AS IncomeAmount,
        //                    SUM(ExpenseAmount) AS ExpenseAmount,
        //                    SUM(Piece) AS Piece
        //                FROM
        //                (
        //                    SELECT
        //                        SUM(Amount) AS Amount,
        //                        CASE WHEN TransactionType = 1 THEN SUM(ISNULL(Amount, 0)) ELSE 0 END AS IncomeAmount,
        //                        CASE WHEN TransactionType = 2 THEN SUM(ISNULL(Amount, 0)) ELSE 0 END AS ExpenseAmount,
        //                        SUM(ISNULL(Piece, 0)) AS Piece
        //                    FROM CompanyFinanceTransaction
        //                    WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2
        //                    GROUP BY TransactionType
        //                ) AS Total
        //            ) AS AmountTotal
        //            LEFT JOIN
        //            (
        //                SELECT
        //                    @CurrentID AS ID,
        //                    0 AS CreditCardAmount,
        //                    0 AS EftAmount,
        //                    SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //                    SUM(NetAmountTotal) AS NetAmountTotal,
        //                    SUM(CountNetAmount) AS CountNetAmount,
        //                    SUM(CountNetAmountToday) AS CountNetAmountToday
        //                FROM
        //                (
        //                    SELECT
        //                        SUM(Total) + ISNULL(ccPool.Amount, 0) AS NetAmountTotal,
        //                        SUM(Total - ISNULL(t.CompanyCommission, 0)) + ISNULL(ccPool.Amount, 0) AS NetAmount,
        //                        COUNT(Total) + ISNULL(RebateCount, 0) AS CountNetAmount,
        //                        COUNT(CASE WHEN CONVERT(DATE, t.TransactionDate) = CONVERT(DATE, GETDATE()) THEN 1 ELSE NULL END) + ISNULL(RebateCount, 0) AS CountNetAmountToday,
        //                        CASE WHEN IsPartialRebate = 1 THEN ISNULL(cr.PartialCompanyCommission, 0) - ISNULL(cr.CompanyCommission, 0) ELSE(ISNULL(cr.Amount, 0) - ISNULL(cr.CompanyCommission, 0)) END AS ExpenseNetAmount
        //                    FROM CompanyTransactions t
        //                    LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //                    CROSS JOIN
        //                    (
        //                        SELECT
        //                            SUM(CASE WHEN IsPartialRebate = 1 THEN 0 ELSE cr.PartialRebatePaymentInstitutionTotalAmount - cr.PartialRebatePaymentInstitutionCommission END) AS CompanyCommission,
        //                            SUM(t.CompanyCommission) AS PartialCompanyCommission,
        //                            SUM(CASE WHEN IsPartialRebate = 1 THEN 1 ELSE 0 END) AS IsPartialRebate,
        //                            SUM(cr.Amount) AS Amount,
        //                            COUNT(cr.Amount) AS RebateCount
        //                        FROM CompanyRebateRequests cr
        //                        INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //                        INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //                        INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //                        WHERE cpn.CreditCardPaymentMethodID = @CurrentID
        //                            AND(@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //                            AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //                    ) cr
        //                    CROSS JOIN
        //                    (
        //                        SELECT SUM(cpn.PaymentInstitutionNetAmount) AS Amount
        //                        FROM CreditCardPaymentNotifications cpn
        //                        WHERE cpn.CreditCardPaymentMethodID = @CurrentID
        //                            AND cpn.Status IN (5, 6)
        //                            AND cpn.TransactionReferenceCode IS NOT NULL
        //                            AND cpn.PaymentInstitutionNetAmount IS NOT NULL
        //                            AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //                            AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //                    ) ccPool
        //                    WHERE IDActionType IN(100, 110)
        //                        AND cs.Status = 2 
        //                        AND cs.CreditCardPaymentMethodID = @CurrentID
        //                        AND (@StartDate IS NULL OR CAST(TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //                        AND(@EndDate IS NULL OR CAST(TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //                    GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount,  cr.PartialCompanyCommission, cr.IsPartialRebate
        //                ) AS AmountTotal
        //            ) AS sumT ON sumT.ID = @CurrentID;
        //        END
        //        ELSE
        //        BEGIN
        //            IF @UseForForeignCard = 0
        //            BEGIN
        //INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount, EndOfDayTime)
        //       SELECT TOP(1)

        //                    @CurrentID AS ID,
        //           isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //                    @Name AS Name,
        //                    @UseForForeignCard AS UseForForeignCard,
        //           0 AS CreditCardAmount,
        //           0 AS EftAmount,
        //                    isnull(sumT.NetAmount, 0) AS NetAmount,
        //                   isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount,
        //                   @EndOfDayTime as EndOfDayTime
        //                FROM
        //                (
        //                    SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //                           SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //                    FROM (
        //                        SELECT sum(Amount) AS Amount,
        //                               CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                      CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                      SUM(isnull(Piece,0)) AS Piece

        //                            FROM CompanyFinanceTransaction

        //                            WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2

        //                            GROUP BY TransactionType
        //            ) AS Total
        //        ) AS AmountTotal

        //                LEFT JOIN(
        //                        SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //                               SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //                               SUM(CountNetAmount) AS CountNetAmount
        //                        FROM (
        //                            SELECT sum(ISNULL((Total - isnull(t.CompanyCommission,0)),0)) + isnull(ccPool.Amount,0) AS NetAmount,
        //                                   count((NetTotal)) + isnull(cr.RebateCount,0) + isnull(crPartial.RebateCount,0) AS CountNetAmount,
        //                       (isnull(cr.Amount, 0) - isnull(cr.CompanyCommission, 0) + isnull(crPartial.CompanyCommission, 0))  AS ExpenseNetAmount

        //                            FROM CompanyTransactions t
        //                            LEFT JOIN CreditCardPaymentNotifications cs ON cs.Id = t.Id
        //                            CROSS JOIN(
        //                                SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                                       sum(cr.Amount) AS Amount,
        //                                       count(cr.Amount) AS RebateCount
        //                                FROM CompanyRebateRequests cr

        //                     INNER JOIN CompanyTransactions t ON t.ID = cr.ID

        //                                INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID

        //                                INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID

        //                                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND (cr.IsPartialRebate = 0 or cr.IsPartialRebate IS NULL) AND(@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //               AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //                ) cr

        //                           CROSS JOIN(
        //                                SELECT sum(cr2.PartialRebatePaymentInstitutionTotalAmount - cr2.PartialRebatePaymentInstitutionCommission  ) AS CompanyCommission,
        //                                       count(cr2.Amount) AS RebateCount

        //                                FROM CompanyRebateRequests cr2
        //                                 INNER JOIN CompanyTransactions t ON t.ID = cr2.ID
        //                                INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr2.TransactionID
        //                                INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //                                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND(cr2.IsPartialRebate = 1)

        //                                AND(@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //       		        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //                ) crPartial

        //                            CROSS JOIN(
        //                             SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                            From CreditCardPaymentNotifications cpn

        //                            WHERE cpn.CreditCardPaymentMethodID = @CurrentID

        //                            AND cpn.Status in (5,6) AND cpn.TransactionReferenceCode is not null 

        //                            AND cpn.PaymentInstitutionNetAmount is not null 

        //                            AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        // 		        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //                ) ccPool

        //                            WHERE IDActionType IN(100,110) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID

        //                            GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount, crPartial.CompanyCommission, crPartial.RebateCount

        //                           ) AS AmountTotal
        //        ) AS sumT ON sumT.ID = @CurrentID
        //            END
        //            ELSE
        //            BEGIN

        //                        INSERT INTO #TempResults (ID, Amount, Name, UseForForeignCard, CreditCardAmount, EftAmount, NetAmount, CountNetAmount, EndOfDayTime)
        //       SELECT TOP(1)

        //                    @CurrentID AS ID,
        //           isnull(sumT.NetAmount,0) + isnull(IncomeAmount,0) - isnull(ExpenseAmount,0) AS Amount,
        //                    @Name AS Name,
        //                    @UseForForeignCard AS UseForForeignCard,
        //           0 AS CreditCardAmount,
        //           0 AS EftAmount,
        //                    isnull(sumT.NetAmount, 0) AS NetAmount,
        //                   isnull(CountNetAmount, 0) - isnull(Piece,0) AS CountNetAmount,
        //                   @EndOfDayTime as EndOfDayTime
        //                FROM
        //                (
        //                    SELECT @CurrentID AS ID, SUM(Amount) AS Amount, SUM(IncomeAmount) AS IncomeAmount,
        //                           SUM(ExpenseAmount) AS ExpenseAmount, SUM(Piece) AS Piece
        //                    FROM (
        //                        SELECT sum(Amount) AS Amount,
        //                               CASE WHEN TransactionType = 1 THEN sum(isnull(Amount,0)) ELSE 0 END AS IncomeAmount,
        //                      CASE WHEN TransactionType = 2 THEN sum(isnull(Amount,0)) ELSE 0 END AS ExpenseAmount,
        //                      SUM(isnull(Piece,0)) AS Piece

        //                            FROM CompanyFinanceTransaction

        //                            WHERE CompanyIntegrationType = @CurrentID AND PaymentMethod = 2

        //                            GROUP BY TransactionType
        //            ) AS Total
        //        ) AS AmountTotal

        //                LEFT JOIN(
        //                        SELECT @CurrentID AS ID, 0 AS CreditCardAmount, 0 AS EftAmount,
        //                               SUM(NetAmount) - SUM(ExpenseNetAmount) AS NetAmount,
        //                               SUM(CountNetAmount) AS CountNetAmount
        //                        FROM (
        //                            SELECT sum(ISNULL((Total - isnull(t.CompanyCommission,0)),0)) + isnull(ccPool.Amount,0) AS NetAmount,
        //                                   count((NetTotal)) + isnull(cr.RebateCount,0) + isnull(crPartial.RebateCount,0) AS CountNetAmount,
        //                       (isnull(cr.Amount, 0) - isnull(cr.CompanyCommission, 0) + isnull(cr.CompanyCommission, 0))  AS ExpenseNetAmount

        //                            FROM CompanyTransactions t
        //                            LEFT JOIN ForeignCreditCardPaymentNotifications cs ON cs.Id = t.Id
        //                            CROSS JOIN(
        //                                SELECT sum(t2.CompanyCommission) AS CompanyCommission,
        //                                       sum(cr.Amount) AS Amount,
        //                                       count(cr.Amount) AS RebateCount
        //                                FROM CompanyRebateRequests cr

        //                     INNER JOIN CompanyTransactions t ON t.ID = cr.ID

        //                                INNER JOIN ForeignCreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID

        //                                INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID

        //                                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND (cr.IsPartialRebate = 0 or cr.IsPartialRebate IS NULL) AND(@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //               AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //                ) cr

        //                           CROSS JOIN(
        //                                SELECT sum(cr2.PartialRebatePaymentInstitutionTotalAmount - cr2.PartialRebatePaymentInstitutionCommission  ) AS CompanyCommission,
        //                                       count(cr2.Amount) AS RebateCount

        //                                FROM CompanyRebateRequests cr2
        //                                 INNER JOIN CompanyTransactions t ON t.ID = cr2.ID
        //                                INNER JOIN ForeignCreditCardPaymentNotifications cpn ON cpn.TransactionID = cr2.TransactionID
        //                                INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //                                WHERE cpn.CreditCardPaymentMethodID = @CurrentID AND(cr2.IsPartialRebate = 1)

        //                                AND(@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        //       		        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //                ) crPartial

        //                            CROSS JOIN(
        //                             SELECT sum(cpn.PaymentInstitutionNetAmount) as Amount
        //                            From ForeignCreditCardPaymentNotifications cpn

        //                            WHERE cpn.CreditCardPaymentMethodID = @CurrentID

        //                            AND cpn.Status in (5,6) AND cpn.TransactionReferenceCode is not null 

        //                            AND cpn.PaymentInstitutionNetAmount is not null 

        //                            AND (@StartDate IS NULL OR CAST(cpn.ActionDate AS DATE) >= CAST(@StartDate AS DATE))
        // 		        AND(@EndDate IS NULL OR CAST(cpn.ActionDate AS DATE) <= CAST(@EndDate AS DATE))
        //                ) ccPool

        //                            WHERE IDActionType IN(140) AND cs.Status = 2 AND cs.CreditCardPaymentMethodID = @CurrentID

        //                            GROUP BY IDActionType, cr.Amount, cr.CompanyCommission, cr.RebateCount, ccPool.Amount, crPartial.CompanyCommission, crPartial.RebateCount

        //                           ) AS AmountTotal
        //        ) AS sumT ON sumT.ID = @CurrentID
        //            END
        //        END;

        //        SET @Counter = @Counter + 1;
        //        END;

        //    SELECT*
        //    FROM #TempResults 
        //    ORDER BY CAST(ID AS INT);

        //        DROP TABLE #TempResults;
        //END;

        //GO

        //ALTER Proc[dbo].[CompanyRebateRequests_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null,
        //@CompanyBankAccountID nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        UPDATE CompanyRebateRequests SET MUser = @MUser, MDate = @MDate, Description = @Description, Status = @Status, IsBankQueryNr = @IsBankQueryNr, SIDBank = @SIDBank, CompanyBankAccountID = @CompanyBankAccountID

        //        WHERE ID = @ID AND Status in (1,8)

        //        IF(@Status= 2)

        //        BEGIN
        //            INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission , CompanyCommissionRate)

        //            SELECT cr.ID, GETDATE(), cr.IDCompany, '90', cr.MDate, cr.TransactionNr, cr.IDBank, cr.Amount,0,0, cr.Amount,0,
        //--			case when cr.IsPartialRebate = 1 then cr.Amount - ((cr.Amount* ct.CommissionRate) / 100) else ct.NetTotal end, 0, 0,
        //--			case when cr.IsPartialRebate = 1 then cr.Amount - ((cr.Amount* ct.CommissionRate) / 100) else ct.NetTotal end,
        //--			case when cr.IsPartialRebate = 1 then cr.Amount - ((cr.Amount* ct.CompanyCommissionRate) / 100) else ct.NetTotal end,
        //            ct.CompanyCommissionRate
        //            FROM CompanyRebateRequests cr

        //            LEFT JOIN PaymentNotifications pt ON pt.TransactionID=cr.TransactionID
        //            LEFT JOIN CreditCardPaymentNotifications ccpt ON ccpt.TransactionID= cr.TransactionID

        //            LEFT JOIN ForeignCreditCardPaymentNotifications fccpt ON fccpt.TransactionID= cr.TransactionID

        //            INNER JOIN CompanyTransactions ct ON (ct.TransactionNr= pt.TransactionNr or ct.TransactionNr= ccpt.TransactionNr or ct.TransactionNr= fccpt.TransactionNr) AND ct.IDActionType IN ('10', '20', '100', '90','140')

        //            WHERE cr.ID=@ID
        //        END

        //        ELSE IF(@Status= 3)

        //        BEGIN
        //            UPDATE Companies SET UsingBalance+=(select cr.Amount from CompanyRebateRequests cr where cr.ID=@ID)

        //            WHERE ID = (select cr.IDCompany from CompanyRebateRequests cr where cr.ID=@ID)

        //        END

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyRebateRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@TransactionID nvarchar(50),
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null,
        //@Amount decimal (18,2),
        //@IsPartialRebate bit,
        //@PaymentedEntityID nvarchar(50) = null,
        //@PartialRebatePaymentInstitutionTotalAmount decimal (18,2) = null,
        //@PartialRebatePaymentInstitutionCommission decimal (18,2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //IF(Select Count(*) From CompanyRebateRequests Where TransactionID= @TransactionID AND Status IN (1,2))>0
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu işlem numaralı iade talebi sistemde mevcut.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<@Amount
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE IF(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<@Amount
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //SET @IDOut = NEWID()


        //INSERT INTO CompanyRebateRequests(ID, CUser, CDate, TransactionNr, IDCompany, TransactionID, IDMember, IDBank, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, IsPartialRebate, Status, IsBankQueryNr, SIDBank, PartialRebatePaymentInstitutionTotalAmount, PartialRebatePaymentInstitutionCommission, PaymentedEntityID)

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, IDBank, ActionDate, ActionTime, @Amount, SenderName, SenderIdentityNr, @IsPartialRebate, 1, @IsBankQueryNr, @SIDBank, @PartialRebatePaymentInstitutionTotalAmount,@PartialRebatePaymentInstitutionCommission, @PaymentedEntityID FROM PaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UNION ALL

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, '00' , ActionDate, ActionTime, @Amount, SenderName, SenderIdentityNr, @IsPartialRebate, 1 , @IsBankQueryNr, @SIDBank, @PartialRebatePaymentInstitutionTotalAmount,@PartialRebatePaymentInstitutionCommission, @PaymentedEntityID FROM CreditCardPaymentNotifications Where TransactionID=@TransactionID AND Status=2
        //UNION ALL

        //SELECT @IDOut, @CUser, @CDate, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDCompany, @TransactionID, IDMember, '00' , ActionDate, ActionTime, @Amount, SenderName, SenderIdentityNr, @IsPartialRebate, 1 , @IsBankQueryNr, @SIDBank, @PartialRebatePaymentInstitutionTotalAmount,@PartialRebatePaymentInstitutionCommission, @PaymentedEntityID FROM ForeignCreditCardPaymentNotifications Where TransactionID=@TransactionID AND Status=2

        //UPDATE Companies SET UsingBalance-=@Amount

        //WHERE ID = @IDCompany


        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        // ALTER TABLE AccountSummaries ADD
        // ForeignCreditCardPaymentNotificationProfit decimal (18, 4) NULL

        //GO

        //ALTER Proc[dbo].[AccountSummaries_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@Profit decimal (18,2),
        //@ExpenseAmount decimal (18,2),
        //@Difference decimal (18,2),
        //@PaymentNotificationProfit decimal (18,2),
        //@CreditCardPaymentNotificationProfit decimal (18,2),
        //@ForeignCreditCardPaymentNotificationProfit decimal (18,2),
        //@WithdrawalRequestProfit decimal (18,2),
        //@DealerTotalBalance decimal (18,2),
        //@UnmatchedPaymentNotificationBalance decimal (18,2),
        //@NetAmount decimal (18,2),
        //@IncomeAmount decimal (18,2),
        //@IsMonthly bit = null,
        //@RebateExpenseProfitAmount decimal (18,2),
        //@Month int = null,
        //@Year int = null,
        //@CreditCardPoolBalance decimal (18,2) = 0,
        //@FraudPoolBalance decimal (18,2) = 0,
        //@FraudExpenseProfitAmount decimal (18,2) = 0
        //AS
        //BEGIN

        //BEGIN TRY

        //SET @IDOut = NEWID()

        //INSERT INTO AccountSummaries(ID, CUser, CDate, Profit, ExpenseAmount, Difference,
        //PaymentNotificationProfit, CreditCardPaymentNotificationProfit,
        //WithdrawalRequestProfit, DealerTotalBalance, UnmatchedPaymentNotificationBalance, NetAmount,
        //IncomeAmount, IsMonthly, RebateExpenseProfitAmount, Month, Year, CreditCardPoolBalance,
        //FraudPoolBalance, FraudExpenseProfitAmount, ForeignCreditCardPaymentNotificationProfit)

        //VALUES(@IDOut, @CUser, @CDate, @Profit, @ExpenseAmount, @Difference,
        //@PaymentNotificationProfit, @CreditCardPaymentNotificationProfit,
        //@WithdrawalRequestProfit, @DealerTotalBalance, @UnmatchedPaymentNotificationBalance, @NetAmount,
        //@IncomeAmount, @IsMonthly, @RebateExpenseProfitAmount, @Month, @Year, @CreditCardPoolBalance,
        //@FraudPoolBalance, @FraudExpenseProfitAmount, @ForeignCreditCardPaymentNotificationProfit)

        //SELECT @IDOut
        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //        ALTER Proc[dbo].[CompanyTransactions_GetAccountReportv2]
        //        @IDCompany nvarchar(50),
        //        @StartDate datetime,
        //        @EndDate datetime
        //        AS
        //        BEGIN

        //        SELECT top 1 
        //        isnull(sumT.TransferTotalAmount,0) as TransferTotalAmount ,
        //        isnull(sumTr.CompanyCommission,0) as TransferCommissionProfitAmount,
        //        isnull(sumTr.TransferDealerPaidAmount,0) as TransferDealerPaidAmount,
        //        isnull(sumTrPool.Amount,0) as TransferNotMatchedAmount,

        //        isnull(sumT.CreditCardTotalAmount,0) as CreditCardTotalAmount,
        //        isnull(sumT.ForeignCreditCardTotalAmount,0) as ForeignCreditCardTotalAmount,
        //        isnull(sumCr.CompanyCommission,0) as CreditCardCommissionProfitAmount,
        //        isnull(sumCr.CreditCardDealerPaidAmount,0) as CreditCardDealerPaidAmount,
        //        isnull(sumCr.CreditCardPaymentInstitutionPaidAmount,0) as CreditCardPaymentInstitutionPaidAmount,    

        //        isnull(sumFcr.ForeignCompanyCommission,0) as ForeignCreditCardCommissionProfitAmount,
        //        isnull(sumFcr.ForeignCreditCardDealerPaidAmount,0) as ForeignCreditCardDealerPaidAmount,
        //        isnull(sumFcr.ForeignCreditCardPaymentInstitutionPaidAmount,0) as ForeignCreditCardPaymentInstitutionPaidAmount,   

        //        isnull(sumWt.WithdrawalTotalAmount,0) as WithdrawalTotalAmount, 
        //        isnull(sumWt.WithdrawalTotalPaidAmount,0) as WithdrawalTotalPaidAmount, 
        //        isnull(sumWt.WithdrawalTotalTransactionFeeAmount,0) as WithdrawalTotalTransactionFeeAmount, 
        //        isnull(sumEft.Amount,0) as WithdrawalEftAmount, 
        //        isnull(sumFast.Amount,0) as WithdrawalFastAmount, 

        //       	isnull(sumRebate.Amount,0) as RebateExpenseProfitAmount, 
        //       	isnull(sumFraud.Amount,0) + isnull(sumForeignCCFraud.Amount,0) as FraudExpenseProfitAmount, 
        //        isnull(sumEx.Amount,0) as TotalExpenseAmount,
        //        isnull(sumIncome.Amount,0) as TotalIncomeAmount

        //        FROM CompanyTransactions t

        //        cross join(Select SUM(CASE WHEN t.IDActionType IN (10, 20,150) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS TransferTotalAmount,
        //        SUM(CASE WHEN t.IDActionType IN(100, 110) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS CreditCardTotalAmount,
        //        SUM(CASE WHEN t.IDActionType IN(140) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) as ForeignCreditCardTotalAmount From CompanyTransactions
        //        t where IDActionType IN(10,20,100,110,150,140)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //--        cross join(Select sum([dbo].RoundToZero(Commission)) as Commission From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumC

        //        cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as CompanyCommission, 
        //        sum([dbo].RoundToZero(NetTotal)) as CreditCardDealerPaidAmount, 
        //        sum([dbo].RoundToZero(CompanyCommission)) as CreditCardPaymentInstitutionPaidAmount
        //        From CompanyTransactions t where IDActionType IN(100,110)
        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumCr

        //        cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as ForeignCompanyCommission, 
        //        sum([dbo].RoundToZero(NetTotal)) as ForeignCreditCardDealerPaidAmount, 
        //        sum([dbo].RoundToZero(CompanyCommission)) as ForeignCreditCardPaymentInstitutionPaidAmount
        //        From CompanyTransactions t where IDActionType IN(140)
        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumFcr

        //        cross join(Select sum([dbo].RoundToZero(Commission)) as CompanyCommission, sum([dbo].RoundToZero(NetTotal)) AS TransferDealerPaidAmount

        //        From CompanyTransactions t where IDActionType IN(10,20,150)

        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumTr

        //--        cross join(Select sum([dbo].RoundToZero(NetTotal)) as NetTotal From CompanyTransactions t where IDActionType IN(10,20,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumNet

        //        cross join(Select sum([dbo].RoundToZero(t.Total + t.CostTotal)) as WithdrawalTotalAmount,
        //        sum([dbo].RoundToZero(t.Total)) as WithdrawalTotalPaidAmount,
        //        sum([dbo].RoundToZero(t.CostTotal)) as WithdrawalTotalTransactionFeeAmount

        //        From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        Where
        //         t.IDActionType IN (30)
        //        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumWt

        //        CROSS JOIN(
        //            SELECT
        //                SUM(
        //                    ROUND(
        //                        CASE
        //                            WHEN ct.Commission = ct.CompanyCommission THEN 0

        //                            ELSE
        //                                CASE

        //                                    WHEN r.IsPartialRebate = 1 THEN (r.PartialRebatePaymentInstitutionTotalAmount - r.PartialRebatePaymentInstitutionCommission) - r.Amount
        //                                    ELSE[dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal
        //                                END

        //                        END, 4
        //		            )
        //		        ) AS Amount
        //        From CompanyRebateRequests r
        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)

        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //           where r.Status = 2
        //        and (@IDCompany IS NULL OR ct.IDCompany= @IDCompany)
        //        and(CAST(ct2.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(ct2.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumRebate

        //        cross join(select sum([dbo].RoundToZero(r.PaymentInstitutionNetAmount - r.Commission)) as Amount
        //        From CreditCardPaymentNotifications r

        //           INNER JOIN CompanyIntegrations ci on ci.ServiceID = r.ServiceID
        //           where r.Status in (6,7) AND r.PaymentInstitutionNetAmount is not null 
        //        and (@IDCompany IS NULL OR ci.ID= @IDCompany)
        //        and(CAST(r.MDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(r.MDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFraud

        //        cross join(select sum([dbo].RoundToZero(r.PaymentInstitutionNetAmount)) as Amount
        //        From ForeignCreditCardPaymentNotifications r

        //           INNER JOIN CompanyIntegrations ci on ci.ServiceID = r.ServiceID
        //           where r.Status in (6,7) AND r.PaymentInstitutionNetAmount is not null 
        //        and (@IDCompany IS NULL OR ci.ID= @IDCompany)
        //        and(CAST(r.MDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(r.MDate AS datetime)<=CAST(@EndDate AS datetime))) as sumForeignCCFraud


        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //        cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //        and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast

        //--        cross join(Select sum([dbo].RoundToZero(cw.CostTotal)) as CostTotal , Count(cw.Amount) as cwCostTotal From CompanyTransactions t
        //--
        //--        inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //--        where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110)
        //--
        //--        and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //--
        //--        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //--        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumProcess

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 2

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //        and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1 ) as sumEx

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //        where TransactionType = 1

        //        and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //    and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //        AND T.TransactionDetailType = 1  ) as sumIncome

        //        cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From PaymentTransferPools t

        //        where t.Status = 1 
        //        AND NOT EXISTS (select* from WhereConditions wc
        //        WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //        (wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //        AND t.Amount > 0 


        //		) as sumTrPool

        //        --WHERE(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        // --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE)))
        //        --	  AND(IDCompany IS NULL OR  (CAST(t.TransactionDate AS DATE)<=CAST(@EndDate AS DATE)))


        //        END

        //Go

        //INSERT INTO dbo.PaymentInstitutions
        //(ID, Name, Show, Rate, IsActive, UseForForeignCard, DebitCardRate, ForSpecialCreditCard, RedirectToActionGetThreeDView, RedirectToActionPaymentMethod, RedirectToActionRebateMethod, EndOfDayTime, ConsecutiveTransactionLimit, CurrentTransactionCount)
        //VALUES(N'10', N'LidioPos Yurt Dışı TL', 1, 2.60, 0, 1, 2.60, 0, N'LidioPosThreeDSecure', N'LidioPosPaymentMethod', N'LidioPosForeignCardRefundMethod', N'22:00', NULL, NULL);

        //GO

        //UPDATE dbo.Settings
        //SET ParamVal= N'100000', 
        //WHERE ParamType = N'MaxFastAmountLimit' AND ParamDef = N'max_fast_amount_limit' AND ParamVal = N'50000' AND ActivatedForGeneralUse = 0;

        //GO

        //CREATE TABLE dbo.CreditCardBinList(
        //    Bin nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL
        //);

        //GO

        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'404591');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'407814');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'413226');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'444676');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'444677');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'444678');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'447504');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'454671');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'454672');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'454673');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'454674');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'469884');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'476619');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512440');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'513662');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516932');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'523529');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'527682');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'528208');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'530905');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'531102');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'533154');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'534981');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540130');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540134');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542374');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'546957');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547287');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'549449');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676123');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676124');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'415514');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'415515');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'421030');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'440776');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'447505');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'451454');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'492094');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'492095');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498852');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'499821');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510056');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521378');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'526289');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'526290');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540435');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'543081');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552879');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'588843');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'639001');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676258');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979210');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979212');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402940');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'409084');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411724');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411942');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411943');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411944');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411979');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'415792');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'416757');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'428945');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'442671');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'459252');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479908');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479909');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'491005');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'493840');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'493841');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'493846');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520017');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540045');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540046');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542119');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542798');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542804');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547244');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552101');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'554548');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'589311');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979209');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402142');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402458');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402459');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'404315');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'406015');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'413528');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'427308');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'427707');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'438040');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'440247');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'440273');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'440293');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'440294');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'440295');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'447503');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'450918');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'455645');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'459026');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'469188');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479227');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'489494');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'489495');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'489496');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510138');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510139');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510221');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512753');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512803');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516742');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'519780');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'524346');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'524839');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'524840');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'525314');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'527026');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'528825');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'528920');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'530853');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'531531');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'532581');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'534538');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535217');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542259');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545124');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545148');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547985');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'549998');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'550449');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552207');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'553090');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'606329');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676406');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'413252');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'425669');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'432071');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'432072');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'435508');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'435509');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'474853');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'474854');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512754');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516840');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516841');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520932');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521807');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521942');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'524347');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535280');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552608');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552609');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'553056');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'557113');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'557829');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'589004');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979206');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979207');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979208');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'403836');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411156');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411157');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411158');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411159');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'421086');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'423833');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'433383');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'459068');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'459268');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'489401');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'494063');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'494064');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516846');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'519753');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521394');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'525404');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'527657');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'530866');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547311');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'549208');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'589713');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676832');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'374421');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'374422');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'374424');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'374425');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'374426');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'374427');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375622');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375623');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375624');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375625');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375626');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375627');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375628');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375629');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375631');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'377137');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'401738');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'403280');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'403666');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'404308');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'405051');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'405090');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'409219');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'410141');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'413836');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'420556');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'420557');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'426886');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'426887');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'426888');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'426889');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'427314');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'427315');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'428220');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'428221');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'432154');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'448472');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'461668');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'462274');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'467293');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'467294');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'467295');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'474151');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479682');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'482489');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'482490');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'482491');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'486567');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'487074');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'487075');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'489455');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'489478');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'490175');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'492186');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'492187');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'492193');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'493845');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'514915');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516943');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516961');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'517040');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'517041');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'517042');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'517048');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'517049');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520097');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520922');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520940');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520988');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521368');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521824');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521825');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521832');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522204');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'524659');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'526955');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'528939');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'528956');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'533169');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'534261');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535488');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540036');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540037');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540118');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540226');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540227');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540669');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540709');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'541865');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542030');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'543738');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'544078');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545102');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'546001');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547302');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'548935');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552095');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'553130');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'554796');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'554960');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'557023');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'557945');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558699');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'589318');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'622403');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'670606');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676255');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676283');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676651');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676827');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979236');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'418342');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'418343');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'418344');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'418345');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'441075');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'450803');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'454318');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'454358');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'454359');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'454360');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479610');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510152');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540667');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540668');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'543771');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'548237');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552096');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'553058');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'589283');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'401622');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'404809');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'413382');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'414392');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'420342');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'420343');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'442106');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'446212');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'450634');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'455359');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479612');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479794');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479795');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'490983');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'491205');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'491206');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'492128');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'492130');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'492131');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'494314');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516888');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'525864');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535435');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535601');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535602');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540061');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540062');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540063');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540122');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540129');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542117');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545103');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552645');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552659');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'603797');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'639004');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676166');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'437897');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'471509');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'553493');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'555087');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'518599');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'529939');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552098');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'589288');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'677522');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'400684');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'408579');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'408581');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'414070');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'420322');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'420323');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'420324');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'455571');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'474823');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479632');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479633');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'480296');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'490805');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'490806');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'490807');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'490808');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510151');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'514140');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'515755');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'515895');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'517946');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'526973');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'526975');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'532443');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535137');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540024');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540025');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542029');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542605');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542965');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542967');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547765');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'548819');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'550074');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'554297');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'554570');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'603322');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676366');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676402');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522075');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522265');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522566');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522576');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'559056');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'603343');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'603005');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676429');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'413729');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'413972');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'445988');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'456057');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'456059');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'514025');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521875');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'527080');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545769');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545770');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558634');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'589416');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402277');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402278');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402563');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'403082');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'409364');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'410147');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'413583');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'414388');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'415565');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'420092');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'422376');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'423277');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'423398');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'427311');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'435653');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'441007');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'442395');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'444029');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'459333');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479679');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498749');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'499850');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'499851');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'499852');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'499853');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'519324');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521022');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521584');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521836');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'529572');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'530818');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'531157');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542404');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545120');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545616');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545847');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547567');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547800');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'677238');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979202');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979203');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'405903');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'405913');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'405917');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'405918');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'405919');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'408969');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'409071');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'422629');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'424909');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'428240');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'496019');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510005');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512651');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'519399');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'525413');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'525795');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'540643');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'542254');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545183');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'550472');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'550473');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552143');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'556030');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'556031');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'556033');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'556034');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'556665');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676401');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'677193');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'466280');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'466281');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'466282');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'466283');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'466284');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516308');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516458');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522221');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'544836');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558485');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'627768');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'670670');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'414941');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498516');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498517');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498518');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498519');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498520');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498521');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'523759');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'548202');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'548434');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'554034');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558379');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'403134');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'404990');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'408625');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'409070');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411924');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'423667');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'424360');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'424361');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'441139');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'460345');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'460346');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'460347');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'462276');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'462448');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'462449');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'465574');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'472914');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'472915');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'476662');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'483747');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'489456');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'489457');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'489458');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'508129');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510063');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510118');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510119');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512017');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512117');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512446');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'514924');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'515865');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516731');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516740');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516914');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'517047');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520019');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520303');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520909');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522517');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'523515');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'529545');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'529876');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'533293');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'533330');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'539605');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'543358');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'543400');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'543427');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'546764');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'549938');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552679');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'554483');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'554566');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558443');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558446');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558448');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558460');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558514');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'670610');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'677047');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'425846');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'425847');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'425848');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'425849');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'441341');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522240');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522241');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535881');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'554301');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'558593');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'603072');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'676460');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'453144');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'453145');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'453146');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'453147');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'453148');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'453149');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'504166');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'517343');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'528246');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'532813');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'534563');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535843');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'581877');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'671121');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'671155');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'515456');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'468791');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'468793');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'468794');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'468795');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'468796');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'468797');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'469180');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'469181');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'460957');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516944');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'519261');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522347');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522356');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522362');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'524677');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'526952');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'527369');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'527383');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'527396');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'536255');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'670868');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'417715');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'534653');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'424935');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'432284');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'432285');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'511583');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'534264');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547234');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'548232');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'627510');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979227');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402589');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402590');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402591');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'402592');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'403360');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'403810');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'410555');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'410556');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'431024');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'483714');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'511660');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512595');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'518896');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'520180');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'525312');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'527083');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'547564');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'400742');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'404952');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'411685');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'424927');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'424931');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'428462');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'435627');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'435628');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'435629');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'441206');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'470954');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479915');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479916');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479917');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'485061');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498724');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'498725');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'511758');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'511783');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'512360');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979217');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'521848');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'528293');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'537719');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'549294');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'552610');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'606043');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'677451');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'483602');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535514');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979233');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979204');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'365770');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'365771');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'365772');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'365773');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'423478');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'483612');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535576');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479680');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'479681');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'534253');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535449');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'603344');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'603650');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979242');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'527765');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'654997');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979216');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'537504');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979215');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979241');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'401072');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'423002');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'533796');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'416275');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979235');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535355');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'670544');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979244');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'526911');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'528064');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'531389');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535925');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'434530');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'406281');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'657366');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'657998');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'531401');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979266');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'549624');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'377597');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'377598');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'432952');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'432954');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'538121');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'549997');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'531369');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'434528');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'434529');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'377599');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979246');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'434572');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'374423');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'416607');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'434724');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'522441');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'404350');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'497022');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'516643');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'374428');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'375630');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'377596');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'406665');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'406666');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'538124');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'538139');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'638888');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'685800');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'533803');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'550478');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'549839');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'534567');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'549539');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'483673');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979265');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535616');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'650457');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'548793');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'439748');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'478500');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979260');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'535248');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979259');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'650161');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'510054');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'476625');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'650082');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'401049');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979240');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979248');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979218');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979243');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'537829');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'432951');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'545254');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979280');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'416563');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'650170');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'537475');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'434727');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'471688');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'650173');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'511885');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'537058');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'539957');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'478593');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'478594');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'559096');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'483674');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'533207');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'537608');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'671200');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979249');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979254');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979257');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'650456');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'460952');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'434913');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'434914');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'482465');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'432953');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'538196');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'460925');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'537567');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979264');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979211');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'423091');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979277');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979278');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979223');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'670586');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'476626');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'650987');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'650052');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979213');
        //INSERT INTO dbo.CreditCardBinList(Bin) VALUES(N'979250');

        // GUNCELLENDİ

        //------------------------------------------------------- 28.08.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE TABLE dbo.Currencies(
        //    CurrencyCode nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CurrencyName nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CurrencySymbol nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CDate datetime NOT NULL,
        // CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    MDate datetime NULL,
        //    MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CONSTRAINT PK_Currencies PRIMARY KEY(CurrencyCode)
        //);

        //GO

        //INSERT INTO dbo.Currencies
        //(CurrencyCode, CurrencyName, CurrencySymbol, CDate, CUser, MDate, MUser, ID)
        //VALUES(N'USD', N'US Dollar', N'$', '2024-08-28 00:00:00.000', N'1', NULL, NULL, N'1');

        //GO

        //CREATE Proc[dbo].[Currencies_Delete]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@CurrencyCode nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY

        //        DELETE FROM Currencies WHERE ID=@ID AND CurrencyCode=@CurrencyCode

        //        SELECT @IDOut=@ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //CREATE Proc[dbo].[Currencies_GetList]
        //@CurrencyCode nvarchar(10) = null
        //AS
        //BEGIN

        //    SELECT* FROM Currencies c where @CurrencyCode IS NULL OR CurrencyCode = @CurrencyCode

        //END

        //GO

        //CREATE Proc[dbo].[Currencies_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@CurrencyCode nvarchar(10),
        //@CurrencyName nvarchar(50),
        //@CurrencySymbol nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        SET @IDOut = NEWID()

        //        INSERT INTO Currencies(ID, CDate, CUser, CurrencyCode, CurrencyName, CurrencySymbol) VALUES(@IDOut, @CDate, @CUser, @CurrencyCode, @CurrencyName, @CurrencySymbol)

        //        SELECT @IDOut

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //CREATE Proc[dbo].[Currencies_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@CurrencyCode nvarchar(10),
        //@CurrencyName nvarchar(50),
        //@CurrencySymbol nvarchar(50)
        //AS
        //BEGIN

        //    BEGIN TRY


        //        UPDATE Currencies SET MUser = @MUser, MDate = @MDate, CurrencyCode = @CurrencyCode, CurrencyName = @CurrencyName, CurrencySymbol = @CurrencySymbol WHERE ID = @ID
        //        SELECT @IDOut = @ID


        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //CREATE TABLE dbo.CompanyCurrencies(
        //    IDCompany nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CurrencyCode nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    Balance decimal (18,4) DEFAULT 0 NOT NULL,
        //    CDate datetime NOT NULL,
        // CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    MDate datetime NULL,
        //    MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    IsActive bit DEFAULT 0 NOT NULL,
        //    CONSTRAINT PK_CompanyCurrencies PRIMARY KEY(ID)
        //);
        //ALTER TABLE dbo.CompanyCurrencies ADD CONSTRAINT CompanyCurrencies_Currencies_FK FOREIGN KEY (CurrencyCode) REFERENCES dbo.Currencies(CurrencyCode);

        //GO

        //CREATE PROCEDURE[dbo].[CompanyCurrencies_Delete]
        //@IDOut NVARCHAR(50) OUTPUT,
        //    @IDCompany NVARCHAR(50),
        //    @CurrencyCode NVARCHAR(10),
        //    @IsActive BIT = NULL
        //AS
        //BEGIN


        //    DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)


        //    DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine


        //    BEGIN TRY

        //        IF EXISTS(
        //            SELECT 1 
        //            FROM CompanyCurrencies
        //            WHERE IDCompany = @IDCompany
        //              AND CurrencyCode = @CurrencyCode
        //              AND Balance <> 0
        //        )
        //        BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Kullanılabilir bakiye olması nedeniyle silinemez.'
        //   	        RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //        END

        //        IF EXISTS(
        //            SELECT
        //              1

        //             FROM
        //                 [dbo].ForeignCreditCardPaymentNotifications r

        //             INNER JOIN

        //                 [dbo].CompanyTransactions ct ON ct.ID = r.ID

        //             WHERE
        //                 ct.IDCompany = @IDCompany

        //                 AND r.Status = 2

        //                 AND r.IsNotBocked = 0

        //                 AND r.CurrencyCode = @CurrencyCode
        //        )
        //        BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Blokeli bakiye olması nedeniyle silinemez.'
        //   	        RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //        END

        //        DELETE FROM CompanyCurrencies
        //        WHERE IDCompany = @IDCompany
        //          AND CurrencyCode = @CurrencyCode
        //          AND Balance = 0;


        //        IF @@ROWCOUNT > 0
        //        BEGIN
        //            SELECT @IDOut = @IDCompany;
        //        END
        //        ELSE
        //        BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Silinecek kayıt bulunamadı.'
        //   	        RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //        END

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT;
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE();
        //        RAISERROR(@ERRORMESSAGE, 16, 1);
        //        END CATCH
        //END

        //GO

        //CREATE PROCEDURE[dbo].[CompanyCurrencies_GetList]
        //@IDCompany NVARCHAR(50)
        //AS
        //BEGIN
        //    SELECT
        //        c.*,
        //        (SELECT
        //             ISNULL(SUM(ct.NetTotal), 0)
        //         FROM
        //             [dbo].ForeignCreditCardPaymentNotifications r
        //         INNER JOIN
        //             [dbo].CompanyTransactions ct ON ct.ID = r.ID
        //         WHERE
        //             ct.IDCompany = @IDCompany
        //             AND r.Status = 2
        //             AND r.IsNotBocked = 0
        //             AND r.CurrencyCode = c.CurrencyCode
        //        ) AS BlockedBalance
        //    FROM
        //        CompanyCurrencies c
        //    WHERE
        //        c.IDCompany = @IDCompany
        //END

        //GO

        //CREATE Proc[dbo].[CompanyCurrencies_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@CurrencyCode nvarchar(50),
        //@IsActive bit
        //AS
        //BEGIN
        //    BEGIN TRY


        //        SET @IDOut = NEWID()

        //        INSERT INTO CompanyCurrencies(ID, CDate, CUser, IDCompany, CurrencyCode, IsActive) VALUES(@IDOut, @CDate, @CUser, @IDCompany, @CurrencyCode, @IsActive)

        //        SELECT @IDOut

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //CREATE Proc[dbo].[CompanyCurrencies_Update]
        //@IDOut nvarchar(50) output,
        //@CurrencyCode nvarchar(10),
        //@IDCompany nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@IsActive bit
        //AS
        //BEGIN

        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)


        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //        UPDATE CompanyCurrencies SET MUser=@MUser, MDate=@MDate, IsActive=@IsActive WHERE CurrencyCode=@CurrencyCode and IDCompany = @IDCompany


        //        IF @@ROWCOUNT = 0
        //        BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Lütfen önce üye işyerine para birimi atayın'
        //   RAISERROR(@CUSTOMERRORMESSAGE,18,1)
        //            RETURN;
        //        END


        //        SELECT @IDOut = @IDCompany

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[PaymentCreditCardPools_Insert]
        //@IDOut nvarchar(50) output,
        //@TransactionDate datetime,
        //@BankName nvarchar(50) = null,
        //@TransactionType nvarchar(20),
        //@PaymentMethodName nvarchar(50),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@PaymentMethodID int,
        //@InstallmentCount int,
        //@Status tinyint,
        //@Commission decimal (18,2),
        //@TransactionKey nvarchar(50),
        //@TransactionID nvarchar(50),
        //@Description nvarchar(200) = null,
        //@CardTypeId int = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //SET @IDOut = NEWID();

        //        INSERT INTO.PaymentCreditCardPools
        //        (ID, CDate, TransactionDate, BankName, SenderName, TransactionType, TransactionKey, Commission, Amount, Status, InstallmentCount, PaymentMethodID, PaymentMethodName, TransactionID, Description )

        //VALUES(@IDOut, GETDATE(), @TransactionDate, @BankName, @SenderName, @TransactionType, @TransactionKey, @Commission, @Amount, @Status, @InstallmentCount, @PaymentMethodID, @PaymentMethodName, @TransactionID , @Description );

        //        SELECT @IDOut


        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER FUNCTION[dbo].[CalculateBlockedBalance] (@IDCompany nvarchar(50))
        //RETURNS DECIMAL(18,2) AS
        //BEGIN

        //declare @blockedBalance decimal (18,4);

        //SELECT @blockedBalance = isnull(TUTAR, 0) from(
        //SELECT SUM (TUTAR) AS TUTAR FROM  (
        //SELECT ISNULL([dbo].RoundToZero(ct.NetTotal), 0) AS TUTAR FROM PaymentNotifications r
        //LEFT JOIN[dbo].CompanyTransactions ct ON ct.ID = r.ID
        //WHERE  ct.IDCompany= @IDCompany AND r.Status= 2 AND r.IsNotBocked= 0

        //UNION ALL

        //SELECT ISNULL([dbo].RoundToZero(ISNULL(ct.NetTotal, r.Commission)), 0)  AS TUTAR FROM CreditCardPaymentNotifications r
        //INNER JOIN[dbo].CompanyTransactions ct ON ct.ID = r.ID
        //WHERE  ct.IDCompany= @IDCompany AND r.Status= 2 AND r.IsNotBocked= 0

        //UNION ALL

        //SELECT ISNULL([dbo].RoundToZero(ct.NetTotal), 0) AS TUTAR FROM ForeignCreditCardPaymentNotifications r
        //INNER JOIN[dbo].CompanyTransactions ct ON ct.ID = r.ID
        //WHERE  ct.IDCompany= @IDCompany AND r.Status= 2 AND r.IsNotBocked= 0 and r.CurrencyCode = 'TRY'
        //) AS AAA ) as aa

        //RETURN @blockedBalance;
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetMonthlyAccountSummary]
        //@DailyReportStartDateTime datetime,
        //@DailyReportEndDateTime datetime,
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime,
        //@WeeklyReportStartDateTime datetime,
        //@WeeklyReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //    SELECT
        //        ccpn.CreditCardPaymentMethodID AS CreditCardPaymentMethodID,
        //        [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //    SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit
        //    FROM CompanyTransactions t
        //    LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //    INNER JOIN PaymentInstitutions pins on pins.ID = ccpn.CreditCardPaymentMethodID
        //    WHERE t.IDActionType IN(100, 110,140) AND pins.UseForForeignCard = 0
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ccpn.CreditCardPaymentMethodID
        //),

        //ForeignCreditCardCTE AS(
        //    SELECT
        //        ccpn.CreditCardPaymentMethodID AS ForeignCreditCardPaymentMethodID,
        //        [dbo].RoundToZero(SUM(t.Total)) AS ForeignCreditCardSumTotal,
        //    SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS ForeignCreditCardProfit
        //    FROM CompanyTransactions t
        //    LEFT JOIN ForeignCreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //    INNER JOIN PaymentInstitutions pins on pins.ID = ccpn.CreditCardPaymentMethodID
        //    WHERE t.IDActionType IN(140) AND pins.UseForForeignCard = 1
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ccpn.CreditCardPaymentMethodID
        //),

        //PaymentTransferPoolCTE AS(
        //    SELECT
        //        t.IDBank AS PaymentTranferPoolBankID,
        //        [dbo].RoundToZero(SUM(t.Amount)) AS PaymentTranferPoolSumTotal,
        //    [dbo].RoundToZero(SUM(ct.Commission)) AS PaymentNotificationProfitAmount
        //    FROM PaymentTransferPools t
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionNr = t.ResponseTransactionNr
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = pn.ID
        //    WHERE t.Status = 2
        //        AND ct.TransactionDate >= @ReportStartDateTime
        //        AND ct.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDBank
        //),

        //WithdrawalRequestCTE AS(
        //    SELECT
        //        cwr.SIDBank AS WithdrawalRequestSIDBank,
        //        [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //        SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit
        //FROM CompanyTransactions t
        //LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //WHERE t.IDActionType = '30'
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY cwr.SIDBank
        //),

        //PaymentNotificationCTE AS(
        //    SELECT
        //        ptp.IDBank AS PaymentNotificationSIDBank,
        //        [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationTotalAmount
        //    FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //    LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //    WHERE t.IDActionType IN(10, 20, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY ptp.IDBank
        //),

        //DateRangeQueryCTE AS(
        //    SELECT
        //        [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @DailyReportStartDateTime
        //    AND TransactionDate <= @DailyReportEndDateTime THEN Total ELSE 0 END)) AS DailyTotalPaymentAmount,

        //    [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @WeeklyReportStartDateTime
        //    AND TransactionDate <= @WeeklyReportEndDateTime THEN Total ELSE 0 END)) AS WeeklyTotalPaymentAmount,

        //    [dbo].RoundToZero(SUM(CASE WHEN TransactionDate >= @ReportStartDateTime
        //        AND TransactionDate <= @ReportEndDateTime THEN Total ELSE 0 END)) AS MonthlyTotalPaymentAmount

        //    FROM CompanyTransactions

        //    WHERE IDActionType IN(10, 20, 100, 110,150)
        //),

        //CompanyTransactionCTE AS(
        //    SELECT
        //        t.IDCompany AS IDCompany,
        //        [dbo].RoundToZero(SUM(CASE WHEN t.IDActionType<> 30 THEN t.Total ELSE 0 END)) AS CompanyTransactionTotalAmount,

        //           [dbo].RoundToZero(SUM(t.Commission - t.CompanyCommission) + SUM(t.CostTotal)) AS CompanyTransactionProfit,
        //        [dbo].RoundToZero(SUM(CASE WHEN t.IDActionType = 30 THEN t.Total ELSE 0 END)) AS CompanyWithdrawalTransactionTotalAmount,
        //        [dbo].RoundToZero(SUM(CASE WHEN t.IDActionType = 30 THEN 1 ELSE 0 END)) AS CompanyWithdrawalTransactionCount
        //    FROM CompanyTransactions t
        //    INNER JOIN Companies c on c.ID = t.IDCompany
        //    WHERE t.IDActionType IN(10, 20, 30, 100, 110, 140, 150)
        //        AND t.TransactionDate >= @ReportStartDateTime
        //        AND t.TransactionDate <= @ReportEndDateTime
        //    GROUP BY t.IDCompany
        //),

        //RebateRequestCTE AS(
        //    SELECT
        //     SUM(
        //                    ROUND(
        //                        CASE
        //                            WHEN ct.Commission = ct.CompanyCommission THEN 0

        //                            ELSE
        //                                CASE

        //                                    WHEN r.IsPartialRebate = 1 THEN ct2.CompanyCommission - ct2.Total
        //                                    ELSE [dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal
        //                                END

        //                        END, 4
        //              )
        //          ) as RebateNetAmount
        //    From CompanyRebateRequests r
        //    LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //    LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //    LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //    LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)
        //    LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //    WHERE ct2.IDActionType IN (90)
        //        AND ct2.TransactionDate >= @ReportStartDateTime
        //        AND ct2.TransactionDate <= @ReportEndDateTime
        //)

        //SELECT
        //    CreditCardCTE.CreditCardPaymentMethodID,
        //    CreditCardCTE.CreditCardSumTotal,
        //    CreditCardCTE.CreditCardProfit,
        //    ForeignCreditCardCTE.ForeignCreditCardPaymentMethodID,
        //    ForeignCreditCardCTE.ForeignCreditCardSumTotal,
        //    ForeignCreditCardCTE.ForeignCreditCardProfit,
        //    PaymentTransferPoolCTE.PaymentTranferPoolBankID,
        //    PaymentTransferPoolCTE.PaymentTranferPoolSumTotal,
        //    WithdrawalRequestCTE.WithdrawalRequestSIDBank,
        //    WithdrawalRequestCTE.WithdrawalRequestTotalAmount,
        //    WithdrawalRequestCTE.WithdrawalRequestProfit,
        //    PaymentNotificationCTE.PaymentNotificationSIDBank,
        //    PaymentNotificationCTE.PaymentNotificationTotalAmount,
        //    DateRangeQueryCTE.DailyTotalPaymentAmount,
        //    DateRangeQueryCTE.WeeklyTotalPaymentAmount,
        //    DateRangeQueryCTE.MonthlyTotalPaymentAmount,
        //    CompanyTransactionCTE.IDCompany,
        //    CompanyTransactionCTE.CompanyTransactionTotalAmount,
        //    CompanyTransactionCTE.CompanyTransactionProfit,
        //    CompanyTransactionCTE.CompanyWithdrawalTransactionTotalAmount,
        //    CompanyTransactionCTE.CompanyWithdrawalTransactionCount,
        //    RebateRequestCTE.RebateNetAmount
        //FROM CreditCardCTE
        //FULL JOIN PaymentTransferPoolCTE ON 1 = 0
        //FULL JOIN ForeignCreditCardCTE ON 1 = 0
        //FULL JOIN WithdrawalRequestCTE ON 1 = 0
        //FULL JOIN PaymentNotificationCTE ON 1 = 0
        //FULL JOIN DateRangeQueryCTE ON 1 = 0
        //FULL JOIN CompanyTransactionCTE ON 1 = 0
        //FULL JOIN RebateRequestCTE ON 1 = 0;
        //        END

        //GO

        //ALTER TRIGGER[dbo].[tggrInsertCompanyTransactions]
        //ON[dbo].[CompanyTransactions]
        //AFTER INSERT
        //AS
        //BEGIN

        //declare @id nvarchar(50);
        //        declare @idActionType nvarchar(3);
        //        declare @idCompany nvarchar(50);
        //        declare @netTotal decimal (18,2);
        //declare @transactionDate datetime;

        //select @id = ID, @idActionType = IDActionType, @idCompany = IDCompany, @netTotal = [dbo].RoundToZero(NetTotal), @transactionDate = DATEADD(day, DATEDIFF(day, 0, TransactionDate), 0) from inserted


        //If @idActionType = '10' OR @idActionType = '20'

        //Begin
        //declare @IsNotBocked bit = (select ISNULL(IsNotBocked, 0) from PaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked=1

        // IF @IsNotBocked = 0

        //    BEGIN
        //        IF EXISTS(SELECT 1 FROM CompanyProgressPaymentCalendars WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany)

        //        BEGIN
        //            UPDATE CompanyProgressPaymentCalendars
        //            SET ProgressPayment += @netTotal
        //            WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany;
        //        END
        //        ELSE

        //        BEGIN
        //            INSERT INTO CompanyProgressPaymentCalendars(ID, IDCompany, [Date], ProgressPayment)

        //            VALUES(NEWID(), @idCompany, @transactionDate, @netTotal);
        //        END
        //    END
        //End
        //Else If @idActionType = '100'

        //Begin
        //declare @IsNotBocked2 bit = (select ISNULL(IsNotBocked, 0) from CreditCardPaymentNotifications where ID = @id)

        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked2=1

        // IF @IsNotBocked2 = 0

        //    BEGIN
        //        IF EXISTS(SELECT 1 FROM CompanyProgressPaymentCalendars WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany)

        //        BEGIN
        //            UPDATE CompanyProgressPaymentCalendars
        //            SET ProgressPayment += @netTotal
        //            WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany;
        //        END
        //        ELSE

        //        BEGIN
        //            INSERT INTO CompanyProgressPaymentCalendars(ID, IDCompany, [Date], ProgressPayment)

        //            VALUES(NEWID(), @idCompany, @transactionDate, @netTotal);
        //        END
        //    END
        //End

        //Else If @idActionType = '140'
        //Begin

        //declare @currencyCode nvarchar(10) =(select CurrencyCode from ForeignCreditCardPaymentNotifications where ID = @id)

        //declare @IsNotBocked3 bit = (select ISNULL(IsNotBocked, 0) from ForeignCreditCardPaymentNotifications where ID = @id)

        //IF @currencyCode = 'TRY'
        //begin
        //    UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany and @IsNotBocked3=1
        //end
        //ELSE
        //BEGIN
        //    UPDATE CompanyCurrencies SET Balance+=@netTotal WHERE IDCompany=@idCompany and CurrencyCode = @currencyCode and @IsNotBocked3=1
        //END

        //End

        //Else If @idActionType = '70'

        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End

        //Else If @idActionType='90'
        //Begin
        //UPDATE Companies SET UsingBalance=UsingBalance WHERE ID=@idCompany

        //    IF EXISTS(SELECT 1 FROM CompanyProgressPaymentCalendars WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany)
        //    BEGIN
        //        UPDATE CompanyProgressPaymentCalendars
        //        SET ProgressPayment += @netTotal* -1,
        //        RebateAmount += @netTotal* -1
        //        WHERE[Date] = CONVERT(DATE, @transactionDate) AND IDCompany = @idCompany;
        //        END
        //        ELSE
        //    BEGIN
        //        INSERT INTO CompanyProgressPaymentCalendars(ID, IDCompany, [Date], ProgressPayment, RebateAmount )
        //        VALUES(NEWID(), @idCompany, @transactionDate, @netTotal* -1, @netTotal* -1);
        //        END

        //    End

        //Else If(@idActionType= '120' or @idActionType = '150')
        //Begin
        //UPDATE Companies SET UsingBalance+=@netTotal WHERE ID=@idCompany
        //End
        //Else If @idActionType='130'
        //    Begin
        //    UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //    End


        //    Else
        //    Begin

        //    IF @idActionType<>'30'
        //Begin
        //IF(Select UsingBalance From Companies Where ID= @idCompany)<@netTotal
        //Begin

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiye yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //End
        //Else

        //Begin
        //UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@idCompany
        //End

        //End
        //End

        //END

        //GO

        //INSERT INTO dbo.PaymentInstitutions
        //(ID, Name, Show, Rate, IsActive, UseForForeignCard, DebitCardRate, ForSpecialCreditCard, RedirectToActionGetThreeDView, RedirectToActionPaymentMethod, RedirectToActionRebateMethod, EndOfDayTime, ConsecutiveTransactionLimit, CurrentTransactionCount)
        //VALUES(N'11', N'LidioPos Yurt Dışı Döviz', 1, 2.60, 0, 1, 2.60, NULL, N'LidioPosThreeDSecure', N'LidioPosPaymentMethod', N'LidioPosForeignCardRefundMethod', N'22:00', NULL, NULL);


        // GUNCELLENDİ

        //------------------------------------------------------- 09.09.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------


        // ALTER TABLE dbo.CreditCardPaymentNotifications ADD
        //   EncryptedCardNumber nvarchar(MAX) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //   IsTrustedCardNumber bit DEFAULT 0 NOT NULL,
        //   IsCaughtInFraudControl bit DEFAULT 0 NOT NULL,
        //   FraudControlDescription nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL

        //GO

        // ALTER TABLE dbo.ForeignCreditCardPaymentNotifications ADD
        //   EncryptedCardNumber nvarchar(MAX) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //   IsTrustedCardNumber bit DEFAULT 0 NOT NULL,
        //   IsCaughtInFraudControl bit DEFAULT 0 NOT NULL,
        //   FraudControlDescription nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@ParamCommission decimal (18,2),
        //@PayNKolayCommission decimal (18,2),
        //@CardNumber nvarchar(30),
        //@TransactionReferenceCode nvarchar(30),
        //@CreditCardPaymentMethodID tinyint,
        //@CardTypeId int,
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null,
        //@EncryptedCardNumber nvarchar(max) = null,
        //@FraudControlDescription nvarchar(max) = null,
        //@IsTrustedCardNumber bit = 0,
        //@IsCaughtInFraudControl bit = 0
        //AS
        //BEGIN
        //BEGIN TRY

        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //IF(Select Count(ID) From CreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //declare @_isAutoNotification bit = 0;
        //        declare @_isAuto bit;
        //declare @_minAmount decimal (18,2);
        //declare @_maxAmount decimal (18,2);
        //declare @_quantity smallint;

        //declare @companyCreditCardLimit decimal (18,2);

        //SELECT @companyCreditCardLimit = c.AutoCreditCardLimit
        //FROM Companies c
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID = @ServiceID
        //WHERE c.ID = ci.ID;

        //select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL AND @IsCaughtInFraudControl = 0)
        //begin
        //if(@Amount>=@_minAmount AND @Amount<=@_maxAmount AND @Amount <= @companyCreditCardLimit)
        //begin
        //if (select Count(pn.ID) from CreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //begin

        //    set @_isAutoNotification = 1;
        //        end
        //        end

        //end

        //SET @IDOut = NEWID()

        //INSERT INTO CreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //IsAutoNotification, Description, ParamCommission, PayNKolayCommission, CardNumber, TransactionReferenceCode, CreditCardPaymentMethodID, CardTypeId, EncryptedCardNumber,
        //FraudControlDescription, IsTrustedCardNumber, IsCaughtInFraudControl)

        //SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.CreditCardBlocked, GetDate()), 
        //IIF(cc.CreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @ParamCommission, @PayNKolayCommission, @CardNumber, @TransactionReferenceCode, @CreditCardPaymentMethodID, @CardTypeId, @EncryptedCardNumber, @FraudControlDescription, @IsTrustedCardNumber, @IsCaughtInFraudControl FROM CompanyCommissions cc

        //INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //WHERE ci.ServiceID= @ServiceID

        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CreditCardPaymentNotifications_GetEncryptedCardNumberData]
        //@EncryptedCardNumber nvarchar(50)
        //AS
        //BEGIN

        //    SELECT* FROM CreditCardPaymentNotifications where EncryptedCardNumber = @EncryptedCardNumber
        //    Order by CDate desc
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CreditCardPaymentNotifications_CreditCardTransactionCheckFraudControl]
        //@EncryptedCardNumber NVARCHAR(MAX),
        //@TimeSpanInMinutes INT = 15,
        //@TransactionLimitToday INT = 4
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //    -- 15 dakika içinde yapılan işlemler
        //    DECLARE @RecentTransactionCount INT;
        //    SELECT @RecentTransactionCount = COUNT(*)
        //    FROM CreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber and ccpn.Status = 2
        //      AND ccpn.CDate >= DATEADD(MINUTE, -@TimeSpanInMinutes, GETDATE())

        //    -- Bugünkü işlemler
        //    DECLARE @TransactionCountToday INT;
        //    SELECT @TransactionCountToday = COUNT(*)
        //    FROM CreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber and ccpn.Status = 2
        //      AND CAST(ccpn.CDate AS DATE) = CAST(GETDATE() AS DATE)

        //    -- Son 24 saat içindeki işlemler
        //    DECLARE @TransactionWithin24Hours BIT;
        //        SELECT @TransactionWithin24Hours = CASE

        //        WHEN EXISTS(
        //            SELECT 1

        //            FROM CreditCardPaymentNotifications ccpn
        //            WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber

        //              and ccpn.Status = 2

        //              AND ccpn.CDate >= DATEADD(DAY, -1, CAST(GETDATE() AS DATE))
        //           AND ccpn.CDate<CAST(GETDATE() AS DATE)
        //     ) THEN CAST(1 AS BIT)

        //        ELSE CAST(0 AS BIT)

        //    END;

        //    -- Sonuçları döndürme
        //    SELECT
        //        CASE WHEN @RecentTransactionCount >= 2 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS RecentTransactionLimitExceeded,
        //        CASE WHEN @TransactionCountToday > @TransactionLimitToday THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS DailyTransactionLimitExceeded,
        //        @TransactionWithin24Hours AS TransactionWithin24Hours
        //END


        //GO


        //ALTER Proc[dbo].[CreditCardPaymentNotifications_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT r.*, c.Title as Company,
        //    c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, m2.Name as Modifier, mt.Name AS MemberType,
        //    pins.Name as PaymentInstitutionName
        //    FROM CreditCardPaymentNotifications r

        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID

        //    INNER JOIN Companies c ON c.ID= ci.ID

        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType

        //    LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //    LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID

        //    WHERE r.ID= @ID

        //END

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime = null,
        //@MUser nvarchar(50) = null,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@TransactionReferenceCode nvarchar(30),
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //        IF @Status<> 6 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=6 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=1 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=5
        //  BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Bu bildirim daha önce cevaplanmıştır.'
        //   RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE

        //        BEGIN
        //            UPDATE CreditCardPaymentNotifications SET MDate= IIF(@MDate is null, GETDATE(), @MDate), Description=@Description, Status=@Status, 
        //   TransactionReferenceCode = @TransactionReferenceCode, MUser = @MUser, PaymentInstitutionCommissionRate = @PaymentInstitutionCommissionRate,
        //   PaymentInstitutionNetAmount = @PaymentInstitutionNetAmount, IsTrustedCardNumber = CASE WHEN @Status = 2 THEN 1
        //         ELSE IsTrustedCardNumber END, IsCaughtInFraudControl = CASE WHEN @Status = 2 THEN 0
        //         ELSE IsCaughtInFraudControl

        //            END
        //            WHERE ID=@ID
        //            AND(Status= 1 OR Status = 5 OR @Status = 6 OR Status = 6)

        //            SELECT @IDOut = @ID

        //        END

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, m2.Name as Modifier, mt.Name AS MemberType,
        //pins.Name as PaymentInstitutionName FROM ForeignCreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID
        //INNER JOIN Companies c ON c.ID= ci.ID
        //INNER JOIN Members m ON m.ID= r.IDMember
        //INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType
        //LEFT JOIN Administrators m2 ON m2.ID = r.MUser
        //LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID
        //WHERE r.ID= @ID

        //END;

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_GetSingleByTransactionID]
        //@TransactionID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, CAST([dbo].RoundToZero(ct.NetTotal) AS DECIMAL(18,2)) as NetTotal FROM ForeignCreditCardPaymentNotifications r

        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID

        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    LEFT JOIN CompanyTransactions ct on ct.ID = r.ID

        //    WHERE 1=1

        //          AND (@TransactionID IS NULL OR r.TransactionID= @TransactionID)

        //    ORDER BY CDate DESC

        //END

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@CountryCode nvarchar(10),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@CardNumber nvarchar(30),
        //@TransactionReferenceCode nvarchar(30),
        //@CreditCardPaymentMethodID tinyint,
        //@CardTypeId int = 2,
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null,
        //@CurrencyCode nvarchar(30) = "TRY",
        //@EncryptedCardNumber nvarchar(max) = null,
        //@FraudControlDescription nvarchar(max) = null,
        //@IsTrustedCardNumber bit = 0,
        //@IsCaughtInFraudControl bit = 0
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--		IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where IDMember= @IDMember And Status = 1)>0  
        //--		BEGIN
        //--			SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //--			RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--		END
        //IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //declare @_isAutoNotification bit = 0;
        //declare @_isAuto bit;
        //declare @_minAmount decimal (18,2);
        //declare @_maxAmount decimal (18,2);
        //declare @_quantity smallint;

        //declare @companyForeignCreditCardLimit decimal (18,2);

        //SELECT @companyForeignCreditCardLimit = c.AutoForeignCreditCardLimit
        //FROM Companies c
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID = @ServiceID
        //WHERE c.ID = ci.ID;

        //select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL AND @IsCaughtInFraudControl = 0)
        //begin
        //if(@Amount>=@_minAmount AND @Amount<=@_maxAmount AND @Amount <= @companyForeignCreditCardLimit)
        //begin
        //if (select Count(pn.ID) from ForeignCreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //begin

        //set @_isAutoNotification = 1;
        //end
        //end

        //end

        //SET @IDOut = NEWID()

        //INSERT INTO ForeignCreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //IsAutoNotification, Description, CardNumber, TransactionReferenceCode, CountryCode, CreditCardPaymentMethodID, CardTypeId, CurrencyCode, EncryptedCardNumber, FraudControlDescription, IsTrustedCardNumber, IsCaughtInFraudControl)

        //SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.ForeignCreditCardBlocked, GetDate()), 
        //IIF(cc.ForeignCreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @CardNumber, @TransactionReferenceCode, 
        //@CountryCode, @CreditCardPaymentMethodID, @CardTypeId, @CurrencyCode, @EncryptedCardNumber, @FraudControlDescription, @IsTrustedCardNumber, @IsCaughtInFraudControl FROM CompanyCommissions cc

        //INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //WHERE ci.ServiceID= @ServiceID

        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END;

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime = null,
        //@MUser nvarchar(50) = null,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@TransactionReferenceCode nvarchar(30),
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //        IF @Status<> 6 AND(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=6 AND(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=1 AND(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=5
        //  BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Bu bildirim daha önce cevaplanmıştır.'
        //   RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE

        //        BEGIN
        //            UPDATE ForeignCreditCardPaymentNotifications SET MDate= IIF(@MDate is null, GETDATE(), @MDate), Description=@Description, Status=@Status, 
        //   TransactionReferenceCode = @TransactionReferenceCode, MUser = @MUser, PaymentInstitutionCommissionRate = @PaymentInstitutionCommissionRate,
        //   PaymentInstitutionNetAmount = @PaymentInstitutionNetAmount, IsTrustedCardNumber = CASE WHEN @Status = 2 THEN 1
        //         ELSE IsTrustedCardNumber END, IsCaughtInFraudControl = CASE WHEN @Status = 2 THEN 0
        //         ELSE IsCaughtInFraudControl

        //            END WHERE ID=@ID
        //            AND(Status= 1 OR Status = 5 OR @Status = 6 OR Status = 6)

        //            SELECT @IDOut = @ID

        //        END

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER PROCEDURE[dbo].[ForeignCreditCardPaymentNotifications_CreditCardTransactionCheckFraudControl]
        //@EncryptedCardNumber NVARCHAR(MAX),
        //@TimeSpanInMinutes INT = 15,
        //@TransactionLimitToday INT = 4
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //    -- 15 dakika içinde yapılan işlemler
        //    DECLARE @RecentTransactionCount INT;
        //    SELECT @RecentTransactionCount = COUNT(*)
        //    FROM ForeignCreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber and ccpn.Status = 2
        //      AND ccpn.CDate >= DATEADD(MINUTE, -@TimeSpanInMinutes, GETDATE())

        //    -- Bugünkü işlemler
        //    DECLARE @TransactionCountToday INT;
        //    SELECT @TransactionCountToday = COUNT(*)
        //    FROM ForeignCreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber and ccpn.Status = 2
        //      AND CAST(ccpn.CDate AS DATE) = CAST(GETDATE() AS DATE)

        //    -- Son 24 saat içindeki işlemler
        //    DECLARE @TransactionWithin24Hours BIT;
        //        SELECT @TransactionWithin24Hours = CASE

        //        WHEN EXISTS(
        //            SELECT 1

        //            FROM ForeignCreditCardPaymentNotifications ccpn
        //            WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber

        //              and ccpn.Status = 2

        //              AND ccpn.CDate >= DATEADD(DAY, -1, CAST(GETDATE() AS DATE))
        //           AND ccpn.CDate<CAST(GETDATE() AS DATE)
        //     ) THEN CAST(1 AS BIT)

        //        ELSE CAST(0 AS BIT)

        //    END;

        //    -- Sonuçları döndürme
        //    SELECT
        //        CASE WHEN @RecentTransactionCount >= 2 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS RecentTransactionLimitExceeded,
        //        CASE WHEN @TransactionCountToday > @TransactionLimitToday THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS DailyTransactionLimitExceeded,
        //        @TransactionWithin24Hours AS TransactionWithin24Hours
        //END

        //GO

        //ALTER PROCEDURE[dbo].[ForeignCreditCardPaymentNotifications_GetEncryptedCardNumberData]
        //@EncryptedCardNumber nvarchar(50)
        //AS
        //BEGIN

        //    SELECT* FROM ForeignCreditCardPaymentNotifications where EncryptedCardNumber = @EncryptedCardNumber
        //    Order by CDate desc
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 12.09.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //        INSERT INTO.dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'FraudControlParams', N'first_transaction_limit_amount', N'10000', 0);
        //        INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'FraudControlParams', N'fifteen_miniute_limit_amount', N'1000', 0);

        //        Go
        //        ALTER PROCEDURE[dbo].[CreditCardPaymentNotifications_CreditCardTransactionCheckFraudControl]
        //        @EncryptedCardNumber NVARCHAR(MAX),
        //@TimeSpanInMinutes INT = 15,
        //@TransactionLimitToday INT = 3
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //	DECLARE @CurrentTime DATETIME = GETDATE();
        //        DECLARE @MinutesAgo DATETIME = DATEADD(MINUTE, -@TimeSpanInMinutes, @CurrentTime);

        //	-- 20 dakika önceki zamandan itibaren mevcut zamana kadar yapılan başarılı işlemler

        //    DECLARE @RecentTransactionCount INT = 0;

        //	SELECT @RecentTransactionCount = COUNT(*)

        //    FROM CreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //	  AND ccpn.CDate BETWEEN @MinutesAgo AND @CurrentTime; 

        //    -- Bugünkü işlemler
        //    DECLARE @TransactionCountToday INT;
        //    SELECT @TransactionCountToday = COUNT(*)
        //    FROM CreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //      AND CAST(ccpn.CDate AS DATE) = CAST(GETDATE() AS DATE);

        //    -- Tam olarak 24 saat öncesinden önceki işlemler var mı?
        //    DECLARE @TransactionWithin24Hours BIT;
        //    SELECT @TransactionWithin24Hours = CASE
        //        WHEN EXISTS(
        //            SELECT 1
        //            FROM CreditCardPaymentNotifications ccpn
        //            WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //              AND ccpn.Status = 2
        //              AND ccpn.CDate<DATEADD(HOUR, -24, GETDATE())  -- Tam olarak 24 saat öncesinden önce
        //        ) THEN CAST(1 AS BIT)  -- Eğer böyle bir işlem varsa, 1 (TRUE) döner
        //        ELSE CAST(0 AS BIT)  -- Aksi halde, 0 (FALSE) döner
        //    END;

        //    -- Sonuçları döndürme
        //    SELECT
        //        CASE WHEN @RecentTransactionCount >= 1 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS RecentTransactionLimitExceeded,
        //        CASE WHEN @TransactionCountToday > @TransactionLimitToday THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS DailyTransactionLimitExceeded,
        //        @TransactionWithin24Hours AS TransactionWithin24Hours;
        //END

        //GO

        //ALTER PROCEDURE[dbo].[ForeignCreditCardPaymentNotifications_CreditCardTransactionCheckFraudControl]
        //        @EncryptedCardNumber NVARCHAR(MAX),
        //@TimeSpanInMinutes INT = 15,
        //@TransactionLimitToday INT = 3
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //	DECLARE @CurrentTime DATETIME = GETDATE();
        //        DECLARE @MinutesAgo DATETIME = DATEADD(MINUTE, -@TimeSpanInMinutes, @CurrentTime);

        //	-- 20 dakika önceki zamandan itibaren mevcut zamana kadar yapılan başarılı işlemler

        //    DECLARE @RecentTransactionCount INT = 0;

        //	SELECT @RecentTransactionCount = COUNT(*)

        //    FROM ForeignCreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //	  AND ccpn.CDate BETWEEN @MinutesAgo AND @CurrentTime; 


        //    -- Bugünkü işlemler
        //    DECLARE @TransactionCountToday INT;
        //    SELECT @TransactionCountToday = COUNT(*)
        //    FROM ForeignCreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //      AND CAST(ccpn.CDate AS DATE) = CAST(GETDATE() AS DATE);

        //    -- Tam olarak 24 saat öncesinden önceki işlemler var mı?
        //    DECLARE @TransactionWithin24Hours BIT;
        //    SELECT @TransactionWithin24Hours = CASE
        //        WHEN EXISTS(
        //            SELECT 1
        //            FROM ForeignCreditCardPaymentNotifications ccpn
        //            WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //              AND ccpn.Status = 2
        //              AND ccpn.CDate<DATEADD(HOUR, -24, GETDATE())  -- Tam olarak 24 saat öncesinden önce
        //        ) THEN CAST(1 AS BIT)  -- Eğer böyle bir işlem varsa, 1 (TRUE) döner
        //        ELSE CAST(0 AS BIT)  -- Aksi halde, 0 (FALSE) döner
        //    END;

        //    -- Sonuçları döndürme
        //    SELECT
        //        CASE WHEN @RecentTransactionCount >= 1 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS RecentTransactionLimitExceeded,
        //        CASE WHEN @TransactionCountToday > @TransactionLimitToday THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS DailyTransactionLimitExceeded,
        //        @TransactionWithin24Hours AS TransactionWithin24Hours;
        //END

        //GUNCELLENDI 

        //------------------------------------------------------- 13.09.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //INSERT INTO DEV_TEST2.dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'DealerMaxSwiftAmountLimit', N'dealer_max_swift_amount_limit', N'20000', 0);

        //GO

        //ALTER TABLE dbo.CompanyWithdrawalRequests ADD
        //CurrencyCode nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS DEFAULT 'TRY' NOT NULL

        //GO

        //ALTER Proc[dbo].[CompanyWithdrawalRequests_Insert]
        //@IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@IDCompany nvarchar(50),
        //@IDBank nvarchar(2),
        //@IBAN nvarchar(32),
        //@Title nvarchar(100),
        //@Amount decimal (18,2),
        //@CostTotal decimal (18,2),
        //@IsEFT bit,
        //@Description nvarchar(250),
        //@RequestNr nvarchar(50),
        //@Status tinyint,
        //@DealerDescription nvarchar(250),
        //@IsBankQueryNr nvarchar(50) = null,
        //@SIDBank nvarchar(2) = null,
        //@IsProcess bit = false,
        //@CurrencyCode nvarchar(10) = 'TRY'
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany And Status = 1)>0  
        //--BEGIN
        //--	SET @CUSTOMERRORMESSAGE += N'Mevcutta 1 çekim talebiniz bulunmaktadır.'
        //--	RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--END

        //IF @CurrencyCode = 'TRY' AND(Select UsingBalance + NegativeBalanceLimit From Companies Where ID= @IDCompany)<(@Amount+@CostTotal)
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //END

        //ELSE IF @CurrencyCode<> 'TRY' AND (Select Balance From CompanyCurrencies Where IDCompany= @IDCompany)<(@Amount+@CostTotal)
        //BEGIN
        //    SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        // RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //END

        //ELSE IF(Select Count(*) From CompanyWithdrawalRequests Where IDCompany= @IDCompany AND IBAN = @IBAN AND Amount = @Amount AND RequestNr = @RequestNr)>0
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Bu talep numarası sistemde mevcut.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //SET @IDOut = NEWID()

        //INSERT INTO CompanyWithdrawalRequests(ID, CUser, CDate, IDCompany, TransactionNr, IDBank, IBAN, Title, Amount, CostTotal, IsEFT, Description, RequestNr, Status, MDate, DealerDescription, IsBankQueryNr, SIDBank, IsProcess, CurrencyCode)

        //SELECT @IDOut, @CUser, @CDate, @IDCompany, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank,
        //@IBAN, @Title, @Amount, @CostTotal, @IsEFT, @Description, ISNULL(@RequestNr, ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5)), @Status, GETDATE(), 
        //@DealerDescription,@IsBankQueryNr, @SIDBank, @IsProcess, @CurrencyCode FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany

        //IF @CurrencyCode = 'TRY'
        //BEGIN
        //    UPDATE Companies SET UsingBalance-=(@Amount+@CostTotal) WHERE ID = @IDCompany
        //END
        //ELSE
        //BEGIN
        //    UPDATE CompanyCurrencies SET Balance-=(@Amount+@CostTotal) WHERE IDCompany = @IDCompany AND CurrencyCode = @CurrencyCode
        //END

        //SELECT @IDOut

        //END
        //IF(@Status= 2)

        //BEGIN
        //INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, MDate, CompanyCommission , CompanyCommissionRate)

        //SELECT @IDOut, GETDATE(), @IDCompany, '30', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @IDBank, @Amount, 0, @CostTotal, @Amount+@CostTotal, GETDATE() , 0 , 0  FROM CompanyIntegrations ci WHERE ci.ID=@IDCompany
        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //GO

        //ALTER PROCEDURE[dbo].[CompanyWithdrawalRequests_SetStatus]
        //@IDOut NVARCHAR(50) OUTPUT,
        //@ID NVARCHAR(50),
        //@MUser NVARCHAR(50),
        //@MDate DATETIME,
        //@Description NVARCHAR(250),
        //@Status TINYINT,
        //@IsBankQueryNr NVARCHAR(50) = NULL,
        //@SIDBank NVARCHAR(50) = NULL,
        //@IsProcess BIT = 0,
        //@CompanyBankAccountID NVARCHAR(50)
        //AS
        //BEGIN

        //--	IF @MUser = '00000000-0000-0000-0000-000000000000'
        //--  BEGIN
        //--	    SET @Status = 2; -- Dışarıdan gelen değer 3 ise 2 olarak ayarla
        //--	END
        //--	
        //--	DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)
        //--	DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--	
        //--	IF(Select Status From CompanyWithdrawalRequests Where ID = @ID)=8
        //--	BEGIN
        //--		SET @CUSTOMERRORMESSAGE += N'İşlemde olan kayda müdahale edilemez.'
        //--		RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--	END

        //        DECLARE @Total DECIMAL(18,2);
        //        DECLARE @IDCompany NVARCHAR(50);
        //        DECLARE @CurrencyCode NVARCHAR(10);


        //        SELECT @CurrencyCode = CurrencyCode,
        //               @Total = Amount + CostTotal,
        //               @IDCompany = IDCompany

        //        FROM CompanyWithdrawalRequests

        //        WHERE ID = @ID;

        //        BEGIN TRY
        //        UPDATE CompanyWithdrawalRequests
        //        SET
        //            MUser = @MUser,
        //            MDate = IIF(@MDate IS NULL, GETDATE(), @MDate),
        //            Description = @Description,
        //            Status = @Status,
        //            IsBankQueryNr = @IsBankQueryNr,
        //            SIDBank = @SIDBank,
        //            IsProcess = @IsProcess,
        //            CompanyBankAccountID = @CompanyBankAccountID
        //        WHERE
        //            ID = @ID
        //            AND Status in (1,2,8)

        //        IF @@ROWCOUNT > 0 AND @Status IN(2, 3)
        //        BEGIN
        //            IF @Status = 2
        //            BEGIN
        //                INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank, Total, Commission, CostTotal, NetTotal, CompanyCommission, CompanyCommissionRate)
        //                SELECT
        //                    ID,
        //                    GETDATE(),
        //                    IDCompany,
        //                    '30',
        //                    MDate,
        //                    TransactionNr,
        //                    IDBank,
        //                    Amount,
        //                    0,
        //                    CostTotal,
        //                    Amount + CostTotal,
        //                    0,
        //                    0
        //                FROM
        //                    CompanyWithdrawalRequests
        //                WHERE
        //                    ID = @ID
        //            END
        //            ELSE IF @Status = 3
        //            BEGIN
        //                IF @CurrencyCode = 'TRY'
        //             BEGIN
        //                    UPDATE Companies
        //                    SET UsingBalance += @Total
        //                    WHERE

        //                        Companies.ID = @IDCompany
        //                END

        //                ELSE
        //                BEGIN

        //                    UPDATE CompanyCurrencies

        //                    SET Balance += @Total
        //                    WHERE

        //                        CompanyCurrencies.IDCompany = @IDCompany
        //                END


        //                DELETE FROM CompanyTransactions WHERE ID = @ID
        //            END
        //        END

        //        SELECT @IDOut = @ID
        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE, 16, 1)
        //    END CATCH
        //END

        //GO

        //ALTER TABLE dbo.CompanyCommissions ADD
        //WithdrawalForeignCurrencySwiftAmount decimal(5,2) DEFAULT 5 NOT NULL

        //GO

        //ALTER Proc[dbo].[CompanyCommissions_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@CreditCardRate decimal (5,2),
        //@CreditCardStatus bit,
        //@CreditCardBlocked tinyint,
        //@TransferRate decimal (5,2),
        //@TransferStatus bit,
        //@TransferBlocked tinyint,
        //@MobilePayRate decimal (5,2),
        //@MobilePayStatus bit,
        //@MobilePayBlocked tinyint,
        //@WithdrawalTransferAmount decimal (5,2),
        //@WithdrawalEftAmount decimal (5,2),
        //@ForeignCreditCardRate decimal (5,2),
        //@ForeignCreditCardBlocked tinyint,
        //@ToslaRate decimal (5,2),
        //@ToslaBlocked tinyint,
        //@WithdrawalForeignCurrencySwiftAmount decimal (5,2)
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyCommissions SET MUser = @MUser, MDate = @MDate, CreditCardRate = @CreditCardRate, TransferRate = @TransferRate, MobilePayRate = @MobilePayRate,
        //CreditCardStatus = @CreditCardStatus, TransferStatus = @TransferStatus, MobilePayStatus = @MobilePayStatus, CreditCardBlocked = @CreditCardBlocked, TransferBlocked = @TransferBlocked,
        //MobilePayBlocked = @MobilePayBlocked, WithdrawalTransferAmount = @WithdrawalTransferAmount, WithdrawalEftAmount = @WithdrawalEftAmount, ForeignCreditCardRate = @ForeignCreditCardRate,
        //ForeignCreditCardBlocked = @ForeignCreditCardBlocked, ToslaRate = @ToslaRate, ToslaBlocked = @ToslaBlocked,
        //WithdrawalForeignCurrencySwiftAmount = @WithdrawalForeignCurrencySwiftAmount

        //WHERE ID = @ID


        //--DELETE FROM CompanyBanks WHERE ID=@ID
        //--INSERT INTO CompanyBanks(ID, IDBank, CUser, CDate) SELECT @ID, ID, @MUser, @MDate FROM Banks WHERE StatusFlag = 1 AND 1=@TransferStatus

        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_CreditCardDetailedSearch]
        //@Status TINYINT,
        //@IDCompany NVARCHAR(50),
        //@SenderName NVARCHAR(500),
        //@SenderPhone NVARCHAR(50),
        //@CardNumber NVARCHAR(50),
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //    -- Declare a variable to store the total record count
        //    DECLARE @totalRecords INT;

        //    -- Select records into a temporary table
        //    SELECT
        //        r.ID,
        //        r.CDate,
        //        r.TransactionID,
        //        r.TransactionNr,
        //        r.Company,
        //        r.SenderName,
        //        r.Phone AS SenderPhone,
        //        r.CardNumber,
        //        r.CardTypeId,
        //        r.PaymentInstitutionName,
        //        r.Amount,
        //        r.Status,
        //        r.RebateID
        //    INTO #TempTable
        //    FROM
        //    (
        //        -- First query for CreditCardPaymentNotifications
        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            r.SenderName,
        //            r.Phone,
        //            r.CardNumber,
        //            r.CardTypeId,
        //            pins.Name AS PaymentInstitutionName,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID
        //        FROM CreditCardPaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        LEFT JOIN PaymentInstitutions pins ON pins.ID = r.CreditCardPaymentMethodID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@SenderName IS NULL OR r.SenderName COLLATE Turkish_CI_AS LIKE '%' + @SenderName + '%')
        //            AND(@SenderPhone IS NULL OR r.Phone COLLATE Turkish_CI_AS LIKE '%' + @SenderPhone + '%')
        //            AND(@CardNumber IS NULL OR r.CardNumber COLLATE Turkish_CI_AS LIKE '%' + @CardNumber + '%')

        //        UNION ALL

        //        -- Second query for ForeignCreditCardPaymentNotifications
        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            r.SenderName,
        //            r.Phone,
        //            r.CardNumber,
        //            r.CardTypeId,
        //            pins.Name AS PaymentInstitutionName,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID
        //        FROM ForeignCreditCardPaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        LEFT JOIN PaymentInstitutions pins ON pins.ID = r.CreditCardPaymentMethodID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@SenderName IS NULL OR r.SenderName COLLATE Turkish_CI_AS LIKE '%' + @SenderName + '%')
        //            AND(@SenderPhone IS NULL OR r.Phone COLLATE Turkish_CI_AS LIKE '%' + @SenderPhone + '%')
        //            AND(@CardNumber IS NULL OR r.CardNumber COLLATE Turkish_CI_AS LIKE '%' + @CardNumber + '%')
        //        ) AS r;

        //        -- Get the total number of records
        //        SELECT @totalRecords = COUNT(*) FROM #TempTable;

        //        -- Select the paginated results with the total records count
        //        SELECT*, @totalRecords AS TotalRecords
        //        FROM #TempTable
        //        ORDER BY CDate DESC
        //        OFFSET @OffsetValue ROWS FETCH NEXT @PageLength ROWS ONLY;

        //        -- Drop the temporary table
        //        DROP TABLE #TempTable;

        //        SET NOCOUNT OFF;
        //    END;

        //GO

        //ALTER Proc[dbo].[Members_GetActiveList]
        //@PageLenght int,
        //@OffsetValue int = 0,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //DECLARE @totalRecords int

        //SELECT ID,CDate, (Name + ' - ' + Phone) AS NAME into #TempTable FROM Members 

        //WHERE(@SearchValue IS NULL OR  (Name LIKE '%' + @SearchValue + '%' OR Phone LIKE '%' + @SearchValue + '%' ))


        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //    OFFSET ISNULL(@OffsetValue, 0) ROWS

        //    FETCH NEXT @PageLenght ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetDealerAccountSummary]
        //@IDCompany nvarchar(50),
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit,
        //            COUNT(*) AS CreditCardCount,
        //            AVG(ccpn.PaymentInstitutionCommissionRate) AS CreditCardRate
        //        FROM CompanyTransactions t
        //        LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //        WHERE t.IDActionType IN(100, 110)
        //          AND pins.UseForForeignCard = 0
        //          AND ccpn.CardTypeId = 2
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    ),

        //    ForeignCreditCardCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS ForeignCreditCardSumTotal,
        //            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS ForeignCreditCardProfit,
        //            COUNT(*) AS ForeignCreditCardCount
        //        FROM CompanyTransactions t
        //        LEFT JOIN ForeignCreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //        WHERE t.IDActionType IN(140)
        //          AND pins.UseForForeignCard = 1
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //        AND t.IDCompany = @IDCompany-- Missing condition was added
        //        GROUP BY ccpn.CreditCardPaymentMethodID
        //    ),

        //    WithdrawalRequestCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //            SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit,
        //            COUNT(*) AS WithdrawalRequestCount
        //        FROM CompanyTransactions t
        //        LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //        WHERE t.IDActionType = '30'
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    ),

        //    PaymentNotificationCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS PaymentNotificationTotalAmount,
        //            [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationProfit,
        //            COUNT(*) AS PaymentNotificationCount
        //        FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //        LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //        WHERE t.IDActionType IN(10, 20, 150)
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    ),

        //    RebateRequestCTE AS(
        //        SELECT
        //            SUM(
        //                ROUND(
        //                    CASE
        //                        WHEN ct.Commission = ct.CompanyCommission THEN 0
        //                        ELSE
        //                            CASE
        //                                WHEN r.IsPartialRebate = 1 THEN ct2.CompanyCommission - ct2.Total
        //                                ELSE [dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal
        //                            END
        //                    END, 4
        //                )
        //            ) AS RebateNetAmount
        //        FROM CompanyRebateRequests r
        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)
        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //        WHERE ct2.IDActionType IN (90)
        //          AND r.Status = 2
        //          AND ct2.TransactionDate >= @ReportStartDateTime
        //          AND ct2.TransactionDate <= @ReportEndDateTime
        //          AND ct2.IDCompany = @IDCompany
        //    ),

        //    BankCardCTE AS(
        //        SELECT
        //            COUNT(*) AS BankCardCount,
        //            [dbo].RoundToZero(SUM(t.Total)) AS BankCardSumTotal,
        //            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS BankCardProfit,
        //            AVG(ccpn.PaymentInstitutionCommissionRate) AS BankCardRate
        //        FROM CompanyTransactions t
        //        LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        WHERE t.IDActionType IN(100, 110)
        //          AND ccpn.CardTypeId = 1
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    )

        //    SELECT
        //        CreditCardSumTotal,
        //        CreditCardProfit,
        //        CreditCardCount,
        //        ForeignCreditCardSumTotal,
        //        ForeignCreditCardProfit,
        //        ForeignCreditCardCount,
        //        WithdrawalRequestTotalAmount,
        //        WithdrawalRequestProfit,
        //        WithdrawalRequestCount,
        //        PaymentNotificationTotalAmount,
        //        PaymentNotificationProfit,
        //        PaymentNotificationCount,
        //        RebateNetAmount,
        //        BankCardCount,
        //        BankCardSumTotal,
        //        BankCardProfit,
        //        CASE
        //            WHEN(CreditCardCount + BankCardCount) = 0 THEN 0
        //            ELSE((CreditCardSumTotal* CreditCardRate + BankCardSumTotal* BankCardRate) / (CreditCardSumTotal + BankCardSumTotal))
        //        END AS AverageCommissionRate
        //    FROM CreditCardCTE, ForeignCreditCardCTE, WithdrawalRequestCTE, PaymentNotificationCTE, RebateRequestCTE, BankCardCTE;
        //END


        //GUNCELLENDİ

        //------------------------------------------------------- 17.09.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //INSERT INTO dbo.Banks
        //(ID, Name, Title, Branch, AccountNr, IBAN, Img, OrderNr, StatusFlag, ActivatedForGeneralUse, IFrameWarnText)
        //VALUES(N'38', N'VTN PAPARA', N'VTN BİLİŞİM HİZMETLERİ LTD.', N'0', N'', N'TR45 0082 9010 0949 0000 0183 09', N'papara.png', 5, 1, 0, NULL);

        //    GO

        //    INSERT INTO dbo.CompanyBankAccounts
        //    (ID, CDate, CUser, MDate, MUser, IDCompany, Name, Title, IDBank, IBAN, StatusFlag, Amount, CreditCardAmount, EftAmount, IsExitAccount, IsActiveByDefaultExpenseAccount, ShowInSystemSettings, IsActiveForIFrame, AccountNr, OrderNr, IFrameWarnText)
        //VALUES(N'FA6A92FE-8C8A-4A48-9CA7-06B0D1E23DFF', '2024-09-17 10:39:31.833', N'14B899E2-444C-4DE4-87F5-CC09A4D28259', NULL, NULL, N'1312E00F-E83E-45B4-85C6-892396D12331', N'VTN PAPARA', N'VTN BİLİŞİM HİZMETLERİ LTD.', N'38', N'TR45 0082 9010 0949 0000 0183 09', 1, 0.00, 0.00, 0.00, 0, 0, 0, 0, NULL, 5, NULL);

        //    GO

        //    ALTER PROCEDURE[dbo].[Banks_GetActiveList]
        //    @IsAdminPanelRequest BIT = 1
        //AS
        //BEGIN
        //SELECT*
        //FROM Banks
        //WHERE
        //    (
        //        (@IsAdminPanelRequest = 1 AND ID NOT IN ('00', '98', '99')) 
        //        OR
        //        (@IsAdminPanelRequest = 0 AND ID NOT IN ('00', '98', '99', '36', '35', '34', '33', '37','38'))
        //    )
        //    AND StatusFlag = 1
        //ORDER BY OrderNr;
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetCreditCardTransactions]
        //@PaymentInstitutionID NVARCHAR(10) = NULL,
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords INT
        //    DECLARE @totalNegativeBalance decimal (18, 4) = 0	
        //    DECLARE @totalPositiveBalance decimal (18, 4) = 0
        //    DECLARE @skippedAmount DECIMAL(18, 4) = 0  		
        //    DECLARE @ccPool decimal (18, 4)
        //    DECLARE @result decimal (18, 4)
        //    DECLARE @isForeignCreditCard bit;

        //    select @isForeignCreditCard = (select UseForForeignCard from PaymentInstitutions pins where @PaymentInstitutionID = pins.ID )


        //       IF @isForeignCreditCard = 0

        //           BEGIN
        //               select @ccPool = ISNULL(SUM(cpn.PaymentInstitutionNetAmount), 0)

        //            FROM CreditCardPaymentNotifications cpn
        //            WHERE cpn.CreditCardPaymentMethodID = @PaymentInstitutionID
        //            AND cpn.Status in (5,6)
        //   --AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //   AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))



        //   SELECT @result = ISNULL(SUM((Total - ISNULL(t.CompanyCommission, 0))) - crPartial.ExpenseAmountPartialRebate + cftIncome.IncomeAmount - cft.ExpenseAmount - cr.ExpenseAmountRebate, 0)

        //            FROM CompanyTransactions t
        //            INNER JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID

        //            cross join(SELECT ISNULL(sum(t.Amount),0) AS ExpenseAmount

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2
        //            WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND  t.PaymentMethod = 2 and t.TransactionType = 2
        //      AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      ) as cft

        //            cross join(SELECT ISNULL(sum(t.Amount),0) AS IncomeAmount

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //            WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND  t.PaymentMethod = 2 and t.TransactionType = 1
        //      AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      ) as cftIncome

        //            cross join(SELECT ISNULL(sum((isnull(t2.Total,0) - isnull(t2.CompanyCommission,0))),0) AS ExpenseAmountRebate

        //            FROM CompanyRebateRequests cr
        //            INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //            INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr.Status = 2 and cpn.Status = 2 AND (cr.IsPartialRebate = 0 or cr.IsPartialRebate IS NULL)

        //            AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      ) as cr

        //            cross join(SELECT ISNULL(sum((cr2.PartialRebatePaymentInstitutionTotalAmount - cr2.PartialRebatePaymentInstitutionCommission)),0) AS ExpenseAmountPartialRebate

        //            FROM CompanyRebateRequests cr2
        //            INNER JOIN CompanyTransactions t ON t.ID = cr2.ID
        //            INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr2.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr2.Status = 2 and cpn.Status = 2 AND (cr2.IsPartialRebate = 1)

        //            AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      ) as crPartial

        //            WHERE 1 = 1

        //                AND t.IDActionType IN (100, 110)

        //         AND(cs.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //                AND cs.Status = 2
        // 	        --AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //          AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      GROUP BY cft.ExpenseAmount, cftIncome.IncomeAmount, cr.ExpenseAmountRebate, crPartial.ExpenseAmountPartialRebate

        //            CREATE TABLE #TempTable (
        //          TransactionDate DATETIME,
        //          PaymentInstitutionID NVARCHAR(10),
        //          SenderName NVARCHAR(MAX),
        //          Amount DECIMAL(18, 4),
        //          PaymentInstitutionName NVARCHAR(MAX),
        //          Description NVARCHAR(MAX),
        //          TotalBalance DECIMAL(18, 4),
        //          IsPositiveBalance tinyint,
        //      )


        //            INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                cs.CreditCardPaymentMethodID,
        //                cs.SenderName,
        //                (isnull(t.Total,0) - isnull(t.CompanyCommission,0)) as Amount, 
        //          pins.Name as PaymentInstitutionName, 
        //          cs.Description,
        // 	        0,
        // 	        1
        //      FROM CompanyTransactions t
        //            LEFT JOIN CreditCardPaymentNotifications cs ON cs.ID = t.ID
        //            INNER JOIN PaymentInstitutions pins ON cs.CreditCardPaymentMethodID = pins.ID
        //            WHERE t.IDActionType IN(100,110) and cs.Status = 2
        //      AND (cs.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                   cpn.MDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //                isnull(cpn.PaymentInstitutionNetAmount,0),
        //          pins.Name as PaymentInstitutionName, 
        //          N'Manuel Kredi Kartı Ödeme Havuzunda' as Description,
        //          0,
        //          1
        //      FROM CreditCardPaymentNotifications cpn
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cpn.Status = 5
        //      AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                   cpn.MDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //                isnull(cpn.PaymentInstitutionNetAmount,0),
        //          pins.Name as PaymentInstitutionName, 
        //          N'Fraud Havuzunda' as Description,
        //          0,
        //          1
        //      FROM CreditCardPaymentNotifications cpn
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cpn.Status = 6
        //      AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //          case when cr.IsPartialRebate = 1 then cr.PartialRebatePaymentInstitutionTotalAmount - cr.PartialRebatePaymentInstitutionCommission else (isnull(t2.Total,0) - isnull(t2.CompanyCommission,0)) end,
        //          pins.Name as PaymentInstitutionName, 
        //          N'İade Yapıldı' as Description,
        //          -1,
        //          0
        //      FROM CompanyRebateRequests cr
        //            INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //            INNER JOIN CreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr.Status = 2 and cpn.Status = 2
        //      AND (cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                t.CompanyIntegrationType,
        //                cba.Name,
        //                t.Amount,
        //                pins.Name as PaymentInstitutionName,
        //                cba.Name + N' Bankasına Çıkış Yapıldı' as Description,
        // 	        -1,
        // 	        0

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID

        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2

        //            WHERE
        //            t.CompanyIntegrationType = @PaymentInstitutionID

        //            AND t.PaymentMethod = 2 AND t.TransactionType = 2

        //            AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //   GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount

        //            INSERT INTO #TempTable (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT

        //                t.TransactionDate, 
        //          t.CompanyIntegrationType, 
        //          cba.Name, 
        //          t.Amount,
        //          pins.Name as PaymentInstitutionName,  
        //          cba.Name + N' Bankasından Transfer Yapıldı' as Description,
        // 	        -1,
        // 	        1
        //      FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //            WHERE

        //            t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND t.PaymentMethod = 2 AND t.TransactionType = 1
        //      AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //   GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount


        //            SELECT @totalRecords = COUNT(*) FROM #TempTable
        //      select @totalNegativeBalance = ISNULL(SUM(Amount), 0) from #TempTable where IsPositiveBalance = 0 and TotalBalance >= 0
        //      select @totalPositiveBalance = ISNULL(@result,0) + ISNULL(@ccPool,0)


        //               IF @OffsetValue<> 0
        //      BEGIN
        //                SELECT @totalPositiveBalance = @totalPositiveBalance + ISNULL(SUM(CASE WHEN IsPositiveBalance = 1 THEN Amount * -1 ELSE Amount END), 0)

        //                FROM (
        //                    SELECT Amount, IsPositiveBalance, ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum

        //                    FROM #TempTable
        //       ) AS SubQuery

        //                WHERE RowNum <= @OffsetValue
        //            END


        //            SELECT TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, @totalPositiveBalance - @totalNegativeBalance  as TotalBalance, IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable
        //      ORDER BY TransactionDate DESC

        //            OFFSET @OffsetValue ROWS
        //            FETCH NEXT @PageLength ROWS ONLY


        //            DROP TABLE #TempTable
        //  END
        //    ELSE

        //        BEGIN
        //            select @ccPool = ISNULL(SUM(cpn.PaymentInstitutionNetAmount), 0)

        //            FROM ForeignCreditCardPaymentNotifications cpn
        //            WHERE cpn.CreditCardPaymentMethodID = @PaymentInstitutionID
        //            AND cpn.Status in (5,6)
        //   --AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //   AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))



        //   SELECT @result = ISNULL(SUM((Total - ISNULL(t.CompanyCommission, 0))) - crPartial.ExpenseAmountPartialRebate + cftIncome.IncomeAmount - cft.ExpenseAmount - cr.ExpenseAmountRebate, 0)

        //            FROM CompanyTransactions t
        //            INNER JOIN ForeignCreditCardPaymentNotifications cs ON cs.ID = t.ID

        //            cross join(SELECT ISNULL(sum(t.Amount),0) AS ExpenseAmount

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2
        //            WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND  t.PaymentMethod = 2 and t.TransactionType = 2
        //      AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      ) as cft

        //            cross join(SELECT ISNULL(sum(t.Amount),0) AS IncomeAmount

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //            WHERE t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND  t.PaymentMethod = 2 and t.TransactionType = 1
        //      AND (@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      ) as cftIncome

        //            cross join(SELECT ISNULL(sum((isnull(t2.Total,0) - isnull(t2.CompanyCommission,0))),0) AS ExpenseAmountRebate

        //            FROM CompanyRebateRequests cr
        //            INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //            INNER JOIN ForeignCreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr.Status = 2 and cpn.Status = 2 AND (cr.IsPartialRebate = 0 or cr.IsPartialRebate IS NULL)

        //            AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      ) as cr

        //            cross join(SELECT ISNULL(sum((cr2.PartialRebatePaymentInstitutionTotalAmount - cr2.PartialRebatePaymentInstitutionCommission)),0) AS ExpenseAmountPartialRebate

        //            FROM CompanyRebateRequests cr2
        //            INNER JOIN CompanyTransactions t ON t.ID = cr2.ID
        //            INNER JOIN ForeignCreditCardPaymentNotifications cpn ON cpn.TransactionID = cr2.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr2.Status = 2 and cpn.Status = 2 AND (cr2.IsPartialRebate = 1)

        //            AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      ) as crPartial

        //            WHERE 1 = 1

        //                AND t.IDActionType IN (140)

        //                AND(cs.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //                AND cs.Status = 2
        // 	        --AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE)>=CAST(@StartDate AS DATE))
        //          AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //      GROUP BY cft.ExpenseAmount, cftIncome.IncomeAmount, cr.ExpenseAmountRebate, crPartial.ExpenseAmountPartialRebate

        //            CREATE TABLE #TempTable2 (
        //          TransactionDate DATETIME,
        //          PaymentInstitutionID NVARCHAR(10),
        //          SenderName NVARCHAR(MAX),
        //          Amount DECIMAL(18, 4),
        //          PaymentInstitutionName NVARCHAR(MAX),
        //          Description NVARCHAR(MAX),
        //          TotalBalance DECIMAL(18, 4),
        //          IsPositiveBalance tinyint,
        //      )


        //            INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                cs.CreditCardPaymentMethodID,
        //                cs.SenderName,
        //                (isnull(t.Total,0) - isnull(t.CompanyCommission,0)) as Amount, 
        //          pins.Name + ' ' + cs.CurrencyCode as PaymentInstitutionName, 
        //          cs.Description,
        // 	        0,
        // 	        1
        //      FROM CompanyTransactions t
        //            LEFT JOIN ForeignCreditCardPaymentNotifications cs ON cs.ID = t.ID
        //            INNER JOIN PaymentInstitutions pins ON cs.CreditCardPaymentMethodID = pins.ID
        //            WHERE t.IDActionType IN(140) and cs.Status = 2
        //      AND (cs.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                   cpn.MDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //                isnull(cpn.PaymentInstitutionNetAmount,0),
        //          pins.Name as PaymentInstitutionName, 
        //          N'Manuel Kredi Kartı Ödeme Havuzunda' as Description,
        //          0,
        //          1
        //      FROM ForeignCreditCardPaymentNotifications cpn
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cpn.Status = 5
        //      AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                   cpn.MDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //                isnull(cpn.PaymentInstitutionNetAmount,0),
        //          pins.Name as PaymentInstitutionName, 
        //          N'Fraud Havuzunda' as Description,
        //          0,
        //          1
        //      FROM ForeignCreditCardPaymentNotifications cpn
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cpn.Status = 6
        //      AND(cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(cpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(cpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description , TotalBalance , IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                cpn.CreditCardPaymentMethodID,
        //                cpn.SenderName,
        //          case when cr.IsPartialRebate = 1 then cr.PartialRebatePaymentInstitutionTotalAmount - cr.PartialRebatePaymentInstitutionCommission else (isnull(t2.Total,0) - isnull(t2.CompanyCommission,0)) end,
        //          pins.Name as PaymentInstitutionName, 
        //          N'İade Yapıldı' as Description,
        //          -1,
        //          0
        //      FROM CompanyRebateRequests cr
        //            INNER JOIN CompanyTransactions t ON t.ID = cr.ID
        //            INNER JOIN ForeignCreditCardPaymentNotifications cpn ON cpn.TransactionID = cr.TransactionID
        //            INNER JOIN CompanyTransactions t2 ON t2.ID = cpn.ID
        //            INNER JOIN PaymentInstitutions pins ON cpn.CreditCardPaymentMethodID = pins.ID
        //            WHERE cr.Status = 2 and cpn.Status = 2
        //      AND (cpn.CreditCardPaymentMethodID = @PaymentInstitutionID)

        //            AND(@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))

        //      INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT
        //                t.TransactionDate,
        //                t.CompanyIntegrationType,
        //                cba.Name,
        //                t.Amount,
        //                pins.Name as PaymentInstitutionName,
        //                cba.Name + N' Bankasına Çıkış Yapıldı' as Description,
        // 	        -1,
        // 	        0

        //            FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID

        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount2

        //            WHERE
        //            t.CompanyIntegrationType = @PaymentInstitutionID

        //            AND t.PaymentMethod = 2 AND t.TransactionType = 2

        //            AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //   GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount

        //            INSERT INTO #TempTable2 (TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, TotalBalance, IsPositiveBalance)
        //      SELECT

        //                t.TransactionDate, 
        //          t.CompanyIntegrationType, 
        //          cba.Name, 
        //          t.Amount,
        //          pins.Name as PaymentInstitutionName,  
        //          cba.Name + N' Bankasından Transfer Yapıldı' as Description,
        // 	        -1,
        // 	        1
        //      FROM CompanyFinanceTransaction t
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = @PaymentInstitutionID
        //            INNER JOIN CompanyBankAccounts cba on cba.ID = t.IDBankAccount
        //            WHERE

        //            t.CompanyIntegrationType = @PaymentInstitutionID
        //            AND t.PaymentMethod = 2 AND t.TransactionType = 1
        //      AND (@StartDate IS NULL OR CAST(t.TransactionDate AS DATE) >= CAST(@StartDate AS DATE))
        //      AND(@EndDate IS NULL OR CAST(t.TransactionDate AS DATE) <= CAST(@EndDate AS DATE))
        //   GROUP BY t.TransactionDate, t.CompanyIntegrationType, pins.Name, cba.Name, t.Amount


        //            SELECT @totalRecords = COUNT(*) FROM #TempTable2
        //      select @totalNegativeBalance = ISNULL(SUM(Amount), 0) from #TempTable2 where IsPositiveBalance = 0 and TotalBalance >= 0
        //      select @totalPositiveBalance = ISNULL(@result,0) + ISNULL(@ccPool,0)


        //               IF @OffsetValue<> 0
        //      BEGIN
        //                SELECT @totalPositiveBalance = @totalPositiveBalance + ISNULL(SUM(CASE WHEN IsPositiveBalance = 1 THEN Amount * -1 ELSE Amount END), 0)

        //                FROM (
        //                    SELECT Amount, IsPositiveBalance, ROW_NUMBER() OVER (ORDER BY TransactionDate DESC) AS RowNum

        //                    FROM #TempTable2
        //       ) AS SubQuery

        //                WHERE RowNum <= @OffsetValue
        //            END


        //            SELECT TransactionDate, PaymentInstitutionID, SenderName, Amount, PaymentInstitutionName, Description, @totalPositiveBalance - @totalNegativeBalance  as TotalBalance, IsPositiveBalance, @totalRecords AS TotalRecords FROM #TempTable2
        //      ORDER BY TransactionDate DESC

        //            OFFSET @OffsetValue ROWS
        //            FETCH NEXT @PageLength ROWS ONLY


        //            DROP TABLE #TempTable2
        //  END
        //END

        //------------------------------------------------------- 15.10.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------
        //   CREATE TABLE CompanyFraudControls(
        //   ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   IsCreditCardFraudControlActive bit DEFAULT 1 NOT NULL,
        //   CreditCardTimeSpanInRecentTransactionMinutes int DEFAULT 15 NOT NULL,
        //   CreditCardDailyTransactionCount int DEFAULT 3 NOT NULL,
        //   CreditCardFirstTransactionLimit decimal (18,2) DEFAULT 10000 NOT NULL,
        //   IsForeignCreditCardFraudControlActive bit DEFAULT 1 NOT NULL,
        //   ForeignCreditCardTimeSpanInRecentTransactionMinutes int DEFAULT 15 NOT NULL,
        //   ForeignCreditCardDailyTransactionCount int DEFAULT 3 NOT NULL,
        //   ForeignCreditCardFirstTransactionLimit decimal (18,2) DEFAULT 10000 NOT NULL,
        //   MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //MDate datetime NULL,
        //CreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18,2) DEFAULT 1000 NOT NULL,
        //   ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18,2) DEFAULT 1000 NOT NULL,
        //   CONSTRAINT PK_CompanyFraudControls PRIMARY KEY(ID)
        //   );

        //   ALTER TABLE CompanyFraudControls ADD CONSTRAINT CompanyFraudControls_Companies_FK FOREIGN KEY(ID) REFERENCES Companies(ID);

        //GO

        //CREATE PROCEDURE[dbo].[CompanyFraudControls_GetSingle]
        //@ID nchar(50)
        //AS
        //BEGIN
        //    SELECT* FROM CompanyFraudControls
        //    WHERE ID = @ID;
        //END

        //GO

        //CREATE PROCEDURE[dbo].[CompanyFraudControls_Update]
        //@IDOut nvarchar(50) output,
        //@ID nchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@IsCreditCardFraudControlActive bit,
        //@CreditCardTimeSpanInRecentTransactionMinutes int,
        //@CreditCardDailyTransactionCount int,
        //@CreditCardFirstTransactionLimit decimal (18, 2),
        //@IsForeignCreditCardFraudControlActive bit,
        //@ForeignCreditCardTimeSpanInRecentTransactionMinutes int,
        //@ForeignCreditCardDailyTransactionCount int,
        //@ForeignCreditCardFirstTransactionLimit decimal (18, 2),
        //@ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2),
        //@CreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2)
        //AS
        //BEGIN
        //    UPDATE CompanyFraudControls
        //    SET IsCreditCardFraudControlActive = @IsCreditCardFraudControlActive,
        //        CreditCardTimeSpanInRecentTransactionMinutes = @CreditCardTimeSpanInRecentTransactionMinutes,
        //        CreditCardDailyTransactionCount = @CreditCardDailyTransactionCount,
        //        CreditCardFirstTransactionLimit = @CreditCardFirstTransactionLimit,
        //        IsForeignCreditCardFraudControlActive = @IsForeignCreditCardFraudControlActive,
        //        ForeignCreditCardTimeSpanInRecentTransactionMinutes = @ForeignCreditCardTimeSpanInRecentTransactionMinutes,
        //        ForeignCreditCardDailyTransactionCount = @ForeignCreditCardDailyTransactionCount,
        //        ForeignCreditCardFirstTransactionLimit = @ForeignCreditCardFirstTransactionLimit,
        //        MUser = @MUser, MDate = @MDate,
        //        ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount = @ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //        CreditCardTimeSpanInRecentTransactionMinutesLimitAmount = @CreditCardTimeSpanInRecentTransactionMinutesLimitAmount
        //    WHERE ID = @ID;

        //        SELECT @IDOut = @ID
        //END

        //GO

        //ALTER Proc[dbo].[CompanyApplications_SetAplicationStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@Status bit
        //AS
        //BEGIN
        //BEGIN TRY

        //IF(@Status= 1)

        //BEGIN
        //DECLARE @idCompany nvarchar(50)= NEWID();
        //        DECLARE @AutoWithdrawalLimit nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'auto_withdrawal_limit');
        //        DECLARE @NegativeBalanceLimit nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'negative_balance_limit');

        //        DECLARE @TransferBeUsed int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'transfer_be_used');
        //        DECLARE @CreditCardBeUsed int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'credit_card_be_used');
        //        DECLARE @ForeignCreditCardBeUsed int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'foreign_credit_card_be_used');

        //        DECLARE @TransferRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'transfer_rate');
        //        DECLARE @CreditCardRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'credit_card_rate');
        //        DECLARE @ForeignCreditCardRate nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'foreign_credit_card_rate');

        //        DECLARE @TransferBlocked int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'transfer_blocked');
        //        DECLARE @CreditCardBlocked int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'credit_card_blocked');
        //        DECLARE @ForeignCreditCardBlocked int = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'foreign_credit_card_blocked');

        //        DECLARE @WithdrawalTransferAmount nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'withdrawal_transfer_amount');
        //        DECLARE @WithdrawalEftAmount nvarchar(10) = (SELECT s.ParamVal FROM Settings s WHERE s.ParamDef = 'withdrawal_eft_amount');

        //        INSERT INTO Companies(ID, CUser, CDate, Phone, UsingBalance, Title, Name, Email, TaxNr, TaxOffice, MonthlyGiro, Address, IdentityFrontSide,
        //        IdentityBackSide, TaxPlate, SignatureCirculars, TradeRegistryGazette, Agreement, StatusFlag, NegativeBalanceLimit, AutoWithdrawalLimit, AutoTransferLimit, AutoCreditCardLimit, AutoForeignCreditCardLimit)

        //SELECT @idCompany, @CUser, @CDate, Phone, 0, ISNULL(Title, Name), Name, Email, TaxNr, TaxOffice, MonthlyGiro, Address, IdentityFrontSide, IdentityBackSide,
        //TaxPlate, SignatureCirculars, TradeRegistryGazette, Agreement, 1, CAST(@NegativeBalanceLimit AS DECIMAL(10, 2)), CAST(@AutoWithdrawalLimit AS DECIMAL(10, 2)), 0,0,0  FROM CompanyApplications WHERE ID = @ID


        //INSERT INTO CompanyIntegrations(ID, CUser, CDate, ServiceID, SecretKey, TransferBeUsed, CreditCardBeUsed , CreditCardPaymentWithParam,
        //CreditCardPaymentWithPayNKolay, ForeignCreditCardBeUsed, ForeignCreditCardPaymentWithPayNKolay)

        //VALUES(@idCompany, @CUser, @CDate, dbo.GenerateServiceId(), dbo.GenerateSecretKey(), @TransferBeUsed , @CreditCardBeUsed , 0, 1, @ForeignCreditCardBeUsed,0)


        //DECLARE @idUser nvarchar(50)= NEWID()

        //INSERT INTO CompanyUsers(ID, CUser, CDate, IDCompany, Phone, Name, Email, Password, IsMainUser, StatusFlag) SELECT @idUser, @CUser, @CDate, @idCompany, Phone, Name, Email, Password, 1, 1 FROM CompanyApplications WHERE ID = @ID

        //INSERT INTO CompanyFraudControls(ID) VALUES(@idCompany)


        //INSERT INTO CompanyUserRoles(IDCompanyUser, RoleKey, Authorized) SELECT @idUser, RoleKey, 1 FROM Roles WHERE RoleType = 2 Order By OrderNr

        //--INSERT INTO CompanyBanks(ID, CUser, CDate, IDBank) SELECT @idCompany, @CUser, @CDate, ID FROM Banks WHERE StatusFlag = 1 Order By OrderNr

        //INSERT INTO CompanyCommissions(ID, CUser, CDate, CreditCardRate, CreditCardStatus, CreditCardBlocked, TransferRate, TransferStatus, TransferBlocked,
        //MobilePayRate, MobilePayStatus, MobilePayBlocked, WithdrawalTransferAmount, WithdrawalEftAmount, ForeignCreditCardRate, ForeignCreditCardBlocked )

        //VALUES(@idCompany, @CUser, @CDate, CAST(@CreditCardRate AS DECIMAL(10, 2)), 1, @CreditCardBlocked, CAST(@TransferRate AS DECIMAL(10, 2)), 1, @TransferBlocked, 60, 1, 1,
        //CAST(@WithdrawalTransferAmount AS DECIMAL(10, 2)),CAST(@WithdrawalEftAmount AS DECIMAL(10, 2)),CAST(@ForeignCreditCardRate AS DECIMAL(10, 2)),@ForeignCreditCardBlocked)

        //DELETE CompanyApplications WHERE ID = @ID

        //END

        //DELETE CompanyApplications WHERE ID=@ID
        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //ALTER PROCEDURE[dbo].[Companies_NewDealerInsert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser NVARCHAR(50),
        //@Name NVARCHAR(500),
        //@Phone NVARCHAR(50),
        //@Password NVARCHAR(500),
        //@Title NVARCHAR(500),
        //@Email NVARCHAR(500),
        //@TaxNr NVARCHAR(500),
        //@TaxOffice NVARCHAR(500),
        //@MonthlyGiro NVARCHAR(MAX),
        //@Address NVARCHAR(500),
        //@AutoWithdrawalLimit DECIMAL(18, 2),
        //@AutoTransferLimit DECIMAL(18, 2),
        //@AutoCreditCardLimit DECIMAL(18, 2),
        //@AutoForeignCreditCardLimit DECIMAL(18, 2),
        //@CreditCardRate DECIMAL(18, 2),
        //@TransferRate DECIMAL(18, 2),
        //@MobilePayRate DECIMAL(18, 2),
        //@WithdrawalTransferAmount DECIMAL(18, 2),
        //@WithdrawalEftAmount DECIMAL(18, 2),
        //@ForeignCreditCardRate DECIMAL(18, 2),
        //@SiteUrl NVARCHAR(500),
        //@CallbackUrl NVARCHAR(500),
        //@RedirectUrl NVARCHAR(500),
        //@IPAddress NVARCHAR(500),
        //@WithdrawalRequestCallBack NVARCHAR(500),
        //@WithdrawalApiBeUsed BIT,
        //@ForeignCreditCardBeUsed BIT,
        //@TransferBeUsed BIT,
        //@CreditCardBeUsed BIT
        //AS
        //BEGIN
        //    BEGIN TRY

        //    DECLARE @idCompany nvarchar(50)= NEWID();

        //        INSERT INTO Companies(ID, CUser, CDate, Phone, UsingBalance, Title, Name, Email, TaxNr, TaxOffice, MonthlyGiro, Address,
        //        StatusFlag, NegativeBalanceLimit, AutoWithdrawalLimit, AutoTransferLimit, AutoCreditCardLimit, AutoForeignCreditCardLimit)
        //    VALUES(@idCompany, @CUser, @CDate, @Phone, 0, @Title, @Name, @Email, @TaxNr, @TaxOffice, @MonthlyGiro, @Address, 1, 0,
        //    @AutoWithdrawalLimit, @AutoTransferLimit, @AutoCreditCardLimit, @AutoForeignCreditCardLimit)


        //    INSERT INTO CompanyIntegrations
        //    (ID, CUser, CDate, ServiceID, SecretKey, SiteUrl, CallbackUrl, TransferBeUsed, CreditCardBeUsed,
        //    CreditCardPaymentWithParam, CreditCardPaymentWithPayNKolay, RedirectUrl, IPAddress, WithdrawalRequestCallBack,
        //    ForeignCreditCardBeUsed, ForeignCreditCardPaymentWithPayNKolay, WithdrawalApiBeUsed)


        //    VALUES(@idCompany, @CUser, @CDate, dbo.GenerateServiceId(), dbo.GenerateSecretKey(), @SiteUrl, @CallbackUrl, @TransferBeUsed, @CreditCardBeUsed,
        // 0, 0, @RedirectUrl, @IPAddress, @WithdrawalRequestCallBack, @ForeignCreditCardBeUsed, 0, @WithdrawalApiBeUsed);


        //        DECLARE @idUser nvarchar(50)= NEWID();

        //        INSERT INTO CompanyUsers(ID, CUser, CDate, IDCompany, Phone, Name, Email, Password, IsMainUser, StatusFlag)
        //    SELECT @idUser, @CUser, @CDate, @idCompany, @Phone, @Name, @Email, @Password, 1, 1


        //    INSERT INTO CompanyUserRoles(IDCompanyUser, RoleKey, Authorized) SELECT @idUser, RoleKey, 1 FROM Roles WHERE RoleType = 2 Order By OrderNr

        //    INSERT INTO CompanyFraudControls(ID) VALUES(@idCompany)

        //    INSERT INTO CompanyCommissions(ID, CUser, CDate, CreditCardRate, CreditCardStatus, CreditCardBlocked, TransferRate, TransferStatus, TransferBlocked,
        //        MobilePayRate, MobilePayStatus, MobilePayBlocked, WithdrawalTransferAmount, WithdrawalEftAmount, ForeignCreditCardRate, ForeignCreditCardBlocked )

        //    VALUES(@idCompany, @CUser, @CDate, @CreditCardRate, 1, 1, @TransferRate, 1, 1, @MobilePayRate, 1, 1, @WithdrawalTransferAmount, @WithdrawalEftAmount,
        //    @ForeignCreditCardRate, 1)



        //       SELECT @IDOut = @idCompany

        //    END TRY
        //    BEGIN CATCH
        //    DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //    SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //    RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //INSERT INTO CompanyFraudControls(ID)
        //SELECT ID
        //FROM Companies
        //WHERE ID NOT IN(SELECT ID FROM CompanyFraudControls);

        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@CountryCode nvarchar(10),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@CardNumber nvarchar(30),
        //@TransactionReferenceCode nvarchar(30),
        //@CreditCardPaymentMethodID tinyint,
        //@CardTypeId int = 2,
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null,
        //@CurrencyCode nvarchar(30) = "TRY",
        //@EncryptedCardNumber nvarchar(max) = null,
        //@FraudControlDescription nvarchar(max) = null,
        //@IsTrustedCardNumber bit = 0,
        //@IsCaughtInFraudControl bit = 0
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--		IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where IDMember= @IDMember And Status = 1)>0  
        //--		BEGIN
        //--			SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //--			RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--		END
        //IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //declare @_isAutoNotification bit = 0;
        //        declare @_isAuto bit;
        //declare @_minAmount decimal (18,2);
        //declare @_maxAmount decimal (18,2);
        //declare @_quantity smallint;

        //declare @companyForeignCreditCardLimit decimal (18,2);

        //SELECT @companyForeignCreditCardLimit = c.AutoForeignCreditCardLimit
        //FROM Companies c
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID = @ServiceID
        //WHERE c.ID = ci.ID;

        //select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL AND @IsCaughtInFraudControl = 0)
        //begin
        //if(@Amount>=@_minAmount AND @Amount<=@_maxAmount AND @Amount <= @companyForeignCreditCardLimit)
        //begin
        //if (select Count(pn.ID) from ForeignCreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //begin

        //set @_isAutoNotification = 1;
        //        end
        //        end

        //end

        //SET @IDOut = NEWID()

        //INSERT INTO ForeignCreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //IsAutoNotification, Description, CardNumber, TransactionReferenceCode, CountryCode, CreditCardPaymentMethodID, CardTypeId, CurrencyCode, EncryptedCardNumber, FraudControlDescription, IsTrustedCardNumber, IsCaughtInFraudControl)

        //SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.ForeignCreditCardBlocked, GetDate()), 
        //IIF(cc.ForeignCreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @CardNumber, @TransactionReferenceCode, 
        //@CountryCode, @CreditCardPaymentMethodID, @CardTypeId, @CurrencyCode, @EncryptedCardNumber, @FraudControlDescription, @IsTrustedCardNumber, @IsCaughtInFraudControl FROM CompanyCommissions cc

        //INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //WHERE ci.ServiceID= @ServiceID

        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END;

        //GUNCELLENDİ

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetDealerAccountSummary]
        //@IDCompany nvarchar(50),
        //@ReportStartDateTime datetime,
        //@ReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit,
        //            COUNT(*) AS CreditCardCount,
        //            AVG(ccpn.PaymentInstitutionCommissionRate) AS CreditCardRate
        //        FROM CompanyTransactions t
        //        LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //        WHERE t.IDActionType IN(100, 110)
        //          AND pins.UseForForeignCard = 0
        //          AND ccpn.CardTypeId = 2
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    ),

        //--    ForeignCreditCardCTE AS(
        //--        SELECT
        //--            [dbo].RoundToZero(SUM(t.Total)) AS ForeignCreditCardSumTotal,
        //--            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS ForeignCreditCardProfit,
        //--            COUNT(*) AS ForeignCreditCardCount
        //--        FROM CompanyTransactions t
        //--        LEFT JOIN ForeignCreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //--        INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //--        WHERE t.IDActionType IN (140) AND ccpn.CurrencyCode ='TRY'
        //--          AND pins.UseForForeignCard = 1
        //--          AND t.TransactionDate >= @ReportStartDateTime
        //--          AND t.TransactionDate <= @ReportEndDateTime
        //--          AND t.IDCompany = @IDCompany
        //--        GROUP BY ccpn.CreditCardPaymentMethodID
        //--    ),
        //--    
        //--    ForeignCreditCardCurrencyListCTE AS(
        //--        SELECT
        //--            ccpn.CurrencyCode,
        //--            [dbo].RoundToZero(SUM(t.Total)) AS ForeignCurrencyCreditCardSumTotal,
        //--            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS ForeignCurrencyCreditCardProfit,
        //--            COUNT(*) AS ForeignCurrencyCreditCardCount
        //--        FROM CompanyTransactions t
        //--        LEFT JOIN ForeignCreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //--        INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //--        WHERE t.IDActionType = 140 AND ccpn.CurrencyCode<> 'TRY'
        //--          AND pins.UseForForeignCard = 1
        //--          AND t.TransactionDate >= @ReportStartDateTime
        //--          AND t.TransactionDate <= @ReportEndDateTime
        //--          AND t.IDCompany = @IDCompany
        //--        GROUP BY ccpn.CurrencyCode
        //--    ),

        //    WithdrawalRequestCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //            SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit,
        //            COUNT(*) AS WithdrawalRequestCount
        //        FROM CompanyTransactions t
        //        LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //        WHERE t.IDActionType = '30'
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    ),

        //    PaymentNotificationCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS PaymentNotificationTotalAmount,
        //            [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationProfit,
        //            COUNT(*) AS PaymentNotificationCount
        //        FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //        LEFT JOIN PaymentTransferPools ptp ON pn.TransactionNr = ptp.ResponseTransactionNr
        //        WHERE t.IDActionType IN(10, 20, 150)
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    ),

        //    RebateRequestCTE AS(
        //        SELECT
        //            SUM(
        //                ROUND(
        //                    CASE
        //                        WHEN ct.Commission = ct.CompanyCommission THEN 0
        //                        ELSE
        //                            CASE
        //                                WHEN r.IsPartialRebate = 1 THEN (r.PartialRebatePaymentInstitutionTotalAmount - r.PartialRebatePaymentInstitutionCommission) - r.Amount
        //                                ELSE[dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal
        //                            END
        //                    END, 4
        //                )
        //            ) AS RebateNetAmount
        //        FROM CompanyRebateRequests r
        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //        LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)
        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //        WHERE ct2.IDActionType IN (90)
        //          AND r.Status = 2
        //          AND ct2.TransactionDate >= @ReportStartDateTime
        //          AND ct2.TransactionDate <= @ReportEndDateTime
        //          AND ct2.IDCompany = @IDCompany
        //    ),

        //    BankCardCTE AS(
        //        SELECT
        //            COUNT(*) AS BankCardCount,
        //            [dbo].RoundToZero(SUM(t.Total)) AS BankCardSumTotal,
        //            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS BankCardProfit,
        //            AVG(ccpn.PaymentInstitutionCommissionRate) AS BankCardRate
        //        FROM CompanyTransactions t
        //        LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        WHERE t.IDActionType IN(100, 110)
        //          AND ccpn.CardTypeId = 1
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    )

        //    SELECT
        //        COALESCE(CC.CreditCardSumTotal, 0) AS CreditCardSumTotal,
        //        COALESCE(CC.CreditCardProfit, 0) AS CreditCardProfit,
        //        COALESCE(CC.CreditCardCount, 0) AS CreditCardCount,
        //--        COALESCE(FC.ForeignCreditCardSumTotal, 0) AS ForeignCreditCardSumTotal,
        //--        COALESCE(FC.ForeignCreditCardProfit, 0) AS ForeignCreditCardProfit,
        //--        COALESCE(FC.ForeignCreditCardCount, 0) AS ForeignCreditCardCount,
        //--        FCL.CurrencyCode,
        //--		COALESCE(FCL.ForeignCurrencyCreditCardSumTotal, 0) AS ForeignCurrencyCreditCardSumTotal,
        //--        COALESCE(FCL.ForeignCurrencyCreditCardProfit, 0) AS ForeignCurrencyCreditCardProfit,
        //--        COALESCE(FCL.ForeignCurrencyCreditCardCount, 0) AS ForeignCurrencyCreditCardCount,
        //        --        COALESCE(FC.ForeignCreditCardSumTotal, 0) AS ForeignCreditCardSumTotal,
        //--        COALESCE(FC.ForeignCreditCardProfit, 0) AS ForeignCreditCardProfit,
        //--        COALESCE(FC.ForeignCreditCardCount, 0) AS ForeignCreditCardCount,
        //        COALESCE(WR.WithdrawalRequestTotalAmount, 0) AS WithdrawalRequestTotalAmount,
        //        COALESCE(WR.WithdrawalRequestProfit, 0) AS WithdrawalRequestProfit,
        //        COALESCE(WR.WithdrawalRequestCount, 0) AS WithdrawalRequestCount,
        //        COALESCE(PN.PaymentNotificationTotalAmount, 0) AS PaymentNotificationTotalAmount,
        //        COALESCE(PN.PaymentNotificationProfit, 0) AS PaymentNotificationProfit,
        //        COALESCE(PN.PaymentNotificationCount, 0) AS PaymentNotificationCount,
        //        COALESCE(RR.RebateNetAmount, 0) AS RebateNetAmount,
        //        COALESCE(BK.BankCardCount, 0) AS BankCardCount,
        //        COALESCE(BK.BankCardSumTotal, 0) AS BankCardSumTotal,
        //        COALESCE(BK.BankCardProfit, 0) AS BankCardProfit,
        //        CASE
        //            WHEN(COALESCE(CC.CreditCardCount, 0) + COALESCE(BK.BankCardCount, 0)) = 0 THEN 0
        //            ELSE((COALESCE(CC.CreditCardSumTotal, 0) * COALESCE(CC.CreditCardRate, 0) + COALESCE(BK.BankCardSumTotal, 0) * COALESCE(BK.BankCardRate, 0)) / 
        //                  (COALESCE(CC.CreditCardSumTotal, 0) + COALESCE(BK.BankCardSumTotal, 0)))
        //        END AS AverageCommissionRate,
        //        (
        //            SELECT
        //                ccpn.CurrencyCode AS Currency,
        //                [dbo].RoundToZero(SUM(t.Total)) AS SumTotal,
        //                SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS Profit,
        //                COUNT(*) AS Count
        //            FROM CompanyTransactions t
        //            LEFT JOIN ForeignCreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //            WHERE t.IDActionType = 140
        //              AND pins.UseForForeignCard = 1
        //              AND t.TransactionDate BETWEEN @ReportStartDateTime AND @ReportEndDateTime
        //              AND t.IDCompany = @IDCompany
        //            GROUP BY ccpn.CurrencyCode
        //            FOR JSON PATH
        //        ) AS ForeignCreditCardSummary
        //    FROM CreditCardCTE CC
        //--    FULL OUTER JOIN ForeignCreditCardCurrencyListCTE FCL ON 1 = 1
        //--    FULL OUTER JOIN ForeignCreditCardCTE FC ON 1 = 1
        //    FULL OUTER JOIN WithdrawalRequestCTE WR ON 1 = 1
        //    FULL OUTER JOIN PaymentNotificationCTE PN ON 1 = 1
        //    FULL OUTER JOIN RebateRequestCTE RR ON 1 = 1
        //    FULL OUTER JOIN BankCardCTE BK ON 1 = 1;
        //        END

        //GUNCELLENDİ

        //------------------------------------------------------- 17.10.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        // ALTER TABLE dbo.ForeignCreditCardPaymentNotifications ADD
        // Commission decimal (18, 2) NULL

        //GO

        // ALTER TABLE dbo.PaymentNotifications ADD
        // Commission decimal (18, 2) NULL

        //GO

        //      ALTER Proc[dbo].[CompanyTransactions_GetAccountReportv2]
        //      @IDCompany nvarchar(50),
        //      @StartDate datetime,
        //      @EndDate datetime
        //      AS
        //      BEGIN

        //      SELECT top 1 
        //      isnull(sumT.TransferTotalAmount,0) as TransferTotalAmount ,
        //      isnull(sumTr.CompanyCommission,0) as TransferCommissionProfitAmount,
        //      isnull(sumTr.TransferDealerPaidAmount,0) as TransferDealerPaidAmount,
        //      isnull(sumTrPool.Amount,0) as TransferNotMatchedAmount,

        //      isnull(sumT.CreditCardTotalAmount,0) as CreditCardTotalAmount,
        //      isnull(sumT.ForeignCreditCardTotalAmount,0) as ForeignCreditCardTotalAmount,
        //      isnull(sumCr.CompanyCommission,0) as CreditCardCommissionProfitAmount,
        //      isnull(sumCr.CreditCardDealerPaidAmount,0) as CreditCardDealerPaidAmount,
        //      isnull(sumCr.CreditCardPaymentInstitutionPaidAmount,0) as CreditCardPaymentInstitutionPaidAmount,    

        //      isnull(sumFcr.ForeignCompanyCommission,0) as ForeignCreditCardCommissionProfitAmount,
        //      isnull(sumFcr.ForeignCreditCardDealerPaidAmount,0) as ForeignCreditCardDealerPaidAmount,
        //      isnull(sumFcr.ForeignCreditCardPaymentInstitutionPaidAmount,0) as ForeignCreditCardPaymentInstitutionPaidAmount,   

        //      isnull(sumWt.WithdrawalTotalAmount,0) as WithdrawalTotalAmount, 
        //      isnull(sumWt.WithdrawalTotalPaidAmount,0) as WithdrawalTotalPaidAmount, 
        //      isnull(sumWt.WithdrawalTotalTransactionFeeAmount,0) as WithdrawalTotalTransactionFeeAmount, 
        //      isnull(sumEft.Amount,0) as WithdrawalEftAmount, 
        //      isnull(sumFast.Amount,0) as WithdrawalFastAmount, 

        //     	isnull(sumRebate.Amount,0) as RebateExpenseProfitAmount, 
        //     	isnull(sumFraud.Amount,0) + isnull(sumForeignCCFraud.Amount,0) as FraudExpenseProfitAmount, 
        //      isnull(sumEx.Amount,0) as TotalExpenseAmount,
        //      isnull(sumIncome.Amount,0) as TotalIncomeAmount

        //      FROM CompanyTransactions t

        //      cross join(Select SUM(CASE WHEN t.IDActionType IN (10, 20,150) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS TransferTotalAmount,
        //      SUM(CASE WHEN t.IDActionType IN(100, 110) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) AS CreditCardTotalAmount,
        //      SUM(CASE WHEN t.IDActionType IN(140) THEN[dbo].RoundToZero(t.Total) ELSE 0 END) as ForeignCreditCardTotalAmount From CompanyTransactions
        //      t where IDActionType IN(10,20,100,110,150,140)

        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumT

        //      cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as CompanyCommission, 
        //      sum([dbo].RoundToZero(NetTotal)) as CreditCardDealerPaidAmount, 
        //      sum([dbo].RoundToZero(CompanyCommission)) as CreditCardPaymentInstitutionPaidAmount
        //      From CompanyTransactions t where IDActionType IN(100,110)
        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumCr

        //      cross join(Select sum([dbo].RoundToZero(Commission - CompanyCommission)) as ForeignCompanyCommission, 
        //      sum([dbo].RoundToZero(NetTotal)) as ForeignCreditCardDealerPaidAmount, 
        //      sum([dbo].RoundToZero(CompanyCommission)) as ForeignCreditCardPaymentInstitutionPaidAmount
        //      From CompanyTransactions t where IDActionType IN(140)
        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)
        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumFcr

        //      cross join(Select sum([dbo].RoundToZero(Commission)) as CompanyCommission, sum([dbo].RoundToZero(NetTotal)) AS TransferDealerPaidAmount

        //      From CompanyTransactions t where IDActionType IN(10,20,150)

        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<CAST(@EndDate AS datetime))) as sumTr


        //      cross join(Select sum([dbo].RoundToZero(t.Total + t.CostTotal)) as WithdrawalTotalAmount,
        //      sum([dbo].RoundToZero(t.Total)) as WithdrawalTotalPaidAmount,
        //      sum([dbo].RoundToZero(t.CostTotal)) as WithdrawalTotalTransactionFeeAmount

        //      From CompanyTransactions t

        //      inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //      Where
        //       t.IDActionType IN (30)
        //      and(@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumWt

        //      CROSS JOIN(
        //          SELECT
        //              SUM(
        //                  ROUND(
        //                      CASE
        //                          WHEN ct.Commission = ct.CompanyCommission THEN 0

        //                          ELSE
        //                              CASE

        //                                  WHEN r.IsPartialRebate = 1 THEN (r.PartialRebatePaymentInstitutionTotalAmount - r.PartialRebatePaymentInstitutionCommission) - r.Amount
        //                                  ELSE[dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal
        //                              END

        //                      END, 4
        //            )
        //        ) AS Amount
        //      From CompanyRebateRequests r
        //      LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //      LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //      LEFT JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID
        //      LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID, fn.ID)

        //      LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //         where r.Status = 2
        //      and (@IDCompany IS NULL OR ct.IDCompany= @IDCompany)
        //      and(CAST(ct2.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(ct2.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumRebate

        //      cross join(select sum([dbo].RoundToZero(r.PaymentInstitutionNetAmount - ISNULL(r.Commission,0))) as Amount
        //      From CreditCardPaymentNotifications r

        //         INNER JOIN CompanyIntegrations ci on ci.ServiceID = r.ServiceID
        //         where r.Status in (7) AND r.PaymentInstitutionNetAmount is not null and r.Commission is not null
        //      and (@IDCompany IS NULL OR ci.ID= @IDCompany)
        //      and(CAST(r.MDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(r.MDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFraud

        //      cross join(select sum([dbo].RoundToZero(r.PaymentInstitutionNetAmount - ISNULL(r.Commission,0))) as Amount
        //      From ForeignCreditCardPaymentNotifications r

        //         INNER JOIN CompanyIntegrations ci on ci.ServiceID = r.ServiceID
        //         where r.Status in (7) AND r.PaymentInstitutionNetAmount is not null and r.Commission is not null
        //      and (@IDCompany IS NULL OR ci.ID= @IDCompany)
        //      and(CAST(r.MDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(r.MDate AS datetime)<=CAST(@EndDate AS datetime))) as sumForeignCCFraud


        //      cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //      inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //      where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 1
        //      and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumEft

        //      cross join(Select sum([dbo].RoundToZero(cw.Amount)) as Amount From CompanyTransactions t

        //      inner join CompanyWithdrawalRequests cw on cw.ID = t.ID
        //      where t.IDActionType IN (10,20,30,40,50,60,70,80,90,100,110) and cw.IsEFT = 0
        //      and (@IDCompany IS NULL OR t.IDCompany= @IDCompany)

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))) as sumFast



        //      cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //      where TransactionType = 2

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //      and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //      AND T.TransactionDetailType = 1 ) as sumEx

        //      cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From CompanyFinanceTransaction t

        //      where TransactionType = 1

        //      and(CAST(t.TransactionDate AS datetime)>=CAST(@StartDate AS datetime)) 
        //  and(CAST(t.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //      AND T.TransactionDetailType = 1  ) as sumIncome

        //      cross join(Select sum([dbo].RoundToZero(Amount)) as Amount From PaymentTransferPools t

        //      where t.Status = 1 
        //      AND NOT EXISTS (select* from WhereConditions wc
        //      WHERE (wc.ColumnName = 'SenderName' and t.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //      (wc.ColumnName = 'Description' and t.Description LIKE '%' + wc.ConditionName + '%'))
        //      AND t.Amount > 0 


        //) as sumTrPool



        //      END


        //GO

        //ALTER Proc[dbo].[CompanyTransactions_SetStatusToFraud]
        //@IDOut nvarchar(50) output,
        //@EntityID nvarchar(50),
        //@IDCompany nvarchar(50),
        //@MDate datetime = null,
        //@MUser nvarchar(50) = null,
        //@Description nvarchar(250),
        //@EntityActionType nvarchar(20),
        //@Status tinyint,
        //@AdminAction nvarchar(500)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //        declare @netTotal decimal (18,2);
        //  declare @isNotBocked decimal (18,2);
        //  declare @blockedDate date;
        //  declare @entityStatus tinyint;

        //  If @EntityActionType = ('10,20')

        //        Begin
        //            IF(select Status from PaymentNotifications where ID = @EntityID)=2
        //   BEGIN
        //                UPDATE PaymentNotifications SET Status = @Status, MDate = @MDate , MUser = @MUser, Description = @Description, Commission=@netTotal where ID=@EntityID AND Status = 2

        //    INSERT INTO PaymentsAdminAction
        //                (ID, MDate, MUser, EntityID, EntityActionType, AdminAction)

        //                VALUES(NEWID(), @MDate , @MUser, @EntityID, @EntityActionType, @AdminAction);

        //        select @netTotal = [dbo].RoundToZero(NetTotal) FROM CompanyTransactions where ID = @EntityID


        //                UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@IDCompany

        //                DELETE FROM CompanyTransactions WHERE ID = @EntityID



        //                SELECT @IDOut = @EntityID

        //            END

        //            ELSE

        //            BEGIN
        //                SET @CUSTOMERRORMESSAGE += N'Onaylı Durumda Olmayan İşlem Fraud Olarak Güncellenemez'
        //    RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //            END

        //        End


        //        Else If @EntityActionType = ('100,110')	
        //  Begin

        //            select @blockedDate = BlockedDate, @isNotBocked = ISNULL(IsNotBocked, 0), @entityStatus = Status FROM CreditCardPaymentNotifications where ID=@EntityID AND Status = 2

        //   IF @entityStatus = 2

        //            BEGIN

        //                select @netTotal = [dbo].RoundToZero(NetTotal) FROM CompanyTransactions where ID = @EntityID


        //                UPDATE CreditCardPaymentNotifications SET Status = @Status, MDate = @MDate, MUser = @MUser,
        //                Description = @Description, Commission = @netTotal where ID = @EntityID AND Status = 2


        //                UPDATE Companies SET UsingBalance-=@netTotal WHERE ID=@IDCompany and @isNotBocked = 1

        //    DELETE FROM CompanyTransactions WHERE ID=@EntityID

        //                INSERT INTO PaymentsAdminAction
        //                (ID, MDate, MUser, EntityID, EntityActionType, AdminAction)

        //                VALUES(NEWID(), @MDate , @MUser, @EntityID, @EntityActionType, @AdminAction);

        //        SELECT @IDOut = @EntityID

        //            END

        //            ELSE

        //            BEGIN
        //                SET @CUSTOMERRORMESSAGE += N'Onaylı Durumda Olmayan İşlem Fraud Olarak Güncellenemez'
        //    RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //            END
        //        End



        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END


        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetDealerAccountSummary]
        //@IDCompany nvarchar(50),
        //    @ReportStartDateTime datetime,
        //    @ReportEndDateTime datetime
        //AS
        //BEGIN
        //    WITH CreditCardCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS CreditCardSumTotal,
        //            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS CreditCardProfit,
        //            COUNT(*) AS CreditCardCount,
        //            AVG(ccpn.PaymentInstitutionCommissionRate) AS CreditCardRate
        //        FROM CompanyTransactions t
        //        LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //        WHERE t.IDActionType IN(100, 110)
        //          AND pins.UseForForeignCard = 0
        //          AND ccpn.CardTypeId = 2
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    ),

        //--    ForeignCreditCardCTE AS(
        //--        SELECT
        //--            [dbo].RoundToZero(SUM(t.Total)) AS ForeignCreditCardSumTotal,
        //--            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS ForeignCreditCardProfit,
        //--            COUNT(*) AS ForeignCreditCardCount
        //--        FROM CompanyTransactions t
        //--        LEFT JOIN ForeignCreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //--        INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //--        WHERE t.IDActionType IN (140) AND ccpn.CurrencyCode ='TRY'
        //--          AND pins.UseForForeignCard = 1
        //--          AND t.TransactionDate >= @ReportStartDateTime
        //--          AND t.TransactionDate <= @ReportEndDateTime
        //--          AND t.IDCompany = @IDCompany
        //--        GROUP BY ccpn.CreditCardPaymentMethodID
        //--    ),
        //--    
        //--    ForeignCreditCardCurrencyListCTE AS(
        //--        SELECT
        //--            ccpn.CurrencyCode,
        //--            [dbo].RoundToZero(SUM(t.Total)) AS ForeignCurrencyCreditCardSumTotal,
        //--            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS ForeignCurrencyCreditCardProfit,
        //--            COUNT(*) AS ForeignCurrencyCreditCardCount
        //--        FROM CompanyTransactions t
        //--        LEFT JOIN ForeignCreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //--        INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //--        WHERE t.IDActionType = 140 AND ccpn.CurrencyCode<> 'TRY'
        //--          AND pins.UseForForeignCard = 1
        //--          AND t.TransactionDate >= @ReportStartDateTime
        //--          AND t.TransactionDate <= @ReportEndDateTime
        //--          AND t.IDCompany = @IDCompany
        //--        GROUP BY ccpn.CurrencyCode
        //--    ),

        //    WithdrawalRequestCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS WithdrawalRequestTotalAmount,
        //            SUM([dbo].RoundToZero(t.CostTotal)) AS WithdrawalRequestProfit,
        //            COUNT(*) AS WithdrawalRequestCount
        //        FROM CompanyTransactions t
        //        LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t.ID
        //        WHERE t.IDActionType = '30' AND cwr.CurrencyCode = 'TRY'
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    ),

        //    PaymentNotificationCTE AS(
        //        SELECT
        //            [dbo].RoundToZero(SUM(t.Total)) AS PaymentNotificationTotalAmount,
        //            [dbo].RoundToZero(SUM(t.Commission)) AS PaymentNotificationProfit,
        //            COUNT(*) AS PaymentNotificationCount
        //        FROM CompanyTransactions t
        //        LEFT JOIN PaymentNotifications pn ON pn.ID = t.ID
        //        WHERE t.IDActionType IN(10, 20, 150)
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    ),

        //    RebateRequestCTE AS(
        //        SELECT
        //            SUM(
        //         ROUND(
        //        CASE
        //                        WHEN ct.Commission = ct.CompanyCommission THEN 0
        //                        ELSE
        //                            CASE
        //                                WHEN r.IsPartialRebate = 1 THEN (r.PartialRebatePaymentInstitutionTotalAmount - r.PartialRebatePaymentInstitutionCommission) - r.Amount
        //                                ELSE[dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal
        //                            END
        //                    END, 4
        //                )
        //            ) AS RebateNetAmount
        //        FROM CompanyRebateRequests r
        //        LEFT JOIN PaymentNotifications pn ON pn.TransactionID = r.TransactionID
        //        LEFT JOIN CreditCardPaymentNotifications cn ON cn.TransactionID = r.TransactionID
        //        LEFT JOIN CompanyTransactions ct ON ct.ID = COALESCE(pn.ID, cn.ID)
        //        LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID
        //        WHERE ct2.IDActionType IN (90)
        //          AND r.Status = 2
        //          AND ct2.TransactionDate >= @ReportStartDateTime
        //          AND ct2.TransactionDate <= @ReportEndDateTime
        //          AND ct2.IDCompany = @IDCompany
        //    ),

        //  CreditCardFraudExpenseAmountCTE AS(
        //       select sum([dbo].RoundToZero(ccpn.PaymentInstitutionNetAmount - ISNULL(ccpn.Commission,0))) as CreditCardFraudExpenseAmount
        //        FROM CreditCardPaymentNotifications ccpn

        //           INNER JOIN CompanyIntegrations ci on ci.ServiceID = ccpn.ServiceID
        //        WHERE
        //          ccpn.Status = 7
        //          AND ccpn.MDate >= @ReportStartDateTime
        //          AND ccpn.MDate <= @ReportEndDateTime
        //          AND ci.ID = @IDCompany
        //    ),

        //BankCardCTE AS(
        //        SELECT
        //            COUNT(*) AS BankCardCount,
        //            [dbo].RoundToZero(SUM(t.Total)) AS BankCardSumTotal,
        //            SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS BankCardProfit,
        //            AVG(ccpn.PaymentInstitutionCommissionRate) AS BankCardRate
        //        FROM CompanyTransactions t
        //        LEFT JOIN CreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //        WHERE t.IDActionType IN(100, 110)
        //          AND ccpn.CardTypeId = 1
        //          AND t.TransactionDate >= @ReportStartDateTime
        //          AND t.TransactionDate <= @ReportEndDateTime
        //          AND t.IDCompany = @IDCompany
        //    )

        //    SELECT
        //        COALESCE(CC.CreditCardSumTotal, 0) AS CreditCardSumTotal,
        //        COALESCE(CC.CreditCardProfit, 0) AS CreditCardProfit,
        //        COALESCE(CC.CreditCardCount, 0) AS CreditCardCount,
        //--        COALESCE(FC.ForeignCreditCardSumTotal, 0) AS ForeignCreditCardSumTotal,
        //--        COALESCE(FC.ForeignCreditCardProfit, 0) AS ForeignCreditCardProfit,
        //--        COALESCE(FC.ForeignCreditCardCount, 0) AS ForeignCreditCardCount,
        //--        FCL.CurrencyCode,
        //--		COALESCE(FCL.ForeignCurrencyCreditCardSumTotal, 0) AS ForeignCurrencyCreditCardSumTotal,
        //--        COALESCE(FCL.ForeignCurrencyCreditCardProfit, 0) AS ForeignCurrencyCreditCardProfit,
        //--        COALESCE(FCL.ForeignCurrencyCreditCardCount, 0) AS ForeignCurrencyCreditCardCount,
        //        --        COALESCE(FC.ForeignCreditCardSumTotal, 0) AS ForeignCreditCardSumTotal,
        //--        COALESCE(FC.ForeignCreditCardProfit, 0) AS ForeignCreditCardProfit,
        //--        COALESCE(FC.ForeignCreditCardCount, 0) AS ForeignCreditCardCount,
        //        COALESCE(WR.WithdrawalRequestTotalAmount, 0) AS WithdrawalRequestTotalAmount,
        //        COALESCE(WR.WithdrawalRequestProfit, 0) AS WithdrawalRequestProfit,
        //        COALESCE(WR.WithdrawalRequestCount, 0) AS WithdrawalRequestCount,
        //        COALESCE(PN.PaymentNotificationTotalAmount, 0) AS PaymentNotificationTotalAmount,
        //        COALESCE(PN.PaymentNotificationProfit, 0) AS PaymentNotificationProfit,
        //        COALESCE(PN.PaymentNotificationCount, 0) AS PaymentNotificationCount,
        //        COALESCE(RR.RebateNetAmount, 0) AS RebateNetAmount,
        //        COALESCE(BK.BankCardCount, 0) AS BankCardCount,
        //        COALESCE(BK.BankCardSumTotal, 0) AS BankCardSumTotal,
        //        COALESCE(BK.BankCardProfit, 0) AS BankCardProfit,
        //        COALESCE(CCFEA.CreditCardFraudExpenseAmount, 0) as CreditCardFraudExpenseAmount,
        //        CASE
        //            WHEN(COALESCE(CC.CreditCardCount, 0) + COALESCE(BK.BankCardCount, 0)) = 0 THEN 0
        //            ELSE((COALESCE(CC.CreditCardSumTotal, 0) * COALESCE(CC.CreditCardRate, 0) + COALESCE(BK.BankCardSumTotal, 0) * COALESCE(BK.BankCardRate, 0)) / 
        //                  (COALESCE(CC.CreditCardSumTotal, 0) + COALESCE(BK.BankCardSumTotal, 0)))
        //        END AS AverageCommissionRate,
        //  (
        //            SELECT
        //                ccpn.CurrencyCode AS Currency,
        //          [dbo].RoundToZero(SUM(t.Total)) AS SumTotal,
        //                SUM([dbo].RoundToZero(t.Commission - t.CompanyCommission)) AS Profit,
        //                COUNT(*) AS Count,
        //          (
        //              SELECT
        //                        [dbo].RoundToZero(SUM(t2.Total)) AS WithdrawalRequestTotalAmount,
        //                        SUM([dbo].RoundToZero(t2.CostTotal)) AS WithdrawalRequestProfit,
        //                        COUNT(*) AS WithdrawalRequestCount

        //                    FROM CompanyTransactions t2

        //                    LEFT JOIN CompanyWithdrawalRequests cwr ON cwr.ID = t2.ID

        //                    WHERE t2.IDActionType = '30'

        //                      AND cwr.CurrencyCode = ccpn.CurrencyCode

        //                      AND t2.TransactionDate BETWEEN @ReportStartDateTime AND @ReportEndDateTime

        //                      AND t2.IDCompany = @IDCompany

        //                    FOR JSON PATH, WITHOUT_ARRAY_WRAPPER
        //          ) AS WithdrawalRequestSummary,
        //          (
        //              SELECT

        //                        SUM(fn.PaymentInstitutionNetAmount - ROUND((fn.Amount - (fn.Amount * cc.ForeignCreditCardRate / 100)), 4)) AS FraudExpenseAmount

        //                    FROM ForeignCreditCardPaymentNotifications fn

        //                    INNER JOIN CompanyIntegrations ci ON ci.ServiceID = fn.ServiceID

        //                    INNER JOIN CompanyCommissions cc ON cc.ID = ci.ID

        //                    WHERE fn.Status = 7

        //                      AND fn.CurrencyCode = ccpn.CurrencyCode

        //                      AND fn.MDate BETWEEN @ReportStartDateTime AND @ReportEndDateTime

        //                      AND ci.ID = @IDCompany

        //                    FOR JSON PATH, WITHOUT_ARRAY_WRAPPER
        //          ) AS FraudExpenseSummary,
        //          (
        //              SELECT

        //                     ISNULL(
        //                        SUM(
        //                            ROUND(
        //                            CASE

        //                                WHEN ct.Commission = ct.CompanyCommission THEN 0

        //                                ELSE

        //                                    CASE

        //                                        WHEN r.IsPartialRebate = 1 THEN(r.PartialRebatePaymentInstitutionTotalAmount - r.PartialRebatePaymentInstitutionCommission) - r.Amount

        //                                        ELSE[dbo].RoundToZero(ct.Total - ct.CompanyCommission) - ct.NetTotal

        //                                    END

        //                            END, 4
        //                        )), 0
        //                    ) AS ForeignRebateNetAmount

        //                    FROM CompanyRebateRequests r

        //                    INNER JOIN ForeignCreditCardPaymentNotifications fn ON fn.TransactionID = r.TransactionID

        //                    LEFT JOIN CompanyTransactions ct ON ct.ID = fn.ID

        //                    LEFT JOIN CompanyTransactions ct2 ON ct2.ID = r.ID

        //                    WHERE ct2.IDActionType IN(90)

        //                      AND fn.CurrencyCode = ccpn.CurrencyCode

        //                      AND r.Status = 2

        //                      AND ct2.TransactionDate BETWEEN @ReportStartDateTime AND @ReportEndDateTime

        //                      AND ct2.IDCompany = @IDCompany

        //                    FOR JSON PATH, WITHOUT_ARRAY_WRAPPER
        //          ) AS RebateRequestSummary

        //            FROM CompanyTransactions t
        //            INNER JOIN ForeignCreditCardPaymentNotifications ccpn ON ccpn.ID = t.ID
        //            INNER JOIN PaymentInstitutions pins ON pins.ID = ccpn.CreditCardPaymentMethodID
        //            WHERE t.IDActionType = 140
        //        AND pins.UseForForeignCard = 1
        //        AND t.TransactionDate BETWEEN @ReportStartDateTime AND @ReportEndDateTime
        //              AND t.IDCompany = @IDCompany

        //            GROUP BY ccpn.CurrencyCode
        //            FOR JSON PATH
        //        ) as ForeignCreditCardSummary
        //    FROM CreditCardCTE CC
        //--    FULL OUTER JOIN ForeignCreditCardCurrencyListCTE FCL ON 1 = 1
        //--    FULL OUTER JOIN ForeignCreditCardCTE FC ON 1 = 1
        //    FULL OUTER JOIN WithdrawalRequestCTE WR ON 1 = 1
        //    FULL OUTER JOIN PaymentNotificationCTE PN ON 1 = 1
        //    FULL OUTER JOIN RebateRequestCTE RR ON 1 = 1
        //    FULL OUTER JOIN BankCardCTE BK ON 1 = 1
        //    FULL OUTER JOIN CreditCardFraudExpenseAmountCTE CCFEA ON 1 = 1;
        //        END


        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_GetDealerFraudPool]
        //@StartDate DATE = NULL,
        //@EndDate DATE = NULL,
        //@IDCompany NVARCHAR(50),
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords INT

        //    CREATE TABLE #TempTable (
        //        ID NVARCHAR(50),
        //        CDate DATETIME,
        //        MDate DATETIME,
        //        PaymentMethodType TINYINT,
        //        TransactionID NVARCHAR(50),
        //        TransactionNr NVARCHAR(50),
        //        Description NVARCHAR(500),
        //        Amount DECIMAL(18, 4),
        //        PaymentInstitutionName NVARCHAR(50),
        //        SenderName NVARCHAR(500),
        //        MemberName NVARCHAR(500),
        //        IDCompany NVARCHAR(50),
        //        CompanyPhone NVARCHAR(50),
        //        MemberPhone NVARCHAR(50),
        //        Company NVARCHAR(500),
        //        CardNumber NVARCHAR(50),
        //        MUser NVARCHAR(50),
        //        MUserName NVARCHAR(50),
        //        PaymentInstitutionNetAmount DECIMAL(18, 4), 
        //        DealerCommission DECIMAL(18, 4)
        //    )

        //    INSERT INTO #TempTable (ID, CDate, MDate, PaymentMethodType, TransactionID, TransactionNr, Description, Amount, 
        //    PaymentInstitutionName, SenderName,MemberName,IDCompany, CompanyPhone, MemberPhone,Company,CardNumber, Muser , MUserName, PaymentInstitutionNetAmount, DealerCommission)

        //    SELECT ccpn.ID, ccpn.CDate, ccpn.MDate, 2, ccpn.TransactionID, ccpn.TransactionNr, ccpn.Description, ccpn.Amount,
        //       pins.Name, ccpn.SenderName, m.Name, c.ID, c.Phone, m.Phone, c.Title, ccpn.CardNumber, ccpn.MUser, a.Name, ISNULL(ccpn.PaymentInstitutionNetAmount,0), ISNULL(ccpn.Commission,0)
        //    FROM CreditCardPaymentNotifications  ccpn
        //    INNER JOIN PaymentInstitutions pins ON pins.ID=CreditCardPaymentMethodID
        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID=ccpn.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID
        //    INNER JOIN Members m ON m.ID= IDMember
        //    LEFT JOIN Administrators a ON a.ID= ccpn.MUser
        //    WHERE Status in (6) 
        //    AND(@IDCompany IS NULL OR c.ID = @IDCompany)
        //    AND(@StartDate IS NULL OR CAST(ccpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(ccpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //    INSERT INTO #TempTable (ID, CDate, MDate, PaymentMethodType, TransactionID, TransactionNr, Description, Amount, 
        //    PaymentInstitutionName, SenderName,MemberName,IDCompany, CompanyPhone, MemberPhone,Company,CardNumber, Muser , MUserName, PaymentInstitutionNetAmount, DealerCommission)

        //    SELECT ccpn.ID, ccpn.CDate, ccpn.MDate, 3, ccpn.TransactionID, ccpn.TransactionNr, ccpn.Description, ccpn.Amount,
        //       pins.Name, ccpn.SenderName, m.Name, c.ID, c.Phone, m.Phone, c.Title, ccpn.CardNumber, ccpn.MUser, a.Name, ISNULL(ccpn.PaymentInstitutionNetAmount,0), ISNULL(ccpn.Commission,0)
        //    FROM ForeignCreditCardPaymentNotifications ccpn
        //    INNER JOIN PaymentInstitutions pins ON pins.ID=CreditCardPaymentMethodID
        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID=ccpn.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID
        //    INNER JOIN Members m ON m.ID= IDMember
        //    LEFT JOIN Administrators a ON a.ID= ccpn.MUser
        //    WHERE Status in (6) 
        //    AND(@IDCompany IS NULL OR c.ID = @IDCompany)
        //    AND(@StartDate IS NULL OR CAST(ccpn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(ccpn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        //    INSERT INTO #TempTable (ID, CDate, MDate, PaymentMethodType, TransactionID, TransactionNr, Description, 
        //    Amount, PaymentInstitutionName, SenderName,MemberName,IDCompany, CompanyPhone, MemberPhone, Company,CardNumber, Muser , MUserName, PaymentInstitutionNetAmount, DealerCommission)
        //    SELECT pn.ID, pn.CDate, pn.MDate, 1, pn.TransactionID, pn.TransactionNr, pn.Description,
        //    pn.Amount, cba.Name, pn.SenderName, m.Name, c.ID, c.Phone, m.Phone, c.Title, null, pn.MUser, a.Name, pn.Amount, ISNULL(pn.Commission,0)


        //    FROM PaymentNotifications pn
        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID=pn.ServiceID
        //    INNER JOIN Companies c ON c.ID= ci.ID
        //    INNER JOIN CompanyBankAccounts cba ON CompanyBankAccountID = cba.ID
        //    INNER JOIN Members m ON m.ID= pn.IDMember
        //       INNER JOIN CompanyCommissions cc ON cc.ID=ci.ID
        //    LEFT JOIN Administrators a ON a.ID= pn.MUser

        //    WHERE Status in (6) 
        //    AND(@IDCompany IS NULL OR c.ID = @IDCompany)
        //    AND(@StartDate IS NULL OR CAST(pn.MDate AS DATE) >= CAST(@StartDate AS DATE))
        //    AND(@EndDate IS NULL OR CAST(pn.MDate AS DATE) <= CAST(@EndDate AS DATE))

        // SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // ORDER BY MDate DESC
        //    OFFSET @OffsetValue ROWS


        //    DROP TABLE #TempTable

        //END

        //GO

        //   CREATE TABLE DEV_TEST2.dbo.CustomerInfos(
        //   ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   CDate datetime NOT NULL,
        //CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   TransactionID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   CustomerName nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   CustomerEmail nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   CustomerPhone nvarchar(15) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   MDate datetime NULL,
        //   MUser nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //ServiceID nvarchar(10) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //   CONSTRAINT PK_CustomerInfos PRIMARY KEY(ID)
        //   );

        //GO

        //CREATE Proc[dbo].[CustomerInfos_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@TransactionID nvarchar(50),
        //@CustomerPhone nvarchar(15),
        //@CustomerEmail nvarchar(500),
        //@CustomerName nvarchar(500),
        //@ServiceID nvarchar(10)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        SET @IDOut = NEWID()


        //        INSERT INTO CustomerInfos(ID, CDate, CUser, TransactionID, CustomerName, CustomerEmail, CustomerPhone, ServiceID)

        //        VALUES(@IDOut, @CDate, @CUser, @TransactionID , @CustomerName, @CustomerEmail, @CustomerPhone, @ServiceID );

        //        SELECT @IDOut

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //CREATE Proc[dbo].[CustomerInfos_GetSingle]
        //@ID nvarchar(50) = null,
        //@ServiceID nvarchar(10) = null,
        //@TransactionID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT* FROM CustomerInfos WHERE(@ID IS NULL OR ID= @ID) and(@ServiceID IS NULL OR ServiceID= @ServiceID) and TransactionID = @TransactionID

        //END


        //GO

        //ALTER Proc[dbo].[PaymentNotifications_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member,
        //    m.Phone, b.Name AS Bank, mt.Name AS MemberType , m2.Name as Modifier , cif.CustomerName as CustomerName , cif.CustomerEmail as CustomerEmail, cif.CustomerPhone as CustomerPhone FROM PaymentNotifications r

        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID

        //    INNER JOIN Companies c ON c.ID= ci.ID

        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType

        //    INNER JOIN Banks b ON b.ID= r.IDBank

        //    LEFT JOIN CustomerInfos cif on cif.TransactionID = r.TransactionID

        //    LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //    WHERE r.ID= @ID

        //END

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //    SELECT r.*, c.Title as Company,
        //    c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, m2.Name as Modifier, mt.Name AS MemberType,
        //    pins.Name as PaymentInstitutionName, cif.CustomerName as CustomerName , cif.CustomerEmail as CustomerEmail, cif.CustomerPhone as CustomerPhone
        //    FROM CreditCardPaymentNotifications r

        //    INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID

        //    INNER JOIN Companies c ON c.ID= ci.ID

        //    INNER JOIN Members m ON m.ID= r.IDMember

        //    INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType

        //    LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //    LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID

        //    LEFT JOIN CustomerInfos cif on cif.TransactionID = r.TransactionID

        //    WHERE r.ID= @ID

        //END


        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN


        //SELECT r.*, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, m.Phone, m2.Name as Modifier, mt.Name AS MemberType,
        //pins.Name as PaymentInstitutionName, cif.CustomerName as CustomerName , cif.CustomerEmail as CustomerEmail, cif.CustomerPhone as CustomerPhone FROM ForeignCreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID= r.ServiceID
        //INNER JOIN Companies c ON c.ID= ci.ID
        //INNER JOIN Members m ON m.ID= r.IDMember
        //INNER JOIN MemberTypes mt ON mt.ID= m.IDMemberType
        //LEFT JOIN Administrators m2 ON m2.ID = r.MUser
        //LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID
        //LEFT JOIN CustomerInfos cif on cif.TransactionID = r.TransactionID
        //WHERE r.ID= @ID

        //END;

        //GUNCELLENDİ 

        //------------------------------------------------------- 18.10.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE TABLE dbo.MailLogs(
        //    ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CDate datetime NOT NULL,
        // IDCompany nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // Email nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // Title nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // Body nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // IsSuccess bit NULL,
        // CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CONSTRAINT PK_MailLogs PRIMARY KEY(ID)
        //);

        //CREATE Proc[dbo].[MailLogs_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@Body nvarchar(MAX),
        //@Email nvarchar(20),
        //@Title nvarchar(MAX),
        //@IsSuccess bit
        //AS
        //BEGIN
        //    BEGIN TRY

        //        SET @IDOut = NEWID()

        //        INSERT INTO MailLogs
        //        (ID, CDate, CUser, IDCompany, Body, Email, Title, IsSuccess)

        //        VALUES(@IDOut, @CDate, @CUser, @IDCompany, @Body, @Email, @Title, @IsSuccess);
        //        SELECT @IDOut

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //CREATE Proc[dbo].[MailLogs_GetList]
        //@IDCompany nvarchar(50),
        //@IsSuccess bit,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //    DECLARE @totalRecords int

        //    SELECT m.*, c.Title as Company, ba.Name AS Creator into #TempTable FROM MailLogs m 
        // LEFT JOIN Companies c ON c.ID= m.IDCompany
        //    LEFT JOIN Administrators ba ON ba.ID= m.CUser

        //       WHERE (@IDCompany is null or m.IDCompany= @IDCompany)

        //       AND(@IsSuccess is null or m.IsSuccess= @IsSuccess)

        //       AND(@SearchValue IS NULL OR (m.Title LIKE '%' + @SearchValue + '%' OR m.Body LIKE '%' + @SearchValue + '%' ))

        //    SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS


        //    FETCH NEXT @PageLength ROWS ONLY
        //    DROP TABLE #TempTable
        //END

        //GO

        //ALTER Proc[dbo].[CallbackResponseLogs_GetList]
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@ServiceType nvarchar(100),
        //@TransactionID nvarchar(50),
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN


        //    DECLARE @totalRecords int

        //    SELECT cl.*, c.Title as Company into #TempTable
        // FROM CallbackResponseLogs cl
        //    INNER JOIN Companies c on c.ID = cl.IDCompany

        //    WHERE(@IDCompany IS NULL OR cl.IDCompany = @IDCompany)
        //          AND(@StartDate IS NULL OR CAST(cl.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //          AND(@EndDate IS NULL OR CAST(cl.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //          AND(@ServiceType IS NULL OR cl.ServiceType = @ServiceType)
        //          AND(@TransactionID IS NULL OR cl.TransactionID = @TransactionID)

        //          AND(@SearchValue IS NULL OR (c.Title LIKE '%' + @SearchValue + '%' OR cl.ServiceType LIKE '%' + @SearchValue + '%' OR cl.TransactionID LIKE '%' + @SearchValue + '%' OR cl.TransactionType LIKE '%' + @SearchValue + '%' ))

        //    SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS


        //    FETCH NEXT @PageLength ROWS ONLY
        //    DROP TABLE #TempTable
        //END

        //GO

        //GUNCELLENDİ

        //------------------------------------------------------- 22.10.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //DROP TABLE dbo.CompanyInvoices;

        //GO


        //CREATE TABLE DEV_TEST2.dbo.CompanyInvoices(
        //    ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CDate datetime NOT NULL,
        // CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    MDate datetime NULL,
        //    MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // IDCompany nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    SendStatus bit NOT NULL,
        // TaxAmount decimal (18,2) NULL,
        // NetAmount decimal (18,2) NOT NULL,
        //    TotalAmount decimal (18,2) NOT NULL,
        //    ParasutPrintUrl nvarchar(1000) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // InvoiceStartDateTime datetime NOT NULL,
        //    InvoiceEndDateTime datetime NOT NULL,
        // CurrencyCode nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    InvoiceNumber bigint IDENTITY(1,1) NOT NULL,
        //    IntegratorInvoiceNumber nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // TaxRate int NOT NULL,
        // CONSTRAINT PK_CompanyInvoices PRIMARY KEY(ID)
        //);

        //GO

        //CREATE PROCEDURE[dbo].[CompanyInvoices_CheckInvoiceDateOverlap]
        //@Result BIT OUTPUT,
        //@IDCompany NVARCHAR(50),
        //@StartDate DATETIME,
        //@EndDate DATETIME
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //        IF EXISTS(
        //            SELECT 1

        //            FROM CompanyInvoices

        //            WHERE IDCompany = @IDCompany

        //              AND (@StartDate <= InvoiceEndDateTime AND @EndDate >= InvoiceStartDateTime)
        //    )
        //    BEGIN
        //        SET @Result = 1;
        //    END
        //    ELSE
        //    BEGIN
        //        SET @Result = 0;
        //    END
        //END

        //GO

        //ALTER Proc[dbo].[CompanyInvoices_GetList]
        //@IDCompany nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //    DECLARE @totalRecords int

        //    SELECT c.*, ca.Title AS Company, ba.Name AS Creator, ba2.Name AS Modifier into #TempTable FROM CompanyInvoices c
        //  INNER JOIN Companies ca ON ca.ID = c.IDCompany
        //        INNER JOIN Administrators ba ON ba.ID= c.CUser

        //        LEFT JOIN Administrators ba2 ON ba2.ID = c.MUser

        //    WHERE 1=1

        //        AND (@IDCompany IS NULL OR c.IDCompany= @IDCompany)

        //        AND(@StartDate IS NULL OR CAST(c.CDate AS DATE)>=CAST(@StartDate AS DATE))
        //  AND(@EndDate IS NULL OR CAST(c.CDate AS DATE)<=CAST(@EndDate AS DATE))

        // SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // ORDER BY InvoiceNumber DESC
        //    OFFSET @OffsetValue ROWS


        //    FETCH NEXT @PageLength ROWS ONLY
        //    DROP TABLE #TempTable
        //END

        //GO

        //ALTER Proc[dbo].[CompanyInvoices_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN

        //    SELECT* FROM CompanyInvoices c

        //    WHERE c.ID=@ID
        //END

        //GO

        //ALTER Proc[dbo].[CompanyInvoices_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@SendStatus bit,
        //@TaxAmount decimal (18,2),
        //@NetAmount decimal (18,2),
        //@TotalAmount decimal (18,2),
        //@ParasutPrintUrl nvarchar(1000),
        //@InvoiceStartDateTime datetime,
        //@InvoiceEndDateTime datetime,
        //@CurrencyCode nvarchar(50),
        //@TaxRate int,
        //@IntegratorInvoiceNumber nvarchar(50) = null
        //AS
        //BEGIN

        //    BEGIN TRY


        //        SET @IDOut = NEWID()

        //        INSERT INTO CompanyInvoices(ID, CUser, CDate, IDCompany, SendStatus, TaxAmount, NetAmount, TotalAmount, ParasutPrintUrl,
        //        InvoiceStartDateTime, InvoiceEndDateTime, CurrencyCode, TaxRate)

        //        VALUES(@IDOut, @CUser, @CDate, @IDCompany, @SendStatus, @TaxAmount, @NetAmount, @TotalAmount, @ParasutPrintUrl,
        //        @InvoiceStartDateTime, @InvoiceEndDateTime , @CurrencyCode, @TaxRate)

        //        SELECT @IDOut
        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO


        //ALTER Proc[dbo].[CompanyInvoices_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@SendStatus bit,
        //@InvoiceNumber nvarchar(50) = null,
        //@TaxAmount decimal,
        //@NetAmount decimal,
        //@TotalAmount decimal,
        //@ParasutPrintUrl nvarchar(1000),
        //@IntegratorInvoiceNumber nvarchar(50),
        //@TaxRate int = null,
        //@CurrencyCode nvarchar(10)= null,
        //@InvoiceEndDateTime datetime = null,
        //@InvoiceStartDateTime datetime = null
        //AS
        //BEGIN

        //    BEGIN TRY

        //        SET @IDOut = NEWID()

        //        UPDATE CompanyInvoices SET MUser = @MUser, MDate = @MDate, IDCompany = @IDCompany, SendStatus = @SendStatus,
        //        TaxAmount = @TaxAmount, NetAmount = @NetAmount, TotalAmount = @TotalAmount, ParasutPrintUrl = @ParasutPrintUrl, IntegratorInvoiceNumber = @IntegratorInvoiceNumber

        //        WHERE ID = @ID


        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END
        //GO

        //INSERT INTO dbo.Settings
        //(ParamType, ParamDef, ParamVal, ActivatedForGeneralUse)
        //VALUES(N'CompanyInvoiceTaxRate', N'tax_rate', N'20', NULL);

        //GUNCELLENDİ

        //------------------------------------------------------- 22.10.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        // ALTER TABLE dbo.CompanyInvoices ADD
        // Status tinyint NULL

        //GO

        //ALTER Proc[dbo].[CompanyInvoices_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@SendStatus bit,
        //@InvoiceNumber nvarchar(50) = null,
        //@TaxAmount decimal,
        //@NetAmount decimal,
        //@TotalAmount decimal,
        //@ParasutPrintUrl nvarchar(1000),
        //@IntegratorInvoiceNumber nvarchar(50) = null,
        //@TaxRate int = null,
        //@CurrencyCode nvarchar(10)= null,
        //@InvoiceEndDateTime datetime = null,
        //@InvoiceStartDateTime datetime = null,
        //@Status tinyint = null
        //AS
        //BEGIN

        //    BEGIN TRY

        //        SET @IDOut = NEWID()

        //        UPDATE CompanyInvoices SET MUser = @MUser, MDate = @MDate, IDCompany = @IDCompany, SendStatus = @SendStatus, Status = @Status,
        //        TaxAmount = @TaxAmount, NetAmount = @NetAmount, TotalAmount = @TotalAmount, ParasutPrintUrl = @ParasutPrintUrl, IntegratorInvoiceNumber = @IntegratorInvoiceNumber

        //        WHERE ID = @ID


        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyInvoices_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@SendStatus bit,
        //@TaxAmount decimal (18,2),
        //@NetAmount decimal (18,2),
        //@TotalAmount decimal (18,2),
        //@ParasutPrintUrl nvarchar(1000),
        //@InvoiceStartDateTime datetime,
        //@InvoiceEndDateTime datetime,
        //@CurrencyCode nvarchar(50),
        //@TaxRate int,
        //@IntegratorInvoiceNumber nvarchar(50) = null,
        //@Status tinyint = null
        //AS
        //BEGIN

        //    BEGIN TRY


        //        SET @IDOut = NEWID()

        //        INSERT INTO CompanyInvoices(ID, CUser, CDate, IDCompany, SendStatus, TaxAmount, NetAmount, TotalAmount, ParasutPrintUrl,
        //        InvoiceStartDateTime, InvoiceEndDateTime, CurrencyCode, TaxRate, Status)

        //        VALUES(@IDOut, @CUser, @CDate, @IDCompany, @SendStatus, @TaxAmount, @NetAmount, @TotalAmount, @ParasutPrintUrl,
        //        @InvoiceStartDateTime, @InvoiceEndDateTime , @CurrencyCode, @TaxRate, @Status)

        //        SELECT @IDOut
        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyInvoices_CheckInvoiceDateOverlap]
        //@Result BIT OUTPUT,
        //@IDCompany NVARCHAR(50),
        //@StartDate DATETIME,
        //@EndDate DATETIME
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //        IF EXISTS(
        //            SELECT 1

        //            FROM CompanyInvoices

        //            WHERE IDCompany = @IDCompany AND Status <> 1

        //              AND (@StartDate <= InvoiceEndDateTime AND @EndDate >= InvoiceStartDateTime)
        //    )
        //    BEGIN
        //        SET @Result = 1;
        //    END
        //    ELSE
        //    BEGIN
        //        SET @Result = 0;
        //    END
        //END

        //------------------------------------------------------- 25.10.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.Companies ADD
        //City nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //District nvarchar(100) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //IsAbroad bit DEFAULT 0 NOT NULL

        //GO

        //ALTER Proc[dbo].[Companies_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Title nvarchar(100),
        //@Name nvarchar(50),
        //@Phone nvarchar(11),
        //@Email nvarchar(50),
        //@TaxNr nvarchar(11),
        //@TaxOffice nvarchar(50),
        //@Address nvarchar(100),
        //@MonthlyGiro nvarchar(25),
        //@IDParasut nvarchar(50),
        //@AutoWithdrawalLimit decimal = null,
        //@NegativeBalanceLimit decimal = null,
        //@AutoTransferLimit decimal = null,
        //@AutoCreditCardLimit decimal = null,
        //@AutoForeignCreditCardLimit decimal = null,
        //@IsAbroad bit = null,
        //@District nvarchar(100) = null,
        //@City nvarchar(100) = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @IDCU nvarchar(50)

        //        SET @IDCU = (SELECT top 1 CompanyUsers.ID FROM Companies join CompanyUsers on IDCompany=Companies.ID AND Companies.Phone=CompanyUsers.Phone WHERE IDCompany=@ID AND IsMainUser=1)

        //  UPDATE Companies SET MUser = @MUser, MDate = @MDate, Name = @Name, Title = @Title, Phone = @Phone, Email = @Email, TaxNr = @TaxNr,
        //        TaxOffice = @TaxOffice, Address = @Address, MonthlyGiro = @MonthlyGiro, IDParasut = @IDParasut, IsAbroad = @IsAbroad, District = @District, City = @City

        //        WHERE ID = @ID


        //        UPDATE CompanyUsers SET Phone = @Phone WHERE IDCompany = @ID AND IsMainUser = 1 AND ID = @IDCU

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[Companies_GetList]
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords int
        //    SELECT ID, CUser, CDate, MUser, MDate, Title, Name, TaxNr, TaxOffice, Phone, Email, MonthlyGiro, Address, StatusFlag, City,District,IsAbroad
        //    into #TempTable FROM Companies c
        // where isnull(DataStatus,0) = 0  AND(@SearchValue IS NULL OR  (Name LIKE '%' + @SearchValue + '%' OR Phone LIKE '%' + @SearchValue + '%'  OR Title LIKE '%' + @SearchValue + '%'   ))

        // SELECT @totalRecords = COUNT(*) FROM #TempTable
        //  SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //  ORDER BY CDate DESC
        //        OFFSET @OffsetValue ROWS

        //         FETCH NEXT @PageLenght ROWS ONLY
        //    DROP TABLE #TempTable

        //END

        //go

        //ALTER TABLE CompanyCommissions ADD
        //SPWithdrawalTransferCostAmount decimal (5,2) DEFAULT 0 NOT NULL,
        //SPWithdrawalEftCostAmount decimal (5,2) DEFAULT 0 NOT NULL,
        //SPWithdrawalForeignCurrencySwiftCostAmount decimal (5,2) DEFAULT 145 NOT NULL

        //go

        //ALTER Proc[dbo].[CompanyCommissions_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@CreditCardRate decimal (5,2),
        //@CreditCardStatus bit,
        //@CreditCardBlocked tinyint,
        //@TransferRate decimal (5,2),
        //@TransferStatus bit,
        //@TransferBlocked tinyint,
        //@MobilePayRate decimal (5,2),
        //@MobilePayStatus bit,
        //@MobilePayBlocked tinyint,
        //@WithdrawalTransferAmount decimal (5,2),
        //@WithdrawalEftAmount decimal (5,2),
        //@ForeignCreditCardRate decimal (5,2),
        //@ForeignCreditCardBlocked tinyint,
        //@ToslaRate decimal (5,2),
        //@ToslaBlocked tinyint,
        //@WithdrawalForeignCurrencySwiftAmount decimal (5,2),
        //@SPWithdrawalTransferCostAmount decimal (5,2),
        //@SPWithdrawalEftCostAmount decimal (5,2),
        //@SPWithdrawalForeignCurrencySwiftCostAmount decimal (5,2)
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE CompanyCommissions SET MUser = @MUser, MDate = @MDate, CreditCardRate = @CreditCardRate, TransferRate = @TransferRate, MobilePayRate = @MobilePayRate,
        //CreditCardStatus = @CreditCardStatus, TransferStatus = @TransferStatus, MobilePayStatus = @MobilePayStatus, CreditCardBlocked = @CreditCardBlocked, TransferBlocked = @TransferBlocked,
        //MobilePayBlocked = @MobilePayBlocked, WithdrawalTransferAmount = @WithdrawalTransferAmount, WithdrawalEftAmount = @WithdrawalEftAmount, ForeignCreditCardRate = @ForeignCreditCardRate,
        //ForeignCreditCardBlocked = @ForeignCreditCardBlocked, ToslaRate = @ToslaRate, ToslaBlocked = @ToslaBlocked,
        //WithdrawalForeignCurrencySwiftAmount = @WithdrawalForeignCurrencySwiftAmount, SPWithdrawalTransferCostAmount = @SPWithdrawalTransferCostAmount, SPWithdrawalEftCostAmount = @SPWithdrawalEftCostAmount,
        //SPWithdrawalForeignCurrencySwiftCostAmount = @SPWithdrawalForeignCurrencySwiftCostAmount

        //WHERE ID = @ID


        //--DELETE FROM CompanyBanks WHERE ID=@ID
        //--INSERT INTO CompanyBanks(ID, IDBank, CUser, CDate) SELECT @ID, ID, @MUser, @MDate FROM Banks WHERE StatusFlag = 1 AND 1=@TransferStatus

        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END

        //GO

        //    CREATE TABLE dbo.Todoist(
        //    ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CDate datetime NOT NULL,
        // CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    MDate datetime NULL,
        //    MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // Title nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // Body nvarchar(MAX) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // PriorityType tinyint NULL,
        // IsCompleted bit NULL,
        // ResponseMessage varchar(MAX) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // CONSTRAINT PK_Todoist PRIMARY KEY(ID)
        //);

        //GO

        //CREATE Proc[dbo].[Todoist_GetList]
        //@StartDate datetime,
        //@EndDate datetime,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN

        //    DECLARE @totalRecords int

        //    SELECT m.*, ba.Name AS Creator, ba.Name as Modifier into #TempTable FROM Todoist m 
        // LEFT JOIN Administrators ba ON ba.ID=m.CUser

        //       WHERE (@StartDate IS NULL OR CAST(m.CDate AS DATE)>=CAST(@StartDate AS DATE))
        // AND(@EndDate IS NULL OR CAST(m.CDate AS DATE)<=CAST(@EndDate AS DATE))
        //    AND(@SearchValue IS NULL OR (m.Title LIKE '%' + @SearchValue + '%' OR m.Body LIKE '%' + @SearchValue + '%' ))

        //    SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS


        //    FETCH NEXT @PageLength ROWS ONLY
        //    DROP TABLE #TempTable
        //END



        //GO

        //CREATE PROCEDURE[dbo].[Todoist_Insert]
        //@IDOut NVARCHAR(50) OUTPUT,
        //@CDate DATETIME,
        //@CUser NVARCHAR(50),
        //@MDate DATETIME = NULL,
        //@MUser NVARCHAR(50) = NULL,
        //@Title NVARCHAR(500),
        //@Body NVARCHAR(MAX) = NULL,
        //@PriorityType TINYINT = NULL,
        //@IsCompleted BIT = 0,
        //@ResponseMessage VARCHAR(MAX) = NULL
        //AS
        //BEGIN

        //    SET @IDOut = NEWID();

        //        INSERT INTO Todoist
        //        (ID, CDate, CUser, MDate, MUser, Title, Body, PriorityType, IsCompleted, ResponseMessage)
        //    VALUES
        //    (@IDOut, @CDate, @CUser, @MDate, @MUser, @Title, @Body, @PriorityType, @IsCompleted, @ResponseMessage)

        //    SELECT @IDOut;
        // END;



        //GO

        //CREATE Proc[dbo].[Todoist_GetSingle]
        //@ID nvarchar(50)
        //AS
        //BEGIN
        //    SELECT* FROM Todoist WHERE ID=@ID

        //END


        //GO

        //CREATE Proc[dbo].[Todoist_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Title NVARCHAR(500),
        //@Body NVARCHAR(MAX) = NULL,
        //@PriorityType TINYINT = NULL,
        //@IsCompleted BIT = 0,
        //@ResponseMessage VARCHAR(MAX) = NULL
        //AS
        //BEGIN
        //BEGIN TRY


        //UPDATE Todoist SET MUser = @MUser, MDate = @MDate, Title = @Title, Body = @Body, PriorityType = @PriorityType,
        //IsCompleted = @IsCompleted, ResponseMessage = @ResponseMessage

        //WHERE ID = @ID


        //SELECT @IDOut = @ID

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END


        //------------------------------------------------------- 5.11.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------
        //alter TABLE dbo.CompanyCurrencies ADD
        //CanCreateWithdrawalRequest bit DEFAULT 0 NOT NULL

        //GO

        //alter Proc[dbo].[CompanyCurrencies_Update]
        //@IDOut nvarchar(50) output,
        //@CurrencyCode nvarchar(10),
        //@IDCompany nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@IsActive bit,
        //@CanCreateWithdrawalRequest bit
        //AS
        //BEGIN
        //    BEGIN TRY

        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)


        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //        UPDATE CompanyCurrencies SET MUser=@MUser, MDate=@MDate, IsActive=@IsActive, CanCreateWithdrawalRequest = @CanCreateWithdrawalRequest WHERE CurrencyCode=@CurrencyCode and IDCompany = @IDCompany


        //        IF @@ROWCOUNT = 0
        //        BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Lütfen önce üye işyerine para birimi atayın'
        //   RAISERROR(@CUSTOMERRORMESSAGE,18,1)
        //            RETURN;
        //        END


        //        SELECT @IDOut = @IDCompany

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //alter Proc[dbo].[CompanyCurrencies_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@CurrencyCode nvarchar(50),
        //@IsActive bit,
        //@CanCreateWithdrawalRequest bit = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        SET @IDOut = NEWID()

        //        INSERT INTO CompanyCurrencies(ID, CDate, CUser, IDCompany, CurrencyCode, IsActive) VALUES(@IDOut, @CDate, @CUser, @IDCompany, @CurrencyCode, @IsActive)

        //        SELECT @IDOut

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[Currencies_GetList]
        //@CurrencyCode nvarchar(10) = null,
        //@IDCompany nvarchar(50) = null
        //AS
        //BEGIN

        //    SELECT*, ISNULL(cc.Balance, 0) AS Balance,(SELECT
        //             ISNULL(SUM(ct.NetTotal), 0)
        //         FROM
        //             [dbo].ForeignCreditCardPaymentNotifications r
        //         INNER JOIN
        //             [dbo].CompanyTransactions ct ON ct.ID = r.ID
        //         WHERE
        //             ct.IDCompany = @IDCompany
        //             AND r.Status = 2
        //             AND r.IsNotBocked = 0
        //             AND r.CurrencyCode = c.CurrencyCode
        //        ) AS BlockedBalance,
        //        CAST(ISNULL(cc.IsActive, 0) AS BIT) AS IsActive,
        //        CAST(ISNULL(cc.CanCreateWithdrawalRequest, 0) AS BIT) AS CanCreateWithdrawalRequest,
        //        CAST(CASE WHEN cc.CurrencyCode IS NULL THEN 0 ELSE 1 END AS BIT) AS IsAddedCurrency,
        //        cc.IDCompany

        //        FROM Currencies c


        //        LEFT JOIN

        //            CompanyCurrencies cc ON c.CurrencyCode = cc.CurrencyCode
        //            AND cc.IDCompany = @IDCompany

        //        where @CurrencyCode IS NULL OR c.CurrencyCode = @CurrencyCode


        //END

        //------------------------------------------------------- 07.11.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.CompanyInvoices ADD
        //    ExchangeRate decimal(18,2) DEFAULT 0 NULL

        //GO

        //ALTER Proc[dbo].[CompanyInvoices_Insert]
        //@IDOut nvarchar(50) output,
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@SendStatus bit,
        //@TaxAmount decimal (18,2),
        //@NetAmount decimal (18,2),
        //@TotalAmount decimal (18,2),
        //@ParasutPrintUrl nvarchar(1000),
        //@InvoiceStartDateTime datetime,
        //@InvoiceEndDateTime datetime,
        //@CurrencyCode nvarchar(50),
        //@TaxRate int,
        //@IntegratorInvoiceNumber nvarchar(50) = null,
        //@Status tinyint = null,
        //@ExchangeRate decimal (18,2)
        //AS
        //BEGIN

        //    BEGIN TRY


        //        SET @IDOut = NEWID()

        //        INSERT INTO CompanyInvoices(ID, CUser, CDate, IDCompany, SendStatus, TaxAmount, NetAmount, TotalAmount, ParasutPrintUrl,
        //        InvoiceStartDateTime, InvoiceEndDateTime, CurrencyCode, TaxRate, Status)

        //        VALUES(@IDOut, @CUser, @CDate, @IDCompany, @SendStatus, @TaxAmount, @NetAmount, @TotalAmount, @ParasutPrintUrl,
        //        @InvoiceStartDateTime, @InvoiceEndDateTime , @CurrencyCode, @TaxRate, @Status)

        //        SELECT @IDOut
        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CompanyInvoices_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime,
        //@MUser nvarchar(50),
        //@IDCompany nvarchar(50),
        //@SendStatus bit,
        //@InvoiceNumber nvarchar(50) = null,
        //@TaxAmount decimal (18,2),
        //@NetAmount decimal (18,2),
        //@TotalAmount decimal (18,2),
        //@ParasutPrintUrl nvarchar(1000),
        //@IntegratorInvoiceNumber nvarchar(50) = null,
        //@TaxRate int = null,
        //@CurrencyCode nvarchar(10)= null,
        //@InvoiceEndDateTime datetime = null,
        //@InvoiceStartDateTime datetime = null,
        //@Status tinyint = null,
        //@ExchangeRate decimal (18,2) = null
        //AS
        //BEGIN

        //    BEGIN TRY

        //        SET @IDOut = NEWID()

        //        UPDATE CompanyInvoices SET MUser = @MUser, MDate = @MDate, IDCompany = @IDCompany, SendStatus = @SendStatus, Status = @Status,
        //        TaxAmount = @TaxAmount, NetAmount = @NetAmount, TotalAmount = @TotalAmount, ParasutPrintUrl = @ParasutPrintUrl, IntegratorInvoiceNumber = @IntegratorInvoiceNumber, ExchangeRate = @ExchangeRate

        //        WHERE ID = @ID


        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //CREATE PROCEDURE[dbo].[CompanyTransactions_CustomerInfoDetailedSearch]
        //@Status TINYINT,
        //@IDCompany NVARCHAR(50),
        //@CustomerName NVARCHAR(500),
        //@CustomerEmail NVARCHAR(50),
        //@CustomerPhone NVARCHAR(50),
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //    DECLARE @totalRecords INT;

        //    SELECT
        //        r.ID,
        //        r.CDate,
        //        r.TransactionID,
        //        r.TransactionNr,
        //        r.Company,
        //        CustomerName,
        //        CustomerPhone,
        //        CustomerEmail,
        //        TransactionType,
        //        r.Amount,
        //        r.Status,
        //        r.RebateID,
        //        EntityUrl
        //    INTO #TempTable
        //    FROM
        //    (
        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            cin.CustomerName,
        //            cin.CustomerPhone,
        //            cin.CustomerEmail,
        //         'Kredi Kartı' as TransactionType,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID,
        //         '/DealerCreditCardTransaction/Edit/' + r.ID as EntityUrl
        //        FROM CreditCardPaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        INNER JOIN CustomerInfos cin ON cin.TransactionID = r.TransactionID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@CustomerName IS NULL OR cin.CustomerName COLLATE Turkish_CI_AS LIKE '%' + @CustomerName + '%')
        //            AND(@CustomerPhone IS NULL OR cin.CustomerPhone COLLATE Turkish_CI_AS LIKE '%' + @CustomerPhone + '%')
        //            AND(@CustomerEmail IS NULL OR cin.CustomerEmail COLLATE Turkish_CI_AS LIKE '%' + @CustomerEmail + '%')


        //        UNION ALL

        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            cin.CustomerName,
        //            cin.CustomerPhone,
        //            cin.CustomerEmail,
        //         'Yurt Dışı Kredi Kartı' as TransactionType,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID,
        //         '/DealerForeignCreditCardTransaction/Edit/' + r.ID as EntityUrl
        //        FROM ForeignCreditCardPaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        INNER JOIN CustomerInfos cin ON cin.TransactionID = r.TransactionID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@CustomerName IS NULL OR cin.CustomerName COLLATE Turkish_CI_AS LIKE '%' + @CustomerName + '%')
        //            AND(@CustomerPhone IS NULL OR cin.CustomerPhone COLLATE Turkish_CI_AS LIKE '%' + @CustomerPhone + '%')
        //            AND(@CustomerEmail IS NULL OR cin.CustomerEmail COLLATE Turkish_CI_AS LIKE '%' + @CustomerEmail + '%')


        //        UNION ALL

        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            cin.CustomerName,
        //            cin.CustomerPhone,
        //            cin.CustomerEmail,
        //         'Havale / EFT' as TransactionType,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID,
        //         '/DealerPaymentTransaction/Edit/' + r.ID as EntityUrl
        //        FROM PaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        INNER JOIN CustomerInfos cin ON cin.TransactionID = r.TransactionID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@CustomerName IS NULL OR cin.CustomerName COLLATE Turkish_CI_AS LIKE '%' + @CustomerName + '%')
        //            AND(@CustomerPhone IS NULL OR cin.CustomerPhone COLLATE Turkish_CI_AS LIKE '%' + @CustomerPhone + '%')
        //            AND(@CustomerEmail IS NULL OR cin.CustomerEmail COLLATE Turkish_CI_AS LIKE '%' + @CustomerEmail + '%')
        //    ) AS r;

        //        SELECT @totalRecords = COUNT(*) FROM #TempTable;

        //    SELECT*, @totalRecords AS TotalRecords
        //    FROM #TempTable
        //    ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS FETCH NEXT @PageLength ROWS ONLY;

        //        DROP TABLE #TempTable;

        //    SET NOCOUNT OFF;
        //END;

        //------------------------------------------------------- 08.11.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.Companies ADD
        //    InvoiceTitle nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL

        //GO

        //ALTER Proc[dbo].[Companies_GetList]
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX)
        //AS
        //BEGIN
        //    DECLARE @totalRecords int
        //    SELECT ID, CUser, CDate, MUser, MDate, Title, Name, TaxNr, TaxOffice, Phone, Email, MonthlyGiro, Address, StatusFlag, City,District,IsAbroad, InvoiceTitle
        //    into #TempTable FROM Companies c
        // where isnull(DataStatus,0) = 0  AND(@SearchValue IS NULL OR  (Name LIKE '%' + @SearchValue + '%' OR Phone LIKE '%' + @SearchValue + '%'  OR Title LIKE '%' + @SearchValue + '%'   ))

        // SELECT @totalRecords = COUNT(*) FROM #TempTable
        //  SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //  ORDER BY CDate DESC
        //        OFFSET @OffsetValue ROWS

        //         FETCH NEXT @PageLenght ROWS ONLY
        //    DROP TABLE #TempTable

        //END

        //GO

        //ALTER Proc[dbo].[Companies_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Title nvarchar(100),
        //@Name nvarchar(50),
        //@Phone nvarchar(11),
        //@Email nvarchar(50),
        //@TaxNr nvarchar(11),
        //@TaxOffice nvarchar(50),
        //@Address nvarchar(100),
        //@MonthlyGiro nvarchar(25),
        //@IDParasut nvarchar(50),
        //@AutoWithdrawalLimit decimal = null,
        //@NegativeBalanceLimit decimal = null,
        //@AutoTransferLimit decimal = null,
        //@AutoCreditCardLimit decimal = null,
        //@AutoForeignCreditCardLimit decimal = null,
        //@IsAbroad bit = null,
        //@District nvarchar(100) = null,
        //@City nvarchar(100) = null,
        //@InvoiceTitle nvarchar(500) = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @IDCU nvarchar(50)

        //        SET @IDCU = (SELECT top 1 CompanyUsers.ID FROM Companies join CompanyUsers on IDCompany=Companies.ID AND Companies.Phone=CompanyUsers.Phone WHERE IDCompany=@ID AND IsMainUser=1)

        //  UPDATE Companies SET MUser = @MUser, MDate = @MDate, Name = @Name, Title = @Title, Phone = @Phone, Email = @Email, TaxNr = @TaxNr,
        //        TaxOffice = @TaxOffice, Address = @Address, MonthlyGiro = @MonthlyGiro, IDParasut = @IDParasut, IsAbroad = @IsAbroad, District = @District, City = @City, InvoiceTitle = @InvoiceTitle

        //        WHERE ID = @ID


        //        UPDATE CompanyUsers SET Phone = @Phone WHERE IDCompany = @ID AND IsMainUser = 1 AND ID = @IDCU

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_GetList]
        //@Status tinyint,
        //@IDCompany  nvarchar(50),
        //@IDMember nvarchar(50),
        //@StartDate date,
        //@EndDate date,
        //@IsAutoNotification tinyint,
        //@PageLenght int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@PaymentMethodID int = null
        //AS
        //BEGIN
        //DECLARE @totalRecords int
        //SELECT r.ID, r.CDate,r.MDate,r.ServiceID,r.TransactionNr,r.TransactionID,r.IDMember,r.Phone,r.ActionDate,r.ActionTime,r.Amount,r.SenderName,r.SenderIdentityNr,
        //r.Description,r.Status,r.BlockedDate,r.IsNotBocked,r.IsAutoNotification,r.ParamCommission,r.PayNKolayCommission,r.CardNumber,r.TransactionReferenceCode,
        //r.MUser,r.MemberIPAddress,r.MemberPort,r.CardTypeId,r.EncryptedCardNumber,r.PaymentInstitutionCommissionRate,r.PaymentInstitutionNetAmount, c.Title as Company, c.Phone AS CompanyPhone, m.Name AS Member, ct.CommissionRate, 
        //[dbo].RoundToZero(ct.Commission) as Commission, [dbo].RoundToZero(ct.NetTotal) as NetTotal, m2.Name AS Modifier, r.CreditCardPaymentMethodID, pins.Name as PaymentInstitutionName
        //into #TempTable FROM CreditCardPaymentNotifications r
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID=r.ServiceID
        //INNER JOIN Companies c ON c.ID= ci.ID
        //LEFT JOIN PaymentInstitutions pins on pins.ID = r.CreditCardPaymentMethodID

        //INNER JOIN Members m ON m.ID= r.IDMember

        //LEFT JOIN Administrators m2 ON m2.ID = r.MUser

        //LEFT JOIN CompanyTransactions ct ON ct.ID = r.ID

        //WHERE

        // CASE
        //        WHEN @Status IN (5, 6, 7) THEN
        //            CASE
        //                WHEN(@StartDate IS NULL OR CAST(r.MDate AS DATE) >= CAST(@StartDate AS DATE)) AND
        //                     (@EndDate IS NULL OR CAST(r.MDate AS DATE) <= CAST(@EndDate AS DATE)) THEN 1
        //                ELSE 0
        //            END
        //        ELSE
        //            CASE
        //                WHEN(@StartDate IS NULL OR CAST(r.CDate AS DATE) >= CAST(@StartDate AS DATE)) AND
        //                     (@EndDate IS NULL OR CAST(r.CDate AS DATE) <= CAST(@EndDate AS DATE)) THEN 1
        //                ELSE 0
        //            END
        //END = 1

        //AND 1=1

        //AND(@IsAutoNotification IS NULL OR r.IsAutoNotification = @IsAutoNotification)

        //AND(
        //    @IsAutoNotification IS NULL
        //    OR
        //    (@IsAutoNotification = 0 AND r.PaymentInstitutionCommissionRate IS NOT NULL AND r.PaymentInstitutionNetAmount IS NOT NULL AND r.IsAutoNotification = 0)
        //    OR
        //    (@IsAutoNotification<> 0 and r.IsAutoNotification = 1))

        //AND(@PaymentMethodID IS NULL OR r.CreditCardPaymentMethodID = @PaymentMethodID)

        //AND(r.Status= @Status OR (@Status IS NULL AND r.Status IN(2,3)) OR @Status = 4)

        //AND(@IDCompany IS NULL OR c.ID= @IDCompany)

        //AND(@IDMember IS NULL OR r.IDMember= @IDMember)



        //AND(@SearchValue IS NULL OR  (m.Name LIKE '%' + @SearchValue + '%' OR r.TransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%'   ))


        //IF @Status IN(5, 6, 7)
        //BEGIN
        //    SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // ORDER BY MDate DESC
        //    OFFSET @OffsetValue ROWS

        //    FETCH NEXT @PageLenght ROWS ONLY
        //    DROP TABLE #TempTable
        //END


        //ELSE
        //BEGIN

        //    SELECT @totalRecords = COUNT(*) FROM #TempTable
        // SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS

        //    FETCH NEXT @PageLenght ROWS ONLY
        //    DROP TABLE #TempTable

        //END


        //END;

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_CreditCardDetailedSearch]
        //@Status TINYINT,
        //@IDCompany NVARCHAR(50),
        //@SenderName NVARCHAR(500),
        //@SenderPhone NVARCHAR(50),
        //@CardNumber NVARCHAR(50),
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //    -- Declare a variable to store the total record count
        //    DECLARE @totalRecords INT;

        //    -- Select records into a temporary table
        //    SELECT
        //        r.ID,
        //        r.CDate,
        //        r.TransactionID,
        //        r.TransactionNr,
        //        r.Company,
        //        r.SenderName,
        //        r.Phone AS SenderPhone,
        //        r.CardNumber,
        //        r.CardTypeId,
        //        r.PaymentInstitutionName,
        //        r.Amount,
        //        r.Status,
        //        r.RebateID
        //    INTO #TempTable
        //    FROM
        //    (
        //        -- First query for CreditCardPaymentNotifications
        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            r.SenderName,
        //            r.Phone,
        //            r.CardNumber,
        //            r.CardTypeId,
        //            pins.Name AS PaymentInstitutionName,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID
        //        FROM CreditCardPaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        LEFT JOIN PaymentInstitutions pins ON pins.ID = r.CreditCardPaymentMethodID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@SenderName IS NULL OR r.SenderName COLLATE Turkish_CI_AS LIKE '%' + @SenderName + '%')
        //            AND(@SenderPhone IS NULL OR r.Phone COLLATE Turkish_CI_AS LIKE '%' + @SenderPhone + '%')
        //            AND(@CardNumber IS NULL OR r.CardNumber COLLATE Turkish_CI_AS LIKE '%' + @CardNumber + '%' OR EncryptedCardNumber = @CardNumber)

        //        UNION ALL

        //        -- Second query for ForeignCreditCardPaymentNotifications
        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            r.SenderName,
        //            r.Phone,
        //            r.CardNumber,
        //            r.CardTypeId,
        //            pins.Name AS PaymentInstitutionName,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID
        //        FROM ForeignCreditCardPaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        LEFT JOIN PaymentInstitutions pins ON pins.ID = r.CreditCardPaymentMethodID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@SenderName IS NULL OR r.SenderName COLLATE Turkish_CI_AS LIKE '%' + @SenderName + '%')
        //            AND(@SenderPhone IS NULL OR r.Phone COLLATE Turkish_CI_AS LIKE '%' + @SenderPhone + '%')
        //            AND(@CardNumber IS NULL OR r.CardNumber COLLATE Turkish_CI_AS LIKE '%' + @CardNumber + '%')
        //    ) AS r;

        //    -- Get the total number of records
        //    SELECT @totalRecords = COUNT(*) FROM #TempTable;

        //    -- Select the paginated results with the total records count
        //    SELECT*, @totalRecords AS TotalRecords
        //    FROM #TempTable
        //    ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS FETCH NEXT @PageLength ROWS ONLY;

        //    -- Drop the temporary table
        //    DROP TABLE #TempTable;

        //    SET NOCOUNT OFF;
        //END;

        //GO

        //ALTER Proc[dbo].[CreditCardPaymentNotifications_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime = null,
        //@MUser nvarchar(50) = null,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@TransactionReferenceCode nvarchar(30),
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //        IF @Status<> 6 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=6 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=1 AND(select Status from CreditCardPaymentNotifications where ID = @ID)!=5
        //  BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Bu bildirim daha önce cevaplanmıştır.'
        //   RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE

        //        BEGIN
        //            UPDATE CreditCardPaymentNotifications SET MDate= IIF(@MDate is null, GETDATE(), @MDate), Description=@Description, Status=@Status, 
        //   TransactionReferenceCode = @TransactionReferenceCode, MUser = @MUser, PaymentInstitutionCommissionRate = @PaymentInstitutionCommissionRate,
        //   PaymentInstitutionNetAmount = @PaymentInstitutionNetAmount, IsTrustedCardNumber = 0, 
        //   IsCaughtInFraudControl = CASE WHEN @Status = 2 AND IsCaughtInFraudControl = 1 THEN 0
        //         ELSE IsCaughtInFraudControl

        //            END
        //            WHERE ID=@ID
        //            AND(Status= 1 OR Status = 5 OR @Status = 6 OR Status = 6)

        //            SELECT @IDOut = @ID

        //        END

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END



        //GO

        //ALTER PROCEDURE[dbo].[CreditCardPaymentNotifications_CreditCardTransactionCheckFraudControl]
        //@EncryptedCardNumber NVARCHAR(MAX),
        //@TimeSpanInMinutes INT = 15,
        //@TransactionLimitToday INT = 2
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        // DECLARE @CurrentTime DATETIME = GETDATE();
        //        DECLARE @MinutesAgo DATETIME = DATEADD(MINUTE, -@TimeSpanInMinutes, @CurrentTime);

        //        DECLARE @RecentTransactionCount INT = 0;

        // SELECT @RecentTransactionCount = COUNT(*)

        //    FROM CreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //   AND ccpn.CDate BETWEEN @MinutesAgo AND @CurrentTime;

        //        DECLARE @TransactionCountToday INT;
        //    SELECT @TransactionCountToday = COUNT(*)
        //    FROM CreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //   AND ccpn.CDate >= DATEADD(HOUR, -24, GETDATE())

        //      AND ccpn.CDate <= GETDATE();

        //        DECLARE @TransactionWithin24Hours BIT;
        //    SELECT @TransactionWithin24Hours = CASE
        //        WHEN EXISTS(
        //            SELECT 1
        //            FROM CreditCardPaymentNotifications ccpn
        //            WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //              AND ccpn.Status = 2
        //              AND ccpn.CDate<DATEADD(HOUR, -24, GETDATE())
        //        ) THEN CAST(1 AS BIT)
        //        ELSE CAST(0 AS BIT)
        //    END;

        //    SELECT
        //        CASE WHEN @RecentTransactionCount >= 1 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS RecentTransactionLimitExceeded,
        //        CASE WHEN @TransactionCountToday >= @TransactionLimitToday THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS DailyTransactionLimitExceeded,
        //        CAST(0 AS BIT) AS TransactionWithin24Hours;
        //        END




        //GO

        //      ALTER Proc[dbo].[CreditCardPaymentNotifications_Insert]
        //      @IDOut nvarchar(50) output,
        //      @ServiceID nvarchar(4),
        //      @TransactionID nvarchar(50),
        //      @IDMember nvarchar(50),
        //      @Phone nvarchar(15),
        //      @ActionDate date,
        //      @ActionTime nvarchar(5),
        //      @Amount decimal (18,2),
        //      @SenderName nvarchar(50),
        //      @SenderIdentityNr nvarchar(11),
        //      @Description nvarchar(250),
        //      @Status tinyint,
        //      @ParamCommission decimal (18,2),
        //      @PayNKolayCommission decimal (18,2),
        //      @CardNumber nvarchar(30),
        //      @TransactionReferenceCode nvarchar(30),
        //      @CreditCardPaymentMethodID tinyint,
        //      @CardTypeId int,
        //      @PaymentInstitutionCommissionRate decimal (18,2) = null,
        //      @PaymentInstitutionNetAmount decimal (18,2) = null,
        //      @EncryptedCardNumber nvarchar(max) = null,
        //      @FraudControlDescription nvarchar(max) = null,
        //      @IsTrustedCardNumber bit = 0,
        //      @IsCaughtInFraudControl bit = 0,
        //      @DealerCommissionRate decimal (18,2) = null
        //      AS
        //      BEGIN
        //      BEGIN TRY

        //      DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //      DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //      IF(Select Count(ID) From CreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //      BEGIN
        //      SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //      RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //      END
        //      ELSE

        //      BEGIN
        //      declare @_isAutoNotification bit = 0;
        //      declare @_isAuto bit;
        //      declare @_minAmount decimal (18,2);
        //      declare @_maxAmount decimal (18,2);
        //      declare @_quantity smallint;

        //      declare @companyCreditCardLimit decimal (18,2);

        //      SELECT @companyCreditCardLimit = c.AutoCreditCardLimit
        //      FROM Companies c
        //      INNER JOIN CompanyIntegrations ci ON ci.ServiceID = @ServiceID
        //      WHERE c.ID = ci.ID;

        //if (@Amount >= @companyCreditCardLimit and @IsCaughtInFraudControl = 0)
        //begin
        //          set @FraudControlDescription = 'Üye işyeri otomatik işlem limiti ' + cast(cast(@companyCreditCardLimit as decimal(18, 2)) as nvarchar(50)) + ', işlem durduruldu'
        //end

        //      select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID= @IDMember
        //      if(@_isAuto= 1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL AND @IsCaughtInFraudControl = 0)
        //      begin
        //      if(@Amount>=@_minAmount AND @Amount<=@_maxAmount AND @Amount<@companyCreditCardLimit)
        //      begin
        //      if (select Count(pn.ID) from CreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //      begin

        //          set @_isAutoNotification = 1;
        //      end
        //      end

        //      end

        //      SET @IDOut = NEWID()

        //      INSERT INTO CreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //      IsAutoNotification, Description, ParamCommission, PayNKolayCommission, CardNumber, TransactionReferenceCode, CreditCardPaymentMethodID, CardTypeId, EncryptedCardNumber,
        //      FraudControlDescription, IsTrustedCardNumber, IsCaughtInFraudControl, DealerCommissionRate)

        //      SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.CreditCardBlocked, GetDate()), 
        //      IIF(cc.CreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @ParamCommission, @PayNKolayCommission, @CardNumber, 
        //      @TransactionReferenceCode, @CreditCardPaymentMethodID, @CardTypeId, @EncryptedCardNumber, @FraudControlDescription, 
        //      0, @IsCaughtInFraudControl, cc.CreditCardRate FROM CompanyCommissions cc

        //      INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //      WHERE ci.ServiceID= @ServiceID

        //      SELECT @IDOut

        //      END

        //      END TRY
        //      BEGIN CATCH
        //      DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //      SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //      RAISERROR(@ERRORMESSAGE,16,1)
        //      END CATCH
        //      END


        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@CountryCode nvarchar(10),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(250),
        //@Status tinyint,
        //@CardNumber nvarchar(30),
        //@TransactionReferenceCode nvarchar(30),
        //@CreditCardPaymentMethodID tinyint,
        //@CardTypeId int = 2,
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null,
        //@CurrencyCode nvarchar(30) = "TRY",
        //@EncryptedCardNumber nvarchar(max) = null,
        //@FraudControlDescription nvarchar(max) = null,
        //@IsTrustedCardNumber bit = 0,
        //@IsCaughtInFraudControl bit = 0,
        //@DealerCommissionRate decimal (18,2) = null
        //AS
        //BEGIN
        //BEGIN TRY


        //DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //--		IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where IDMember= @IDMember And Status = 1)>0  
        //--		BEGIN
        //--			SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //--			RAISERROR(@CUSTOMERRORMESSAGE,16,1)
        //--		END
        //IF(Select Count(ID) From ForeignCreditCardPaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //BEGIN
        //SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //END
        //ELSE

        //BEGIN
        //declare @_isAutoNotification bit = 0;
        //        declare @_isAuto bit;
        //declare @_minAmount decimal (18,2);
        //declare @_maxAmount decimal (18,2);
        //declare @_quantity smallint;

        //declare @companyForeignCreditCardLimit decimal (18,2);

        //SELECT @companyForeignCreditCardLimit = c.AutoForeignCreditCardLimit
        //FROM Companies c
        //INNER JOIN CompanyIntegrations ci ON ci.ServiceID = @ServiceID
        //WHERE c.ID = ci.ID;

        //if (@Amount >= @companyForeignCreditCardLimit and @IsCaughtInFraudControl = 0)
        //begin
        //    set @FraudControlDescription = 'Üye işyeri otomatik işlem limiti ' + cast(cast(@companyForeignCreditCardLimit as decimal(18, 2)) as nvarchar(50)) + ', işlem durduruldu'
        //end


        //select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID= @IDMember
        //if(@_isAuto= 1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL AND @IsCaughtInFraudControl = 0)
        //begin
        //if(@Amount>=@_minAmount AND @Amount<=@_maxAmount AND @Amount <= @companyForeignCreditCardLimit)
        //begin
        //if (select Count(pn.ID) from ForeignCreditCardPaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //begin

        //set @_isAutoNotification = 1;
        //        end
        //        end

        //end

        //SET @IDOut = NEWID()

        //INSERT INTO ForeignCreditCardPaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //IsAutoNotification, Description, CardNumber, TransactionReferenceCode, CountryCode, CreditCardPaymentMethodID, CardTypeId,
        //CurrencyCode, EncryptedCardNumber, FraudControlDescription, IsTrustedCardNumber, IsCaughtInFraudControl, DealerCommissionRate)

        //SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') +SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @ActionDate, @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.ForeignCreditCardBlocked, GetDate()), 
        //IIF(cc.ForeignCreditCardBlocked= 0,1,0), @_isAutoNotification, @Description, @CardNumber, @TransactionReferenceCode, 
        //@CountryCode, @CreditCardPaymentMethodID, @CardTypeId, @CurrencyCode, @EncryptedCardNumber, @FraudControlDescription,
        //0, @IsCaughtInFraudControl, cc.ForeignCreditCardRate FROM CompanyCommissions cc

        //INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //WHERE ci.ServiceID= @ServiceID

        //SELECT @IDOut

        //END

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH
        //END;



        //GO

        //ALTER Proc[dbo].[ForeignCreditCardPaymentNotifications_SetStatus]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MDate datetime = null,
        //@MUser nvarchar(50) = null,
        //@Description nvarchar(250),
        //@Status tinyint,
        //@TransactionReferenceCode nvarchar(30),
        //@PaymentInstitutionCommissionRate decimal (18,2) = null,
        //@PaymentInstitutionNetAmount decimal (18,2) = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine

        //        IF @Status<> 6 AND(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=6 AND(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=1 AND(select Status from ForeignCreditCardPaymentNotifications where ID = @ID)!=5
        //  BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Bu bildirim daha önce cevaplanmıştır.'
        //   RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE

        //        BEGIN
        //            UPDATE ForeignCreditCardPaymentNotifications SET MDate= IIF(@MDate is null, GETDATE(), @MDate), Description=@Description, Status=@Status, 
        //   TransactionReferenceCode = @TransactionReferenceCode, MUser = @MUser, PaymentInstitutionCommissionRate = @PaymentInstitutionCommissionRate,
        //   PaymentInstitutionNetAmount = @PaymentInstitutionNetAmount, IsTrustedCardNumber = 0, 
        //   IsCaughtInFraudControl = CASE WHEN @Status = 2 AND IsCaughtInFraudControl = 1 THEN 0
        //         ELSE IsCaughtInFraudControl

        //            END WHERE ID=@ID
        //            AND(Status= 1 OR Status = 5 OR @Status = 6 OR Status = 6)

        //            SELECT @IDOut = @ID

        //        END

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END


        //GO

        //ALTER  PROCEDURE[dbo].[ForeignCreditCardPaymentNotifications_CreditCardTransactionCheckFraudControl]
        //@EncryptedCardNumber NVARCHAR(MAX),
        //@TimeSpanInMinutes INT = 15,
        //@TransactionLimitToday INT = 2
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        // DECLARE @CurrentTime DATETIME = GETDATE();
        //        DECLARE @MinutesAgo DATETIME = DATEADD(MINUTE, -@TimeSpanInMinutes, @CurrentTime);

        //        DECLARE @RecentTransactionCount INT = 0;

        // SELECT @RecentTransactionCount = COUNT(*)

        //    FROM ForeignCreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //   AND ccpn.CDate BETWEEN @MinutesAgo AND @CurrentTime;

        //        DECLARE @TransactionCountToday INT;
        //    SELECT @TransactionCountToday = COUNT(*)
        //    FROM ForeignCreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //   AND ccpn.CDate >= DATEADD(HOUR, -24, GETDATE())

        //      AND ccpn.CDate <= GETDATE();

        //        DECLARE @TransactionWithin24Hours BIT;
        //    SELECT @TransactionWithin24Hours = CASE
        //        WHEN EXISTS(
        //            SELECT 1
        //            FROM ForeignCreditCardPaymentNotifications ccpn
        //            WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //              AND ccpn.Status = 2
        //              AND ccpn.CDate<DATEADD(HOUR, -24, GETDATE())
        //        ) THEN CAST(1 AS BIT)
        //        ELSE CAST(0 AS BIT)
        //    END;

        //    SELECT
        //        CASE WHEN @RecentTransactionCount >= 1 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS RecentTransactionLimitExceeded,
        //        CASE WHEN @TransactionCountToday >= @TransactionLimitToday THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS DailyTransactionLimitExceeded,
        //        CAST(0 AS BIT) AS TransactionWithin24Hours;
        //        END

        //GO

        //GUNCELLENDİ

        //------------------------------------------------------- 11.11.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.CompanyFraudControls ADD
        //ForeignCreditCardDailyTransactionLimitAmount decimal (18,2) DEFAULT 1000 NOT NULL,
        //CreditCardDailyTransactionLimitAmount decimal (18,2) DEFAULT 1000 NOT NULL,
        //BeStoppedCreditCardDailyTransactionCount int DEFAULT 5 NOT NULL,
        //BeStoppedForeignCreditCardDailyTransactionCount int DEFAULT 5 NOT NULL

        //GO

        //ALTER PROCEDURE[dbo].[CompanyFraudControls_Insert]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@IsCreditCardFraudControlActive bit = 1,
        //@CreditCardTimeSpanInRecentTransactionMinutes int = 15,
        //@CreditCardDailyTransactionCount int = 3,
        //@CreditCardFirstTransactionLimit decimal (18, 2) = 10000,
        //@IsForeignCreditCardFraudControlActive bit = 1,
        //@ForeignCreditCardTimeSpanInRecentTransactionMinutes int = 15,
        //@ForeignCreditCardDailyTransactionCount int = 3,
        //@ForeignCreditCardFirstTransactionLimit decimal (18, 2) = 10000,
        //@ForeignCreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //@CreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //@BeStoppedCreditCardDailyTransactionCount int = 5,
        //@BeStoppedForeignCreditCardDailyTransactionCount int = 5
        //AS
        //BEGIN
        //    INSERT INTO CompanyFraudControls
        //    (ID, IsCreditCardFraudControlActive, CreditCardTimeSpanInRecentTransactionMinutes, CreditCardDailyTransactionCount,
        //    CreditCardFirstTransactionLimit, IsForeignCreditCardFraudControlActive, ForeignCreditCardTimeSpanInRecentTransactionMinutes,
        //    ForeignCreditCardDailyTransactionCount, ForeignCreditCardFirstTransactionLimit,
        //    ForeignCreditCardDailyTransactionLimitAmount, CreditCardDailyTransactionLimitAmount,
        //    BeStoppedCreditCardDailyTransactionCount, BeStoppedForeignCreditCardDailyTransactionCount)
        //    VALUES
        //    (@ID, @IsCreditCardFraudControlActive, @CreditCardTimeSpanInRecentTransactionMinutes,
        //       @CreditCardDailyTransactionCount, @CreditCardFirstTransactionLimit, @IsForeignCreditCardFraudControlActive,
        //      @ForeignCreditCardTimeSpanInRecentTransactionMinutes, @ForeignCreditCardDailyTransactionCount,
        //     @ForeignCreditCardFirstTransactionLimit, @ForeignCreditCardDailyTransactionLimitAmount, @CreditCardDailyTransactionLimitAmount
        // , @BeStoppedCreditCardDailyTransactionCount, @BeStoppedForeignCreditCardDailyTransactionCount);

        //        SELECT @IDOut = @ID
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyFraudControls_Update]
        //@IDOut nvarchar(50) output,
        //@ID nchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@IsCreditCardFraudControlActive bit,
        //@CreditCardTimeSpanInRecentTransactionMinutes int,
        //@CreditCardDailyTransactionCount int,
        //@CreditCardFirstTransactionLimit decimal (18, 2),
        //@IsForeignCreditCardFraudControlActive bit,
        //@ForeignCreditCardTimeSpanInRecentTransactionMinutes int,
        //@ForeignCreditCardDailyTransactionCount int,
        //@ForeignCreditCardFirstTransactionLimit decimal (18, 2),
        //@ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2),
        //@CreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2),
        //@ForeignCreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //@CreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //@BeStoppedCreditCardDailyTransactionCount int = 5,
        //@BeStoppedForeignCreditCardDailyTransactionCount int = 5
        //AS
        //BEGIN
        //    UPDATE CompanyFraudControls
        //    SET IsCreditCardFraudControlActive = @IsCreditCardFraudControlActive,
        //        CreditCardTimeSpanInRecentTransactionMinutes = @CreditCardTimeSpanInRecentTransactionMinutes,
        //        CreditCardDailyTransactionCount = @CreditCardDailyTransactionCount,
        //        CreditCardFirstTransactionLimit = @CreditCardFirstTransactionLimit,
        //        IsForeignCreditCardFraudControlActive = @IsForeignCreditCardFraudControlActive,
        //        ForeignCreditCardTimeSpanInRecentTransactionMinutes = @ForeignCreditCardTimeSpanInRecentTransactionMinutes,
        //        ForeignCreditCardDailyTransactionCount = @ForeignCreditCardDailyTransactionCount,
        //        ForeignCreditCardFirstTransactionLimit = @ForeignCreditCardFirstTransactionLimit,
        //        MUser = @MUser, MDate = @MDate,
        //        ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount = @ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //        CreditCardTimeSpanInRecentTransactionMinutesLimitAmount = @CreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //        ForeignCreditCardDailyTransactionLimitAmount = @ForeignCreditCardDailyTransactionLimitAmount,
        //        CreditCardDailyTransactionLimitAmount = @CreditCardDailyTransactionLimitAmount,
        //        BeStoppedCreditCardDailyTransactionCount = @BeStoppedCreditCardDailyTransactionCount,
        //        BeStoppedForeignCreditCardDailyTransactionCount = @BeStoppedForeignCreditCardDailyTransactionCount


        //    WHERE ID = @ID;

        //        SELECT @IDOut = @ID
        //END

        //GO

        //ALTER PROCEDURE[dbo].[ForeignCreditCardPaymentNotifications_CreditCardTransactionCheckFraudControl]
        //@EncryptedCardNumber NVARCHAR(MAX),
        //@TimeSpanInMinutes INT = 15,
        //@TransactionLimitToday INT = 2
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        // DECLARE @CurrentTime DATETIME = GETDATE();
        //        DECLARE @MinutesAgo DATETIME = DATEADD(MINUTE, -@TimeSpanInMinutes, @CurrentTime);

        //        DECLARE @RecentTransactionCount INT = 0;

        // SELECT @RecentTransactionCount = COUNT(*)

        //    FROM ForeignCreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //   AND ccpn.CDate BETWEEN @MinutesAgo AND @CurrentTime;

        //        DECLARE @TransactionCountToday INT;
        //    SELECT @TransactionCountToday = COUNT(*)
        //    FROM ForeignCreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //   AND ccpn.CDate >= DATEADD(HOUR, -24, GETDATE())

        //      AND ccpn.CDate <= GETDATE();

        //        DECLARE @TransactionWithin24Hours BIT;
        //    SELECT @TransactionWithin24Hours = CASE
        //        WHEN EXISTS(
        //            SELECT 1
        //            FROM ForeignCreditCardPaymentNotifications ccpn
        //            WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //              AND ccpn.Status = 2
        //              AND ccpn.CDate<DATEADD(HOUR, -24, GETDATE())
        //        ) THEN CAST(1 AS BIT)
        //        ELSE CAST(0 AS BIT)
        //    END;

        //    SELECT
        //        CASE WHEN @RecentTransactionCount >= 1 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS RecentTransactionLimitExceeded,
        //        CASE WHEN @TransactionCountToday >= @TransactionLimitToday THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS DailyTransactionLimitExceeded,
        //        @TransactionCountToday as TransactionCountToday,
        //        CAST(0 AS BIT) AS TransactionWithin24Hours;
        //        END

        //GO

        //ALTER PROCEDURE[dbo].[CreditCardPaymentNotifications_CreditCardTransactionCheckFraudControl]
        //@EncryptedCardNumber NVARCHAR(MAX),
        //@TimeSpanInMinutes INT = 15,
        //@TransactionLimitToday INT = 2
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        // DECLARE @CurrentTime DATETIME = GETDATE();
        //        DECLARE @MinutesAgo DATETIME = DATEADD(MINUTE, -@TimeSpanInMinutes, @CurrentTime);

        //        DECLARE @RecentTransactionCount INT = 0;

        // SELECT @RecentTransactionCount = COUNT(*)

        //    FROM CreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //   AND ccpn.CDate BETWEEN @MinutesAgo AND @CurrentTime;

        //        DECLARE @TransactionCountToday INT;
        //    SELECT @TransactionCountToday = COUNT(*)
        //    FROM CreditCardPaymentNotifications ccpn
        //    WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //      AND ccpn.Status = 2
        //   AND ccpn.CDate >= DATEADD(HOUR, -24, GETDATE())

        //      AND ccpn.CDate <= GETDATE();

        //        DECLARE @TransactionWithin24Hours BIT;
        //    SELECT @TransactionWithin24Hours = CASE
        //        WHEN EXISTS(
        //            SELECT 1
        //            FROM CreditCardPaymentNotifications ccpn
        //            WHERE ccpn.EncryptedCardNumber = @EncryptedCardNumber
        //              AND ccpn.Status = 2
        //              AND ccpn.CDate<DATEADD(HOUR, -24, GETDATE())
        //        ) THEN CAST(1 AS BIT)
        //        ELSE CAST(0 AS BIT)
        //    END;

        //    SELECT
        //        CASE WHEN @RecentTransactionCount >= 1 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS RecentTransactionLimitExceeded,
        //        CASE WHEN @TransactionCountToday >= @TransactionLimitToday THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS DailyTransactionLimitExceeded,
        //        @TransactionCountToday as TransactionCountToday,
        //        CAST(0 AS BIT) AS TransactionWithin24Hours;
        //        END


        //GUNCELLENDİ


        //------------------------------------------------------- 25.11.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE dbo.CompanyFraudControls ADD
        //IsSmsConfirmationActiveTransfer bit DEFAULT 1 NOT NULL,
        //IsSmsConfirmationActiveCreditCard bit DEFAULT 1 NOT NULL,
        //IsSmsConfirmationActiveForeingCreditCard bit DEFAULT 1 NOT NULL

        //GO

        //ALTER PROCEDURE[dbo].[CompanyFraudControls_Update]
        //@IDOut nvarchar(50) output,
        //@ID nchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@IsCreditCardFraudControlActive bit,
        //@CreditCardTimeSpanInRecentTransactionMinutes int,
        //@CreditCardDailyTransactionCount int,
        //@CreditCardFirstTransactionLimit decimal (18, 2),
        //@IsForeignCreditCardFraudControlActive bit,
        //@ForeignCreditCardTimeSpanInRecentTransactionMinutes int,
        //@ForeignCreditCardDailyTransactionCount int,
        //@ForeignCreditCardFirstTransactionLimit decimal (18, 2),
        //@ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2),
        //@CreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2),
        //@ForeignCreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //@CreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //@BeStoppedCreditCardDailyTransactionCount int = 5,
        //@BeStoppedForeignCreditCardDailyTransactionCount int = 5,
        //@IsSmsConfirmationActiveTransfer bit = true,
        //@IsSmsConfirmationActiveCreditCard bit = true,
        //@IsSmsConfirmationActiveForeingCreditCard bit = true

        //AS
        //BEGIN
        //    UPDATE CompanyFraudControls
        //    SET IsCreditCardFraudControlActive = @IsCreditCardFraudControlActive,
        //        CreditCardTimeSpanInRecentTransactionMinutes = @CreditCardTimeSpanInRecentTransactionMinutes,
        //        CreditCardDailyTransactionCount = @CreditCardDailyTransactionCount,
        //        CreditCardFirstTransactionLimit = @CreditCardFirstTransactionLimit,
        //        IsForeignCreditCardFraudControlActive = @IsForeignCreditCardFraudControlActive,
        //        ForeignCreditCardTimeSpanInRecentTransactionMinutes = @ForeignCreditCardTimeSpanInRecentTransactionMinutes,
        //        ForeignCreditCardDailyTransactionCount = @ForeignCreditCardDailyTransactionCount,
        //        ForeignCreditCardFirstTransactionLimit = @ForeignCreditCardFirstTransactionLimit,
        //        MUser = @MUser, MDate = @MDate,
        //        ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount = @ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //        CreditCardTimeSpanInRecentTransactionMinutesLimitAmount = @CreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //        ForeignCreditCardDailyTransactionLimitAmount = @ForeignCreditCardDailyTransactionLimitAmount,
        //        CreditCardDailyTransactionLimitAmount = @CreditCardDailyTransactionLimitAmount,
        //        BeStoppedCreditCardDailyTransactionCount = @BeStoppedCreditCardDailyTransactionCount,
        //        BeStoppedForeignCreditCardDailyTransactionCount = @BeStoppedForeignCreditCardDailyTransactionCount,
        //        IsSmsConfirmationActiveTransfer = @IsSmsConfirmationActiveTransfer,
        //        IsSmsConfirmationActiveCreditCard = @IsSmsConfirmationActiveCreditCard,
        //        IsSmsConfirmationActiveForeingCreditCard = @IsSmsConfirmationActiveForeingCreditCard



        //    WHERE ID = @ID;

        //        SELECT @IDOut = @ID
        //END


        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_CustomerInfoDetailedSearch]
        //@Status TINYINT,
        //@IDCompany NVARCHAR(50),
        //@CustomerName NVARCHAR(500),
        //@CustomerEmail NVARCHAR(50),
        //@CustomerPhone NVARCHAR(50),
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //    DECLARE @totalRecords INT;

        //    SELECT
        //        r.ID,
        //        r.CDate,
        //        r.TransactionID,
        //        r.TransactionNr,
        //        r.Company,
        //        CustomerName,
        //        CustomerPhone,
        //        CustomerEmail,
        //        TransactionType,
        //        r.Amount,
        //        r.Status,
        //        r.RebateID,
        //        EntityUrl
        //    INTO #TempTable
        //    FROM
        //    (
        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            cin.CustomerName,
        //            cin.CustomerPhone,
        //            cin.CustomerEmail,
        //         'Kredi Kartı' + CHAR(13) + CHAR(10) + r.CardNumber as TransactionType,
        //         r.Amount,
        //         r.Status,
        //         crr.ID AS RebateID,
        //         '/DealerCreditCardTransaction/Edit/' + r.ID as EntityUrl
        //        FROM CreditCardPaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        INNER JOIN CustomerInfos cin ON cin.TransactionID = r.TransactionID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@CustomerName IS NULL OR cin.CustomerName COLLATE Turkish_CI_AS LIKE '%' + @CustomerName + '%')
        //            AND(@CustomerPhone IS NULL OR cin.CustomerPhone COLLATE Turkish_CI_AS LIKE '%' + @CustomerPhone + '%')
        //            AND(@CustomerEmail IS NULL OR cin.CustomerEmail COLLATE Turkish_CI_AS LIKE '%' + @CustomerEmail + '%')


        //        UNION ALL

        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            cin.CustomerName,
        //            cin.CustomerPhone,
        //            cin.CustomerEmail,
        //         'Kredi Kartı' + CHAR(13) + CHAR(10) + r.CardNumber as TransactionType,
        //         r.Amount,
        //         r.Status,
        //         crr.ID AS RebateID,
        //         '/DealerForeignCreditCardTransaction/Edit/' + r.ID as EntityUrl
        //        FROM ForeignCreditCardPaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        INNER JOIN CustomerInfos cin ON cin.TransactionID = r.TransactionID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@CustomerName IS NULL OR cin.CustomerName COLLATE Turkish_CI_AS LIKE '%' + @CustomerName + '%')
        //            AND(@CustomerPhone IS NULL OR cin.CustomerPhone COLLATE Turkish_CI_AS LIKE '%' + @CustomerPhone + '%')
        //            AND(@CustomerEmail IS NULL OR cin.CustomerEmail COLLATE Turkish_CI_AS LIKE '%' + @CustomerEmail + '%')


        //        UNION ALL

        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            cin.CustomerName,
        //            cin.CustomerPhone,
        //            cin.CustomerEmail,
        //         'Havale / EFT' as TransactionType,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID,
        //         '/DealerPaymentTransaction/Edit/' + r.ID as EntityUrl
        //        FROM PaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        INNER JOIN CustomerInfos cin ON cin.TransactionID = r.TransactionID
        //        WHERE
        //  (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)
        //            AND(@CustomerName IS NULL OR cin.CustomerName COLLATE Turkish_CI_AS LIKE '%' + @CustomerName + '%')
        //            AND(@CustomerPhone IS NULL OR cin.CustomerPhone COLLATE Turkish_CI_AS LIKE '%' + @CustomerPhone + '%')
        //            AND(@CustomerEmail IS NULL OR cin.CustomerEmail COLLATE Turkish_CI_AS LIKE '%' + @CustomerEmail + '%')
        //    ) AS r;

        //        SELECT @totalRecords = COUNT(*) FROM #TempTable;

        //    SELECT*, @totalRecords AS TotalRecords
        //    FROM #TempTable
        //    ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS FETCH NEXT @PageLength ROWS ONLY;

        //        DROP TABLE #TempTable;

        //    SET NOCOUNT OFF;
        //END;

        //------------------------------------------------------- 03.12.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //CREATE TABLE DEV_TEST2.dbo.PaymentTransferPoolDescriptionControls(
        //    ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // CDate datetime NOT NULL,
        //    MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        // MDate datetime NULL,
        // Name nvarchar(MAX) COLLATE SQL_Latin1_General_CP1_CI_AS NOT NULL,
        //    CONSTRAINT PK_PaymentTransferPoolDescriptionControls PRIMARY KEY(ID)
        //);

        //GO

        //        CREATE Proc[dbo].[PaymentTransferPoolDescriptionControls_GetList]
        //        @PageLength int = 15,
        //@OffsetValue int = 0,
        //@SearchValue nvarchar(MAX) = null
        //AS
        //BEGIN
        //    DECLARE @totalRecords int

        //    SELECT m.*, ba.Name AS Creator, ba2.Name as Modifier into #TempTable FROM PaymentTransferPoolDescriptionControls m
        //	LEFT JOIN Administrators ba ON ba.ID= m.CUser
        //    LEFT JOIN Administrators ba2 ON ba2.ID= m.MUser

        //    WHERE
        //    @SearchValue IS NULL OR  (m.Name LIKE '%' + @SearchValue + '%')


        //    SELECT @totalRecords = COUNT(*) FROM #TempTable
        // 	SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        // 	ORDER BY CDate DESC
        //       OFFSET @OffsetValue ROWS

        //     FETCH NEXT @PageLength ROWS ONLY
        //    DROP TABLE #TempTable

        //END

        //GO

        //        CREATE Proc[dbo].[PaymentTransferPoolDescriptionControls_Insert]
        //        @IDOut nvarchar(50) output,
        //@CUser nvarchar(50),
        //@CDate datetime,
        //@Name nvarchar(MAX)
        //AS
        //BEGIN TRY

        //    DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10);

        //        SET @IDOut = NEWID()


        //    SET @Name = LTRIM(RTRIM(@Name));
        //        INSERT INTO PaymentTransferPoolDescriptionControls(ID, CDate, CUser, Name)

        //    VALUES(@IDOut, @CDate, @CUser, @Name)



        //    SELECT @IDOut

        //END TRY
        //BEGIN CATCH
        //DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //RAISERROR(@ERRORMESSAGE,16,1)
        //END CATCH

        //GO


        //        CREATE Proc[dbo].[PaymentTransferPoolDescriptionControls_Delete]
        //        @IDOut nvarchar(50) output,
        //@ID nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DELETE FROM PaymentTransferPoolDescriptionControls WHERE ID=@ID
        //        SELECT @IDOut=@ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 05.12.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        // ALTER TABLE dbo.PaymentTransferPools ADD
        //   IsCaughtInFraudControl bit DEFAULT 0 NOT NULL,
        //   FraudControlDescription nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL

        //GO

        // ALTER TABLE dbo.PaymentNotifications ADD
        //   IsCaughtInFraudControl bit DEFAULT 0 NOT NULL,
        //   FraudControlDescription nvarchar(500) COLLATE SQL_Latin1_General_CP1_CI_AS NULL

        //GO

        // ALTER TABLE dbo.CompanyFraudControls ADD
        //IsTransferFraudControlActive bit DEFAULT 1 NOT NULL,
        //TransferTimeSpanInRecentTransactionMinutes int DEFAULT 15 NOT NULL,
        //TransferDailyTransactionCount int DEFAULT 3 NOT NULL,
        //TransferFirstTransactionLimit decimal (18,2) DEFAULT 10000 NOT NULL,
        //TransferTimeSpanInRecentTransactionMinutesLimitAmount decimal (18,2) DEFAULT 1000 NOT NULL,
        //TransferDailyTransactionLimitAmount decimal (18,2) DEFAULT 1000 NOT NULL,
        //BeStoppedTransferDailyTransactionCount int DEFAULT 5 NOT NULL,

        //GO

        //CREATE PROCEDURE[dbo].[PaymentTransferPools_CheckFraudControl]
        //@CustomerName NVARCHAR(500) = null,
        //@ReferenceNr NVARCHAR(50)  = null,
        //@SenderName NVARCHAR(500)  = null,
        //@TimeSpanInMinutes INT = 15,
        //@TransactionLimitToday INT = 2
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //    -- Maskeleme işlemi
        //    DECLARE @MaskedName NVARCHAR(MAX);
        //        SET @MaskedName = (
        //            SELECT STRING_AGG(LEFT(Value, 1) + '***', ' ')
        //        FROM STRING_SPLIT(@CustomerName, ' ')
        //        WHERE LTRIM(RTRIM(Value)) <> ''
        //    );

        //    DECLARE @CurrentTime DATETIME = GETDATE();
        //        DECLARE @MinutesAgo DATETIME = DATEADD(MINUTE, -@TimeSpanInMinutes, @CurrentTime);

        //    -- Son belirtilen dakika içinde yapılan işlem sayısı
        //    DECLARE @RecentTransactionCount INT = 0;
        //        SELECT @RecentTransactionCount = COUNT(*)

        //    FROM PaymentTransferPools ptp
        //    INNER JOIN PaymentNotifications pn ON pn.TransactionID = ptp.ResponseTransactionId
        //    WHERE ptp.Status = 2 
        //    AND pn.Status = 2
        //    AND (@ReferenceNr is null or (ptp.Description LIKE '%' + @ReferenceNr + '%'))
        //    AND(@CustomerName is null or (ptp.SenderName = @CustomerName OR ptp.SenderName = @MaskedName))
        //    AND(@SenderName IS NULL OR pn.SenderName = @SenderName)
        //    AND pn.MDate BETWEEN @MinutesAgo AND @CurrentTime


        //    DECLARE @IsCaughtInFraudControlPending BIT = 0;
        //        SELECT @IsCaughtInFraudControlPending = CASE
        //        WHEN EXISTS(
        //            SELECT 1

        //            FROM PaymentTransferPools ptp
        //            WHERE (@ReferenceNr is null or (ptp.Description LIKE '%' + @ReferenceNr + '%')) AND ptp.Status = 1 AND ptp.IsCaughtInFraudControl = 1
        //            AND (@SenderName is null or (ptp.SenderName = @SenderName OR ptp.SenderName = @MaskedName))
        //        ) THEN CAST(1 AS BIT)
        //        ELSE CAST(0 AS BIT)
        //     END;

        //    -- Son 24 saat içindeki işlem sayısı
        //    DECLARE @TransactionCountToday INT = 0;
        //    SELECT @TransactionCountToday = COUNT(*)

        //    FROM PaymentTransferPools ptp
        //    INNER JOIN PaymentNotifications pn ON pn.TransactionID = ptp.ResponseTransactionId
        //    WHERE ptp.Status = 2 
        //    AND pn.Status = 2
        //    AND (@ReferenceNr is null or (ptp.Description LIKE '%' + @ReferenceNr + '%'))
        //    AND(@CustomerName is null or (ptp.SenderName = @CustomerName OR ptp.SenderName = @MaskedName))
        //    AND(@SenderName IS NULL OR pn.SenderName = @SenderName)

        //    AND pn.MDate >= DATEADD(HOUR, -24, GETDATE())

        //    AND pn.MDate <= GETDATE();

        //    -- 24 saatten daha eski işlemler kontrolü
        //    DECLARE @TransactionWithin24Hours BIT = 0;
        //        SELECT @TransactionWithin24Hours = CASE
        //        WHEN EXISTS(
        //            SELECT 1
        //            FROM PaymentTransferPools ptp
        //            INNER JOIN PaymentNotifications pn ON pn.TransactionID = ptp.ResponseTransactionId
        //            WHERE ptp.Status = 2
        //              AND pn.Status = 2
        //              AND (@ReferenceNr is null or (ptp.Description LIKE '%' + @ReferenceNr + '%'))
        //              AND(@CustomerName is null or (ptp.SenderName = @CustomerName OR ptp.SenderName = @MaskedName))
        //              AND(@SenderName IS NULL OR pn.SenderName = @SenderName)
        //              AND pn.MDate<DATEADD(HOUR, -24, GETDATE())
        //        ) THEN CAST(1 AS BIT)
        //        ELSE CAST(0 AS BIT)
        //    END;

        //    SELECT
        //        CASE WHEN @RecentTransactionCount >= 1 THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS RecentTransactionLimitExceeded,
        //        CASE WHEN @TransactionCountToday >= @TransactionLimitToday THEN CAST(1 AS BIT) ELSE CAST(0 AS BIT) END AS DailyTransactionLimitExceeded,
        //        @TransactionCountToday AS TransactionCountToday,
        //        @IsCaughtInFraudControlPending as IsCaughtInFraudControlPending,
        //        @TransactionWithin24Hours AS TransactionWithin24Hours;
        //END;

        //GO

        //ALTER Proc[dbo].[PaymentNotifications_Insert]
        //@IDOut nvarchar(50) output,
        //@ServiceID nvarchar(4),
        //@TransactionID nvarchar(50),
        //@IDMember nvarchar(50),
        //@Phone nvarchar(15),
        //@IDBank nvarchar(50),
        //@ActionDate date,
        //@ActionTime nvarchar(5),
        //@Amount decimal (18,2),
        //@SenderName nvarchar(50),
        //@SenderIdentityNr nvarchar(11),
        //@Description nvarchar(500),
        //@Status tinyint,
        //@Iban nvarchar(50),
        //@TransactionKey nvarchar(50),
        //@CompanyBankAccountID nvarchar(50),
        //@DealerCommissionRate decimal (18,2) = null,
        //@IsCaughtInFraudControl bit = 0,
        //@FraudControlDescription nvarchar(500) = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)

        //        DECLARE @CUSTOMERRORMESSAGE nvarchar(50)= N'MY' + @NewLine
        //        IF(Select Count(ID) From PaymentNotifications Where IDMember= @IDMember And Status = 1)>0  AND
        //        (SELECT TOP 1 CDate From PaymentNotifications Where IDMember= @IDMember And Status = 1 ORDER BY CDate DESC) >= DATEADD(MINUTE, -1, GETDATE())

        //        BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Mevcutta bir bildirimi bulunmaktadır.'
        //   RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE IF(Select Count(ID) From PaymentNotifications Where ServiceID= @ServiceID And TransactionID = @TransactionID And Status = 1)>0  
        //  BEGIN
        //            SET @CUSTOMERRORMESSAGE += N'Aynı İşlem Numarası ile bildirim bulunmaktadır.'
        //   RAISERROR(@CUSTOMERRORMESSAGE,16,1)

        //        END
        //        ELSE

        //        BEGIN
        //            IF(@IDMember<> '00000000-0000-0000-0000-000000000000')

        //            BEGIN
        //                declare @_isAuto bit;
        //        declare @_minAmount decimal (18,2);
        //    declare @_maxAmount decimal (18,2);
        //    declare @_quantity smallint;
        //    declare @_isAutoNotification bit=0;
        //    declare @companyTranferLimit decimal (18,2);

        //    SELECT @companyTranferLimit = c.AutoTransferLimit

        //                FROM Companies c
        //                INNER JOIN CompanyIntegrations ci ON ci.ServiceID = @ServiceID
        //                WHERE c.ID = ci.ID;

        //    select @_isAuto = IsAuto, @_minAmount = MinAmount, @_maxAmount = MaxAmount, @_quantity = Quantity from Members m INNER JOIN MemberTypes mt on m.IDMemberType=mt.ID where m.ID=@IDMember
        //    if(@_isAuto=1 AND @_minAmount IS NOT NULL AND @_maxAmount IS NOT NULL AND @_quantity IS NOT NULL)
        //    begin
        //     if(@Amount>=@_minAmount AND @Amount<=@_maxAmount AND @Amount <= @companyTranferLimit)
        //     begin
        //      if (select Count(pn.ID) from PaymentNotifications pn INNER JOIN Members m ON m.ID=pn.IDMember where pn.IDMember= @IDMember and Status = 2 and pn.CDate>m.MemberTypeDate)<@_quantity
        //                        begin

        //                            set @_isAutoNotification = 1;
        //        end
        //    end

        //                end
        //            END

        //            ELSE
        //            BEGIN

        //                set @_isAutoNotification = 1;
        //        END


        //        SET @IDOut = NEWID()

        //            INSERT INTO PaymentNotifications(ID, CDate, ServiceID, TransactionNr, TransactionID, IDMember, Phone, IDBank,
        //            ActionDate, ActionTime, Amount, SenderName, SenderIdentityNr, Status, BlockedDate, IsNotBocked,
        //            IsAutoNotification, Iban, TransactionKey, Description, CompanyBankAccountID, DealerCommissionRate )


        //            SELECT @IDOut, GETDATE(), @ServiceID, ServiceID + CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@IDOut,28,5), @TransactionID, @IDMember, @Phone, @IDBank, @ActionDate, 
        //   @ActionTime, @Amount, @SenderName, @SenderIdentityNr, @Status, DATEADD(DAY, cc.TransferBlocked, GetDate()), 
        //   IIF(cc.TransferBlocked= 0,1,0), @_isAutoNotification, @Iban, @TransactionKey, @Description, @CompanyBankAccountID, cc.TransferRate FROM CompanyCommissions cc

        //            INNER JOIN CompanyIntegrations ci ON ci.ID=cc.ID
        //            WHERE ci.ServiceID= @ServiceID


        //            SELECT @IDOut


        //        END

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX), @ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE= ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //    ALTER PROCEDURE[dbo].[CompanyFraudControls_Insert]
        //    @IDOut nvarchar(50) OUTPUT,
        //    @ID nvarchar(50),
        //    @IsCreditCardFraudControlActive bit = 1,
        //    @CreditCardTimeSpanInRecentTransactionMinutes int = 15,
        //    @CreditCardDailyTransactionCount int = 3,
        //    @CreditCardFirstTransactionLimit decimal (18, 2) = 10000,
        //    @IsForeignCreditCardFraudControlActive bit = 1,
        //    @ForeignCreditCardTimeSpanInRecentTransactionMinutes int = 15,
        //    @ForeignCreditCardDailyTransactionCount int = 3,
        //    @ForeignCreditCardFirstTransactionLimit decimal (18, 2) = 10000,
        //    @ForeignCreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //    @CreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //    @BeStoppedCreditCardDailyTransactionCount int = 4,
        //    @BeStoppedForeignCreditCardDailyTransactionCount int = 4,
        //    @IsTransferFraudControlActive bit = 1,
        //    @TransferTimeSpanInRecentTransactionMinutes int = 15,
        //    @TransferDailyTransactionCount int = 3,
        //    @TransferFirstTransactionLimit decimal (18, 2) = 10000,
        //    @TransferTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2) = 1000,
        //    @TransferDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //    @BeStoppedTransferDailyTransactionCount int = 4,
        //    @CreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2) = 1000,
        //    @ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2) = 1000,
        //    @IsSmsConfirmationActiveTransfer bit = 1,
        //    @IsSmsConfirmationActiveCreditCard bit = 1,
        //    @IsSmsConfirmationActiveForeingCreditCard bit = 1
        //AS
        //BEGIN
        //    INSERT INTO CompanyFraudControls
        //    (ID,
        //    IsCreditCardFraudControlActive,
        //    CreditCardTimeSpanInRecentTransactionMinutes,
        //    CreditCardDailyTransactionCount,
        //    CreditCardFirstTransactionLimit,
        //    IsForeignCreditCardFraudControlActive,
        //    ForeignCreditCardTimeSpanInRecentTransactionMinutes,
        //    ForeignCreditCardDailyTransactionCount,
        //    ForeignCreditCardFirstTransactionLimit,
        //    ForeignCreditCardDailyTransactionLimitAmount,
        //    CreditCardDailyTransactionLimitAmount,
        //    BeStoppedCreditCardDailyTransactionCount,
        //    BeStoppedForeignCreditCardDailyTransactionCount,
        //    IsTransferFraudControlActive,
        //    TransferTimeSpanInRecentTransactionMinutes,
        //    TransferDailyTransactionCount,
        //    TransferFirstTransactionLimit,
        //    TransferTimeSpanInRecentTransactionMinutesLimitAmount,
        //    TransferDailyTransactionLimitAmount,
        //    BeStoppedTransferDailyTransactionCount,
        //    CreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //    ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //    IsSmsConfirmationActiveTransfer,
        //    IsSmsConfirmationActiveCreditCard,
        //    IsSmsConfirmationActiveForeingCreditCard)
        //    VALUES
        //    (@ID,
        //    @IsCreditCardFraudControlActive,
        //    @CreditCardTimeSpanInRecentTransactionMinutes,
        //    @CreditCardDailyTransactionCount,
        //    @CreditCardFirstTransactionLimit,
        //    @IsForeignCreditCardFraudControlActive,
        //    @ForeignCreditCardTimeSpanInRecentTransactionMinutes,
        //    @ForeignCreditCardDailyTransactionCount,
        //    @ForeignCreditCardFirstTransactionLimit,
        //    @ForeignCreditCardDailyTransactionLimitAmount,
        //    @CreditCardDailyTransactionLimitAmount,
        //    @BeStoppedCreditCardDailyTransactionCount,
        //    @BeStoppedForeignCreditCardDailyTransactionCount,
        //    @IsTransferFraudControlActive,
        //    @TransferTimeSpanInRecentTransactionMinutes,
        //    @TransferDailyTransactionCount,
        //    @TransferFirstTransactionLimit,
        //    @TransferTimeSpanInRecentTransactionMinutesLimitAmount,
        //    @TransferDailyTransactionLimitAmount,
        //    @BeStoppedTransferDailyTransactionCount,
        //    @CreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //    @ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //    @IsSmsConfirmationActiveTransfer,
        //    @IsSmsConfirmationActiveCreditCard,
        //    @IsSmsConfirmationActiveForeingCreditCard);

        //        SELECT @IDOut = @ID;
        //        END


        //GO

        //ALTER PROCEDURE[dbo].[CompanyFraudControls_Update]
        //    @IDOut nvarchar(50) OUTPUT,
        //    @ID nvarchar(50),  
        //    @MUser nvarchar(50),
        //    @MDate datetime,
        //    @IsCreditCardFraudControlActive bit = 1,
        //    @CreditCardTimeSpanInRecentTransactionMinutes int = 15,
        //    @CreditCardDailyTransactionCount int = 3,
        //    @CreditCardFirstTransactionLimit decimal (18, 2) = 10000,
        //    @IsForeignCreditCardFraudControlActive bit = 1,
        //    @ForeignCreditCardTimeSpanInRecentTransactionMinutes int = 15,
        //    @ForeignCreditCardDailyTransactionCount int = 3,
        //    @ForeignCreditCardFirstTransactionLimit decimal (18, 2) = 10000,
        //    @ForeignCreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //    @CreditCardDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //    @BeStoppedCreditCardDailyTransactionCount int = 4,
        //    @BeStoppedForeignCreditCardDailyTransactionCount int = 4,
        //    @IsTransferFraudControlActive bit = 1,
        //    @TransferTimeSpanInRecentTransactionMinutes int = 15,
        //    @TransferDailyTransactionCount int = 3,
        //    @TransferFirstTransactionLimit decimal (18, 2) = 10000,
        //    @TransferTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2) = 1000,
        //    @TransferDailyTransactionLimitAmount decimal (18, 2) = 1000,
        //    @BeStoppedTransferDailyTransactionCount int = 4,
        //    @CreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2) = 1000,
        //    @ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount decimal (18, 2) = 1000,
        //    @IsSmsConfirmationActiveTransfer bit = 1,
        //    @IsSmsConfirmationActiveCreditCard bit = 1,
        //    @IsSmsConfirmationActiveForeingCreditCard bit = 1
        //    AS
        //    BEGIN
        //    UPDATE CompanyFraudControls
        //    SET
        //        MUser = @MUser,
        //        MDate = @MDate,
        //        IsCreditCardFraudControlActive = @IsCreditCardFraudControlActive,
        //        CreditCardTimeSpanInRecentTransactionMinutes = @CreditCardTimeSpanInRecentTransactionMinutes,
        //        CreditCardDailyTransactionCount = @CreditCardDailyTransactionCount,
        //        CreditCardFirstTransactionLimit = @CreditCardFirstTransactionLimit,
        //        IsForeignCreditCardFraudControlActive = @IsForeignCreditCardFraudControlActive,
        //        ForeignCreditCardTimeSpanInRecentTransactionMinutes = @ForeignCreditCardTimeSpanInRecentTransactionMinutes,
        //        ForeignCreditCardDailyTransactionCount = @ForeignCreditCardDailyTransactionCount,
        //        ForeignCreditCardFirstTransactionLimit = @ForeignCreditCardFirstTransactionLimit,
        //        ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount = @ForeignCreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //        CreditCardTimeSpanInRecentTransactionMinutesLimitAmount = @CreditCardTimeSpanInRecentTransactionMinutesLimitAmount,
        //        ForeignCreditCardDailyTransactionLimitAmount = @ForeignCreditCardDailyTransactionLimitAmount,
        //        CreditCardDailyTransactionLimitAmount = @CreditCardDailyTransactionLimitAmount,
        //        BeStoppedCreditCardDailyTransactionCount = @BeStoppedCreditCardDailyTransactionCount,
        //        BeStoppedForeignCreditCardDailyTransactionCount = @BeStoppedForeignCreditCardDailyTransactionCount,
        //        IsTransferFraudControlActive = @IsTransferFraudControlActive,
        //        TransferTimeSpanInRecentTransactionMinutes = @TransferTimeSpanInRecentTransactionMinutes,
        //        TransferDailyTransactionCount = @TransferDailyTransactionCount,
        //        TransferFirstTransactionLimit = @TransferFirstTransactionLimit,
        //        TransferTimeSpanInRecentTransactionMinutesLimitAmount = @TransferTimeSpanInRecentTransactionMinutesLimitAmount,
        //        TransferDailyTransactionLimitAmount = @TransferDailyTransactionLimitAmount,
        //        BeStoppedTransferDailyTransactionCount = @BeStoppedTransferDailyTransactionCount,
        //        IsSmsConfirmationActiveTransfer = @IsSmsConfirmationActiveTransfer,
        //        IsSmsConfirmationActiveCreditCard = @IsSmsConfirmationActiveCreditCard,
        //        IsSmsConfirmationActiveForeingCreditCard = @IsSmsConfirmationActiveForeingCreditCard
        //    WHERE ID = @ID;

        //SELECT @IDOut = @ID;
        //END

        //GO

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate datetime,
        //@EndDate datetime,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IDBank nvarchar(10) = null,
        //@IsHaveReferenceNr bit = null,
        //@ResponseStatus int = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, r.IsHaveReferenceNr, crl.ResponseStatus as ResponseStatus, CAST(0.0 AS DECIMAL(18, 2)) as MatchesBalance
        //, CAST(0.0 AS DECIMAL(18, 2)) as NotMatchesBalance
        //, 0 as MatchesCount
        //, 0 as NotMatchesCount ,
        //c.Title as Company, r.FraudControlDescription into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //LEFT JOIN PaymentNotifications py on py.TransactionNr = r.ResponseTransactionNr
        //LEFT JOIN CompanyIntegrations ci ON (ci.ServiceID= py.ServiceID or ci.ServiceID= r.ResponseTransactionNr)
        //LEFT JOIN CallbackResponseLogs crl ON(crl.TransactionID = py.TransactionID)
        //LEFT JOIN Companies c ON c.ID=ci.ID
        //--cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //WHERE 1=1
        //AND (@IDBank IS NULL  OR r.IDBank= @IDBank)
        //AND(@ResponseStatus IS NULL OR crl.ResponseStatus= @ResponseStatus)
        //AND(@IsHaveReferenceNr IS NULL OR r.IsHaveReferenceNr= @IsHaveReferenceNr)
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  
        //OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR r.Description LIKE '%' + @SearchValue + '%'   ))
        //AND NOT EXISTS(select* from WhereConditions wc

        //    WHERE (wc.ColumnName = 'SenderName' and r.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //    (wc.ColumnName = 'Description' and r.Description LIKE '%' + wc.ConditionName + '%'))
        //and(r.Amount > 0  )
        //and(r.Amount< 260000  ) and(crl.ServiceType is null or crl.ServiceType = 'STILPAY' or crl.ServiceType= 'Ödeme JOB')

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLength ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 09.12.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER Proc[dbo].[PaymentTransferPools_GetList]
        //@Status tinyint,
        //@StartDate datetime,
        //@EndDate datetime,
        //@PageLength int,
        //@OffsetValue int,
        //@SearchValue nvarchar(MAX),
        //@IDBank nvarchar(10) = null,
        //@IsHaveReferenceNr bit = null,
        //@ResponseStatus int = null,
        //@IsCaughtInFraudControl bit = null
        //AS
        //BEGIN

        //DECLARE @totalRecords int

        //SELECT  r.ID, r.CDate, r.MDate, r.TransactionDate, r.IDBank, r.SenderName, r.SenderIban, r.Amount, r.TransactionKey, r.Description, r.Status, r.ResponseDescription, r.ResponseTransactionNr, r.ResponseTransactionId
        //, b.Name as Bank, r.IsHaveReferenceNr, crl.ResponseStatus as ResponseStatus, CAST(0.0 AS DECIMAL(18, 2)) as MatchesBalance
        //, CAST(0.0 AS DECIMAL(18, 2)) as NotMatchesBalance
        //, 0 as MatchesCount
        //, 0 as NotMatchesCount ,
        //c.Title as Company, r.FraudControlDescription, r.IsCaughtInFraudControl into #TempTable FROM PaymentTransferPools r
        //INNER JOIN Banks b ON b.ID = r.IDBank
        //LEFT JOIN PaymentNotifications py on py.TransactionNr = r.ResponseTransactionNr
        //LEFT JOIN CompanyIntegrations ci ON (ci.ServiceID= py.ServiceID or ci.ServiceID= r.ResponseTransactionNr)
        //LEFT JOIN CallbackResponseLogs crl ON(crl.TransactionID = py.TransactionID)
        //LEFT JOIN Companies c ON c.ID=ci.ID
        //--cross join dbo.Fn_PaymentTransferPools_GetListBalance(@Status, @StartDate, @EndDate, @OffsetValue) as GetBalance
        //WHERE 1=1
        //AND (@IDBank IS NULL  OR r.IDBank= @IDBank)
        //AND(@ResponseStatus IS NULL OR crl.ResponseStatus= @ResponseStatus)
        //AND(@IsHaveReferenceNr IS NULL OR r.IsHaveReferenceNr= @IsHaveReferenceNr)
        //AND(@IsCaughtInFraudControl IS NULL OR r.IsCaughtInFraudControl= @IsCaughtInFraudControl)
        //AND(@Status IS NULL OR r.Status= @Status)
        //AND(@StartDate IS NULL OR CAST(r.TransactionDate AS datetime)>=CAST(@StartDate AS datetime))
        //AND(@EndDate IS NULL OR CAST(r.TransactionDate AS datetime)<=CAST(@EndDate AS datetime))
        //AND(@SearchValue IS NULL OR  (r.SenderName LIKE '%' + @SearchValue + '%' OR r.TransactionKey LIKE '%' + @SearchValue + '%'  
        //OR r.ResponseTransactionNr LIKE '%' + @SearchValue + '%'  OR r.Amount LIKE '%' + @SearchValue + '%' OR r.Description LIKE '%' + @SearchValue + '%'   ))
        //AND NOT EXISTS(select* from WhereConditions wc

        //    WHERE (wc.ColumnName = 'SenderName' and r.SenderName LIKE '%' + wc.ConditionName + '%') OR
        //    (wc.ColumnName = 'Description' and r.Description LIKE '%' + wc.ConditionName + '%'))
        //and(r.Amount > 0  )
        //and(r.Amount< 260000  ) and(crl.ServiceType is null or crl.ServiceType = 'STILPAY' or crl.ServiceType= 'Ödeme JOB')

        //SELECT @totalRecords = COUNT(*) FROM #TempTable
        //SELECT *, @totalRecords  AS TotalRecords FROM #TempTable
        //ORDER BY CDate DESC
        //OFFSET @OffsetValue ROWS

        //FETCH NEXT @PageLength ROWS ONLY
        //DROP TABLE #TempTable
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_TransferDetailedSearch]
        //@Status TINYINT,
        //@IDCompany NVARCHAR(50),
        //@SenderName NVARCHAR(500),
        //@SenderPhone NVARCHAR(50),
        //@SenderReferenceNr NVARCHAR(50),
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //    DECLARE @totalRecords INT;

        //    SELECT
        //        r.ID,
        //        r.CDate,
        //        r.TransactionID,
        //        r.TransactionNr,
        //        r.Company,
        //        r.SenderName,
        //           r.SenderPhone,
        //        r.SenderReferenceNr,
        //        r.Amount,
        //        r.Status,
        //        r.RebateID,
        //        EntityUrl
        //    INTO #TempTable
        //    FROM
        //    (
        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            r.SenderName,
        //               r.Phone as SenderPhone,
        //            ptp.Description as SenderReferenceNr,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID,
        //         '/DealerPaymentTransaction/Edit/' + r.ID as EntityUrl
        //        FROM PaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        INNER JOIN PaymentTransferPools ptp ON ptp.ResponseTransactionId = r.TransactionID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)

        //            AND
        //            (
        //                (@SenderName IS NOT NULL AND r.SenderName COLLATE Turkish_CI_AS LIKE '%' + @SenderName + '%')

        //                OR(@SenderPhone IS NOT NULL AND r.Phone COLLATE Turkish_CI_AS LIKE '%' + @SenderPhone + '%')

        //                OR(@SenderReferenceNr IS NOT NULL AND ptp.Description COLLATE Turkish_CI_AS LIKE '%' + @SenderReferenceNr + '%')
        //      )

        //        UNION ALL

        //        SELECT
        //            r.ID,
        //            r.CDate,
        //         null as TransactionID,
        //         null as TransactionNr,
        //         null as Company,
        //            r.SenderName,
        //	        null as SenderPhone,
        //            r.Description as SenderReferenceNr,
        //            r.Amount,
        //            r.Status,
        //         null AS RebateID,
        //         null as EntityUrl
        //        FROM PaymentTransferPools r
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)

        //               AND
        //               (
        //                (@SenderName IS NOT NULL AND r.SenderName COLLATE Turkish_CI_AS LIKE '%' + @SenderName + '%')

        //                OR(@SenderReferenceNr IS NOT NULL AND r.Description COLLATE Turkish_CI_AS LIKE '%' + @SenderReferenceNr + '%')
        //      )
        //    ) AS r;

        //        SELECT @totalRecords = COUNT(*) FROM #TempTable;

        //    SELECT*, @totalRecords AS TotalRecords
        //    FROM #TempTable
        //    ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS FETCH NEXT @PageLength ROWS ONLY;

        //        DROP TABLE #TempTable;

        //    SET NOCOUNT OFF;
        //END;

        //------------------------------------------------------- 02.01.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //        INSERT INTO dbo.ActionTypes
        //(IDActionType, ActionType, ActionName, IDParasut)
        //VALUES(N'160', N'Üye İşyeri Bakiye Aktarımı (GÖNDERİCİ)', N'Sanal Pos Hizmeti', N'1005650946');
        //        INSERT INTO dbo.ActionTypes
        //(IDActionType, ActionType, ActionName, IDParasut)
        //VALUES(N'170', N'Üye İşyeri Bakiye Aktarımı (ALICI)', N'Sanal Pos Hizmeti', N'1005650946');


        //CREATE Proc[dbo].[Companies_BalanceTransfer]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@ReceiverIDCompany nvarchar(50),
        //@Amount decimal (18,2)
        //AS
        //BEGIN
        //BEGIN TRY


        //    DECLARE @OldUsingBalance decimal (18,2)
        // DECLARE @OldReceiverCompanyUsingBalance decimal (18,2)
        // DECLARE @NEWID nvarchar(50)

        //    DECLARE @NEWIDReceiver nvarchar(50)


        //    DECLARE @NewLine AS NCHAR(2) = NCHAR(13) + NCHAR(10)
        //    DECLARE @CUSTOMERRORMESSAGE nvarchar(50) = N'MY' + @NewLine

        //    SET @NEWID = NEWID();
        //        SET @NEWIDReceiver = NEWID();
        //        SET @OldUsingBalance = (Select UsingBalance FROM Companies WHERE ID=@ID)
        // SET @OldReceiverCompanyUsingBalance = (Select UsingBalance FROM Companies WHERE ID=@ReceiverIDCompany)

        // IF(@OldUsingBalance<@Amount )

        //    BEGIN
        //         SET @CUSTOMERRORMESSAGE += N'Mevcut bakiyeniz talep tutarı için yetersiz.'
        //         RAISERROR(@CUSTOMERRORMESSAGE, 16, 1)
        //         RETURN
        //    END

        // -- GÖNDEREN
        //    INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank,
        //    Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)


        //    Select @NEWID, GETDATE(), @ID, '160', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@NEWID,28,5), null,  
        // @Amount, 0, 0, @Amount,  
        // null, 0,0,0
        // FROM Companies  c
        //    INNER JOIN CompanyIntegrations ci ON ci.ID=@ID
        //    INNER JOIN CompanyCommissions cc ON cc.ID=ci.ID
        //    WHERE c.ID=@ID


        // -- ALICI
        //    INSERT INTO CompanyTransactions(ID, CDate, IDCompany, IDActionType, TransactionDate, TransactionNr, IDBank,
        //    Total, Commission, CostTotal, NetTotal, IDMember, CommissionRate , CompanyCommission , CompanyCommissionRate)


        //    Select @NEWIDReceiver, GETDATE(), @ReceiverIDCompany, '170', GETDATE(), ci.ServiceID+ CONVERT(varchar, GETDATE(), 12) + replace(CONVERT(varchar, GETDATE(), 14),':','') + SUBSTRING(@NEWIDReceiver,28,5), null,  
        // @Amount, 0, 0, @Amount,  
        // null, 0,0,0
        // FROM Companies  c
        //    INNER JOIN CompanyIntegrations ci ON ci.ID=@ID
        //    INNER JOIN CompanyCommissions cc ON cc.ID=ci.ID
        //    WHERE c.ID=@ID

        //    END TRY
        //        BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT

        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()

        //        RAISERROR(@ERRORMESSAGE,16,1)

        //    END CATCH
        //END

        //GUNCELLENDİ

        //------------------------------------------------------- 06.01.2024 Arda Değişiklik Scriptleri -----------------------------------------------------------------------------------

        //ALTER TABLE CompanyAutoNotificationSettings
        //ADD
        //CDate datetime NULL,
        //CUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //MDate datetime NULL,
        //MUser nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //ID nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL;

        ///GO

        //ALTER Proc[dbo].[CompanyAutoNotificationSettings_Insert]
        //@IDOut nvarchar(50) output,
        //@IDCompany nvarchar(50),
        //@ReferenceId nvarchar(50),
        //@CDate datetime,
        //@CUser nvarchar(50),
        //@IsActive bit,
        //@RequestUrl nvarchar(500),
        //@CallbackUrl nvarchar(500)
        //AS
        //BEGIN
        //    BEGIN TRY


        //        SET @IDOut = NEWID()

        //        INSERT INTO CompanyAutoNotificationSettings
        //        (IDCompany, ReferenceId, IsActive, RequestUrl, CallbackUrl, CDate, CUser, ID)

        //        VALUES(@IDCompany, @ReferenceId, @IsActive, @RequestUrl, @CallbackUrl, @CDATE, @CUser, @IDOut);
        //        SELECT @IDOut

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        ///GO

        //CREATE Proc[dbo].[CompanyAutoNotificationSettings_Update]
        //@IDOut nvarchar(50) output,
        //@IDCompany nvarchar(50),
        //@ReferenceId nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@IsActive bit,
        //@RequestUrl nvarchar(500),
        //@CallbackUrl nvarchar(500)
        //AS
        //BEGIN
        //    BEGIN TRY


        //    UPDATE CompanyAutoNotificationSettings
        //    SET
        //        MUser = @MUser,
        //        MDate = @MDate,
        //        ReferenceId = @ReferenceId,
        //        IsActive = @IsActive,
        //        RequestUrl = @RequestUrl,
        //        CallbackUrl = @CallbackUrl


        //    WHERE IDCompany = @IDCompany;

        //        SELECT @IDOut = @IDCompany;

        //        END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //CREATE Proc[dbo].[Sliders_Delete]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50)
        //AS
        //BEGIN
        //    BEGIN TRY

        //        DELETE FROM Sliders WHERE ID=@ID
        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GO

        //ALTER PROCEDURE[dbo].[CompanyTransactions_TransferDetailedSearch]
        //@Status TINYINT,
        //@IDCompany NVARCHAR(50),
        //@SenderName NVARCHAR(500),
        //@SenderPhone NVARCHAR(50),
        //@SenderReferenceNr NVARCHAR(50),
        //@PageLength INT,
        //@OffsetValue INT,
        //@SearchValue NVARCHAR(MAX)
        //AS
        //BEGIN
        //    SET NOCOUNT ON;

        //    DECLARE @totalRecords INT;

        //    SELECT
        //        r.ID,
        //        r.CDate,
        //        r.TransactionID,
        //        r.TransactionNr,
        //        r.Company,
        //        r.SenderName,
        //           r.SenderPhone,
        //        r.SenderReferenceNr,
        //        r.Amount,
        //        r.Status,
        //        r.RebateID,
        //        EntityUrl
        //    INTO #TempTable
        //    FROM
        //    (
        //        SELECT
        //            r.ID,
        //            r.CDate,
        //            r.TransactionID,
        //            r.TransactionNr,
        //            c.Title AS Company,
        //            r.SenderName,
        //               r.Phone as SenderPhone,
        //            ptp.Description as SenderReferenceNr,
        //            r.Amount,
        //            r.Status,
        //            crr.ID AS RebateID,
        //         '/DealerPaymentTransaction/Edit/' + r.ID as EntityUrl
        //        FROM PaymentNotifications r
        //        INNER JOIN CompanyIntegrations ci ON ci.ServiceID = r.ServiceID
        //        INNER JOIN Companies c ON c.ID = ci.ID
        //        INNER JOIN PaymentTransferPools ptp ON ptp.ResponseTransactionId = r.TransactionID
        //        LEFT JOIN CompanyRebateRequests crr ON crr.TransactionID = r.TransactionID
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)
        //            AND((@IDCompany IS NULL or @IDCompany = '0') OR c.ID = @IDCompany)

        //            AND
        //            (
        //                (@SenderName IS NOT NULL AND r.SenderName COLLATE Turkish_CI_AS LIKE '%' + @SenderName + '%')

        //                OR(@SenderPhone IS NOT NULL AND r.Phone COLLATE Turkish_CI_AS LIKE '%' + @SenderPhone + '%')

        //                OR(@SenderReferenceNr IS NOT NULL AND ptp.Description COLLATE Turkish_CI_AS LIKE '%' + @SenderReferenceNr + '%')
        //      )

        //        UNION ALL

        //        SELECT
        //            r.ID,
        //            r.CDate,
        //         null as TransactionID,
        //         null as TransactionNr,
        //         null as Company,
        //            r.SenderName,
        //	        null as SenderPhone,
        //            r.Description as SenderReferenceNr,
        //            r.Amount,
        //            r.Status,
        //         null AS RebateID,
        //         null as EntityUrl
        //        FROM PaymentTransferPools r
        //        WHERE
        //            (@Status IS NULL OR r.Status = @Status)

        //               AND
        //               (
        //                (@SenderName IS NOT NULL AND r.SenderName COLLATE Turkish_CI_AS LIKE '%' + @SenderName + '%')

        //                OR(@SenderReferenceNr IS NOT NULL AND r.Description COLLATE Turkish_CI_AS LIKE '%' + @SenderReferenceNr + '%')
        //      )
        //    ) AS r;

        //        SELECT @totalRecords = COUNT(*) FROM #TempTable;

        //    SELECT*, @totalRecords AS TotalRecords
        //    FROM #TempTable
        //    ORDER BY CDate DESC
        //    OFFSET @OffsetValue ROWS FETCH NEXT @PageLength ROWS ONLY;

        //        DROP TABLE #TempTable;

        //    SET NOCOUNT OFF;
        //END;

        //GO

        //   ALTER TABLE dbo.Companies ADD

        //ProgressPaymentIban nvarchar(50) COLLATE SQL_Latin1_General_CP1_CI_AS NULL,
        //ProgressPaymentAccountHolder nvarchar(300) COLLATE SQL_Latin1_General_CP1_CI_AS NULL ;

        //  

        //GO

        //ALTER Proc[dbo].[Companies_Update]
        //@IDOut nvarchar(50) output,
        //@ID nvarchar(50),
        //@MUser nvarchar(50),
        //@MDate datetime,
        //@Title nvarchar(100),
        //@Name nvarchar(50),
        //@Phone nvarchar(11),
        //@Email nvarchar(50),
        //@TaxNr nvarchar(11),
        //@TaxOffice nvarchar(50),
        //@Address nvarchar(100),
        //@MonthlyGiro nvarchar(25),
        //@IDParasut nvarchar(50),
        //@AutoWithdrawalLimit decimal = null,
        //@NegativeBalanceLimit decimal = null,
        //@AutoTransferLimit decimal = null,
        //@AutoCreditCardLimit decimal = null,
        //@AutoForeignCreditCardLimit decimal = null,
        //@IsAbroad bit = null,
        //@District nvarchar(100) = null,
        //@City nvarchar(100) = null,
        //@InvoiceTitle nvarchar(500) = null,
        //@ProgressPaymentIban nvarchar(50) = null,
        //@ProgressPaymentAccountHolder nvarchar(500) = null
        //AS
        //BEGIN
        //    BEGIN TRY


        //        DECLARE @IDCU nvarchar(50)

        //        SET @IDCU = (SELECT top 1 CompanyUsers.ID FROM Companies join CompanyUsers on IDCompany=Companies.ID AND Companies.Phone=CompanyUsers.Phone WHERE IDCompany=@ID AND IsMainUser=1)

        //  UPDATE Companies SET MUser = @MUser, MDate = @MDate, Name = @Name, Title = @Title, Phone = @Phone, Email = @Email, TaxNr = @TaxNr,
        //        TaxOffice = @TaxOffice, Address = @Address, MonthlyGiro = @MonthlyGiro, IDParasut = @IDParasut,
        //        IsAbroad = @IsAbroad, District = @District, City = @City,
        //        InvoiceTitle = @InvoiceTitle, ProgressPaymentIban = @ProgressPaymentIban, ProgressPaymentAccountHolder = @ProgressPaymentAccountHolder

        //        WHERE ID = @ID


        //        UPDATE CompanyUsers SET Phone = @Phone WHERE IDCompany = @ID AND IsMainUser = 1 AND ID = @IDCU

        //        SELECT @IDOut = @ID

        //    END TRY
        //    BEGIN CATCH
        //        DECLARE @ERRORMESSAGE VARCHAR(MAX),@ERRORNUMBER INT
        //        SELECT @ERRORNUMBER = ERROR_NUMBER(), @ERRORMESSAGE = ERROR_MESSAGE()
        //        RAISERROR(@ERRORMESSAGE,16,1)
        //    END CATCH
        //END

        //GUNCELLENDI 



    }
}
